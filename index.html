<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="随心而动，随刃而行">
<meta property="og:type" content="website">
<meta property="og:title" content="风">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="风">
<meta property="og:description" content="随心而动，随刃而行">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="风">
<meta name="twitter:description" content="随心而动，随刃而行">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>风</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">风</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">技术博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/12/编程思想/状态机机制--位运算的巧妙使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/12/编程思想/状态机机制--位运算的巧妙使用/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-12T12:25:31+08:00">
                2020-03-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="位运算在android源码中的使用"><a href="#位运算在android源码中的使用" class="headerlink" title="位运算在android源码中的使用"></a>位运算在android源码中的使用</h1><h2 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h2><pre><code>1|2|4|8分别对应的二进制数：
    1 ： 0001
    2 ： 0010
    4 ： 0100
    8 ： 1000
</code></pre><h2 id="位运算应用口诀"><a href="#位运算应用口诀" class="headerlink" title="位运算应用口诀"></a>位运算应用口诀</h2><p>清零取反要用与，某位置一可用或</p>
<p>若要取反和交换，轻轻松松用异或</p>
<h2 id="添加多个标志位-–-或"><a href="#添加多个标志位-–-或" class="headerlink" title="添加多个标志位 – 或"></a>添加多个标志位 – 或</h2><pre><code>mIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_RESET_TASK_IF_NEEDED | Intent.FLAG_ACTIVITY_SINGLE_TOP );  
</code></pre><h2 id="判断某个标志位-–-与"><a href="#判断某个标志位-–-与" class="headerlink" title="判断某个标志位 – 与"></a>判断某个标志位 – 与</h2><pre><code>// 返回是否可点击  
return (((viewFlags &amp; CLICKABLE) == CLICKABLE || (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE));  

if ((intent.getFlags()&amp;Intent.FLAG_ACTIVITY_NEW_TASK) == 0)｛//intent.getFlags()不包含NEW_TASK  
...  
｝
</code></pre><h2 id="清除某个标志位-–-与-标志位"><a href="#清除某个标志位-–-与-标志位" class="headerlink" title="清除某个标志位 – 与~标志位"></a>清除某个标志位 – 与~标志位</h2><p>View.java</p>
<pre><code>private static final int PRESSED                = 0x00004000;
int mPrivateFlags ;

public void setPressed(boolean pressed) {
    if (pressed) {
        mPrivateFlags |= PRESSED;     // 添加PRESSED状态
    } else {
        mPrivateFlags &amp;= ~PRESSED;    // 取消PRESSED状态
    }
    refreshDrawableState();
    dispatchSetPressed(pressed);
}
</code></pre><h1 id="状态"><a href="#状态" class="headerlink" title="状态"></a>状态</h1><p>定义十六进制状态常量，和模式状态集</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> STATUS_1 = <span class="number">0x0001</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> STATUS_2 = <span class="number">0x0002</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> STATUS_3 = <span class="number">0x0004</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> STATUS_4 = <span class="number">0x0008</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> STATUS_5 = <span class="number">0x0010</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> STATUS_6 = <span class="number">0x0020</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> STATUS_7 = <span class="number">0x0040</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> STATUS_8 = <span class="number">0x0080</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> MODE_A = STATUS_1 | STATUS_2 | STATUS_3;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> MODE_B = STATUS_1 | STATUS_4 | STATUS_5 | STATUS_6;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> MODE_C = STATUS_1 | STATUS_7 | STATUS_8;</span><br></pre></td></tr></table></figure>
<h1 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h1><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>一个分享对话框，可以分享到 微信好友，微信朋友圈，app好友，app社群</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><pre><code> private static final int BASE = 0x1;

/**
 * 展示微信好友
 */
public static final int WECHAT_CONTACTS = BASE;

/**
 * 展示微信朋友圈
 */
public static final int WECHAT_MOMENTS = BASE &lt;&lt; 1;

/**
 * 展示好友
 */
public static final int APP_CONTACTS = BASE &lt;&lt; 2;

/**
 * 展示社群
 */
public static final int APP_COMMUNITY = BASE &lt;&lt; 3;

public void show(int flag) {
    if ((WECHAT_CONTACTS &amp; flag) == 0) {
        wechatContacts.setVisibility(View.GONE);
    } else {
        wechatContacts.setVisibility(View.VISIBLE);
    }

    if ((WECHAT_MOMENTS &amp; flag) == 0) {
        wechatMoments.setVisibility(View.GONE);
    } else {
        wechatMoments.setVisibility(View.VISIBLE);
    }

    if ((APP_CONTACTS &amp; flag) == 0) {
        appContacts.setVisibility(View.GONE);
    } else {
        appContacts.setVisibility(View.VISIBLE);
    }

    if ((APP_COMMUNITY &amp; flag) == 0) {
        appCommunity.setVisibility(View.GONE);
    } else {
        appCommunity.setVisibility(View.VISIBLE);
    }

    dialog.show();
}
</code></pre><h1 id="参考-amp-扩展"><a href="#参考-amp-扩展" class="headerlink" title="参考&amp;扩展"></a>参考&amp;扩展</h1><ul>
<li><a href="http://blog.csdn.net/zzp16/article/details/7956768" target="_blank" rel="noopener">Android中巧妙的位运算</a></li>
<li><a href="https://juejin.im/post/5d1a148e6fb9a07ea6488ba3#heading-5" target="_blank" rel="noopener">Android 状态管理最佳实践</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/12/直播/音频/AMR音频在Android和iOS跨平台应用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/12/直播/音频/AMR音频在Android和iOS跨平台应用/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-12T12:25:31+08:00">
                2020-03-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>title: AMR音频在Android和iOS跨平台应用<br>date: 2019-09-03 14:52:14<br>categories:</p>
<ul>
<li>直播<br>tags:</li>
<li>直播</li>
</ul>
<hr>
<pre><code>AMR音频在Android和iOS上的应用  http://shaoyuan1943.github.io/2016/02/26/chat-in-game-three/
</code></pre><p>AMR格式的文件大小比AAC更小，经过测试之后发现的确如此，10s左右的语音采用AMR格式的文件大小可以稳定在15k左右。</p>
<p>现实情况<strong>Android支持AMR</strong>，但是<strong>iOS4.3.x</strong>版本之后不再支持AMR，<strong>剔除了AMR的硬解</strong>。但通过opencore这个codec依旧可以在iOS平台上对AMR进行软解，以实现AMR转换到其他的格式可以播放。</p>
<p>最终确定采用AMR作为两平台的语音交互格式，不同的是，在iOS平台上需要进行WAV和AMR之间的转换。好在libopencore可以解决这个事情。</p>
<p>在折腾过程中也踩到一个坑，我把<strong>Android上录制的AMR放到iOS上进行转换播放时会出现问题，无法进行转换。尝试调整了各种参数也无法解决</strong></p>
<p>偶然想到是不是因为两者解码时的文件参数不一样，于是下载了MediaInfo对比了Android和iOS上录制的AMR文件，发现两者参数不一样，于是我尝试去调整一下Android上录制AMR的参数：</p>
<pre><code>recorder.setOutputFormat(MediaRecorder.OutputFormat.AMR_NB);
recorder.setAudioEncoder(MediaRecorder.AudioEncoder.AMR_NB);
recorder.setAudioChannels(1);
</code></pre><p><strong>一定要输出和编码格式都是AMR_NB格式的，才能在两者正常通用。</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/12/java基础/java虚拟机/深入理解java虚拟机面试精华总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/12/java基础/java虚拟机/深入理解java虚拟机面试精华总结/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-12T12:25:31+08:00">
                2020-03-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="jvm_1.jpg" alt=""></p>
<h1 id="一、运行时数据区-Runtime-Data-Area"><a href="#一、运行时数据区-Runtime-Data-Area" class="headerlink" title="一、运行时数据区 Runtime Data Area"></a>一、运行时数据区 Runtime Data Area</h1><p><img src="jvm_2.jpg" alt=""></p>
<p><strong>1. 程序计数器</strong></p>
<p>任一时刻，一个CPU的内核只会执行一条线程中的指令，因此，为了能够使得每个线程都在线程切换后能够恢复切换之前的程序执行位置，每个线程都需要有自己独立的程序计数器，不能互相被干扰，否则就会影响到程序的正常执行次序</p>
<p>如果线程执行的是非native方法，则程序计数器中保存的是当前需要执行的指令的地址；如果线程执行的是native方法，则程序计数器中的值是undefined。</p>
<p>所占空间的大小不会随程序的执行而发生改变，因此，对于程序计数器是不会发生内存溢出现象(OutOfMemory)</p>
<p><strong>2. Java栈</strong></p>
<p>就是我们常常所说的栈。</p>
<p>为执行Java方法(字节码)服务的，是Java方法执行的内存模型</p>
<p>每个线程正在执行的方法可能不同，因此每个线程都会有一个自己的Java栈，互不干扰。</p>
<p><img src="jvm_3.jpg" alt=""></p>
<p>Java栈中存放的是一个个的栈帧，每个栈帧对应一个被调用的方法</p>
<p>当线程执行一个方法时，就会随之创建一个对应的栈帧，并将建立的栈帧压栈。当方法执行完毕之后，便会将栈帧出栈。</p>
<p>规定了两种异常：</p>
<ul>
<li>线程请求的栈深度大于虚拟机所允许的深度，将抛出StackOverflowError异常。</li>
<li>虚拟机扩展时无法申请到足够的内存，将抛出OutOfMemoryError异常(堆和方法区也会抛出OOM)</li>
</ul>
<p><strong>3. 本地方法栈</strong></p>
<p>为执行本地方法（Native Method）服务的</p>
<p>VM规范并没有对本地方法栈的具体实现方法以及数据结构作强制规定，虚拟机可以自由实现它。</p>
<p>HotSopt虚拟机直接就把本地方法栈和Java栈合二为一。</p>
<p>会抛出StackOverflowError和OutOfMemoryErroy异常</p>
<p><strong>4.堆</strong></p>
<p>C语言中，堆是程序员唯一可以管理的内存区域。程序员可以通过malloc函数和free函数在堆上申请和释放空间</p>
<p>Java中的堆是用来存储<strong>对象实例以及数组</strong>（当然，数组引用是存放在Java栈中）。</p>
<p>Java<strong>垃圾收集器</strong>管理的主要区域</p>
<p>Java堆细分为新生代和老年代(为了更好的管理内存)</p>
<p><strong>5.方法区</strong></p>
<p>存储了每个<strong>类的信息(类名称、方法信息、字段信息、接口信息)、静态变量、常量、运行时常量池以及编译器编译后的代码</strong>等</p>
<p>运行时常量池：</p>
<ul>
<li>加载 Class文件常量池<ul>
<li>储编译期间生成的字面常量和符号引用</li>
</ul>
</li>
<li>运行期间放入的<ul>
<li>比如String的intern方法，就能将常量放入运行时常量池</li>
</ul>
</li>
</ul>
<p>JVM规范中，<strong>不强制要求实现垃圾回收</strong>。</p>
<p>很多人习惯将方法区称为“永久代”，是因为HotSpot虚拟机以<strong>永久代</strong>来实现方法区，从而JVM的垃圾收集器可以像管理堆区一样管理这部分区域，从而不需要专门为这部分设计垃圾回收机制。</p>
<p>不过自从JDK7之后，Hotspot虚拟机便将运行时常量池从永久代移除了。</p>
<h1 id="二、对象"><a href="#二、对象" class="headerlink" title="二、对象"></a>二、对象</h1><p>hotspot虚拟机为例</p>
<p><strong>2.1 对象的创建</strong></p>
<p><strong>1.检查</strong> </p>
<p>检查new指令的参数能否在常量池中定位到一个类的符号引用</p>
<p>检查这个符号引用代表的类是否已经被加载、解析和初始化过。如果没有，执行相应的类加载过程</p>
<p><strong>2.分配内存</strong> </p>
<p>为新生对象分配内存</p>
<p>假设Java堆中内存是绝对规整的，所有用过的内存放在一遍，空闲的内存放在另一边，中间放着一个指针作为分界点的指示器，那所分配内存就仅仅是把那个指针指向空闲空间那边挪动一段与对象大小相等的距离，这个分配方式叫做“<strong>指针碰撞</strong>”</p>
<p>如果Java堆中的内存并不是规整的，已使用的内存和空闲的内存相互交错，那就没办法简单地进行指针碰撞了，虚拟机就必须维护一个列表，记录上哪些内存块是可用的，在分配的时候从列表中找到一块足够大的空间划分给对象实例，并更新列表上的记录，这种分配方式成为“<strong>空闲列表</strong>”</p>
<p>选择那种分配方式由Java堆是否规整决定，而Java堆是否规整又由所采用的垃圾收集器是否带有压缩整理功能决定。</p>
<p><strong>3. Init</strong></p>
<p>执行new指令之后会接着执行Init方法，进行初始化，这样一个对象才算产生出来</p>
<p><strong>2.2 对象的内存布局</strong></p>
<p>对象在内存中储存的布局可以分为3块区域：</p>
<ul>
<li>对象头。包括两部分：<ul>
<li>对象自身的运行时数据，如哈希码、GC分代年龄、锁状态标志、线程持有的锁、偏向线程ID、偏向时间戳</li>
<li>类型指针，即对象指向它的类元数据的指针，虚拟机通过这个来确定对象是哪个类的实例</li>
</ul>
</li>
<li>实例数据</li>
<li>对齐填充</li>
</ul>
<p><strong>2.3 对象的访问定位</strong></p>
<ul>
<li>使用句柄访问<ul>
<li>reference存储的是对象的句柄地址(Java堆中有句柄池)</li>
<li>句柄中包含了对象实例数据与类型数据各自的具体地址</li>
<li>优势:对象被移动(垃圾收集时移动对象是非常普遍的行为)时只会改变句柄中的实例数据指针，而reference本身不需要修改</li>
</ul>
</li>
<li>使用直接指针访问<br>  -refreence存储的直接就是对象的地址<ul>
<li>Java堆对象的布局必须考虑如何访问类型数据的相关信息</li>
<li>优势：速度更快，节省了一次指针定位的时间开销</li>
</ul>
</li>
</ul>
<h1 id="三、OutOfMemoryError-异常"><a href="#三、OutOfMemoryError-异常" class="headerlink" title="三、OutOfMemoryError 异常"></a>三、OutOfMemoryError 异常</h1><p>3.1 Java堆溢出</p>
<p>检查虚拟机的堆参数（-Xmx与-Xms），与机器物理内存对比看是否还可以调大</p>
<p>3.2 虚拟机栈和本地方法栈溢出</p>
<p>3.3 方法区和运行时常量池溢出</p>
<p>由于常量池分配在永久代中，可以通过-XX:PermSize和-XX:MaxPermSize限制方法区大小，从而间接限制其中常量池的容量。</p>
<h1 id="四、垃圾收集"><a href="#四、垃圾收集" class="headerlink" title="四、垃圾收集"></a>四、垃圾收集</h1><p><strong>1.判断对象存活</strong></p>
<p><strong>4.1.1 引用计数器法</strong></p>
<p>给对象添加一个引用计数器，每当由一个地方引用它时，计数器值就加1；当引用失效时，计数器值就减1；任何时刻计数器为0的对象就是不可能再被使用的</p>
<p><strong>4.1.2 可达性分析算法</strong></p>
<p>通过一系列的“GC Roots”对象作为起始点，从这些节点开始向下搜索，搜索所走过的路径成为引用链，当一个对象到GC ROOTS没有任何引用链相连时，则证明此对象时不可用的</p>
<p>Java语言中GC Roots对象包括下面几种：</p>
<p>1.虚拟机栈（栈帧中的<strong>本地变量</strong>表）中引用的对象</p>
<p>2.本地方法栈<strong>JNI</strong>（Native方法）引用的对象</p>
<p>3.方法区中<strong>类静态成员</strong>引用的对象</p>
<p>4.方法区中<strong>常量</strong>引用的对象</p>
<p><strong>2.对象引用</strong></p>
<ul>
<li><p>强引用</p>
<ul>
<li>Object obj </li>
<li>垃圾收集器永远不会回收掉被强引用引用的对象</li>
</ul>
</li>
<li><p>软引用</p>
<ul>
<li>SoftReference<object> sf = new SoftReference<object>(obj);</object></object></li>
<li><p>用于缓存数据。内存不足自动回收，如果这次回收还没有足够的内存才会抛出内存溢出异常</p>
<pre><code>Object obj = new Object();
SoftReference&lt;Object&gt; sf = new SoftReference&lt;Object&gt;(obj);
obj = null;
sf.get();//有时候会返回null
</code></pre></li>
</ul>
</li>
<li><p>弱引用</p>
<ul>
<li>WeakReference<object> wf</object></li>
<li><p>用于监控对象是否已经被垃圾回收器标记为即将回收的垃圾。无论当前内存是否足够都会回收掉只被弱引用关联的对象</p>
<pre><code>Object obj = new Object();
WeakReference&lt;Object&gt; wf = new WeakReference&lt;Object&gt;(obj);
obj = null;
wf.get();//有时候会返回null
wf.isEnQueued();//返回是否被垃圾回收器标记为即将回收的垃圾
</code></pre></li>
</ul>
</li>
<li><p>虚引用</p>
<ul>
<li>PhantomReference<object> pf = new PhantomReference<object>(obj);</object></object></li>
<li><p>用于检测对象是否已经从内存中删除。能在这个对象被收集器回收时收到一个系统通知</p>
<pre><code>Object obj = new Object();
PhantomReference&lt;Object&gt; pf = new PhantomReference&lt;Object&gt;(obj);
obj=null;
pf.get();//永远返回null
pf.isEnQueued();//返回是否从内存中已经删除
</code></pre></li>
</ul>
</li>
</ul>
<p><strong>3.Finalize方法</strong></p>
<p>任何一个对象的finalize()方法都只会被系统自动调用一次，如果对象面临下一次回收，它的finalize()方法不会被再次执行</p>
<p><strong>4.3.1 回收方法区</strong></p>
<p>永久代的垃圾收集主要回收两部分内容：废弃常量和无用的类</p>
<p>废弃常量：假如一个字符串abc已经进入了常量池中，如果当前系统没有任何一个String对象abc，也就是没有任何Stirng对象引用常量池的abc常量，也没有其他地方引用的这个字面量，这个时候发生内存回收这个常量就会被清理出常量池</p>
<p>无用的类：</p>
<p>1.该类所有的实例都已经被回收，就是Java堆中不存在该类的任何实例</p>
<p>2.加载该类的ClassLoader已经被回收</p>
<p>3.该类对用的java.lang.Class对象没有在任何地方被引用，无法再任何地方通过反射访问该类的方法</p>
<p><strong>4.垃圾收集算法</strong></p>
<p><strong>4.4.1 标记—清除算法</strong></p>
<p>算法分为标记和清除两个阶段：首先标记出所有需要回收的对象，在标记完成后统一回收所有被标记的对象、</p>
<p>不足:一个是效率问题，标记和清除两个过程的效率都不高；另一个是空间问题，标记清楚之后会产生大量不连续的内存碎片，空间碎片太多可能会导致以后再程序运行过程中需要分配较大的对象时，无法找到足够的连续内存而不得不提前触发另一次垃圾收集动作</p>
<p><strong>4.4.2 复制算法</strong></p>
<p>他将可用内存按照容量划分为大小相等的两块，每次只使用其中的一块。当这块的内存用完了，就将还存活着的对象复制到另外一块上面，然后再把已使用过的内存空间一次清理掉。这样使得每次都是对整个半区进行内存回收，内存分配时也就不用考虑内存碎片等复杂情况，只要移动堆顶指针，按顺序分配内存即可</p>
<p>不足：将内存缩小为了原来的一半</p>
<p>实际中我们并不需要按照1:1比例来划分内存空间，而是将内存分为一块较大的Eden空间和两块较小的Survivor空间，每次使用Eden和其中一块Survivor</p>
<p>当另一个Survivor空间没有足够空间存放上一次新生代收集下来的存活对象时，这些对象将直接通过分配担保机制进入老年代</p>
<p><strong>4.4.3 标记整理算法</strong></p>
<p>让所有存活的对象都向一端移动，然后直接清理掉端边界以外的内存</p>
<p><strong>4.4.4 分代收集算法</strong></p>
<p>只是根据对象存活周期的不同将内存划分为几块。一般是把java堆分为新生代和老年代，这样就可以根据各个年代的特点采用最适当的收集算法。在新生代中，每次垃圾收集时都发现有大批对象死去，只有少量存活，那就选用复制算法，只需要付出少量存活对象的复制成本就可以完成收集。而老年代中因为对象存活率高、没有额外空间对它进行分配担保，就必须使用标记清理或者标记整理算法来进行回收</p>
<p>5.垃圾收集器</p>
<p>a)Serial收集器：</p>
<p>这个收集器是一个单线程的收集器，但它的单线程的意义不仅仅说明它会只使用一个COU或一条收集线程去完成垃圾收集工作，更重要的是它在进行垃圾收集时，必须暂停其他所有的工作线程，直到它手机结束</p>
<p>b)ParNew 收集器：</p>
<p>Serial收集器的多线程版本，除了使用了多线程进行收集之外，其余行为和Serial收集器一样</p>
<p>并行：指多条垃圾收集线程并行工作，但此时用户线程仍然处于等待状态</p>
<p>并发：指用户线程与垃圾收集线程同时执行（不一定是并行的，可能会交替执行），用户程序在继续执行，而垃圾收集程序运行于另一个CPU上</p>
<p>c)Parallel Scavenge </p>
<p>收集器是一个新生代收集器，它是使用复制算法的收集器，又是并行的多线程收集器。</p>
<p>吞吐量：就是CPU用于运行用户代码的时间与CPU总消耗时间的比值。即吞吐量=运行用户代码时间/（运行用户代码时间+垃圾收集时间）</p>
<p>d)Serial Old 收集器：</p>
<p>是Serial收集器的老年代版本,是一个单线程收集器，使用标记整理算法</p>
<p>e)Parallel Old 收集器：</p>
<p>Parallel Old是Paraller Seavenge收集器的老年代版本，使用多线程和标记整理算法</p>
<p>f)CMS收集器：</p>
<p>CMS收集器是基于标记清除算法实现的，整个过程分为4个步骤：</p>
<p>1.初始标记2.并发标记3.重新标记4.并发清除</p>
<p>优点：并发收集、低停顿</p>
<p>缺点：</p>
<p>1.CMS收集器对CPU资源非常敏感，CMS默认启动的回收线程数是（CPU数量+3）/4，</p>
<p>2.CMS收集器无法处理浮动垃圾，可能出现Failure失败而导致一次Full G场地产生</p>
<p>3.CMS是基于标记清除算法实现的</p>
<p>g)G1收集器：</p>
<p>它是一款面向服务器应用的垃圾收集器</p>
<p>1.并行与并发：利用多CPU缩短STOP-The-World停顿的时间</p>
<p>2.分代收集</p>
<p>3.空间整合：不会产生内存碎片</p>
<p>4.可预测的停顿</p>
<p>运作方式：初始标记，并发标记，最终标记，筛选回收</p>
<p><strong>6.内存分配与回收策略</strong></p>
<p>4.6.1 对象优先在Eden分配：</p>
<p>大多数情况对象在新生代Eden区分配，当Eden区没有足够空间进行分配时，虚拟机将发起一次Minor GC</p>
<p>4.6.2 大对象直接进入老年代：</p>
<p>所谓大对象就是指需要大量连续内存空间的Java对象，最典型的大对象就是那种很长的字符串以及数组。这样做的目的是避免Eden区及两个Servivor之间发生大量的内存复制</p>
<p>4.6.3长期存活的对象将进入老年代</p>
<p>如果对象在Eden区出生并且尽力过一次Minor GC后仍然存活，并且能够被Servivor容纳，将被移动到Servivor空间中，并且把对象年龄设置成为1.对象在Servivor区中每熬过一次Minor GC，年龄就增加1岁，当它的年龄增加到一定程度（默认15岁），就将会被晋级到老年代中</p>
<p>4.6.4动态对象年龄判定</p>
<p>为了更好地适应不同程序的内存状况，虚拟机并不是永远地要求对象的年龄必须达到了MaxTenuringThreshold才能晋级到老年代，如果在Servivor空间中相同年龄所有对象的大小总和大于Survivor空间的一半，年龄大于或等于该年龄的对象就可以直接进入到老年代，无须登到MaxTenuringThreshold中要求的年龄</p>
<p>4.6.4 空间分配担保：</p>
<p>在发生Minor GC 之前，虚拟机会检查老年代最大可 用的连续空间是否大于新生代所有对象总空间，如果这个条件成立，那么Minor DC可以确保是安全的。如果不成立，则虚拟机会查看HandlePromotionFailure设置值是否允许担保失败。如果允许那么会继续检查老年代最大可用的连续空间是否大于晋级到老年代对象的平均大小，如果大于，将尝试进行一次Minor GC，尽管这次MinorGC 是有风险的：如果小于，或者HandlePromotionFailure设置不允许冒险，那这时也要改为进行一次Full GC</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/12/Android/Android ProGuard 混淆/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/12/Android/Android ProGuard 混淆/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-12T12:25:31+08:00">
                2020-03-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>title: Android ProGuard 混淆<br>date: 2019-07-10 18:36:53<br>categories: </p>
<pre><code>- Android
</code></pre><p>tags: </p>
<pre><code>- Android
</code></pre><hr>
<h1 id="ProGuard作用"><a href="#ProGuard作用" class="headerlink" title="ProGuard作用"></a>ProGuard作用</h1><p><strong>压缩</strong>（Shrinking）：默认开启，用以减小应用体积，移除未被使用的类和成员，并且会在优化动作执行之后再次执行（因为优化后可能会再次暴露一些未被使用的类和成员）。</p>
<pre><code>-dontshrink 关闭压缩
</code></pre><p><strong>优化</strong>（Optimization）：默认开启，在字节码级别执行优化，让应用运行的更快。</p>
<pre><code>-dontoptimize  关闭优化
-optimizationpasses n 表示proguard对代码进行迭代优化的次数，Android一般为5
</code></pre><p><strong>混淆</strong>（Obfuscation）：默认开启，增大反编译难度，类和类成员会被随机命名，除非用keep保护。</p>
<pre><code>-dontobfuscate 关闭混淆
</code></pre><h1 id="开启混淆"><a href="#开启混淆" class="headerlink" title="开启混淆"></a>开启混淆</h1><p>app module 的 build.gradle中minifyEnabled设置为true</p>
<h1 id="混淆规则文件"><a href="#混淆规则文件" class="headerlink" title="混淆规则文件"></a>混淆规则文件</h1><p>app module</p>
<p><code>proguardFiles getDefaultProguardFile(&#39;proguard-android.txt&#39;), &#39;proguard-rules.pro&#39;</code></p>
<p>lib module</p>
<p><code>consumerProguardFiles getDefaultProguardFile(&#39;proguard-android.txt&#39;), &#39;proguard-rules.pro&#39;</code></p>
<p>特别注意：lib module 一定要使用 consumerProguardFiles；否则混淆规则是不生效的</p>
<p>以<code>consumerProguardFiles</code>方式加入的混淆具有以下特性：</p>
<ul>
<li>*.pro文件会包含在aar文件中（aar混淆规则，对应用程序无效）</li>
<li>这些pro配置会在应用程序开启混淆的时候被使用</li>
<li>混淆配置对使用者透明，特别方便</li>
</ul>
<h1 id="stacktrace的恢复"><a href="#stacktrace的恢复" class="headerlink" title="stacktrace的恢复"></a>stacktrace的恢复</h1><p>retrace脚本 <code>./tools/proguard/bin/retrace.sh</code></p>
<p>mapping映射表 <code>./app/build/outputs/mapping/release/mapping.txt</code></p>
<h1 id="哪些不应该混淆"><a href="#哪些不应该混淆" class="headerlink" title="哪些不应该混淆"></a>哪些不应该混淆</h1><h2 id="反射中使用的元素"><a href="#反射中使用的元素" class="headerlink" title="反射中使用的元素"></a>反射中使用的元素</h2><p>属性,方法,类,包名等</p>
<h2 id="序列化与反序列化"><a href="#序列化与反序列化" class="headerlink" title="序列化与反序列化"></a>序列化与反序列化</h2><p>解决方案：</p>
<pre><code>1. 将序列化和反序列化的类排除混淆
2. 使用@SerializedName注解字段
</code></pre><h2 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h2><h2 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h2><h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><h2 id="四大组件"><a href="#四大组件" class="headerlink" title="四大组件"></a>四大组件</h2><h2 id="jni调用的java方法"><a href="#jni调用的java方法" class="headerlink" title="jni调用的java方法"></a>jni调用的java方法</h2><h2 id="java的native方法"><a href="#java的native方法" class="headerlink" title="java的native方法"></a>java的native方法</h2><h2 id="js调用java的方法"><a href="#js调用java的方法" class="headerlink" title="js调用java的方法"></a>js调用java的方法</h2><h2 id="第三方库不建议混淆"><a href="#第三方库不建议混淆" class="headerlink" title="第三方库不建议混淆"></a>第三方库不建议混淆</h2><h1 id="dontwarn指令"><a href="#dontwarn指令" class="headerlink" title="dontwarn指令"></a>dontwarn指令</h1><p>关闭警告。</p>
<p>引入的library可能存在一些无法找到的引用和其他问题,在build时可能会发出警告,如果我们不进行处理,通常会导致build中止.因此为了保证build继续,我们需要使用dontwarn处理这些我们无法解决的library的警告.</p>
<p><code>-dontwarn com.twitter.sdk.** # 关闭Twitter sdk的警告</code></p>
<h1 id="keep指令"><a href="#keep指令" class="headerlink" title="keep指令"></a>keep指令</h1><table>
<thead>
<tr>
<th>保留内容/作用域</th>
<th>防止被移除或者被重命名</th>
<th>防止被重命名(后缀names)</th>
</tr>
</thead>
<tbody>
<tr>
<td>类和类成员</td>
<td>-keep</td>
<td>-keepnames</td>
</tr>
<tr>
<td>仅类成员</td>
<td>-keepclassmembers</td>
<td>-keepclassmembernames</td>
</tr>
<tr>
<td>如果拥有某成员，保留类和类成员</td>
<td>-keepclasseswithmembers</td>
<td>-keepclasseswithmembernames</td>
</tr>
</tbody>
</table>
<p>移除是指在压缩(Shrinking)时是否会被删除。</p>
<h1 id="指令对象"><a href="#指令对象" class="headerlink" title="指令对象"></a>指令对象</h1><h2 id="class"><a href="#class" class="headerlink" title="class"></a><code>class</code></h2><h1 id="指令对象属性"><a href="#指令对象属性" class="headerlink" title="指令对象属性"></a>指令对象属性</h1><h2 id="包名"><a href="#包名" class="headerlink" title="包名.*"></a><code>包名.*</code></h2><p>本包下的，不包括子包下</p>
<p><code>-keep class cn.hadcn.test.*</code></p>
<h2 id="包名-1"><a href="#包名-1" class="headerlink" title="包名.**"></a><code>包名.**</code></h2><p>本包和所含子包下的</p>
<p><code>-keep class cn.hadcn.test.**</code></p>
<h2 id="extend-implement"><a href="#extend-implement" class="headerlink" title="* extend * implement"></a><code>* extend</code> <code>* implement</code></h2><p>子类/实现类</p>
<p><code>-keep public class * extends android.app.Activity</code></p>
<h2 id=""><a href="#" class="headerlink" title="{*;}"></a><code>{*;}</code></h2><p>类的所有内容</p>
<p><code>-keep class cn.hadcn.test.* {*;}</code></p>
<h2 id="类的部分内容"><a href="#类的部分内容" class="headerlink" title="类的部分内容"></a>类的部分内容</h2><p>保护类的特定内容不被混淆</p>
<pre><code>&lt;init&gt;;     //匹配所有构造器
&lt;fields&gt;;   //匹配所有域
&lt;methods&gt;;  //匹配所有方法方法

还可以在&lt;fields&gt;或&lt;methods&gt;前面加上private 、public、native、注解 等来进一步指定不被混淆的内容

-keep class cn.hadcn.test.One {
    public &lt;methods&gt;;
} One类下的所有public方法都不会被混淆

-keep class cn.hadcn.test.One {
   public &lt;init&gt;(org.json.JSONObject);
} 参数为JSONObject的构造函数不会被混淆

-keepclasseswithmembernames class * { # 保持native方法不被混淆    
    native &lt;methods&gt;;
}

-keep class * implements Android.os.Parcelable { # Parcelable的子类和Creator静态成员变量不混淆       
    public static final Android.os.Parcelable$Creator *;
}

-keepclassmembers enum * {  # 以下两个方法会被反射调用
    public static **[] values();  
    public static ** valueOf(java.lang.String);  
}

-keepclassmembers class cc.ninty.chat.ui.fragment.ScriptFragment$JavaScriptInterface {
    public *;
}  # 保持ScriptFragment内部类JavaScriptInterface中的所有public内容不被混淆

-keepclassmembers class ** {
    @com.squareup.otto.Subscribe public *;
    @com.squareup.otto.Produce public *;
} # 保留使用了注解的成员
</code></pre><h1 id="混淆配置模板"><a href="#混淆配置模板" class="headerlink" title="混淆配置模板"></a>混淆配置模板</h1><p>混淆分为2个主要部分</p>
<p><strong>定制化区域</strong>。这里边的内容是我们主要需要补充的部分，大致分为4个小部分，主要是补充这4个部分的东西。</p>
<p><strong>基本不用动区域</strong>。顾名思义，除非有特殊的需求，基本不用改动。</p>
<pre><code>#-------------------------------------------定制化区域----------------------------------------------
#---------------------------------1.实体类---------------------------------



#-------------------------------------------------------------------------

#---------------------------------2.第三方包-------------------------------



#-------------------------------------------------------------------------

#---------------------------------3.与js互相调用的类------------------------



#-------------------------------------------------------------------------

#---------------------------------4.反射相关的类和方法-----------------------



#----------------------------------------------------------------------------
#---------------------------------------------------------------------------------------------------

#-------------------------------------------基本不用动区域--------------------------------------------
#---------------------------------基本指令区----------------------------------
-optimizationpasses 5 # 代码混淆的压缩比例，值在0-7之间
-dontusemixedcaseclassnames # 混淆后类名不区分大小写（即只用小写）
-dontskipnonpubliclibraryclassmembers # 不忽略非公共的库的类
-dontskipnonpubliclibraryclassmembers # 不忽略非公共的库的类的成员
-dontpreverify # 不做预校验的操作
-printmapping proguardMapping.txt # 生成映射文件
-optimizations !code/simplification/cast,!field/*,!class/merging/* # 指定混淆是采用的算法
-keepattributes *Annotation*,InnerClasses # 不混淆Annotation
-keepattributes Signature # 不混淆泛型
-keepattributes SourceFile,LineNumberTable # 保留代码文件名和行号
#----------------------------------------------------------------------------

#---------------------------------默认保留区---------------------------------
-keep public class * extends android.app.Activity
-keep public class * extends android.app.Application
-keep public class * extends android.app.Service
-keep public class * extends android.content.BroadcastReceiver
-keep public class * extends android.content.ContentProvider
-keep public class * extends android.app.backup.BackupAgentHelper
-keep public class * extends android.preference.Preference
-keep public class * extends android.view.View
-keep public class com.android.vending.licensing.ILicensingService
-keep class android.support.** {*;}

-keep public class * extends android.view.View{
    *** get*();
    void set*(***);
    public &lt;init&gt;(android.content.Context);
    public &lt;init&gt;(android.content.Context, android.util.AttributeSet);
    public &lt;init&gt;(android.content.Context, android.util.AttributeSet, int);
}
-keepclasseswithmembers class * {
    public &lt;init&gt;(android.content.Context, android.util.AttributeSet);
    public &lt;init&gt;(android.content.Context, android.util.AttributeSet, int);
}
-keepclassmembers class * implements java.io.Serializable {
    static final long serialVersionUID;
    private static final java.io.ObjectStreamField[] serialPersistentFields;
    private void writeObject(java.io.ObjectOutputStream);
    private void readObject(java.io.ObjectInputStream);
    java.lang.Object writeReplace();
    java.lang.Object readResolve();
}
-keep class **.R$* {
 *;
}
-keepclassmembers class * {
    void *(**On*Event);
}
#----------------------------------------------------------------------------

#---------------------------------webview------------------------------------
-keepclassmembers class fqcn.of.javascript.interface.for.Webview {
   public *;
}
-keepclassmembers class * extends android.webkit.WebViewClient {
    public void *(android.webkit.WebView, java.lang.String, android.graphics.Bitmap);
    public boolean *(android.webkit.WebView, java.lang.String);
}
-keepclassmembers class * extends android.webkit.WebViewClient {
    public void *(android.webkit.WebView, jav.lang.String);
}
#----------------------------------------------------------------------------
#---------------------------------------------------------------------------------------------------
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/06/Android/latex公式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/06/Android/latex公式/" itemprop="url">latex公式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-06T16:12:33+08:00">
                2020-03-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="LaTex"><a href="#LaTex" class="headerlink" title="LaTex"></a>LaTex</h1><h2 id="MathJax"><a href="#MathJax" class="headerlink" title="MathJax"></a>MathJax</h2><p>运行在浏览器中的开源的数学符号渲染引擎</p>
<p>可以解析Latex、MathML和ASCIIMathML的标记语言</p>
<h1 id="MathJax基本语法"><a href="#MathJax基本语法" class="headerlink" title="MathJax基本语法"></a>MathJax基本语法</h1><h2 id="公式标记"><a href="#公式标记" class="headerlink" title="公式标记"></a>公式标记</h2><p>需要用一些适当的标记告诉MathJax某段文本是公式代码</p>
<p>MathJax中的公式排版有两种方式：</p>
<ul>
<li>inline。行内（公式嵌入到文本段中）</li>
<li>displayed。独立（行、块、段落）</li>
</ul>
<p>默认的displayed公式分隔符有 <code>$$...$$</code> 和 <code>\[...\]</code>，默认的inline公式分隔符为 <code>(...)</code> 。</p>
<p>当然可以通过参考文档配置自定义分隔符。下文中，自定义 <code>$...$</code> 作为inline分隔符。</p>
<p>公式：c=(a平方+b平台)开根号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ c = \sqrt&#123;a^&#123;2&#125;+b^&#123;2&#125;&#125; $</span><br><span class="line"></span><br><span class="line">$$ c = \sqrt&#123;a^&#123;2&#125;+b^&#123;2&#125;&#125; $$</span><br></pre></td></tr></table></figure>
<h2 id="上下标"><a href="#上下标" class="headerlink" title="上下标"></a>上下标</h2><ul>
<li><code>^</code> 表示上标, <code>_</code> 表示下标。</li>
<li>如果上下标的内容多于一个字符，要用 <code>{}</code> 把这些内容括起来当成一个整体。</li>
<li>上下标是可以嵌套的，也可以同时使用</li>
</ul>
<h2 id="转义"><a href="#转义" class="headerlink" title="转义"></a>转义</h2><p>以下几个字符: <code># $ % &amp; ~ _ ^ \ { }</code>有特殊意义，需要表示这些字符时，需要转义，即在每个字符前加上 <code>\</code></p>
<h1 id="原生渲染Latex"><a href="#原生渲染Latex" class="headerlink" title="原生渲染Latex"></a>原生渲染Latex</h1><table>
<thead>
<tr>
<th>方案</th>
<th>特性</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>jlatexmath-android</td>
<td>JLaTexMath移植到Android</td>
<td></td>
</tr>
<tr>
<td>JLaTexMath-andriod</td>
<td>基于jlatexmath-android改进；<br> 针对化学、生物类的中文公式做了优化；<br></td>
<td></td>
</tr>
<tr>
<td>FlexibleRichTextView</td>
<td>使用JLaTexMath-andriod渲染；<br></td>
<td>公式弧只支持 ${ab}^{\frown}$ 两个点；<br></td>
</tr>
<tr>
<td>MathView</td>
<td>依赖webview；<br> 支持双渲染引擎MathJax and KaTeX；<br> KaTeX 比 MathJax 快，但 MathJax 支持更多的特性，而且更漂亮</td>
<td>用<code>\(...\)</code>代替<code>$...$</code>表示行内公式；<br> MathJax在Android上的bug导致有些字符是空白的；<br> Java中注意反斜杠、引号等转义字符(<code>\\</code>转义成了<code>\</code>)</td>
</tr>
</tbody>
</table>
<h1 id="参考-amp-扩展"><a href="#参考-amp-扩展" class="headerlink" title="参考&amp;扩展"></a>参考&amp;扩展</h1><ul>
<li><a href="https://www.latex-project.org/" target="_blank" rel="noopener">latex</a></li>
<li><a href="https://www.mathjax.org/" target="_blank" rel="noopener">mathjax</a></li>
<li><a href="https://qianwenma.cn/2018/05/17/mathjax-yu-fa-can-kao/" target="_blank" rel="noopener">MathJax 语法参考</a></li>
<li><a href="https://www.jianshu.com/p/22117d964baf" target="_blank" rel="noopener">LATEX 公式总结</a></li>
<li><a href="https://github.com/opencollab/jlatexmath" target="_blank" rel="noopener">JLaTexMath</a> A Java API to render LaTeX</li>
<li><a href="https://github.com/mksmbrtsh/jlatexmath-android" target="_blank" rel="noopener">jlatexmath-android</a></li>
<li><a href="https://github.com/sixgodIT/JLaTexMath-andriod" target="_blank" rel="noopener">JLaTexMath-andriod</a></li>
<li><a href="https://github.com/daquexian/FlexibleRichTextView" target="_blank" rel="noopener">FlexibleRichTextView</a></li>
<li><a href="https://github.com/jianzhongli/MathView" target="_blank" rel="noopener">MathView</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/14/web/黑马前端39期/01 HTML5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/14/web/黑马前端39期/01 HTML5/" itemprop="url">01 HTML5</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-14T15:28:14+08:00">
                2020-02-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="浏览器内核"><a href="#浏览器内核" class="headerlink" title="浏览器内核"></a>浏览器内核</h1><p>浏览器内核可以分成两部分：</p>
<h2 id="渲染引擎"><a href="#渲染引擎" class="headerlink" title="渲染引擎"></a>渲染引擎</h2><p>Rendering Engine，或者Layout Engineer</p>
<p>解析输出网页内容</p>
<p>不同内核对于网页的语法解释会有不同，所以渲染的效果也不相同。</p>
<h2 id="JS引擎"><a href="#JS引擎" class="headerlink" title="JS引擎"></a>JS引擎</h2><p>解析 Javascript 语言，执行 javascript语言来实现网页的动态效果。</p>
<p>最开始渲染引擎和 JS 引擎并没有区分的很明确，后来 JS 引擎越来越独立，内核就倾向于只指渲染引擎。</p>
<h1 id="Web标准"><a href="#Web标准" class="headerlink" title="Web标准"></a>Web标准</h1><p>不同的浏览器内核，工作原理、解析、显示会有差别，需要一个统一标准</p>
<h2 id="Web-标准构成"><a href="#Web-标准构成" class="headerlink" title="Web 标准构成"></a>Web 标准构成</h2><p> Web标准是由W3C和其他标准化组织制定的一系列标准的集合。</p>
<p> 主要包括结构（Structure）、表现（Presentation）和行为（Behavior）三个方面。</p>
<h3 id="结构标准"><a href="#结构标准" class="headerlink" title="结构标准"></a>结构标准</h3><p>结构用于对网页元素进行整理和分类</p>
<p>主要包括XML和XHTML两个部分。</p>
<h3 id="样式标准"><a href="#样式标准" class="headerlink" title="样式标准"></a>样式标准</h3><p>表现用于设置网页元素的版式、颜色、大小等外观样式</p>
<p>主要指的是CSS。</p>
<h3 id="行为标准"><a href="#行为标准" class="headerlink" title="行为标准"></a>行为标准</h3><p>行为是指网页模型的定义及交互的编写</p>
<p>主要包括DOM和ECMAScript两个部分</p>
<h1 id="HTML-初识"><a href="#HTML-初识" class="headerlink" title="HTML 初识"></a>HTML 初识</h1><p>HTML（Hyper Text Markup Language）中文译为“超文本标签语言”</p>
<p>主要是通过HTML标签对网页中的文本、图片、声音等内容进行描述。</p>
<p>关键词：文本 标签 语言</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">strong</span>&gt;</span> 我是加粗的字体 <span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="HTML骨架格式"><a href="#HTML骨架格式" class="headerlink" title="HTML骨架格式"></a>HTML骨架格式</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">HTML</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span>     </span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">HTML</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>head标签中我们必须要设置的标签是title</p>
<h2 id="HTML标签分类"><a href="#HTML标签分类" class="headerlink" title="HTML标签分类"></a>HTML标签分类</h2><h3 id="双标签"><a href="#双标签" class="headerlink" title="双标签"></a>双标签</h3><p><code>&lt;标签名&gt; 内容 &lt;/标签名&gt;</code></p>
<h3 id="单标签"><a href="#单标签" class="headerlink" title="单标签"></a>单标签</h3><p><code>&lt;标签名 /&gt;</code> 比如 <code>&lt;br /&gt;</code></p>
<h2 id="HTML标签关系"><a href="#HTML标签关系" class="headerlink" title="HTML标签关系"></a>HTML标签关系</h2><h3 id="嵌套关系"><a href="#嵌套关系" class="headerlink" title="嵌套关系"></a>嵌套关系</h3><p><code>&lt;head&gt;  &lt;title&gt; &lt;/title&gt;  &lt;/head&gt;</code></p>
<h3 id="并列关系"><a href="#并列关系" class="headerlink" title="并列关系"></a>并列关系</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="文档类型-lt-DOCTYPE-gt"><a href="#文档类型-lt-DOCTYPE-gt" class="headerlink" title="文档类型&lt;!DOCTYPE&gt;"></a>文档类型&lt;!DOCTYPE&gt;</h1><p>位于文档的最前面</p>
<p>用于向浏览器说明当前文档使用的标准规范，保证浏览器能正确解析。</p>
<p><code>&lt;!DOCTYPE html&gt;</code></p>
<p>HTML5的文档类型兼容很好(向下兼容的原则)，所以使用HTML5的文档类型就好了。</p>
<h1 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h1><p><code>&lt;meta charset=&quot;UTF-8&quot;&gt;</code></p>
<h1 id="HTML标签"><a href="#HTML标签" class="headerlink" title="HTML标签"></a>HTML标签</h1><h2 id="标签属性"><a href="#标签属性" class="headerlink" title="标签属性"></a>标签属性</h2><p><code>&lt;标签名 属性1=&quot;属性值1&quot; 属性2=&quot;属性值2&quot; …&gt; 内容 &lt;/标签名&gt;</code></p>
<ol>
<li><p>标签可以拥有多个属性，必须写在开始标签中，位于标签名后面。</p>
</li>
<li><p>属性之间不分先后顺序</p>
</li>
<li><p>标签名与属性、属性与属性之间均以空格分开</p>
</li>
<li><p>属性采取  键值对 的格式； key=”value”  的格式</p>
</li>
<li><p>属性都有默认值，省略该属性则取默认值</p>
</li>
</ol>
<h2 id="排版标签"><a href="#排版标签" class="headerlink" title="排版标签"></a>排版标签</h2><p>显示网页结构的标签，是网页布局最常用的标签。</p>
<h3 id="标题标签-h1"><a href="#标题标签-h1" class="headerlink" title="标题标签 h1"></a>标题标签 h1</h3><p>单词缩写：  head   头部. 标题 </p>
<p>HTML提供了6个等级的标题，即 <code>&lt;h1&gt;到&lt;h6&gt;</code></p>
<h3 id="段落标签-p"><a href="#段落标签-p" class="headerlink" title="段落标签 p"></a>段落标签 p</h3><p>单词缩写：  paragraph  段落</p>
<h3 id="水平线标签-hr"><a href="#水平线标签-hr" class="headerlink" title="水平线标签 hr"></a>水平线标签 hr</h3><p>单词缩写：  horizontal  横线</p>
<h3 id="换行标签-br"><a href="#换行标签-br" class="headerlink" title="换行标签 br"></a>换行标签 br</h3><p>单词缩写：  break   打断 ,换行</p>
<h3 id="div-span标签"><a href="#div-span标签" class="headerlink" title="div span标签"></a>div span标签</h3><p>单词缩写：  division  分割，分区</p>
<p>span, 跨度，跨距；范围   </p>
<p>网页布局主要的2个盒子</p>
<h2 id="文本格式化标签"><a href="#文本格式化标签" class="headerlink" title="文本格式化标签"></a>文本格式化标签</h2><p>设置文本格式</p>
<table>
<thead>
<tr>
<th>标签</th>
<th>缩写</th>
<th>显示效果</th>
</tr>
</thead>
<tbody>
<tr>
<td>b strong</td>
<td>bold</td>
<td>粗体</td>
</tr>
<tr>
<td>i em</td>
<td>italic 斜体字；emphasize强调</td>
<td>斜体</td>
</tr>
<tr>
<td>s del</td>
<td>strike out 删去；delete</td>
<td>删除线</td>
</tr>
<tr>
<td>u ins</td>
<td>underline；insert插入</td>
<td>下划线，插入线</td>
</tr>
</tbody>
</table>
<p>b i s u 已经不推荐使用</p>
<h2 id="图像标签-img"><a href="#图像标签-img" class="headerlink" title="图像标签 img"></a>图像标签 img</h2><p>单词缩写：   image  图像</p>
<p><code>&lt;img src=&quot;图像URL&quot; /&gt;</code></p>
<p>src属性用于指定图像文件的路径和文件名，是img标签的必需属性。</p>
<h2 id="链接标签-a"><a href="#链接标签-a" class="headerlink" title="链接标签 a"></a>链接标签 a</h2><p>单词缩写：  anchor 锚</p>
<p><code>&lt;a href=&quot;跳转目标&quot; target=&quot;目标窗口的弹出方式&quot;&gt;文本或图像&lt;/a&gt;</code></p>
<p>网页中各种网页元素，如图像、表格、音频、视频等都可以添加超链接。</p>
<h3 id="关键属性"><a href="#关键属性" class="headerlink" title="关键属性"></a>关键属性</h3><h4 id="href"><a href="#href" class="headerlink" title="href"></a>href</h4><p>指定链接目标的url地址</p>
<p>Hypertext Reference, 超文本引用  </p>
<p>取值有：</p>
<ul>
<li>外部链接 <code>&lt; a href=&quot;http:// www.baidu.com&quot;&gt; 百度 &lt;/a &gt;</code></li>
<li>内部链接 <code>&lt; a href=&quot;index.html&quot;&gt; 首页 &lt;/a &gt;</code></li>
<li>空链接 <code>&lt; a href=&quot;#&quot;&gt; 空链接 &lt;/a &gt;</code></li>
</ul>
<h3 id="target"><a href="#target" class="headerlink" title="target"></a>target</h3><p>指定链接页面的打开方式</p>
<p>其取值有：</p>
<ul>
<li><code>_self</code> 默认值</li>
<li><code>_blank</code> 在新窗口中打开方式</li>
</ul>
<h3 id="锚点定位"><a href="#锚点定位" class="headerlink" title="锚点定位"></a>锚点定位</h3><p>通过创建锚点链接，用户能够快速定位到目标内容。</p>
<p>创建锚点链接分为两步：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.使用相应的id名标注跳转目标的位置</span><br><span class="line"></span><br><span class="line">2.使用 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">”#id名</span>"&gt;</span>“链接文本"<span class="tag">&lt;/<span class="name">a</span>&gt;</span> 创建链接文本</span><br></pre></td></tr></table></figure>
<h3 id="全局链接属性设置标签-base"><a href="#全局链接属性设置标签-base" class="headerlink" title="全局链接属性设置标签 base"></a>全局链接属性设置标签 base</h3><p>设置整体链接的属性  </p>
<p>base 写在 head 之间</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">base</span> <span class="attr">target</span>=<span class="string">"_blank"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>设置所有链接都在在新窗口中打开</p>
<h2 id="注释标签"><a href="#注释标签" class="headerlink" title="注释标签"></a>注释标签</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 单行注释语句 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">多行</span></span><br><span class="line"><span class="comment">注释</span></span><br><span class="line"><span class="comment">语句</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="无序列表-ul"><a href="#无序列表-ul" class="headerlink" title="无序列表 ul"></a>无序列表 ul</h2><p>列表项符号默认是点</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>列表项1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>列表项2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>列表项3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  ......</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="有序列表-ol"><a href="#有序列表-ol" class="headerlink" title="有序列表 ol"></a>有序列表 ol</h2><p>列表项符号默认是数字</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>列表项1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>列表项2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>列表项3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  ......</span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="自定义列表-dl"><a href="#自定义列表-dl" class="headerlink" title="自定义列表 dl"></a>自定义列表 dl</h2><p>列表项前没有任何项目符号</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>名词1<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>名词1解释1<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>名词1解释2<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>名词2<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>名词2解释1<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>名词2解释2<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="表格-table"><a href="#表格-table" class="headerlink" title="表格 table"></a>表格 table</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>单元格内的文字<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">table 表格</span><br><span class="line">tr 行；行内只能放单元格</span><br><span class="line">td 单元格；</span><br><span class="line">th 表头单元格（特殊的td）；一般位于表格的第一行或第一列；文本加粗居中</span><br></pre></td></tr></table></figure>
<h3 id="表格属性"><a href="#表格属性" class="headerlink" title="表格属性"></a>表格属性</h3><table>
<thead>
<tr>
<th>属性</th>
<th>含义</th>
<th>属性值</th>
</tr>
</thead>
<tbody>
<tr>
<td>border</td>
<td>单元格边框像素</td>
<td>默认0像素，无边框</td>
</tr>
<tr>
<td>cellspacing</td>
<td>单元格外间距</td>
<td>默认2像素</td>
</tr>
<tr>
<td>cellpadding</td>
<td>单元格内间距（内容与边框间距）</td>
<td>默认1像素</td>
</tr>
</tbody>
</table>
<h2 id="合并单元格"><a href="#合并单元格" class="headerlink" title="合并单元格"></a>合并单元格</h2><p>跨行合并：rowspan    跨列合并：colspan</p>
<p>将多个内容合并的时候，就会有多余的东西，需要把它删除。例如 把 3个 td 合并成一个， 那就多余了2个，需要删除。</p>
<p>删除的个数  =  合并的个数  - 1</p>
<h2 id="表单"><a href="#表单" class="headerlink" title="表单"></a>表单</h2><p>一个完整的表单通常由3个部分构成：</p>
<ul>
<li><strong>表单域</strong>。<strong>容器</strong>：容纳所有的表单控件和提示信息，定义处理表单数据所用程序的url地址，以及数据提交到服务器的方法。</li>
<li><strong>表单控件</strong>（也称为表单元素）。表单功能项，如单行文本输入框、密码输入框、复选框、提交按钮、重置按钮等。</li>
<li><strong>提示信息</strong></li>
</ul>
<h3 id="表单域-form"><a href="#表单域-form" class="headerlink" title="表单域 form"></a>表单域 form</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"url地址"</span> <span class="attr">method</span>=<span class="string">"提交方式"</span> <span class="attr">name</span>=<span class="string">"表单名称"</span>&gt;</span></span><br><span class="line">  各种表单控件</span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>常用属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. Action</span><br><span class="line">   在表单收集到信息后，需要将信息传递给服务器进行处理，action属性用于指定接收并处理表单数据的服务器程序的url地址。</span><br><span class="line">2. method</span><br><span class="line">   用于设置表单数据的提交方式，其取值为get或post。</span><br><span class="line">3. name</span><br><span class="line">   用于指定表单的名称，以区分同一个页面中的多个表单。</span><br></pre></td></tr></table></figure>
<h3 id="输入控件-input"><a href="#输入控件-input" class="headerlink" title="输入控件 input"></a>输入控件 input</h3><p><img src="media/html5/input.png"></p>
<h3 id="多行文本控件-textarea"><a href="#多行文本控件-textarea" class="headerlink" title="多行文本控件 textarea"></a>多行文本控件 textarea</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">cols</span>=<span class="string">"每行中的字符数"</span> <span class="attr">rows</span>=<span class="string">"显示的行数"</span>&gt;</span></span><br><span class="line">  文本内容</span><br><span class="line"><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="下拉菜单-select"><a href="#下拉菜单-select" class="headerlink" title="下拉菜单 select"></a>下拉菜单 select</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span>&gt;</span>选项1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span>&gt;</span>选项2<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span>&gt;</span>选项3<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以使用 <code>selected =&quot;selected&quot;</code>定义默认选中项</p>
<h3 id="文本标签-label"><a href="#文本标签-label" class="headerlink" title="文本标签 label"></a>文本标签 label</h3><p>为 input 定义标注（即绑定input），点击label的时候, 被绑定的表单元素就会获得输入焦点</p>
<p>for属性用来指定要绑定input的id</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"male"</span>&gt;</span>Male<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"sex"</span> <span class="attr">id</span>=<span class="string">"male"</span> <span class="attr">value</span>=<span class="string">"male"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="路径"><a href="#路径" class="headerlink" title="路径"></a>路径</h1><h2 id="相对路径"><a href="#相对路径" class="headerlink" title="相对路径"></a>相对路径</h2><p>相对自身的路径</p>
<p><code>../</code>表示父级文件夹</p>
<h2 id="绝对路径"><a href="#绝对路径" class="headerlink" title="绝对路径"></a>绝对路径</h2><p>完整的路径地址（文件夹或网络地址）</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/04/杂篇/斗地主的技巧/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/04/杂篇/斗地主的技巧/" itemprop="url">斗地主的技巧</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-04T14:49:53+08:00">
                2020-02-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/杂篇/" itemprop="url" rel="index">
                    <span itemprop="name">杂篇</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>扑克游戏指导 斗地主的技巧，孔维民，北京体育大学出版社</p>
<h1 id="游戏规则"><a href="#游戏规则" class="headerlink" title="游戏规则"></a>游戏规则</h1><h2 id="三人斗地主"><a href="#三人斗地主" class="headerlink" title="三人斗地主"></a>三人斗地主</h2><h3 id="牌型"><a href="#牌型" class="headerlink" title="牌型"></a>牌型</h3><p>单牌</p>
<p>对牌</p>
<p>三条（三张一样的）</p>
<p>三带一（一手牌：单或对）</p>
<p>单顺（5连续单牌）</p>
<p>双顺（3连续对牌）</p>
<p>三顺（飞机，2连续三条，可以带同数量的翅膀-单或对）</p>
<p>四带二（4张一样的+两手牌：单或双）</p>
<p>炸弹（4张一样）</p>
<p>火箭（双王）</p>
<h1 id="叫牌"><a href="#叫牌" class="headerlink" title="叫牌"></a>叫牌</h1><h2 id="量化牌力"><a href="#量化牌力" class="headerlink" title="量化牌力"></a>量化牌力</h2><p>3人斗地主为例，牌力量化如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">炸弹 5</span><br><span class="line">大王 3.5</span><br><span class="line">小王 2.5</span><br><span class="line">2 2 是否有王的保护，牌力升降0.5</span><br><span class="line">A 1</span><br><span class="line">K 0.5</span><br></pre></td></tr></table></figure>
<p>不包括炸弹，总牌力是 (2+1+0.5)x4 + 6 = 20</p>
<p>产生炸弹的概率是 1/4 到 1/3，因此牌力在 7 以上，叫牌比较科学</p>
<h2 id="掉张小牌太多，牌力强也不叫"><a href="#掉张小牌太多，牌力强也不叫" class="headerlink" title="掉张小牌太多，牌力强也不叫"></a>掉张小牌太多，牌力强也不叫</h2><p>3人斗地主中，底牌中获取期望单牌的概率：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">手上0张，28.52%</span><br><span class="line">手上1张，22.99%</span><br><span class="line">手上3张，8.11%</span><br></pre></td></tr></table></figure>
<h1 id="必知概率"><a href="#必知概率" class="headerlink" title="必知概率"></a>必知概率</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/03/Android/gradle/gradle使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/03/Android/gradle/gradle使用/" itemprop="url">gradle使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-03T14:13:53+08:00">
                2020-02-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://segmentfault.com/a/1190000004241503#articleHeader7" target="_blank" rel="noopener">Gradle for Android 读书笔记</a></p>
<h1 id="Android-Gradle-plugin-vs-Gradle"><a href="#Android-Gradle-plugin-vs-Gradle" class="headerlink" title="Android Gradle plugin vs Gradle"></a><a href="https://developer.android.google.cn/studio/releases/gradle-plugin#updating-gradle" target="_blank" rel="noopener">Android Gradle plugin vs Gradle</a></h1><p>Android Gradle plugin 增加了一些编译apk的特性，可以独立于Android Studio 升级和使用</p>
<h2 id="Android-Gradle-plugin-和-Gradle-版本兼容"><a href="#Android-Gradle-plugin-和-Gradle-版本兼容" class="headerlink" title="Android Gradle plugin 和 Gradle 版本兼容"></a>Android Gradle plugin 和 Gradle 版本兼容</h2><table>
<thead>
<tr>
<th>Plugin version</th>
<th>Required Gradle version</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.0.0 - 1.1.3</td>
<td>2.2.1 - 2.3</td>
</tr>
<tr>
<td>1.2.0 - 1.3.1</td>
<td>2.2.1 - 2.9</td>
</tr>
<tr>
<td>1.5.0</td>
<td>2.2.1 - 2.13</td>
</tr>
<tr>
<td>2.0.0 - 2.1.2</td>
<td>2.10 - 2.13</td>
</tr>
<tr>
<td>2.1.3 - 2.2.3</td>
<td>2.14.1+</td>
</tr>
<tr>
<td>2.3.0+</td>
<td>3.3+</td>
</tr>
<tr>
<td>3.0.0+</td>
<td>4.1+</td>
</tr>
<tr>
<td>3.1.0+</td>
<td>4.4+</td>
</tr>
</tbody>
</table>
<h2 id="升级-Android-Gradle-plugin"><a href="#升级-Android-Gradle-plugin" class="headerlink" title="升级 Android Gradle plugin"></a>升级 Android Gradle plugin</h2><p>工程根目录 build.gradle</p>
<pre><code>buildscript {
    repositories {
        // Gradle 4.1 and higher include support for Google&apos;s Maven repo using
        // the google() method. And you need to include this repo to download
        // Android Gradle plugin 3.0.0 or higher.
        google()
        ...
    }
    dependencies {
        classpath &apos;com.android.tools.build:gradle:3.2.1&apos;
    }
}
</code></pre><h2 id="升级-Gradle"><a href="#升级-Gradle" class="headerlink" title="升级 Gradle"></a>升级 Gradle</h2><p>工程根目录 gradle/wrapper/gradle-wrapper.properties</p>
<pre><code>distributionUrl = https\://services.gradle.org/distributions/gradle-4.6-all.zip
</code></pre><p><a href="https://services.gradle.org/distributions/" target="_blank" rel="noopener">Gradle版本</a></p>
<h2 id="选择那个Gradle-plugin版本"><a href="#选择那个Gradle-plugin版本" class="headerlink" title="选择那个Gradle plugin版本"></a>选择那个Gradle plugin版本</h2><p>旧版本的话，建议升级到3.0.0</p>
<p>因为有些特性虽然已声明废弃，但还暂时支持</p>
<p>比如 compile，注解</p>
<p>这样可以兼容很多第三方库，节省大量工作</p>
<h2 id="升级到Gradle-plugin-3-0-0遇到的坑"><a href="#升级到Gradle-plugin-3-0-0遇到的坑" class="headerlink" title="升级到Gradle plugin 3.0.0遇到的坑"></a>升级到Gradle plugin 3.0.0遇到的坑</h2><h3 id="坑1"><a href="#坑1" class="headerlink" title="坑1"></a>坑1</h3><pre><code>Error:Cannot set the value of read-only property &apos;outputFile&apos; for ApkVariantOutputImpl_Decorated{apkData=Main{type=MAIN, fullName=debug, filters=[]}} of type com.android.build.gradle.internal.api.ApkVariantOutputImpl.
</code></pre><p>代码如下</p>
<pre><code>// APK 文件名带上版本号
android.applicationVariants.all { variant -&gt;
    variant.outputs.each { output -&gt;
        output.outputFile = new File(
                output.outputFile.parent,
                output.outputFile.name.replace(&quot;.apk&quot;, &quot;-${variant.versionName}.apk&quot;))
    }
}
</code></pre><p>解决方案：</p>
<pre><code>用 all() 代替 each() 
    新模式下，each只能遍历配置时存在的变量；all才能循环执行时生成的变量
用 outputFileName 代替 output.outputFile ，如果只是修改文件名
</code></pre><p>修改后代码</p>
<pre><code>android.applicationVariants.all { variant -&gt;
    variant.outputs.all { output -&gt;
        outputFileName = output.outputFile.name.replace(&quot;.apk&quot;, &quot;-${variant.versionName}.apk&quot;)
    }
}
</code></pre><h3 id="坑2"><a href="#坑2" class="headerlink" title="坑2"></a>坑2</h3><pre><code>Error:Cannot choose between the following configurations of project :XXX:
  - debugApiElements
  - debugRuntimeElements
  - releaseApiElements
  - releaseRuntimeElements
</code></pre><p>解决方案</p>
<pre><code>annotationProcessor 替换 apt
</code></pre><p>详细步骤</p>
<p>1、项目根目录build.gradle文件，删除“apt”配置：</p>
<pre><code>classpath &apos;com.neenbedankt.gradle.plugins:android-apt:1.8&apos; //删除
</code></pre><p>2、module的build.gradle文件，删除“android-apt” plugin引用：</p>
<pre><code>apply plugin: &apos;android-apt&apos;  //删除
</code></pre><p>3、module的build.gradle文件，修改“dependencies”中的“apt”方式 为“annotationProcessor”方式：</p>
<pre><code>apt &quot;引用项&quot;  //老方式，删除
annotationProcessor &quot;引用项&quot; //新方式

比如
apt &apos;com.jakewharton:butterknife-compiler:8.0.1&apos;
annotationProcessor &apos;com.jakewharton:butterknife-compiler:8.0.1&apos;
</code></pre><h3 id="坑3"><a href="#坑3" class="headerlink" title="坑3"></a>坑3</h3><pre><code>Error:All flavors must now belong to a named flavor dimension. Learn more at https://d.android.com/r/tools/flavorDimensions-missing-error-message.html
</code></pre><p>Plugin 3.0.0之后有一种自动匹配消耗库的机制，便于debug variant 自动消耗一个库，然后就是必须要所有的flavor 都属于同一个维度。 </p>
<p>在主 app 的 build.gradle 里面的</p>
<pre><code>defaultConfig {
     targetSdkVersion：***
     minSdkVersion ：***
     versionCode：***
     versionName ：***

    //意思是flavor dimension 它的维度就是该版本号，
    //这样维度就是都是统一的了
     **flavorDimensions &quot;versionCode&quot;**
</code></pre><h3 id="坑4"><a href="#坑4" class="headerlink" title="坑4"></a>坑4</h3><pre><code>Error:Execution failed for task &apos;:youyoubao:javaPreCompileCommonDebug&apos;.
&gt; Annotation processors must be explicitly declared now.  The following dependencies on the compile classpath are found to contain annotation processor.  Please add them to the annotationProcessor configuration.
    - butterknife-compiler-8.6.0.jar (com.jakewharton:butterknife-compiler:8.6.0)
  Alternatively, set android.defaultConfig.javaCompileOptions.annotationProcessorOptions.includeCompileClasspath = true to continue with previous behavior.  Note that this option is deprecated and will be removed in the future.
  See https://developer.android.com/r/tools/annotation-processor-error-message.html for more details.
</code></pre><p>需要在 <code>app下的build.gradle的defaultConfig</code>下 显式声明annotation Processor库。</p>
<p>3.0.0之前的版本中，compile a ，不但会把lib a 放到compile classpath 路径下，还会自动放到processor classpath路径下。这会导致processor classpath路径下有大量不必要的依赖，这会更加编译时间。所以从gradle插件3.0.0以后，如果一个库是annotation processors库（如果库中还有META-INF/services/javax.annotation.processing.Processor，那么就认为这是一个annotation processors库），那么需要自己手动使用<strong>annotationProcessor</strong>关键字添加：</p>
<pre><code>dependencies {
     ...
annotationProcessor &apos;com.google.dagger:dagger-compiler:&lt;version-number&gt;&apos;
}
</code></pre><p>如果annotation processors库也需要放到compile classpath 路径下，需要使用compile/api/implementation再声明依赖一次。</p>
<p>并且，新版本如果发现annotation processors库也存在于compile classpath路径下，就会报错。所以需要在android defaultConfig块中进行声明不进行错误检查。</p>
<pre><code> android {
    ...
   defaultConfig {
   ...
     javaCompileOptions {
        annotationProcessorOptions {
          includeCompileClasspath false
      }
    }
 }
}
</code></pre><p>如果不想那么麻烦，直接使用如下配置也可以，但是这样的配置在之后的gradle插件版本中并不支持，所以不推荐</p>
<pre><code>defaultConfig {
   ...
   javaCompileOptions { annotationProcessorOptions { includeCompileClasspath = true } }
}
</code></pre><h1 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a><a href="http://www.cnblogs.com/xinmengwuheng/p/5797026.html" target="_blank" rel="noopener">基本配置</a></h1><h2 id="gradle-wrapper-properties"><a href="#gradle-wrapper-properties" class="headerlink" title="gradle-wrapper.properties"></a>gradle-wrapper.properties</h2><ul>
<li>声明gradle的目录。 一般不修改</li>
<li><p>声明项目使用的gradle版本及gradle的下载路径</p>
<pre><code>distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists
distributionUrl=https\://services.gradle.org/distributions/gradle-2.14.1-all.zip //gradle 版本
</code></pre></li>
</ul>
<h2 id="setting-gradle"><a href="#setting-gradle" class="headerlink" title="setting.gradle"></a>setting.gradle</h2><p>声明工程包含的模块</p>
<pre><code>include &apos;:app&apos;,&apos;:library&apos;
</code></pre><h2 id="根目录的build-gradle"><a href="#根目录的build-gradle" class="headerlink" title="根目录的build.gradle"></a>根目录的build.gradle</h2><p>声明工程所有模块的公共属性</p>
<pre><code>buildscript {
    repositories {
        jcenter()//使用jcenter库
    }
    dependencies {
        classpath &apos;com.android.tools.build:gradle:1.5.0&apos;// 依赖android提供的1.5.0的gradle build plugin Tools，一般跟AndroidStudio版本号一致

        // NOTE: Do not place your application dependencies here; they belong
        // in the individual module build.gradle files
    }
}
//为所有的工程的repositories配置为jcenters
allprojects {
    repositories {
        jcenter()
    }
}

task clean(type: Delete) {
    delete rootProject.buildDir
}
</code></pre><h3 id="使用技巧"><a href="#使用技巧" class="headerlink" title="使用技巧"></a>使用技巧</h3><p>repositories 指定本地文件夹</p>
<pre><code>allprojects {
        repositories {
            maven { url &quot;https://dl.bintray.com/thelasterstar/maven/&quot; }
            maven {
                // 本地依赖。目录下所有lib都是通过npm安装的。All of React Native (JS, Obj-C sources, Android binaries) is installed from npm
                url &quot;$rootDir/node_modules/react-native/android&quot;
            }
            flatDir {
                dirs &apos;libs&apos;
            }

A problem occurred configuring project &apos;:react-native-svg&apos;.
   &gt; Could not resolve all dependencies for configuration &apos;:react-native-svg:_debugCompile&apos;.
      &gt; Could not find com.facebook.react:react-native:0.48.4.
        Searched in the following locations:
             https://dl.bintray.com/thelasterstar/maven/com/facebook/react/react-native/0.48.4/react-native-0.48.4.pom
            https://dl.bintray.com/thelasterstar/maven/com/facebook/react/react-native/0.48.4/react-native-0.48.4.jar
             file:/D:/AndroidProject/rns/ssz_rn_project/android/node_modules/react-native/android/com/facebook/react/react-native/0.48.4/react-native-0.48.4.pom
            file:/D:/AndroidProject/rns/ssz_rn_project/android/node_modules/react-native/android/com/facebook/react/react-native/0.48.4/react-native-0.48.4.jar
            file:/D:/AndroidProject/rns/ssz_rn_project/android/node_modules/react-native-svg/android/libs/react-native-0.48.4.jar
</code></pre><h2 id="app-build-gradle"><a href="#app-build-gradle" class="headerlink" title="app/build.gradle"></a>app/build.gradle</h2><p>module的gradle配置</p>
<pre><code>#表示该module是一个app module,library module 写com.android.library
apply plugin: &apos;com.android.application&apos;

#android专用配置
android {
    compileSdkVersion 23
    buildToolsVersion &quot;23.0.2&quot; //构建工具的版本号,对应 AndroidSDK 中的 Android SDK Build-tools

    #默认配置，如果没有其他的配置覆盖，就会使用这里的
    defaultConfig {
        applicationId &quot;com.wuxiaolong.gradle4android&quot;
        minSdkVersion 15
        targetSdkVersion 23
        versionCode 1
        versionName &quot;1.0&quot;
    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;
        }
    }
}

#依赖的jar，aar，jcenter库信息
dependencies {
    compile fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])
    testCompile &apos;junit:junit:4.12&apos;
    compile &apos;com.android.support:appcompat-v7:23.2.1&apos;
    compile &apos;com.android.support:design:23.2.1&apos;
}
</code></pre><h2 id="gradle-properties"><a href="#gradle-properties" class="headerlink" title="gradle.properties"></a>gradle.properties</h2><ul>
<li>任何module的 build.gradle 都可以读取 gradle.properties 中的常量</li>
<li>gradle.properties 中的数据类型都是 String 类型<ul>
<li>使用其他数据类型需要自行转换；</li>
</ul>
</li>
</ul>
<p><a href="http://blog.csdn.net/guiying712/article/details/72629948" target="_blank" rel="noopener">利用本地化配置buildToolsVersion和gradleBuildTools</a> </p>
<p>解决方案：</p>
<ul>
<li><p>gradle.properties 从版本控制工具中给忽略掉<br>gradle.properties</p>
</li>
<li><p>配置好的 gradle.properties 给每个开发人员发一份，供本地使用</p>
</li>
</ul>
<p>代码：</p>
<p>gradle.properties 中</p>
<pre><code># 为自动化出包配置(因为每个开发的电脑坏境不一致)
localBuildToolsVersion=25.0.3
# 这个值一般跟你的AndroidStudio版本号一致
localGradlePluginVersion=2.2.3
</code></pre><p>根目录的build.gradle</p>
<pre><code>buildscript {
    dependencies {
        classpath &quot;com.android.tools.build:gradle:$localGradlePluginVersion&quot;
</code></pre><p>module的build.gradle</p>
<pre><code>android {
    buildToolsVersion localBuildToolsVersion
</code></pre><h2 id="repositories节点"><a href="#repositories节点" class="headerlink" title="repositories节点"></a>repositories节点</h2><ul>
<li>buildScript块。根目录下build.gradle<ul>
<li>Gradle脚本自身执行依赖插件 </li>
</ul>
</li>
<li>allprojects块。根目录下build.gradle<ul>
<li>所有项目共同所需依赖包</li>
</ul>
</li>
<li>根级别。module目录下build.gradle<ul>
<li>当前项目所需依赖包</li>
</ul>
</li>
</ul>
<h1 id="全局设置"><a href="#全局设置" class="headerlink" title="全局设置"></a><a href="http://www.cnblogs.com/xinmengwuheng/p/5797048.html" target="_blank" rel="noopener">全局设置</a></h1><h2 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h2><p>根目录下build.gradle 定义全局设置</p>
<pre><code>ext {
    compileSdkVersion = 23
    buildToolsVersion = &quot;23.0.2&quot;
    minSdkVersion = 14
    targetSdkVersion = 23
}
</code></pre><p>module下build.gradle 引用全局设置</p>
<pre><code>android {
    compileSdkVersion rootProject.ext.compileSdkVersion
    buildToolsVersion rootProject.ext.buildToolsVersion

    defaultConfig {
        applicationId &quot;com.example.android&quot;
        minSdkVersion rootProject.ext.minSdkVersion
        targetSdkVersion rootProject.ext.targetSdkVersion
        versionCode 1
        versionName &quot;1.0&quot;
    }
</code></pre><h2 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h2><p>根目录下建config.gradle 定义全局变量设置</p>
<pre><code>ext {

    android = [
            compileSdkVersion: 23,
            buildToolsVersion: &quot;23.0.2&quot;,
            minSdkVersion    : 14,
            targetSdkVersion : 22,

    ]

    dependencies = [
            appcompatV7&apos;: &apos;com.android.support:appcompat-v7:23.2.1&apos;,
            design      : &apos;com.android.support:design:23.2.1&apos;

    ]
}
</code></pre><p>根目录下build.gradle 最顶部</p>
<pre><code>apply from: &quot;config.gradle&quot;
</code></pre><p>module下build.gradle 引用全局设置</p>
<pre><code>android {
    compileSdkVersion rootProject.ext.android.compileSdkVersion
    buildToolsVersion rootProject.ext.buildToolsVersion

    defaultConfig {
        applicationId &quot;com.example.android&quot;
        minSdkVersion rootProject.ext.android.minSdkVersion
        targetSdkVersion rootProject.ext.android.targetSdkVersion
        versionCode 1
        versionName &quot;1.0&quot;
    }

...

dependencies {
    compile fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])
    testCompile &apos;junit:junit:4.12&apos;
    compile rootProject.ext.dependencies.appcompatV7
    compile rootProject.ext.dependencies.design
}
</code></pre><h1 id="buildConfigField"><a href="#buildConfigField" class="headerlink" title="buildConfigField"></a>buildConfigField</h1><p>自动生成 BuildConfig 类。 每个字段都是 public static final，直接由BuildConfig类点出key名来取值</p>
<p>示例：服务器可能有正式环境和测试环境</p>
<pre><code>defaultConfig {
    buildConfigField &apos;String&apos;,&apos;API_SERVER_URL&apos;,&apos;&quot;http://url/&quot;&apos; //定义了String类型，名为API_SERVER_URL，值为http://url/
}

Log.d(&quot;wxl&quot;, &quot;API_SERVER_URL=&quot; + BuildConfig.API_SERVER_URL);
</code></pre><p>注意，字符串类型的值一定要用双引号包裹起来，否则生成的BuildConfig类中会值类型错误</p>
<pre><code>buildConfigField(&quot;String&quot;, &quot;APP_URL&quot;, &quot;https://test-app.xuehu365.com/&quot;)
public static final String APP_URL = https://test-app.xuehu365.com/; //错误值类型，没有双引号

buildConfigField(&quot;String&quot;, &quot;APP_URL&quot;, &apos;&quot;https://test-app.xuehu365.com/&quot;&apos;)
public static final String APP_URL = &quot;https://test-app.xuehu365.com/&quot;;
</code></pre><p>生成的完整的BuildConfig类</p>
<pre><code>public static final boolean DEBUG = Boolean.parseBoolean(&quot;true&quot;);
public static final String APPLICATION_ID = &quot;com.xuehu365.xuehu&quot;;
public static final String BUILD_TYPE = &quot;debug&quot;;
public static final String FLAVOR = &quot;xuehuDetect&quot;;
public static final int VERSION_CODE = 280;
public static final String VERSION_NAME = &quot;2.8.0&quot;;
public static final String FLAVOR_channel = &quot;xuehu&quot;;
public static final String FLAVOR_server = &quot;detect&quot;;
// Fields from build type: debug
public static final boolean isDebug = true;
// Fields from product flavor: detect 正式开始自定义的值。上面都是预定义的
public static final String APP_URL = https://test-app.xuehu365.com/;
</code></pre><h1 id="flavorDimensions-一套代码打包多个应用"><a href="#flavorDimensions-一套代码打包多个应用" class="headerlink" title="flavorDimensions 一套代码打包多个应用"></a><a href="https://juejin.im/post/59648441f265da6c415f3078" target="_blank" rel="noopener">flavorDimensions 一套代码打包多个应用</a></h1><p>将某个应用更换 UI、文案或者某些界面布局和逻辑代码,换一套皮肤、第三方账号、后台服务器，改个名字上线，并且以后的新功能同步进行更新</p>
<p>总结一下技术点：</p>
<pre><code>manifestPlaceholders -&gt; AndroidManifest.xml 占位符
buildConfigField -&gt; BuildConfig 动态配置常量值
resValue -&gt; String.xml 动态配置字符串
signingConfigs -&gt; 配置签名文件
productFlavors -&gt; 产品定制多版本
flavorDimensions -&gt; 为产品定制设置多个维度
android.applicationVariants -&gt; 操作 task
</code></pre><p>示例： 区分渠道(官方，应用宝)和服务器版本（开发，测试，生产），</p>
<p>根据 Product Flavors 的两个维度和 Build Type [debug, release]，最后会生成 <code>2渠道x3服务器版本x2打包类型=12</code> 12个 Build Variant</p>
<pre><code>android {

    //创建两个维度的 flavor
    flavorDimensions &quot;server&quot;, &quot;channel&quot;//定义顺序很重要。决定BuildVariant和productFlavors.all批量遍历的name值(最后一维的flavor为name值)

    productFlavors {
        xuehu { dimension &quot;channel&quot; }
        yybao { dimension &quot;channel&quot; }

        dev {
            dimension &quot;server&quot;
            buildConfigField(&quot;String&quot;, &quot;APP_URL&quot;, &quot;https://dev.app.xuehu365.com/&quot;)
        }
        detect {
            dimension &quot;server&quot;
            buildConfigField(&quot;String&quot;, &quot;APP_URL&quot;, &quot;https://test-app.xuehu365.com/&quot;)
        }
        prod {
            dimension &quot;server&quot;
            buildConfigField(&quot;String&quot;, &quot;APP_URL&quot;, &quot;https://app.xuehu365.com/&quot;)
        }

        productFlavors.all {
            flavor -&gt; flavor.manifestPlaceholders = [UMENG_CHANNEL_VALUE: name]//取值为最后一维的值(xuehu,yybao等)
        }
    }
</code></pre><h1 id="android-applicationVariants"><a href="#android-applicationVariants" class="headerlink" title="android.applicationVariants"></a><a href="http://www.jianshu.com/p/25b385afd8b7" target="_blank" rel="noopener">android.applicationVariants</a></h1><p>Android工程相对Java工程来说，要复杂的多，因为通过Build Types和Product Flavors动态的创建很多任务。</p>
<ul>
<li>applicationVariants (仅仅适用于Android应用Gradle插件)</li>
<li>libraryVariants (仅仅适用于Android库Gradle插件)</li>
<li>testVariants (以上两种Gradle插件都使用)</li>
</ul>
<p>以上三个属性返回的都是<strong>DomainObjectSet对象集合</strong>，里面元素分别是ApplicationVariant、LibraryVariant和TestVariant</p>
<p>applicationVariants是Android动态构建的产物，可以代表google渠道正式服务器的release包，也可以代表baidu渠道dev开发服务器的debug包</p>
<p><strong>特别注意</strong>，访问以上这三种集合都会触发动态创建所有的任务。也就是说假如我们通过访问这些集合，修改生成Apk的输出文件名，那么就会自动的触发创建所有任务，此时我们修改后的新的Apk文件名就会在所有任务中起作用（如果我们在多个product flavor中都访问这些集合，就以最后一次访问结果为最终结果，而不是每个flavor有不同结果）。</p>
<p>applicationVariants是一个DomainObjectCollection集合，可以通过all方法进行遍历，遍历的每一个variant都是一个ApplicationVariant</p>
<p>ApplicationVariant，通过查看源代码看到它有一个outputs List集合 作为它的输出，我们再遍历它，如果它的名字是以.apk结尾的话那么就是我们要修改的apk名字了</p>
<pre><code>android.applicationVariants.all { variant -&gt;
    variant.outputs.each { output -&gt;
        if (output.outputFile != null &amp;&amp; output.outputFile.name.endsWith(&apos;.apk&apos;)) {
            def file = output.outputFile
            output.outputFile = new File(file.parent, file.name.replace(file.name,
                    variant.productFlavors[0].name + &quot;_&quot; +
                            variant.versionName
                            + &quot;_${variant.productFlavors[1].name}.apk&quot;))
        }
    }
}
</code></pre><h1 id="library-构建"><a href="#library-构建" class="headerlink" title="library 构建"></a>library 构建</h1><p><strong>library module 默认是输出 release 包的</strong>。所以默认情况下载library module 设置debug字段(如高德debug key)是浪费表情</p>
<h2 id="library-支持-debug-设置"><a href="#library-支持-debug-设置" class="headerlink" title="library 支持 debug 设置"></a>library 支持 debug 设置</h2><ul>
<li>library的gradle中加入以下配置 <code>publishNonDefault true</code> 意思是 library在打包的时候不只是打release包</li>
<li><p>主module的gradle中添加如下配置</p>
<pre><code>debugCompile project(path: &apos;:library&apos;, configuration: &apos;debug&apos;)
releaseCompile project(path: &apos;:library&apos;, configuration: &apos;release&apos;)
</code></pre><p>  这样项目就会根据不同的编译环境依赖对应的包。</p>
</li>
</ul>
<h1 id="compileSdkVersion与buildToolsVersion引起的问题"><a href="#compileSdkVersion与buildToolsVersion引起的问题" class="headerlink" title="compileSdkVersion与buildToolsVersion引起的问题"></a>compileSdkVersion与buildToolsVersion引起的问题</h1><pre><code>No resource found that matches the given name: attr &apos;android:keyboardNavigationCluster&apos;.
</code></pre><p>一般都是compileSdkVersion低于依赖的sdk版本，升级版本即可</p>
<pre><code>例如compileSdkVersion是25，依赖了v7:27。就会报错
</code></pre><h1 id="删除重复文件"><a href="#删除重复文件" class="headerlink" title="删除重复文件"></a>删除重复文件</h1><p>有时候依赖三方库会造成文件重复。比如腾讯im包含部分bugly的文件</p>
<pre><code>// 解决IM SDK与RN依赖和bugly冲突【libgnustl_shared.so】
import com.android.build.gradle.internal.pipeline.TransformTask

def deleteDuplicateJniFiles() {
    def files = fileTree(&quot;${buildDir}/intermediates/exploded-aar/shensz_android/imsdk/unspecified/jni/&quot;) {
        include &quot;**/libgnustl_shared.so&quot;
    }
    files.each { it.delete() }
    def buglyFiles = fileTree(&quot;${buildDir}/intermediates/exploded-aar/com.tencent.bugly/nativecrashreport/3.0/jni/&quot;) {
        include &quot;**/libBugly.so&quot;
    }
    buglyFiles.each { it.delete() }

    def sharedFiles = fileTree(&quot;${buildDir}/intermediates/exploded-aar/com.tencent.ilivesdk/ilivesdk/1.7.0/jni/&quot;) {
        include &quot;**/libstlport_shared.so&quot;
    }
    sharedFiles.each { it.delete() }
}

tasks.withType(TransformTask) { pkgTask -&gt;
    pkgTask.doFirst { deleteDuplicateJniFiles() }
}
</code></pre><h1 id="ResolutionStrategy"><a href="#ResolutionStrategy" class="headerlink" title="ResolutionStrategy"></a>ResolutionStrategy</h1><p>support包冲突,无法编译</p>
<p>最深的坑是：force强制使用某个版本，编译通过。然后在某些系统，ClassNotFoundException</p>
<pre><code>java.lang.ClassNotFoundException:Didn&apos;t find class &quot;android.support.v4.animation.AnimatorCompatHelper&quot; on path: DexPathList[[zip file &quot;/data/app/com.zy.course-1/base.apk&quot;],nativeLibraryDirectories=[/data/app/com.zy.course-1/lib/arm, /data/app/com.zy.course-1/base.apk!/lib/armeabi-v7a, /vendor/lib, /system/lib]]
    dalvik.system.BaseDexClassLoader.findClass(BaseDexClassLoader.java:56)
    java.lang.ClassLoader.loadClass(ClassLoader.java:511)
    java.lang.ClassLoader.loadClass(ClassLoader.java:469)
    android.support.v7.widget.DefaultItemAnimator.resetAnimation(ProGuard:515)
    android.support.v7.widget.DefaultItemAnimator.animateChange(ProGuard:322)
    android.support.v7.widget.SimpleItemAnimator.animateChange(ProGuard:149)
    android.support.v7.widget.RecyclerView.animateChange(ProGuard:3624)
</code></pre><p>原来方案：</p>
<pre><code>configurations.all {
    resolutionStrategy {
        force &apos;com.android.support:support-v4:27.0.1&apos;
        force &apos;com.android.support:design:27.0.1&apos;
        force &apos;com.android.support:appcompat-v7:27.0.1&apos;
    }
}
</code></pre><p>解决方案</p>
<pre><code>android {
    configurations.all {
            resolutionStrategy.eachDependency { DependencyResolveDetails details -&gt;
                def requested = details.requested
                if (requested.group == &apos;com.android.support&apos;) {
                    if (!requested.name.startsWith(&quot;multidex&quot;)) {
                        details.useVersion &apos;24.1.0&apos;
                    }
                }
            }
        }
}
</code></pre><h1 id="Walle-渠道包打包神器"><a href="#Walle-渠道包打包神器" class="headerlink" title="Walle 渠道包打包神器"></a>Walle 渠道包打包神器</h1><p>Android Signature V2 Scheme签名下的新一代渠道包打包神器</p>
<p><a href="https://github.com/Meituan-Dianping/walle" target="_blank" rel="noopener">github</a></p>
<h2 id="未开启V2签名错误"><a href="#未开启V2签名错误" class="headerlink" title="未开启V2签名错误"></a>未开启V2签名错误</h2><p><code>Plugin requires &#39;APK Signature Scheme v2 Enabled&#39; for Release.</code></p>
<p>官方教程要求 在 app 的 <code>build.gradle</code> 配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">  signingConfigs &#123;</span><br><span class="line">      sign &#123;</span><br><span class="line">          storeFile file(&quot;../sjd.jks&quot;)</span><br><span class="line">          storePassword &quot;sjd123&quot;</span><br><span class="line">          keyAlias &quot;sjd&quot;</span><br><span class="line">          keyPassword &quot;sjd123&quot;</span><br><span class="line">          v2SigningEnabled true//v2签名</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">   buildTypes &#123;</span><br><span class="line">      release &#123;</span><br><span class="line">          minifyEnabled false</span><br><span class="line">          proguardFiles getDefaultProguardFile(&apos;proguard-android-optimize.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class="line">          signingConfig signingConfigs.sign</span><br><span class="line">      &#125;</span><br><span class="line">      debug &#123;</span><br><span class="line">          minifyEnabled false</span><br><span class="line">          proguardFiles getDefaultProguardFile(&apos;proguard-android-optimize.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class="line">          signingConfig signingConfigs.sign</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置上还是提示未开启V2签名；排查gradle脚本好久，才发现项目未把 keystore文件和sign.properties文件加入git管理，然后ci工作空间这个两个文件被清理掉了。加入这个两个文件，打包成功。</p>
<p>所以，缺少签名配置也会报 未开启V2签名 这个错误</p>
<h1 id="设置代理"><a href="#设置代理" class="headerlink" title="设置代理"></a>设置代理</h1><p>配置文件 <code>gradle.properties</code></p>
<p>作用域：</p>
<ul>
<li>全局。配置文件在当前项目根目录下</li>
<li>当前项目。配置文件在 ~/.gradle目录下</li>
</ul>
<p>配置内容(Host和Port是必须)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemProp.http.proxyHost=xx.xx.xx.xx</span><br><span class="line">systemProp.http.proxyPort=xxxx</span><br><span class="line"># systemProp.http.proxyUser=userid</span><br><span class="line"># systemProp.http.proxyPassword=password</span><br><span class="line"># systemProp.http.nonProxyHosts=*.nonproxydomains.com|localhost</span><br><span class="line"></span><br><span class="line">systemProp.https.proxyHost=xx.xx.xx.xx</span><br><span class="line">systemProp.https.proxyPort=xxxx</span><br></pre></td></tr></table></figure>
<h1 id="替换仓库地址"><a href="#替换仓库地址" class="headerlink" title="替换仓库地址"></a>替换仓库地址</h1><h2 id="阿里云"><a href="#阿里云" class="headerlink" title="阿里云"></a>阿里云</h2><p>打开 <a href="https://maven.aliyun.com" target="_blank" rel="noopener">阿里云源</a><br>，会转到<a href="https://maven.aliyun.com/mvn/view。跟Android相关的有以下四个" target="_blank" rel="noopener">https://maven.aliyun.com/mvn/view。跟Android相关的有以下四个</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">maven &#123; url &apos;https://maven.aliyun.com/repository/jcenter&apos; &#125;</span><br><span class="line">maven &#123; url &apos;https://maven.aliyun.com/repository/google&apos; &#125;</span><br><span class="line">maven &#123; url &apos;https://maven.aliyun.com/repository/central&apos; &#125;</span><br><span class="line">maven &#123; url &apos;https://maven.aliyun.com/repository/gradle-plugin&apos; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>gradle 生命周期中有一个初始化(Initialization)的过程，初始化之后才会运行 build script。我们可以在初始化中定制一些全局设置，比如配置仓库地址。</p>
<p>可以使用初始化脚本的位置：</p>
<ul>
<li>命令行</li>
<li>放一个<code>init.gradle</code> 文件到<code>USER_HOME/.gradle/</code>目录下</li>
<li>放一个<code>xx.gradle</code>的文件到 <code>USER_HOME/.gradle/init.d/</code> 目录下.</li>
<li>放一个<code>xx.gradle</code>的文件到 <code>GRADLE_HOME/init.d/</code> 目录下.</li>
</ul>
<h2 id="文件内容"><a href="#文件内容" class="headerlink" title="文件内容"></a>文件内容</h2><h3 id="在最前面插入仓库"><a href="#在最前面插入仓库" class="headerlink" title="在最前面插入仓库"></a>在最前面插入仓库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenLocal()</span><br><span class="line">        maven &#123; url &apos;http://maven.aliyun.com/nexus/content/repositories/central/&apos; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样就会优先搜索本地和阿里云，找不到才会使用项目配置的仓库</p>
<h3 id="移除国外仓库"><a href="#移除国外仓库" class="headerlink" title="移除国外仓库"></a>移除国外仓库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven &#123; url &apos;https://maven.aliyun.com/repository/public/&apos; &#125;</span><br><span class="line">        maven &#123; url &apos;https://maven.aliyun.com/nexus/content/repositories/google&apos; &#125;</span><br><span class="line">        maven &#123; url &apos;https://maven.aliyun.com/nexus/content/groups/public/&apos; &#125;</span><br><span class="line">        maven &#123; url &apos;https://maven.aliyun.com/nexus/content/repositories/jcenter&apos;&#125;</span><br><span class="line"></span><br><span class="line">        all &#123; ArtifactRepository repo -&gt;</span><br><span class="line">            if (repo instanceof MavenArtifactRepository) &#123;</span><br><span class="line">                def url = repo.url.toString()</span><br><span class="line"></span><br><span class="line">                if (url.startsWith(&apos;https://repo.maven.apache.org/maven2/&apos;) || url.startsWith(&apos;https://repo.maven.org/maven2&apos;) || url.startsWith(&apos;https://repo1.maven.org/maven2&apos;) || url.startsWith(&apos;https://jcenter.bintray.com/&apos;)) &#123;</span><br><span class="line">                    //project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $REPOSITORY_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    buildscript &#123;</span><br><span class="line"></span><br><span class="line">        repositories &#123;</span><br><span class="line"></span><br><span class="line">            maven &#123; url &apos;https://maven.aliyun.com/repository/public/&apos;&#125;</span><br><span class="line">            maven &#123; url &apos;https://maven.aliyun.com/nexus/content/repositories/google&apos; &#125;</span><br><span class="line">            maven &#123; url &apos;https://maven.aliyun.com/nexus/content/groups/public/&apos; &#125;</span><br><span class="line">            maven &#123; url &apos;https://maven.aliyun.com/nexus/content/repositories/jcenter&apos;&#125;</span><br><span class="line">            all &#123; ArtifactRepository repo -&gt;</span><br><span class="line">                if (repo instanceof MavenArtifactRepository) &#123;</span><br><span class="line">                    def url = repo.url.toString()</span><br><span class="line">                    if (url.startsWith(&apos;https://repo1.maven.org/maven2&apos;) || url.startsWith(&apos;https://jcenter.bintray.com/&apos;)) &#123;</span><br><span class="line">                        //project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $REPOSITORY_URL.&quot;</span><br><span class="line">                        remove repo</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/03/Android/gradle/gradle导入依赖/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/03/Android/gradle/gradle导入依赖/" itemprop="url">gradle导入依赖</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-03T14:13:53+08:00">
                2020-02-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://segmentfault.com/a/1190000004237922" target="_blank" rel="noopener">Gradle for Android-第三篇、依赖管理</a></p>
<p><a href="http://www.androidchina.net/2467.html" target="_blank" rel="noopener">Android Studio 打包及引用 aar</a> </p>
<h1 id="依赖配置API"><a href="#依赖配置API" class="headerlink" title="依赖配置API"></a>依赖配置API</h1><h2 id="compile-–-api-implementation"><a href="#compile-–-api-implementation" class="headerlink" title="compile – api/implementation"></a>compile – api/implementation</h2><p>(Gradle plugin 3.0.0)</p>
<pre><code>依赖参与编译并且打包到最终的apk文件中。
    api
        外部依赖，等同于compile
    implementation
        内部依赖：编译期依赖隔离。将该依赖隐藏在内部，而不对外部公开(外部无法访问)
        提高编译速度：不会编译内部依赖
</code></pre><p>实例：A依赖B，B依赖C</p>
<p>依赖路径：</p>
<ul>
<li>compile/api：无法直观知道A所有的依赖，也无法直观知道传递依赖的具体版本</li>
<li>implementation：规范直观。虽然需要多写依赖</li>
</ul>
<p>编译期：C修改重新编译</p>
<ul>
<li>compile/api：AB都需要重新编译(即使A没有用到C的接口)</li>
<li>implementation：编译期隔离，只重新编译B</li>
</ul>
<p>打包运行：</p>
<ul>
<li>都会打包进apk。如果某依赖有多个版本，打包最高版本</li>
</ul>
<h3 id="编译期和运行期版本冲突"><a href="#编译期和运行期版本冲突" class="headerlink" title="编译期和运行期版本冲突"></a>编译期和运行期版本冲突</h3><pre><code>&apos;com.facebook.fresco:fresco&apos; has different version for the compile (1.3.0) and runtime (1.11.0) classpath. You should manually set the same version via DependencyResolution
</code></pre><p>统一版本即可</p>
<pre><code>configurations.all {
    resolutionStrategy.eachDependency { DependencyResolveDetails details -&gt;
        def requested = details.requested
        if (requested.group == &apos;com.facebook.fresco&apos;){
            details.useVersion &apos;1.3.0&apos;
        }
    }
}
</code></pre><h2 id="Provided-–-compileOnly"><a href="#Provided-–-compileOnly" class="headerlink" title="Provided – compileOnly"></a>Provided – compileOnly</h2><pre><code>依赖只在编译时使用，只参与编译，不打包到最终apk。类似eclipse中的external-libs,

注：使用Provided必须删除compile fileTree(include: [&apos;*.jar&apos;], dir: &apos;libs&apos;) 
不然lib下的jar均按照compile方式引入到Module
</code></pre><h2 id="apk-–-runtimeOnly"><a href="#apk-–-runtimeOnly" class="headerlink" title="apk – runtimeOnly"></a>apk – runtimeOnly</h2><pre><code>依赖只会打包到apk文件中，而不参与编译，所以不能在代码中直接调用jar中的类或方法，否则在编译时会报错
</code></pre><p>以上三个 对所有的build type以及favlors 有效</p>
<h2 id="testCompile"><a href="#testCompile" class="headerlink" title="testCompile"></a>testCompile</h2><pre><code>仅单元测试apk时有效，而对正常的debug或者release apk包不起作用。
</code></pre><h2 id="debug-compile"><a href="#debug-compile" class="headerlink" title="debug compile"></a>debug compile</h2><pre><code>仅debug模式的编译和最终的debug apk打包
</code></pre><h2 id="release-compile"><a href="#release-compile" class="headerlink" title="release compile"></a>release compile</h2><pre><code>仅Release 模式的编译和最终的Release apk打包。
</code></pre><h2 id="Gradle-plugin-3-0-0依赖使用api和implementation，废弃compile"><a href="#Gradle-plugin-3-0-0依赖使用api和implementation，废弃compile" class="headerlink" title="Gradle plugin 3.0.0依赖使用api和implementation，废弃compile"></a>Gradle plugin 3.0.0依赖使用api和implementation，废弃compile</h2><p>compile 兼容支持一段时间。即已废弃，还会保留一段时间，直到下个比较大的gradle tools版本发布</p>
<pre><code>compile fileTree(dir: &apos;xxx&apos;, include: [&apos;*.jar&apos;, &quot;*.xxx&quot;])：将某个目录下所有符合扩展名的文件作为依赖；
compile &apos;com.xx.xx:ProjectName:Version&apos;：配置Maven 库作为依赖；在 Maven 库中心 可以搜索自己想用的库进行依赖；
compile project(&apos;:AnotherModule&apos;)：配置另一个 Module 作为本 Module 的依赖，被依赖的 Module 必须被导入到当前工程中；
compile files(&apos;xxx.jar&apos;)：配置某个 jar 包作为依赖。
compile(name: &apos;xxx&apos;, ext: &apos;aar&apos;) //配置某个 aar 包作为依赖。xxx.aar是文件名

compile fileTree(include: [&apos;*.jar&apos;], dir: &apos;libs&apos;)
testCompile &apos;junit:junit:4.12&apos;
apt &apos;com.jakewharton:butterknife-compiler:8.0.1&apos;
compile &apos;com.android.support:appcompat-v7:23.3.0&apos;
compile &apos;com.squareup.retrofit2:retrofit:2.0.2&apos;
compile(name: &apos;Yrecycleview&apos;, ext: &apos;aar&apos;)
compile project(path: &apos;:easeui&apos;)
compile files(&apos;libs/hyphenatechat_3.1.3.jar&apos;)
</code></pre><h1 id="library-module"><a href="#library-module" class="headerlink" title="library module"></a>library module</h1><p>直接引入lib工程</p>
<pre><code>dependencies {
    compile project(&apos;:library名字&apos;)
    compile project(&apos;:libraries:library名字&apos;)//多个library，libraries是文件夹名字
}
</code></pre><h1 id="jar包依赖"><a href="#jar包依赖" class="headerlink" title="jar包依赖"></a>jar包依赖</h1><p>module目录下新建libs文件夹，放置jar</p>
<p>右键 Add As Library，选择相应module即可。</p>
<p>上面第二部的操作其实是配置了相应module的 <code>build.gradle</code></p>
<pre><code>dependencies {
       compile fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])//即添加所有在libs文件夹中的jar
       compile fileTree(&apos;libs/WuXiaolong.jar&apos;)
}
</code></pre><h2 id="添加jar包-Choose-the-appropriate-categories-from-the-list-错误"><a href="#添加jar包-Choose-the-appropriate-categories-from-the-list-错误" class="headerlink" title="添加jar包 Choose the appropriate categories from the list.错误"></a>添加jar包 Choose the appropriate categories from the list.错误</h2><pre><code>Android Studio cannot determine what kind of files the chosen items contain.
Choose the appropriate categories from the list.
- classes
- external annotations
- jar directory
- JavaDocs
- source archive directory
- sources
</code></pre><p>不用考虑，jar出错了！！！</p>
<pre><code>http://ask.android-studio.org/?/question/188
</code></pre><h1 id="so库依赖"><a href="#so库依赖" class="headerlink" title="so库依赖"></a>so库依赖</h1><p>app/src/main/目录下新建jniLibs目录，so库需要放入对应的cpu下（如armeabi）</p>
<pre><code>sourceSets{
    main.jniLibs.srcDir &apos;src/main/libs&apos; //默认so库目录
}
</code></pre><p>.so文件放在对应的文件夹中</p>
<pre><code>app
   ├── AndroidManifest.xml
   └── jniLibs
       ├── armeabi
       │   └── libiconv.so
       ├── armeabi-v7a
       │   └── libiconv.so
       ├── mips
       │   └── libiconv.so
       └── x86
           └── libiconv.so    
</code></pre><h2 id="暂时不提供64位的so文件"><a href="#暂时不提供64位的so文件" class="headerlink" title="暂时不提供64位的so文件"></a>暂时不提供64位的so文件</h2><p>解决方案：强制APP使用32位so</p>
<ul>
<li><p>指定只保留32位so库</p>
<pre><code>android{
    defaultConfig{
        ndk{abiFilters &quot;armeabi&quot;}
    }
}

如果配置后编译报错，在gradle.properties文件中加上 Android.useDeprecatedNdk=true； 
</code></pre></li>
<li><p>指定目录下必须有so文件(否则打包无该目录)</p>
<pre><code>build.gradle中配置的so加载目录:jniLibs.srcDir:customerDir

如果没有该项配置则so加载目录默认为：src/main/jniLibs

将.so文件放置该目录的armeabi文件夹下
    没有该目录则新建一个
    APP中没有使用到.so文件则需要拷贝任意一个32位的so文件到该目录下
        如果没有合适的so可以到官网http://x5.tencent.com/tbs/sdk.html下载官网“SDK接入示例“,拷贝对应目录下的liblbs.so文件
</code></pre></li>
</ul>
<p><a href="https://zhuanlan.zhihu.com/p/21359984" target="_blank" rel="noopener">与 so 有关的一个长年大坑</a><br><a href="https://developer.android.com/ndk/guides/abis.html?hl=is#sa" target="_blank" rel="noopener">ABI 管理</a> </p>
<h3 id="ABI"><a href="#ABI" class="headerlink" title="ABI"></a>ABI</h3><pre><code>mips / mips64: 极少用于手机可以忽略
x86 / x86_64: x86 架构的手机都会包含由 Intel 提供的称为 Houdini 的指令集动态转码工具，实现 对 arm .so 的兼容，再考虑 x86 1% 以下的市场占有率，x86 相关的两个 .so 也是可以忽略的
armeabi: 支持ARMV5TE和更高版本 相当老旧的版本 无硬浮点，在需要大量计算时有性能瓶颈
armeabi-v7a: 支持armeabi等 目前主流版本（与 ARMv5、v6 设备不兼容）
arm64-v8a: 支持AArch-64 64位支持
</code></pre><p>现在armeabi v5基本都淘汰了，<strong>建议保留armeabi-v7a就可以兼容到市面上的绝大多数手机</strong></p>
<p>选择保留armeabi(微信保留了) ，并保证armeabi 和 armeabi-v7a这两个文件夹中 so 数量一致</p>
<p><strong>对只提供 armeabi 版本的第三方 so，原样复制一份到 armeabi-v7a 文件夹（armeabi-v7a: 支持armeabi）。</strong></p>
<p><a href="http://www.jianshu.com/p/a8433f053248" target="_blank" rel="noopener">Android ABI想到的</a></p>
<h3 id="ABI-1"><a href="#ABI-1" class="headerlink" title="ABI"></a>ABI</h3><p>应用程序二进制接口ABI（Application Binary Interface）</p>
<h3 id="so文件"><a href="#so文件" class="headerlink" title=".so文件"></a>.so文件</h3><p>Native Libs Monitor 这个app可以帮助我们理解手机上安装的APK用到了哪些.so文件，以及.so文件来源于哪些函数库或者框架</p>
<h3 id="ABI和CPU的关系"><a href="#ABI和CPU的关系" class="headerlink" title="ABI和CPU的关系"></a>ABI和CPU的关系</h3><p>很多设备都支持多于一种的ABI</p>
<p>但最好是针对特 定平台提供相应平台的二进制包，这种情况下运行时就少了一个模拟层（例如x86设备上模拟arm的虚拟层），从而得到更好的性能</p>
<p>可以通过 <code>Build.SUPPORTED_ABIS</code> 得到根据偏好排序的设备支持的ABI列表。但你不应该从你的应用程序中读取它，因为 Android包管理器安装APK时，会自动选择APK包中为对应系统ABI预编译好的.so文件，如果在对应的lib／ABI目录中存在.so文件的话。</p>
<p>对应关系如下图：<br><img src="http://upload-images.jianshu.io/upload_images/2226246-efd370c8c43bd35f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><strong>不同CPU架构的Android手机加载时会在libs下找自己对应的目录，从对应的目录下寻找需要的.so文件；如果没有对应的目录，就会去armeabi下去寻找，如果已经有对应的目录，但是没有找到对应的.so文件，也不会去armeabi下去寻找了。</strong></p>
<p><strong>微信就是只有armeabi一个目录</strong></p>
<p>当引入一个新的预编译.so文件，而且项目中还存在其他的.so文件时，需要首先确认新引入的.so文件使用的C++运行时是否和已经存在的.so文件一致。</p>
<h3 id="xx-so-is-32-bit-instead-of-64-bit"><a href="#xx-so-is-32-bit-instead-of-64-bit" class="headerlink" title="xx.so is 32-bit instead of 64-bit"></a>xx.so is 32-bit instead of 64-bit</h3><p>这是因为module下有64位的so库目录，而某个so库却没有提供64位的</p>
<p><strong>解决方案：</strong></p>
<ul>
<li>只保留armeabi，删除其他以”armeabi“开头的文件夹</li>
<li><p>module的build.gradle</p>
<pre><code>android {
    defaultConfig {
        ndk {
            abiFilters &quot;armeabi&quot;
        }
    }
}
</code></pre></li>
<li><p>gradle.properties</p>
<pre><code>Android.useDeprecatedNdk=true
</code></pre></li>
</ul>
<h3 id="Android-6-0-so-动态库的适配"><a href="#Android-6-0-so-动态库的适配" class="headerlink" title="Android 6.0 + .so 动态库的适配"></a><a href="http://www.cnblogs.com/linguanh/p/6137641.html" target="_blank" rel="noopener">Android 6.0 + .so 动态库的适配</a></h3><h4 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h4><p>同一个 APP 在 api &lt;=22 的 sdk 情况下编译，可以运行正常，不存在闪退或者 .so 库加载失败的情况</p>
<p>当你采用 api &gt;=23 的sdk 编译的时候，安装到 Android 6.0 及其以上的手机的时候，大范围出现崩溃 或者 .so 库加载失败，而在 6.0 以下的手机却正常；</p>
<p>Catch的信息：<code>dlopen failed: cannot locate symbol &quot;XXXX&quot; xxxx.so</code></p>
<h4 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h4><p>不同链接方式，决定dlopen是否会打开指定的系统中(手机中)提供的动态库，并使用 dlsym 获取符号地址</p>
<p>在此时的手机中如果找不到，那么就会出问题，一般和 API 有关系。</p>
<p><code>Application.mk</code>，里面有一行 <code>APP_STL := XXX</code> 指明<code>库的链接方式</code></p>
<p><strong>STL的取值：</strong></p>
<pre><code>1）system，默认的值，最危险方式，直接和手机系统版本挂钩，采用手机最小版本的.so库链接

2）gabi++_static

3）gabi++_shared

4）stlport_static

5）stlport_shared

6）gnustl_static

7）gnustl_shared

主要是两种，静态链接，动态链接：

动态链接，是指在生成可执行文件时不将所有程序用到的函数链接到一个文件，因为有许多函数在操作系统带的dll文件中，当程序运行时直接从操作系统中找。

静态链接，是把所有用到的函数全部链接到 .so 文件中；
</code></pre><h4 id="目前存在该问题的知名SDK"><a href="#目前存在该问题的知名SDK" class="headerlink" title="目前存在该问题的知名SDK"></a>目前存在该问题的知名SDK</h4><p>百度地图、环信、高德地图、语音库 speex</p>
<p>不知道修复没有</p>
<p>这些 SDK 一但在你的 APK 编译版中中设置 API &gt;=23 就会出现各种问题，闪退或者抛出异常。</p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p>主要有两种：</p>
<ol>
<li><p>委曲求全，指标不治本，把你的 APK 编译时 API 降低到 23 以下，还出问题就继续降低</p>
<p> 这意味着，你很多 Android Sdk 的新控件用不了；</p>
</li>
<li><p>在 Application.mk 中修改 APP_STL，重新编译 .so 。</p>
</li>
</ol>
<p>如果没有源码，要么等他们解决，要么采用第一种，建议尝试 APP_STL := gnustl_shared 这种方式，对于所需要的外部动态链接函数、符号，在 NDK 13b 中都会独立生成一份，全部引用就解决此类问题，例如</p>
<pre><code>private void load() {
      try {
          System.loadLibrary(&quot;gnustl_shared&quot;);
          System.loadLibrary(&quot;speex&quot;);
      } catch (Throwable e) {
          Log.d(&quot;zzzzz&quot;,&quot;加载语音库异常 ：&quot;+e.toString());
      }
}
</code></pre><h1 id="aar文件"><a href="#aar文件" class="headerlink" title="aar文件"></a>aar文件</h1><ul>
<li>Android Library项目导出的<strong>jar文件不能包含资源文件</strong>，<ul>
<li>比如一些drawable文件、xml资源文件之类的，</li>
<li>在gradle之前我们要引用带资源文件的Android Library必须要把整个library导入进来进行引用</li>
</ul>
</li>
<li>Android Library项目导出的<strong>aar（包含资源文件、第三方库文件、so、manifest ）</strong><ul>
<li>gradle最普遍的方法是把aar上传到mavenCentral或者jcenter</li>
</ul>
</li>
</ul>
<h2 id="导出aar"><a href="#导出aar" class="headerlink" title="导出aar"></a>导出aar</h2><pre><code>apply plugin: &apos;com.android.library&apos; //输出 aar。 
apply plugin: &apos;com.android.application&apos; //输出 apk

gradle aR 生成 aar
</code></pre><p>library库输出的.aar文件，目录为 [ModuleName]/build/outputs/aar</p>
<h2 id="依赖aar-两种方式"><a href="#依赖aar-两种方式" class="headerlink" title="依赖aar 两种方式"></a>依赖aar 两种方式</h2><ol>
<li><p>直接导入。不推荐</p>
<pre><code>File -- Project Structure，添加一个新 Module，选择 Import *.JAR or *.AAR Package
导入后，在你的工程下面，会生成一个文件夹，里面是 aar 文件以及 Android Studio 的配置文件。
接着在 gradle 中配置依赖，依赖方式使用 compile project 的方式
</code></pre><p> <code>缺点</code>：被依赖的 aar 无法 F3 跟进去，无法看到资源文件内容以及目录层级等</p>
</li>
<li><p>依赖配置。<strong>推荐使用</strong></p>
<ul>
<li><p>module目录下新建aars文件夹，放置aar</p>
<pre><code>repositories {
    flatDir {
        dirs &apos;aars&apos; //添加该文件夹作为依赖库
    }
}

dependencies {
    compile(name:&apos;libraryname&apos;, ext:&apos;aar&apos;)
}
</code></pre></li>
</ul>
</li>
</ol>
<p>lib module 依赖了aar库，failed to resolve aar</p>
<p>在app module 的build.gradle中加入下面代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;  </span><br><span class="line">    flatDir &#123;  </span><br><span class="line">        dirs project(&apos;:taesdk&apos;).file(&apos;libs&apos;)  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="手动下载远程aar"><a href="#手动下载远程aar" class="headerlink" title="手动下载远程aar"></a>手动下载远程aar</h1><p>有时gradle构建下载依赖包出现错误(timeout)，可以手动去仓库下载，放到gradle的cache目录(<code>~/.gradle/caches/modules-2/files-2.1</code>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; Could not download codeview-android.aar (com.github.softwee:codeview-android:1.2.0)</span><br><span class="line">  &gt; Could not get resource &apos;https://jitpack.io/com/github/softwee/codeview-android/1.2.0/codeview-android-1.2.0.aar&apos;.</span><br><span class="line">     &gt; Read timed out</span><br></pre></td></tr></table></figure>
<p>最终目录 <code>/Users/liyungui/.gradle/caches/modules-2/files-2.1/com.github.softwee/codeview-android/1.2.0/83787aabb0260a92ae7c9632e56995a38395560d/codeview-android-1.2.0.aar</code></p>
<p>关于文件父目录，网上资料很少，其实是文件SHA1码</p>
<p>mac的话可以用 <code>shasum</code> 命令查看，win的话是 <code>certutil -hashfile</code></p>
<p>一般情况，jar、aar、pom、source、doc等文件，都是一个SHA1目录对应一个文件。</p>
<p>有时jar和pom会下载到同一个目录下面，这其实还是用的是jar的SHA1</p>
<h1 id="依赖module和主module-资源id-冲突"><a href="#依赖module和主module-资源id-冲突" class="headerlink" title="依赖module和主module 资源id 冲突"></a>依赖module和主module 资源id 冲突</h1><p>android studio 并不会对依赖module和主module 资源id 在编译时时报错（eclipse会）</p>
<p>如 依赖和主module 都有 activity_main.xml 布局文件，在运行时，依赖module 中activity_main中的id就会找不到，因为首先是在主module中的activity_main文件中查找，就会报错 <code>ava.lang.NoSuchFieldError: No static field rl_dd of type I in class Lcom/xuehu365/videoviewmediacontroller/R$id;</code></p>
<p>确保依赖工程和主module 资源文件名 不重复即可。</p>
<p><strong>每个资源文件名中的控件id可以重复，不影响查找（只要控件id不在同一个资源文件中）</strong></p>
<h1 id="远程依赖包重复问题"><a href="#远程依赖包重复问题" class="headerlink" title="远程依赖包重复问题"></a><a href="https://juejin.im/post/591a5084128fe1005cda382d" target="_blank" rel="noopener">远程依赖包重复问题</a></h1><p>错误 <code>com.android.dex.DexException: Multiple dex files define XXXX</code></p>
<p>或 <code>java.util.zip.ZipException: duplicate entry: uk/co/senab/photoview/BuildConfig.class</code></p>
<p>引用了重复的库或者jar包引起的</p>
<p>两个库同时引用了同一个第三方库，最坑人的是都是直接引用，而不是使用 Provided 的方式</p>
<p><strong>解决思路</strong>：找到重复删掉一个</p>
<pre><code>gradlew -q app:dependencies 命令，输出树状依赖

星号后缀标记 (*)，意思是忽略该依赖(不下载)
</code></pre><ul>
<li><p>删掉远程依赖库的依赖</p>
<pre><code>compile(&apos;com.loonggg.saoyisao.lib:1.1.0&apos;)
compile(&apos;com.timmy.qrcode.lib:1.4.1&apos;) {
        exclude group: &apos;com.google.zxing&apos;
}
编译时将group为com.google.zxing的所有library都去除在外，com.timmy.qrcode.lib:1.4.1就会自动去引用com.loonggg.saoyisao.lib:1.1.0项目里的zxing依赖
</code></pre></li>
<li><p>删掉本地依赖库的依赖</p>
<pre><code>下载修改后重修打jar包，蛋疼
</code></pre></li>
</ul>
<p><code>java.util.zip.ZipException: duplicate entry: tv/danmaku/ijk/media/player/AbstractMediaPlayer.class</code></p>
<p><strong>完美解决方式</strong> <code>resolutionStrategy.force</code></p>
<pre><code>configurations.all {
    resolutionStrategy {
        force &apos;com.android.support:support-v4:27.0.1&apos;
        force &apos;com.android.support:design:27.0.1&apos;
        force &apos;com.android.support:appcompat-v7:27.0.1&apos;
    }
}
</code></pre><h1 id="v4包重复"><a href="#v4包重复" class="headerlink" title="v4包重复"></a>v4包重复</h1><p>v7包已经包含了v4包。</p>
<p>所以如果主module已有v7包依赖，lib module有v4包依赖，就会v4包重复。这时需要把v7包中的v4 exclude</p>
<pre><code>compile(&apos;com.airbnb.android:lottie:2.5.4&apos;) { exclude group: &apos;com.android.support.v4&apos; }
    lottie依赖v7包
</code></pre><h1 id="v4-v7包在线依赖失败"><a href="#v4-v7包在线依赖失败" class="headerlink" title="v4 v7包在线依赖失败"></a>v4 v7包在线依赖失败</h1><pre><code>//将maven.googlecom
//maven { url &apos;https://maven.google.com/&apos; }
//替换为
maven { url &apos;https://dl.google.com/dl/android/maven2/&apos; }
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/03/Android/gradle/gradle构建最佳实践/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/03/Android/gradle/gradle构建最佳实践/" itemprop="url">gradle构建最佳实践</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-03T14:13:53+08:00">
                2020-02-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>gradle构建最佳实践 https://www.figotan.org/2016/04/01/gradle-on-android-best-practise/
Gradle构建编译速度太慢的解决方法 http://www.52codes.net/article/658.html
加速Android Studio/Gradle构建 http://blog.isming.me/2015/03/18/android-build-speed-up/
</code></pre><h1 id="加速篇"><a href="#加速篇" class="headerlink" title="加速篇"></a>加速篇</h1><p>GRADLE的构建过程通常会比较漫长，一个中等项目，10M左右大小的app，一次完整构建大概在5分钟左右。</p>
<p>调试阶段，采用Android Studuo 2.0，默认提供的Instant Run方式，每次修改都不会重新构建项目，从而加快了构建过程。</p>
<p>GRADLE一次完整的构建过程通常分成三个部分，初始化，配置和执行任务，那么我们可以考虑从这三个部分分别尝试优化。</p>
<h3 id="1-开启daemon"><a href="#1-开启daemon" class="headerlink" title="1. 开启daemon"></a>1. 开启daemon</h3><p>构建初始化的很多工作是关于java虚拟机的启动，加载虚拟机环境，加载class文件等，这些动作交给一个单独的后台进程去做</p>
<pre><code>gradle.properties（全局起效是~/.gradle/gradle.properties，从工程目录拷贝过来）

org.gradle.daemon=true
</code></pre><h3 id="2-并行构建模块化项目"><a href="#2-并行构建模块化项目" class="headerlink" title="2. 并行构建模块化项目"></a>2. 并行构建模块化项目</h3><p>库工程(Library projects)，主工程(Application project)并行构建</p>
<pre><code>org.gradle.parallel=true
</code></pre><h3 id="3-按需配置"><a href="#3-按需配置" class="headerlink" title="3. 按需配置"></a>3. 按需配置</h3><pre><code>org.gradle.configureondemand=true
</code></pre><h3 id="4-增大gradle运行的java虚拟机的大小"><a href="#4-增大gradle运行的java虚拟机的大小" class="headerlink" title="4. 增大gradle运行的java虚拟机的大小"></a>4. 增大gradle运行的java虚拟机的大小</h3><p>org.gradle.jvmargs=-Xmx2048m -XX:MaxPermSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8</p>
<h3 id="5-依赖库使用固定版本"><a href="#5-依赖库使用固定版本" class="headerlink" title="5. 依赖库使用固定版本"></a>5. 依赖库使用固定版本</h3><pre><code>compile &apos;com.google.code.gson:gson:2.2.1&apos;

compile &apos;com.google.code.gson:gson:2.+&apos;这种避免使用，每次都去repo拉取最新版本
</code></pre><h3 id="6-升级到最新的GRADLE、和android-gradle-plugin-和-JDK"><a href="#6-升级到最新的GRADLE、和android-gradle-plugin-和-JDK" class="headerlink" title="6. 升级到最新的GRADLE、和android gradle plugin 和 JDK"></a>6. 升级到最新的GRADLE、和android gradle plugin 和 JDK</h3><p>最新版的GRADLE和JDK往往是性能最好</p>
<p>GRALDE采用了一种叫做wrapper的方式，可以做到每个项目独立使用其自己的GRADLE版本，这样做的好处是每个项目的构建环境独立，互不影响。GRADLE发展太快，新旧版本之间很难兼容。假设都用同一个全局的GRADLE，那么当这个GRADLE升级后，所有的项目可能都会编译失败，你得一个一个改配置</p>
<h3 id="7-命令行构建"><a href="#7-命令行构建" class="headerlink" title="7. 命令行构建"></a>7. 命令行构建</h3><p>Android Studio中，点击运行是将当前的构建任务加入到队列中。如果你改过build.gradle的文件导致它在同步脚本时，就必须等到这个任务完成之后才会执行你刚才的构建任务</p>
<h3 id="8-屏蔽不必要的productFlavor"><a href="#8-屏蔽不必要的productFlavor" class="headerlink" title="8. 屏蔽不必要的productFlavor"></a>8. 屏蔽不必要的productFlavor</h3><p>尽管只是要构建Develop版本，但还是会去解析每一个productFlavor的依赖，并且在依赖上卡很久。所以在构建时先注释掉其他pruductFlavor</p>
<h3 id="9-使用离线模式"><a href="#9-使用离线模式" class="headerlink" title="9. 使用离线模式"></a>9. 使用离线模式</h3><p>编译过一次，依赖应该都在本地中有缓存了。这时命令行构建可以使用–offline参数</p>
<h3 id="10-没必要-不要在构建时进行clean"><a href="#10-没必要-不要在构建时进行clean" class="headerlink" title="10. 没必要 不要在构建时进行clean"></a>10. 没必要 不要在构建时进行clean</h3><h3 id="11-引入依赖库尽量使用aar"><a href="#11-引入依赖库尽量使用aar" class="headerlink" title="11. 引入依赖库尽量使用aar"></a>11. 引入依赖库尽量使用aar</h3><pre><code>maven http://gradleplease.appspot.com/
githu https://github.com/Goddchen/mvn-repo。
</code></pre><p>自己的库模块也可以打包成aar</p>
<p><strong>以上功能其实可以通过修改android studio配置实现，区别是配置只会在ide构建的时候生效，命令行构建不会生效</strong></p>
<p>Gradle 和 Compiler 两个选项卡中配置</p>
<h1 id="gradle-把依赖缓存在哪"><a href="#gradle-把依赖缓存在哪" class="headerlink" title="gradle 把依赖缓存在哪"></a>gradle 把依赖缓存在哪</h1><p>用户目录\ .gradle\caches\modules-2\files-2.1</p>
<h1 id="使用Gradle-Wrapper必要性"><a href="#使用Gradle-Wrapper必要性" class="headerlink" title="使用Gradle Wrapper必要性"></a>使用Gradle Wrapper必要性</h1><p>便于统一项目所使用的gradle版本。</p>
<p>GRALDE采用了一种叫做wrapper的方式，可以做到每个项目独立使用其自己的GRADLE版本，这样做的好处是每个项目的构建环境独立，互不影响。GRADLE发展太快，新旧版本之间很难兼容。假设都用同一个全局的GRADLE，那么当这个GRADLE升级后，所有的项目可能都会编译失败，你得一个一个改配置</p>
<p>使用Gradle Wrapper，自动下载二进制包的时间需要以分钟计算（毕竟服务器在国外），不过还好，这个过程只会出现一次</p>
<h1 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h1><h2 id="Error-Configuration-with-name-‘default’-not-found"><a href="#Error-Configuration-with-name-‘default’-not-found" class="headerlink" title="Error:Configuration with name ‘default’ not found."></a><a href="http://blog.csdn.net/luo451591667/article/details/50667549" target="_blank" rel="noopener">Error:Configuration with name ‘default’ not found.</a></h2><p>同事添加了某个module,自己同步代码后会出现Error:Configuration with name ‘default’ not found.的错误,</p>
<p>这是因为同步时不会自动把<code>远程仓库</code>下载下来，需要你自己初始化下载,这时只要执行:</p>
<pre><code>git submodule update --init --recursive 
</code></pre><p><strong>实例</strong> </p>
<p><a href="https://github.com/eolwral/OSMonitor/" target="_blank" rel="noopener">https://github.com/eolwral/OSMonitor/</a></p>
<p>包含远程仓库</p>
<pre><code>colorpicker @ ec1d13e
volley @ d20f9d3
</code></pre><p>下载回来发现 colorpicker 和volley文件夹为空</p>
<pre><code>$ git submodule update --init --recursive
Submodule &apos;colorpicker&apos; (https://github.com/eolwral/android-ColorPickerPreference.git) registered for path &apos;colorpicker&apos;
Submodule &apos;volley&apos; (https://android.googlesource.com/platform/frameworks/volley/) registered for path &apos;volley&apos;
Cloning into &apos;colorpicker&apos;...
remote: Counting objects: 394, done.
Receivin94 g objects:  77% (3(0d4/39e4lta 0), reused 0) ,(del 2ta 0), pa4ck4.00  394
Receiving objects: 100% (394/394), 252.30 KiB | 83.00 KiB/s, done.
Resolving deltas: 100% (164/164), done.
Checking connectivity... done.
Submodule path &apos;colorpicker&apos;: checked out &apos;ec1d13e450e65bbd086bd6094c5cd36a4da737fa&apos;
Cloning into &apos;volley&apos;...
fatal: unable to access &apos;https://android.googlesource.com/platform/frameworks/volley/&apos;: Failed to connect to android.googlesource.com port 443: Timed out
fatal: clone of &apos;https://android.googlesource.com/platform/frameworks/volley/&apos; into submodule path &apos;volley&apos; failed
</code></pre><p>volley下载失败，点击发现volley远程仓库地址失效（无法跳转），手动搜索下载volley</p>
<h2 id="transformClassesWithDexForXuehuDebug-UnsupportedOperationException"><a href="#transformClassesWithDexForXuehuDebug-UnsupportedOperationException" class="headerlink" title="transformClassesWithDexForXuehuDebug UnsupportedOperationException"></a>transformClassesWithDexForXuehuDebug UnsupportedOperationException</h2><p>可能两种原因：</p>
<ol>
<li>JDK1.8与gradle不兼容</li>
<li><p>内存不足</p>
<p> 主module build.gradle</p>
<pre><code>dexOptions {
    javaMaxHeapSize &quot;4g&quot;
    preDexLibraries = false
}

defaultConfig {
    multiDexEnabledtrue
}

dependencies {
    compile &apos;com.android.support:multidex:1.0.1&apos;
}
</code></pre></li>
</ol>
<h2 id="Unsupported-major-minor-version-52-0"><a href="#Unsupported-major-minor-version-52-0" class="headerlink" title="Unsupported major.minor version 52.0"></a>Unsupported major.minor version 52.0</h2><pre><code>java.lang.UnsupportedClassVersionError: com/android/build/gradle/LibraryPlugin : Unsupported major.minor version 52.0
</code></pre><p>可能两种原因：</p>
<ol>
<li>JDK1.8与gradle不兼容</li>
<li><p>compileSdkVersion 和 buildToolsVersion 版本不一致。一个23，一个24</p>
<pre><code>android {
    compileSdkVersion 23
    buildToolsVersion &quot;24.0.3&quot;
</code></pre></li>
</ol>
<h1 id="指定cpu类型，减少apk体积"><a href="#指定cpu类型，减少apk体积" class="headerlink" title="指定cpu类型，减少apk体积"></a>指定cpu类型，减少apk体积</h1><p>gradle.properties</p>
<pre><code>android.useDeprecatedNdk=true
</code></pre><p>主module 的 build.gradle</p>
<pre><code>android {
    defaultConfig {
        ndk {
            abiFilters &quot;armeabi&quot;, &quot;armeabi-v7a&quot;, &quot;armeabi-v8a&quot;, &quot;x86&quot;
        }
    }
}
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/31/">31</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="风" />
            
              <p class="site-author-name" itemprop="name">风</p>
              <p class="site-description motion-element" itemprop="description">随心而动，随刃而行</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">308</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">71</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">风</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  







  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
