<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="随心而动，随刃而行">
<meta property="og:type" content="website">
<meta property="og:title" content="风">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="风">
<meta property="og:description" content="随心而动，随刃而行">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="风">
<meta name="twitter:description" content="随心而动，随刃而行">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>风</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">风</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">技术博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/10/测试/UI自动化测试框架/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/10/测试/UI自动化测试框架/" itemprop="url">UI自动化测试框架</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-10T10:25:42+08:00">
                2020-04-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/测试/" itemprop="url" rel="index">
                    <span itemprop="name">测试</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="自动化测试"><a href="#自动化测试" class="headerlink" title="自动化测试"></a>自动化测试</h1><p>自动化测试听起来很神秘，学起来很简单，用起来很麻烦</p>
<h1 id="框架选型"><a href="#框架选型" class="headerlink" title="框架选型"></a>框架选型</h1><p><strong>手机原生APP</strong>：跨平台用的最多的Appium，纯安卓的可以用Robotium。</p>
<p><strong>WEB</strong>：selenium，Katalon(支持POM、录制)</p>
<p><strong>游戏</strong>：网易Airtest，可以让你像测原生APP一样测试游戏。腾讯也有一款相同的产品：GAutomator。Airtest现在的优势还是Poco框架控件定位(Poco性能和兼容性强，而且Poco能获取属性值，测试更加灵活；而Airtest框架找图太不专业，换个分辨率就不行了)</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/10/测试/网易UI自动化测试Airtest/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/10/测试/网易UI自动化测试Airtest/" itemprop="url">网易UI自动化测试Airtest</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-10T10:25:42+08:00">
                2020-04-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/测试/" itemprop="url" rel="index">
                    <span itemprop="name">测试</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Airtest"><a href="#Airtest" class="headerlink" title="Airtest"></a>Airtest</h1><h2 id="框架概述"><a href="#框架概述" class="headerlink" title="框架概述"></a>框架概述</h2><p>2018 GDC 开幕第一天，谷歌发布了一款由网易研发的游戏 UI 自动化测试框架：Airtest Project。</p>
<p>谷歌方面表示 Airtest 是安卓游戏开发最强大、最全面的自动测试方案之一</p>
<p>该工具已经应用于网易内部《梦幻西游》手游、《荒野行动》、《阴阳师》等数十个游戏项目中</p>
<h2 id="框架结构"><a href="#框架结构" class="headerlink" title="框架结构"></a>框架结构</h2><p>Airtest 主要包含了三部分：</p>
<ul>
<li><strong>Airtest</strong>。底层自动化测试框架<ul>
<li>基于图像识别</li>
</ul>
</li>
<li><strong>Poco</strong>。底层自动化测试框架<ul>
<li>基于UI控件搜索</li>
</ul>
</li>
<li><strong>Airtest IDE</strong>。跨平台的 UI 自动化测试编辑器</li>
<li><strong>AirLab</strong>。真机自动化云测试平台，目前提供了TOP100手机兼容性测试、海外云真机兼容性测试等服务</li>
<li><strong>私有化手机集群技术方案</strong>。从硬件到软件，提供了企业内部私有化手机集群的解决方案</li>
</ul>
<h2 id="框架特性"><a href="#框架特性" class="headerlink" title="框架特性"></a>框架特性</h2><ul>
<li><strong>基于Python</strong>。可以引入Python库扩展脚本能力<ul>
<li>因此写出来的所有脚本都是Python代码</li>
<li>建议在使用前，先学习Python的基础语法知识</li>
<li>通过添加PYTHONPATH设置，可以使用本地的python运行脚本</li>
</ul>
</li>
<li><strong>灵活定位控件</strong>。<ul>
<li>支持 图像识别 和 UI控件搜索 两种方式定位控件</li>
</ul>
</li>
<li><strong>IDE功能完善</strong>，能<strong>快速简单</strong>编写脚本。    <ul>
<li>支持 自动化脚本录制、一键回放、报告查看，轻而易举实现自动化测试流程</li>
</ul>
</li>
<li>可利用<strong>手机集群</strong>进行<strong>大规模自动化</strong>测试，为游戏与 APP 快速实现兼容性测试</li>
</ul>
<h1 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h2 id="连接设备"><a href="#连接设备" class="headerlink" title="连接设备"></a>连接设备</h2><h3 id="连接Android手机"><a href="#连接Android手机" class="headerlink" title="连接Android手机"></a>连接Android手机</h3><ol>
<li>安卓手机 打开 USB调试</li>
<li>IDE – 右侧 Device Screen – 点击 refresh ADB</li>
<li>看到设备后，点击对应设备的 Connect 按钮</li>
<li>连接成功，右侧会显示手机屏幕的镜像</li>
</ol>
<h2 id="录制脚本"><a href="#录制脚本" class="headerlink" title="录制脚本"></a>录制脚本</h2><h3 id="基于Airtest图像识别"><a href="#基于Airtest图像识别" class="headerlink" title="基于Airtest图像识别"></a>基于Airtest图像识别</h3><ol>
<li><code>Airtest Assistant</code>窗口 点击 <code>start recording</code> </li>
<li>点击 <code>Device Screen</code> 手机镜像 相应位置按钮，自动生成代码</li>
<li>点击 <code>Run script</code> 查看效果</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding=utf8 -*-</span></span><br><span class="line">__author__ = <span class="string">"liyungui"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> airtest.core.api <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">auto_setup(__file__) <span class="comment"># 自动配置运行环境</span></span><br><span class="line"></span><br><span class="line">touch(Template(<span class="string">r"tpl1586491050046.png"</span>, record_pos=(<span class="number">-0.106</span>, <span class="number">-0.708</span>), resolution=(<span class="number">1080.0</span>, <span class="number">2280.0</span>)))</span><br></pre></td></tr></table></figure>
<p>自动录制生成的图标不够精确，还可以点击Airtest辅助窗上的touch按钮，然后在设备窗口上框选精确的图标，也可以自动生成一条touch语句</p>
<h3 id="基于Poco控件搜索"><a href="#基于Poco控件搜索" class="headerlink" title="基于Poco控件搜索"></a>基于Poco控件搜索</h3><h4 id="SDK集成"><a href="#SDK集成" class="headerlink" title="SDK集成"></a>SDK集成</h4><p><code>Android/iOS</code>原生应用，是即插即用的，无需接入SDK。</p>
<p>但由于游戏引擎使用OpenGL等图形接口直接渲染，而没有使用原生的UI系统，需要集成SDK与游戏的Runtime进行通信获取整个UI结构</p>
<p>如果使用的引擎或平台不在文档中，同样支持自行扩展SDK。</p>
<p>实际上在网易游戏内部，就是用这种方式支持了<code>Messiah/NeoX/梦幻</code>等多个自研引擎</p>
<h4 id="初始化poco"><a href="#初始化poco" class="headerlink" title="初始化poco"></a>初始化poco</h4><ol>
<li><code>Poco Assistant</code>窗口 下来选择 对应平台 <code>Android</code></li>
<li>会在手机上安装 <code>Yosemite</code> 和 <code>PocoService</code></li>
<li>提示是否要初始化poco，选择是，会自动导入并初始化poco</li>
</ol>
<h4 id="录制脚本-1"><a href="#录制脚本-1" class="headerlink" title="录制脚本"></a>录制脚本</h4><ol>
<li><code>Poco Assistant</code>窗口 点击 <code>poco auto recording</code> </li>
<li>点击 <code>Device Screen</code> 手机镜像 相应位置按钮，自动生成代码</li>
<li>点击 <code>Run script</code> 查看效果</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding=utf8 -*-</span></span><br><span class="line">__author__ = <span class="string">"liyungui"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> airtest.core.api <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">auto_setup(__file__) <span class="comment"># 自动配置运行环境</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> poco.drivers.android.uiautomation <span class="keyword">import</span> AndroidUiautomationPoco</span><br><span class="line">poco = AndroidUiautomationPoco(use_airtest_input=<span class="keyword">True</span>, screenshot_each_action=<span class="keyword">False</span>)</span><br><span class="line">poco(<span class="string">"com.zy.course.dev:id/tv_user_name"</span>).click()</span><br></pre></td></tr></table></figure>
<p>自动录制出的语句不一定能够适应所有场景，采用更合理的选择器编写代码，通常会增强整个自动化脚本的健壮性和可读性</p>
<h2 id="执行脚本"><a href="#执行脚本" class="headerlink" title="执行脚本"></a>执行脚本</h2><p>运行脚本</p>
<h2 id="查看测试报告"><a href="#查看测试报告" class="headerlink" title="查看测试报告"></a>查看测试报告</h2><p>脚本运行完毕后，点击查看报告按钮（<code>快捷键Ctrl+L</code>），会使用默认浏览器打开结果报告页面。报告中将展示出每一个步骤的内容和实际执行过程的截图、运行结果，方便查看步骤是否执行成功。</p>
<p>这个报告非常直观，点赞！</p>
<h1 id="air脚本"><a href="#air脚本" class="headerlink" title=".air脚本"></a><code>.air</code>脚本</h1><h2 id="本质：含有同名-py文件的文件夹"><a href="#本质：含有同名-py文件的文件夹" class="headerlink" title="本质：含有同名.py文件的文件夹"></a>本质：含有<code>同名.py文件</code>的文件夹</h2><p>实际上<code>.air脚本</code>文件是一个普通的<code>文件夹</code>，里面附带了一个同名的<code>.py</code>文件，AirtestIDE在执行脚本时，实际上执行的是里面的<code>.py</code>文件</p>
<h1 id="图片类Template"><a href="#图片类Template" class="headerlink" title="图片类Template"></a>图片类Template</h1><p><code>classTemplate(filename, threshold=None, target_pos=5, record_pos=None, resolution=(), rgb=False)</code></p>
<ul>
<li><strong>filename</strong>。图片名。IDE截图默认3参数之一</li>
<li><strong>record_pos</strong>。截图位置。IDE截图默认3参数之一<ul>
<li>优先在录制时的位置附近查找</li>
<li>如果找不到符合条件的图片，再扩大寻找范围到整个画面。</li>
<li>这样能够提升查找图片的速度和精确度</li>
</ul>
</li>
<li><strong>resolution</strong>。截图屏幕分辨率。IDE截图默认3参数之一<ul>
<li>在不同分辨率设备上进行缩放<ul>
<li>默认使用Cocos引擎的缩放规则<ul>
<li><a href="http://docs.cocos.com/creator/manual/zh/ui/multi-resolution.html" target="_blank" rel="noopener">Cocos引擎的缩放规则</a></li>
<li><a href="https://github.com/AirtestProject/Airtest/blob/73618beb07acf5c6b9b9704575a6bd1561c7c2db/airtest/utils/resolution.py#L11" target="_blank" rel="noopener">代码</a></li>
</ul>
</li>
</ul>
</li>
<li>方便图片的跨分辨率匹配</li>
</ul>
</li>
<li><strong>threshold</strong>。图像识别阈值<ul>
<li>取值范围为[0, 1]，默认值是0.7</li>
<li>建议阈值设定在[0.6, 0.9]之间<ul>
<li>过低混入错误结果</li>
<li>过高导致经常找不到</li>
</ul>
</li>
<li>与图像识别的成功率息息相关</li>
<li>可信度大于阈值时才会返回识别结果</li>
</ul>
</li>
<li><strong>rgb</strong>。是否灰度识别还是彩色识别</li>
<li><strong>target_pos</strong>。点击位置<ul>
<li>将图片划分为三横三列[1, 9]，默认值是5(图片正中间)</li>
</ul>
</li>
</ul>
<p>后面三个参数可以单独配置，也可以脚本全局配置</p>
<p><strong>血泪经验：只用来识别图标</strong>。不同设备环境的字体效果实在太多惊喜！</p>
<h2 id="图像识别阈值"><a href="#图像识别阈值" class="headerlink" title="图像识别阈值"></a>图像识别阈值</h2><p>官方强烈推荐使用“图片编辑器”修改阈值。</p>
<p>【注意】实际开发过程中，发现图像编辑器识别结果的区域和置信区间仅供参考，很多时候是不准的。定位问题以测试报告为准</p>
<ol>
<li>在脚本框中双击图片打开“图片编辑器”</li>
<li>点击<code>Snapshot + Recognition</code> 按钮来实时验证识别结果。</li>
<li>识别结果的可信度会直接呈现在下方状态栏上，可信度大于阈值时才会返回识别结果</li>
</ol>
<h2 id="图像匹配过程日志"><a href="#图像匹配过程日志" class="headerlink" title="图像匹配过程日志"></a>图像匹配过程日志</h2><p>我们可以通过日志分析图像匹配的完整过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[05:10:15][INFO]&lt;airtest.core.api&gt; Try finding:</span><br><span class="line">渲染后的图片 Template(/Users/liyungui/StudioProjects/course_auto_test/test_single.air/tpl1581872345150.png)</span><br><span class="line">[05:10:15][DEBUG]&lt;airtest.core.api&gt; resize: (100, 47)-&gt;(100, 47), resolution: (2160.0, 1080.0)=&gt;(2280, 1080)</span><br><span class="line">[05:10:15][DEBUG]&lt;airtest.core.api&gt; try match with SURFMatching</span><br><span class="line">[05:10:17][DEBUG]&lt;airtest.aircv.keypoint_base&gt; [SURF] threshold=0.7, result=&#123;&apos;result&apos;: [281, 205], &apos;rectangle&apos;: [(226, 180), (226, 229), (336, 229), (336, 180)], &apos;confidence&apos;: 0.8972115218639374&#125;</span><br><span class="line">[05:10:17][DEBUG]&lt;airtest.aircv.keypoint_base&gt; find_best_result() run time is 2.02 s.</span><br><span class="line">[05:10:17][DEBUG]&lt;airtest.core.api&gt; match result: &#123;&apos;result&apos;: [281, 205], &apos;rectangle&apos;: [(226, 180), (226, 229), (336, 229), (336, 180)], &apos;confidence&apos;: 0.8972115218639374&#125;</span><br></pre></td></tr></table></figure>
<p><strong>日志完整展示了图像匹配的6个过程</strong></p>
<ul>
<li>resize：缩放截图尺寸<ul>
<li><code>(100, 47)-&gt;(100, 47)</code>。</li>
<li>示例中屏幕分辨率变化不大，所以是原尺寸，即1倍</li>
</ul>
</li>
<li>resolution：缩放屏幕尺寸<ul>
<li><code>(2160.0, 1080.0)=&gt;(2280, 1080)</code></li>
<li>示例中屏幕分辨率变化不大</li>
</ul>
</li>
<li>try match with SURFMatching 使用SURF算法匹配图片</li>
<li>[SURF] 找到一个匹配结果(阈值，点击区域，图片区域，置信区间)<ul>
<li>threshold=0.7 阈值</li>
<li>result= 结果<ul>
<li>{‘result’: [281, 205], </li>
<li>‘rectangle’: [(226, 180), (226, 229), (336, 229), (336, 180)], </li>
<li>‘confidence’: 0.8972115218639374}</li>
</ul>
</li>
</ul>
</li>
<li><code>find_best_result</code> 挑一个最匹配的结果</li>
<li>match result 最终的匹配结果</li>
</ul>
<h1 id="如何生产兼容性强的脚本"><a href="#如何生产兼容性强的脚本" class="headerlink" title="如何生产兼容性强的脚本"></a><a href="https://airtest.doc.io.netease.com/tutorial/9_Improved_compatibility/" target="_blank" rel="noopener">如何生产兼容性强的脚本</a></h1><h2 id="如何选择Airtest-Poco"><a href="#如何选择Airtest-Poco" class="headerlink" title="如何选择Airtest/Poco"></a>如何选择Airtest/Poco</h2><p><strong>结论：Poco优先，图像脚本辅助(比如游戏暂时没有集成SDK)。</strong></p>
<p>因为poco性能和兼容性更强，而且Poco能获取属性值，测试更加灵活</p>
<p>截图脚本在更换一台不同分辨率的手机/更换一个环境之后，就经常遇到执行失败</p>
<p>这个缺陷是由于图片类Template设计导致的</p>
<p>GitHub上开发成员对这个<a href="https://github.com/AirtestProject/Airtest/issues/4" target="_blank" rel="noopener">issues</a>也是建议换poco</p>
<h1 id="Airtest模拟输入"><a href="#Airtest模拟输入" class="headerlink" title="Airtest模拟输入"></a>Airtest模拟输入</h1><ul>
<li>touch 触摸。可设置 位置、次数、时长等参数</li>
<li>swipe 滑动</li>
<li>text  输入内容</li>
<li>keyevent 按键(回车、删除)</li>
<li>snapshot 截图</li>
<li>wait 等待图片元素出现</li>
<li>sleep 睡眠一段时间</li>
</ul>
<h1 id="Airtest断言"><a href="#Airtest断言" class="headerlink" title="Airtest断言"></a>Airtest断言</h1><ul>
<li>assert_exists 断言图片存在</li>
<li>assert_not_exists 断言图片不存在</li>
<li>assert_equal 断言值相等</li>
<li>assert_not_equal 断言值不相等</li>
</ul>
<p>只有Poco才能获取属性值</p>
<h1 id="Poco-UI属性"><a href="#Poco-UI属性" class="headerlink" title="Poco UI属性"></a>Poco UI属性</h1><p>UI对象常见的属性值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">type :  android.widget.TextView </span><br><span class="line">name :  com.zy.course.dev:id/tv_title </span><br><span class="line">text :  关于我们 </span><br><span class="line">enabled :  True </span><br><span class="line">visible :  True </span><br><span class="line">resourceId :  b&apos;com.zy.course.dev:id/tv_title&apos; </span><br><span class="line">zOrders :  &#123;&apos;global&apos;: 0, &apos;local&apos;: 2&#125; </span><br><span class="line">package :  b&apos;com.zy.course.dev&apos; </span><br><span class="line">anchorPoint :  [0.5, 0.5] </span><br><span class="line">dismissable :  False </span><br><span class="line">checkable :  False </span><br><span class="line">scale :  [1, 1] </span><br><span class="line">boundsInParent :  [0.17777777777777778, 0.02850877192982456] </span><br><span class="line">focusable :  False </span><br><span class="line">touchable :  False </span><br><span class="line">longClickable :  False </span><br><span class="line">size :  [0.17777777777777778, 0.02850877192982456] </span><br><span class="line">pos :  [0.2388888888888889, 0.48333333333333334] </span><br><span class="line">focused :  False </span><br><span class="line">checked :  False </span><br><span class="line">editalbe :  False </span><br><span class="line">selected :  False </span><br><span class="line">scrollable :  False</span><br></pre></td></tr></table></figure>
<h1 id="Poco选择UI"><a href="#Poco选择UI" class="headerlink" title="Poco选择UI"></a>Poco选择UI</h1><h2 id="基本选择器-Basic-Selector"><a href="#基本选择器-Basic-Selector" class="headerlink" title="基本选择器(Basic Selector)"></a>基本选择器(Basic Selector)</h2><p>通过<strong>节点属性</strong>来选择 <strong>可见UI</strong></p>
<ul>
<li>poco实例后加一对括号</li>
<li>遍历，将满足条件的所有UI返回</li>
</ul>
<h3 id="call"><a href="#call" class="headerlink" title="__call__"></a><code>__call__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Poco</span><span class="params">(agent, **options)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(name=None, **kw)</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>只能选择可见UI。即使设置visible=False也无法返回不可见UI</li>
<li>查找UI是懒执行(只有使用该UI时才查找)</li>
<li>kw支持两种模式，任选其一(两种模式不能同时生效)<ul>
<li>属性名=’期望值’。<code>text=&#39;关于我们&#39;</code></li>
<li>属性名Matches=’期望值正则表达式’。<code>textMatches=&#39;^关于.*$&#39;</code></li>
</ul>
</li>
<li>返回值是 UI对象的代理 UIObjectProxy</li>
</ul>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>TextView 的 id不唯一</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">poco(text=<span class="string">'关于我们'</span>)</span><br><span class="line">poco(textMatches=<span class="string">'^关于.*$'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="相对选择器-Relative-Selector"><a href="#相对选择器-Relative-Selector" class="headerlink" title="相对选择器(Relative Selector)"></a>相对选择器(Relative Selector)</h2><p>直接用节点属性没法选出你所想要的UI时，还可以通过UI之间的渲染<strong>层级关系</strong>进行选择</p>
<h3 id="子类child"><a href="#子类child" class="headerlink" title="子类child"></a>子类<code>child</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UIObjectProxy</span><span class="params">(poco, name=None, **attrs)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">child</span><span class="params">(name=None, **attrs)</span></span></span><br></pre></td></tr></table></figure>
<h3 id="后代offspring"><a href="#后代offspring" class="headerlink" title="后代offspring"></a>后代<code>offspring</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UIObjectProxy</span><span class="params">(poco, name=None, **attrs)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">offspring</span><span class="params">(name=None, **attrs)</span></span></span><br></pre></td></tr></table></figure>
<h3 id="所有子类children"><a href="#所有子类children" class="headerlink" title="所有子类children()"></a>所有子类<code>children()</code></h3><h3 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poco(<span class="string">'com.zy.course.dev:id/item_about'</span>).child(<span class="string">'com.zy.course.dev:id/tv_title'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="空间顺序选择器-Sequence-Selector"><a href="#空间顺序选择器-Sequence-Selector" class="headerlink" title="空间顺序选择器(Sequence Selector)"></a>空间顺序选择器(Sequence Selector)</h2><p>按照空间排布顺序来选择</p>
<ul>
<li>从上到下，从左往右，索引从0开始</li>
<li>一旦选择，UI位置发生变化，索引值不变，消失(移除或者隐藏)的UI不能再访问</li>
</ul>
<h3 id="实例-2"><a href="#实例-2" class="headerlink" title="实例"></a>实例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poco(<span class="string">'com.zy.course.dev:id/tv_title'</span>)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<h1 id="Poco等待"><a href="#Poco等待" class="headerlink" title="Poco等待"></a>Poco等待</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UIObjectProxy</span><span class="params">(poco, name=None, **attrs)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">wait</span><span class="params">(timeout=<span class="number">3</span>)</span> 等待<span class="title">UI</span>出现，单位秒。</span></span><br><span class="line"><span class="function">		返回<span class="title">UI</span>对象的代理 <span class="title">UIObjectProxy</span></span></span><br><span class="line"><span class="function">	<span class="title">wait_for_appearance</span><span class="params">(timeout=<span class="number">120</span>)</span>等待<span class="title">UI</span>出现，单位秒；</span></span><br><span class="line"><span class="function">		超时抛异常<span class="title">PocoTargetTimeout</span>。</span></span><br><span class="line"><span class="function">		无返回值</span></span><br><span class="line"><span class="function">	<span class="title">wait_for_disappearance</span><span class="params">(timeout=<span class="number">120</span>)</span>等待<span class="title">UI</span>消失，单位秒；</span></span><br><span class="line"><span class="function">		超时抛异常<span class="title">PocoTargetTimeout</span>。</span></span><br><span class="line"><span class="function">		无返回值</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UIObjectProxy</span><span class="params">(poco, name=None, **attrs)</span>:</span></span><br><span class="line">	wait_for_all(objects, timeout=<span class="number">120</span>)等待所有UI出现，单位秒；</span><br><span class="line">		超时抛异常PocoTargetTimeout。</span><br><span class="line">		无返回值</span><br><span class="line">	wait_for_any(objects, timeout=<span class="number">120</span>)等待任一UI出现，单位秒；</span><br><span class="line">		超时抛异常PocoTargetTimeout。</span><br><span class="line">		返回第一个出现的UI对象的代理 UIObjectProxy</span><br></pre></td></tr></table></figure>
<h1 id="Poco操作UI"><a href="#Poco操作UI" class="headerlink" title="Poco操作UI"></a>Poco操作UI</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">exists 验证UI可见</span><br><span class="line">focus 设置焦点的局部坐标(0到1)</span><br><span class="line">click/long_click 默认点击UI正中，也可以指定局部坐标(0到1)</span><br><span class="line">	click()</span><br><span class="line">	click(&apos;center&apos;)</span><br><span class="line">	click([0.5,0.5])</span><br><span class="line">	focus([0.5,0.5]).click()</span><br><span class="line">swipe 滑动</span><br><span class="line">	swipe(&apos;up&apos;)</span><br><span class="line">	swipe([0.2, -0.2])</span><br><span class="line">	swipe([0.2, -0.2], duration=0.5)</span><br><span class="line">drag_to 拖拽UI到UI</span><br><span class="line">	drag_to(poco(text=&apos;岩石司康饼&apos;))</span><br></pre></td></tr></table></figure>
<h1 id="Poco操作UI属性"><a href="#Poco操作UI属性" class="headerlink" title="Poco操作UI属性"></a>Poco操作UI属性</h1><ul>
<li>直接访问属性名</li>
<li>get方法。<code>get_text()</code></li>
<li>set方法。<code>set_text(&#39;hello&#39;)</code></li>
</ul>
<h1 id="参考-amp-扩展"><a href="#参考-amp-扩展" class="headerlink" title="参考&amp;扩展"></a>参考&amp;扩展</h1><ul>
<li><a href="http://airtest.netease.com/" target="_blank" rel="noopener">官网</a></li>
<li><a href="https://airtest.doc.io.netease.com/" target="_blank" rel="noopener">文档</a></li>
<li><a href="https://github.com/AirtestProject/Airtest" target="_blank" rel="noopener">源码</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/直播/视频连麦方案预研/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/直播/视频连麦方案预研/" itemprop="url">视频连麦方案预研</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T14:52:14+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/直播/" itemprop="url" rel="index">
                    <span itemprop="name">直播</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>现在APP架构是 腾讯云直播推流 + 声网语音连麦。</p>
<p>老师端使用pc自定义obs推流，以满足业务需求（发起答题、巡堂等互动）</p>
<p>腾讯云也有相关独立的SDK支持视频连麦，可以跟腾讯云直播sdk 配合使用。</p>
<p>基于现有架构，APP视频连麦方案有两个方向：</p>
<ul>
<li>使用腾讯云连麦SDK</li>
<li>使用声网SDK</li>
</ul>
<h1 id="使用腾讯云连麦SDK"><a href="#使用腾讯云连麦SDK" class="headerlink" title="使用腾讯云连麦SDK"></a>使用腾讯云连麦SDK</h1><h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><img src="/2020/04/02/直播/视频连麦方案预研/腾讯云连麦.png">
<p><a href="https://cloud.tencent.com/document/product/454/14606" target="_blank" rel="noopener">连麦互动</a></p>
<p>连麦能力需要依赖三个组件：</p>
<ul>
<li>MLVBSDK：闭源，负责直播推流，直播拉流，以及连麦视频通话功能。</li>
<li>TIMSDK：闭源，负责构建直播聊天室，以及聊天室中用户之间的消息传输功能。</li>
<li>MLVBLiveRoom：开源，基于 MLVBSDK 和 TIMSDK 搭建一个支持连麦互动和消息互动的“直播间”。</li>
</ul>
<h2 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h2><ul>
<li>性能消耗相对小。<ul>
<li>连麦双方只需要推自己的流，拉对方的流</li>
<li>混流在云端完成</li>
</ul>
</li>
</ul>
<h2 id="劣势-风险"><a href="#劣势-风险" class="headerlink" title="劣势/风险"></a>劣势/风险</h2><ul>
<li>依赖：连麦依赖三个组件(直播+IM+房间管理)配合</li>
<li>稳定性：未检验；特别是云端混流对延迟和音画同步的影响</li>
<li>资费：需要额外购买连麦预付费套餐包</li>
<li>接入成本：相对高</li>
</ul>
<h3 id="资费"><a href="#资费" class="headerlink" title="资费"></a>资费</h3><p>由于连麦功能会使用到高速专线来降低音视频传输延迟，这部分功能需要额外购买连麦预付费套餐包才能开通</p>
<p>移动直播中的 CDN 线路依然按照云直播带宽或者流量计费，连麦服务仅对连麦通话和低延时播放链路进行计费。</p>
<p><a href="https://cloud.tencent.com/document/product/454/8008" target="_blank" rel="noopener">购买连麦预付费套餐包</a></p>
<h1 id="使用声网SDK"><a href="#使用声网SDK" class="headerlink" title="使用声网SDK"></a>使用声网SDK</h1><h2 id="架构-1"><a href="#架构-1" class="headerlink" title="架构"></a>架构</h2><img src="/2020/04/02/直播/视频连麦方案预研/声网连麦.png">
<h2 id="优势-1"><a href="#优势-1" class="headerlink" title="优势"></a>优势</h2><ul>
<li>稳定性：声网连麦SDK经过线上APP检验</li>
<li>资费：免费额度能满足现有用户量</li>
<li>接入成本：相对低</li>
</ul>
<h2 id="劣势-风险-1"><a href="#劣势-风险-1" class="headerlink" title="劣势/风险"></a>劣势/风险</h2><ul>
<li>性能消耗相对大。<ul>
<li>老师端需要推两路流（声网和腾讯云）</li>
<li>混流在老师端完成</li>
</ul>
</li>
</ul>
<h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p>选用声网SDK连麦方案    </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/31/编程思想/TDD/TDD实战营/FizzBuzz/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/31/编程思想/TDD/TDD实战营/FizzBuzz/" itemprop="url">FizzBuzz</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-31T22:36:53+08:00">
                2020-03-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/TDD/" itemprop="url" rel="index">
                    <span itemprop="name">TDD</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h1><p>FizzBuzz是个非常简单的数字游戏题。</p>
<p>通过对简单题目的多次练习，帮助学员逐渐养成正确的开发习惯，形成刻意练习的节奏。</p>
<h1 id="教学目标"><a href="#教学目标" class="headerlink" title="教学目标"></a>教学目标</h1><ul>
<li>掌握测试驱动开发基本节奏</li>
<li>至少练习3遍FizzBuzz题目</li>
<li>能在10分钟内完成FizzBuzz题目</li>
</ul>
<h1 id="能力目标"><a href="#能力目标" class="headerlink" title="能力目标"></a>能力目标</h1><ul>
<li>键盘编程（不准动鼠标）。掌握IDE的快捷键操作，充分利用代码生成</li>
<li>用JUnit编写单元测试</li>
<li>测试驱动开发。编写失败的测试，驱动出产品代码</li>
<li>刻意练习的节奏</li>
</ul>
<h1 id="JUnit"><a href="#JUnit" class="headerlink" title="JUnit"></a>JUnit</h1><h2 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testN</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertEquals(<span class="string">"1"</span>, FizzBuzz.printValue(<span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="测试异常"><a href="#测试异常" class="headerlink" title="测试异常"></a>测试异常</h2><h3 id="try-catch"><a href="#try-catch" class="headerlink" title="try-catch"></a><code>try-catch</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testN</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        FizzBuzz.printValue(<span class="number">0</span>);</span><br><span class="line">        fail(<span class="string">"No exception thrown."</span>);<span class="comment">//没有抛出异常，使测试失败</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	 	<span class="comment">//断言异常类型</span></span><br><span class="line">        assertTrue(e <span class="keyword">instanceof</span> IllegalArgumentException);</span><br><span class="line">        <span class="comment">//断言异常message</span></span><br><span class="line">        assertTrue(e.getMessage().contains(<span class="string">"input must be &gt; 0"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>缺陷</strong> ：给出的<strong>失败提示不够直接</strong>，需要分析堆栈，测试方法在哪一行失败了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">没有如预期抛出异常，提示信息：</span><br><span class="line">java.lang.AssertionError: No exception thrown.</span><br><span class="line">	at org.junit.Assert.fail(Assert.java:91)</span><br><span class="line">	at com.lyg.fizz.FizzBuzzTest.testN(FizzBuzzTest.java:13)</span><br><span class="line">------------------------</span><br><span class="line">异常的message 不符合预期，提示信息：</span><br><span class="line">java.lang.AssertionError: </span><br><span class="line">	at org.junit.Assert.fail(Assert.java:91)</span><br><span class="line">	at org.junit.Assert.assertTrue(Assert.java:43)</span><br><span class="line">	at org.junit.Assert.assertTrue(Assert.java:54)</span><br><span class="line">	at com.lyg.fizz.FizzBuzzTest.testN(FizzBuzzTest.java:16)</span><br></pre></td></tr></table></figure>
<h3 id="Test-expected-异常类型"><a href="#Test-expected-异常类型" class="headerlink" title="Test expected 异常类型"></a>Test expected 异常类型</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>(expected = IllegalArgumentException.class)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testN</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    FizzBuzz.printValue(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>报错很清晰 </p>
<p><code>java.lang.AssertionError: Expected exception: java.lang.IllegalArgumentException</code></p>
<p><strong>缺陷</strong> ：<strong>无法断言异常信息</strong> （即异常的message）</p>
<h3 id="Rule-断言异常类型和异常信息"><a href="#Rule-断言异常类型和异常信息" class="headerlink" title="Rule 断言异常类型和异常信息"></a>Rule 断言异常类型和异常信息</h3><p>JUnit 4.7 新特性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FizzBuzzTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Rule</span></span><br><span class="line">    <span class="keyword">public</span> ExpectedException mExpectedException = ExpectedException.none();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testN</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mExpectedException.expect(IllegalArgumentException.class);</span><br><span class="line">        mExpectedException.expectMessage(<span class="string">"input must be &gt; 0"</span>);</span><br><span class="line">        FizzBuzz.printValue(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">没有如预期抛出异常，提示信息：</span><br><span class="line">java.lang.AssertionError: </span><br><span class="line">Expected test to throw (exception with message a string containing &quot;input must be &gt; 0&quot; and an instance of java.lang.IllegalArgumentException)</span><br><span class="line">------------------------</span><br><span class="line">异常的message 不符合预期，提示信息：</span><br><span class="line">java.lang.AssertionError: </span><br><span class="line">Expected: (exception with message a string containing &quot;input must be &gt; 0&quot; and an instance of java.lang.IllegalArgumentException)</span><br><span class="line">     got: &lt;java.lang.IllegalArgumentException: input must be &gt; 1&gt;</span><br></pre></td></tr></table></figure>
<h2 id="ParameterizedTest-和-CsvSource"><a href="#ParameterizedTest-和-CsvSource" class="headerlink" title="ParameterizedTest 和 CsvSource"></a>ParameterizedTest 和 CsvSource</h2><p>JUnit 5 新特性；Gradle 4.6 开始支持 JUnit 5</p>
<p>AS 默认使用 JUnit 4</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@CsvSource</span>(&#123;</span><br><span class="line">	<span class="string">"1,1"</span>,</span><br><span class="line">	<span class="string">"3,Fizz"</span>,</span><br><span class="line">	<span class="string">"5,Buzz"</span>,</span><br><span class="line">	<span class="string">"15,FizzBuzz"</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testN</span><span class="params">(<span class="keyword">int</span> number, String value)</span> </span>&#123;</span><br><span class="line">    assertEquals(value, FizzBuzz.printValue(number));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h1><p>写一个程序，打印出从1到100的数字，将其中3的倍数替换成“Fizz”，5的倍数替换成“Buzz”。既能被3整除、又能被5整除的数则替换成“FizzBuzz”。</p>
<h1 id="TDD流程"><a href="#TDD流程" class="headerlink" title="TDD流程"></a>TDD流程</h1><ul>
<li><strong>Red</strong>。write a test that fails</li>
<li><strong>Green</strong>。make the code work</li>
<li><strong>Refactor</strong>。eleminate redundancy [ɪˈlɪmɪneɪt rɪˈdʌndənsi] 消除重复</li>
</ul>
<h2 id="写测试"><a href="#写测试" class="headerlink" title="写测试"></a>写测试</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FizzBuzzTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testN</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertEquals(<span class="string">"1"</span>, FizzBuzz.printValue(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试报错找不到 <code>FizzBuzz.printValue</code> ，使用IDE自动生成</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FizzBuzz</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">printValue</span><span class="params">(<span class="keyword">int</span> input)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>试运行测试，不通过；预期返回1，实际返回null</p>
<h2 id="使测试通过"><a href="#使测试通过" class="headerlink" title="使测试通过"></a>使测试通过</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FizzBuzz</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">printValue</span><span class="params">(<span class="keyword">int</span> input)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.valueOf(input);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重复上面的步骤一和步骤二，逐个增加测试用例并使之通过</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FizzBuzzTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testN</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertEquals(<span class="string">"1"</span>, FizzBuzz.printValue(<span class="number">1</span>));</span><br><span class="line">        assertEquals(<span class="string">"Fizz"</span>, FizzBuzz.printValue(<span class="number">3</span>));</span><br><span class="line">        assertEquals(<span class="string">"Buzz"</span>, FizzBuzz.printValue(<span class="number">5</span>));</span><br><span class="line">        assertEquals(<span class="string">"FizzBuzz"</span>, FizzBuzz.printValue(<span class="number">15</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FizzBuzz</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">printValue</span><span class="params">(<span class="keyword">int</span> input)</span> </span>&#123;</span><br><span class="line">        String result = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">if</span> (input &lt; <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"input must be &gt; 0"</span>);</span><br><span class="line">        <span class="keyword">if</span> (input % <span class="number">3</span> == <span class="number">0</span>) result += <span class="string">"Fizz"</span>;</span><br><span class="line">        <span class="keyword">if</span> (input % <span class="number">5</span> == <span class="number">0</span>) result += <span class="string">"Buzz"</span>;</span><br><span class="line">        <span class="keyword">if</span> (result.isEmpty()) result += input;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="重构，消除重复"><a href="#重构，消除重复" class="headerlink" title="重构，消除重复"></a>重构，消除重复</h2><p>使用 JUnit 5 新特性 ParameterizedTest 和 CsvSource，消除重复断言代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@CsvSource</span>(&#123;</span><br><span class="line">	<span class="string">"1,1"</span>,</span><br><span class="line">	<span class="string">"3,Fizz"</span>,</span><br><span class="line">	<span class="string">"5,Buzz"</span>,</span><br><span class="line">	<span class="string">"15,FizzBuzz"</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testN</span><span class="params">(<span class="keyword">int</span> number, String value)</span> </span>&#123;</span><br><span class="line">    assertEquals(value, FizzBuzz.printValue(number));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/31/编程思想/TDD/TDD实战营/课程导论/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/31/编程思想/TDD/TDD实战营/课程导论/" itemprop="url">课程导论</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-31T22:36:53+08:00">
                2020-03-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/TDD/" itemprop="url" rel="index">
                    <span itemprop="name">TDD</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="熊节"><a href="#熊节" class="headerlink" title="熊节"></a>熊节</h1><p>《重构》译者，前 ThoughtWorks 总监咨询师</p>
<p>我要做的是：把我在ThoughtWorks工作13年的经验输出，通过案例，让你掌握测试驱动开发的方法，练好基本功、改进工作方式，提高开发效率，成为敏捷开发的第一批受益者。</p>
<h1 id="课程内容结构"><a href="#课程内容结构" class="headerlink" title="课程内容结构"></a>课程内容结构</h1><p>我做过一个实验，同样的内容，录视频让我的实习生学，和我写成文档带着他练，后者要远远好于前者。</p>
<p>按效果排序：练习＞文字＞视频＞音频，</p>
<p>整个内容里，60％的时间练习，25％的时间看文字、文档，15％才是视频</p>
<h1 id="3个实战项目"><a href="#3个实战项目" class="headerlink" title="3个实战项目"></a>3个实战项目</h1><ul>
<li>FizzBuzz</li>
<li>Args</li>
<li>Mars Rover</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/20/RN/RN分包和热更/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/20/RN/RN分包和热更/" itemprop="url">RN分包和热更</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-20T17:41:12+08:00">
                2020-03-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="官方metro分包方案"><a href="#官方metro分包方案" class="headerlink" title="官方metro分包方案"></a>官方metro分包方案</h1><p>本文RN版本是 <code>0.61.2</code>，使用基于metro分包的三方框架 <code>react-native-multibundler</code></p>
<p>优势：</p>
<ul>
<li>稳定</li>
<li>灵活<ul>
<li>支持debug</li>
<li>支持远程加载</li>
<li>可以每个页面作为一个业务包</li>
<li>可选模块路径或者递增id作为模块id</li>
</ul>
</li>
</ul>
<h1 id="加载bundle"><a href="#加载bundle" class="headerlink" title="加载bundle"></a>加载bundle</h1><h2 id="基础包"><a href="#基础包" class="headerlink" title="基础包"></a>基础包</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ReactInstanceManagerBuilder builder = ReactInstanceManager.builder()</span><br><span class="line"><span class="keyword">if</span> (jsBundleFile != <span class="keyword">null</span>) &#123;<span class="comment">//本地文件存在</span></span><br><span class="line">	builder.setJSBundleFile(jsBundleFile);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	builder.setBundleAssetName(getBundleAssetName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="业务包"><a href="#业务包" class="headerlink" title="业务包"></a>业务包</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loadScriptAsync</span><span class="params">(<span class="keyword">final</span> ReactRootView reactRootView, <span class="keyword">final</span> String moduleName)</span> </span>&#123;</span><br><span class="line">	String moduleFileName = getModuleFileNameByModuleName(moduleName);</span><br><span class="line">	<span class="keyword">if</span> (sd卡的版本最新) &#123;</span><br><span class="line">	    String rnBundleFilePath = getRNBundleFilePath(moduleFileName);</span><br><span class="line">	    loadScriptFromFile(mReactInstanceManager, rnBundleFilePath, rnBundleFilePath);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	    String moduleBundleAssertsPath = getRNBundleAssertsPath(moduleFileName);</span><br><span class="line">	    loadScriptFromAssets(mReactInstanceManager, getAssetManager(), moduleBundleAssertsPath);</span><br><span class="line">	&#125;</span><br><span class="line">                        </span><br><span class="line">	<span class="comment">//切换到UI线程，展示业务页面</span></span><br><span class="line">	reactRootView.startReactApplication(mReactInstanceManager, moduleName, <span class="keyword">null</span>);                      </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WorkerThread</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadScriptFromFile</span><span class="params">(ReactInstanceManager reactInstanceManager, String fileName, String sourceURL)</span> </span>&#123;</span><br><span class="line">    CatalystInstance catalystInstance = reactInstanceManager.getCurrentReactContext().getCatalystInstance();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Method method = CatalystInstanceImpl.class.getDeclaredMethod(<span class="string">"loadScriptFromFile"</span>,</span><br><span class="line">            String.class,</span><br><span class="line">            String.class, <span class="keyword">boolean</span>.class);</span><br><span class="line">        method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        method.invoke(catalystInstance, fileName, sourceURL, <span class="keyword">false</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WorkerThread</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadScriptFromAssets</span><span class="params">(ReactInstanceManager reactInstanceManager, AssetManager assetManager, String assetName)</span> </span>&#123;</span><br><span class="line">    CatalystInstance catalystInstance = reactInstanceManager.getCurrentReactContext().getCatalystInstance();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        String source = <span class="string">"assets://"</span> + assetName;</span><br><span class="line">        Method method = CatalystInstanceImpl.class.getDeclaredMethod(<span class="string">"loadScriptFromAssets"</span>,</span><br><span class="line">            AssetManager.class,</span><br><span class="line">            String.class, <span class="keyword">boolean</span>.class);</span><br><span class="line">        method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        method.invoke(catalystInstance, assetManager, source, <span class="keyword">false</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="代码bundle热更"><a href="#代码bundle热更" class="headerlink" title="代码bundle热更"></a>代码bundle热更</h1><p>有两种方案：</p>
<ul>
<li>重启<ul>
<li>重新初始化ReactInstanceManager </li>
</ul>
</li>
<li>反射修改ReactInstanceManager的JSBundleLoader，然后重建ReactContext<ul>
<li>recreateReactContextInBackground不行<ul>
<li>因为里面的JSBundleLoader已经初始化好了</li>
<li>没有开放更新的方法，所以只能用反射了</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//反射重新设置BundleLoader</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    JSBundleLoader jSBundleLoader;</span><br><span class="line">    <span class="keyword">if</span> (jSBundleFile.toLowerCase().startsWith(<span class="string">"assets://"</span>)) &#123;</span><br><span class="line">        jSBundleLoader = JSBundleLoader.createAssetLoader(getReactApplicationContext(), jSBundleFile, <span class="keyword">false</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        jSBundleLoader = JSBundleLoader.createFileLoader(jSBundleFile);</span><br><span class="line">    &#125;</span><br><span class="line">    Field bundleLoaderField = instanceManager.getClass().getDeclaredField(<span class="string">"mBundleLoader"</span>);</span><br><span class="line">    bundleLoaderField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">    bundleLoaderField.set(instanceManager, jSBundleLoader);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    Log.i(<span class="string">"lyg"</span>, <span class="string">"Could not setJSBundle"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//重新创建</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	instanceManager.recreateReactContextInBackground();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    <span class="comment">// 重新创建失败；尝试重启Activity</span></span><br><span class="line">    currentActivity.runOnUiThread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">	    <span class="meta">@Override</span></span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	        currentActivity.recreate();</span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//或者直接反射调用带参的recreateReactContextInBackground</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Class&lt;?&gt; RIManagerClazz = mReactInstanceManager.getClass();</span><br><span class="line">    Method method = RIManagerClazz.getDeclaredMethod(<span class="string">"recreateReactContextInBackground"</span>,</span><br><span class="line">            JavaScriptExecutorFactory.class,</span><br><span class="line">            JSBundleLoader.class);</span><br><span class="line">    method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">    method.invoke(mReactInstanceManager,</span><br><span class="line">            <span class="keyword">new</span> JSCJavaScriptExecutorFactory(<span class="string">""</span>, <span class="string">""</span>),</span><br><span class="line">            JSBundleLoader.createFileLoader(JS_BUNDLE_LOCAL_PATH));</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="图片资源热更"><a href="#图片资源热更" class="headerlink" title="图片资源热更"></a>图片资源热更</h1><p>RN热更必不可少的要面对RN中图片的热更新</p>
<p>先探究一下React-Native中图片是如何加载的，搞懂了这个问题，图片的热更新问题也就迎刃而解</p>
<h2 id="Image设置图片"><a href="#Image设置图片" class="headerlink" title="Image设置图片"></a>Image设置图片</h2><p>RN中图片一般是这样使用的</p>
<p><code>&lt;Image source={require(&#39;js/assets/common/ic_phone_kefu.png&#39;);} /&gt;</code></p>
<p>重点关注Image控件属性source，所谓的图片热更新也就是更换source的地址</p>
<h2 id="图片资源打包"><a href="#图片资源打包" class="headerlink" title="图片资源打包"></a>图片资源打包</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">react-native/Libraries/Image/assetPathUtils.js</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAndroidResourceIdentifier</span>(<span class="params">asset: PackagerAsset</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> folderPath = getBasePath(asset); <span class="comment">//去掉/(如果以/打头)</span></span><br><span class="line">  <span class="keyword">return</span> (folderPath + <span class="string">'/'</span> + asset.name)</span><br><span class="line">    .toLowerCase()</span><br><span class="line">    .replace(<span class="regexp">/\//g</span>, <span class="string">'_'</span>) <span class="comment">// Encode folder structure in file name</span></span><br><span class="line">    .replace(<span class="regexp">/([^a-z0-9_])/g</span>, <span class="string">''</span>) <span class="comment">// Remove illegal chars</span></span><br><span class="line">    .replace(<span class="regexp">/^assets_/</span>, <span class="string">''</span>); <span class="comment">// Remove "assets_" prefix</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打包处理：转小写，文件路径用 <code>_</code>连接，去除非法字符，去除开头 <code>assets_</code>(如果是这个开头)</p>
<p>图片被处理成了 <code>js_assets_common_ic_phone_kefu.png</code></p>
<h2 id="加载过程分析"><a href="#加载过程分析" class="headerlink" title="加载过程分析"></a>加载过程分析</h2><h3 id="Image-android-js"><a href="#Image-android-js" class="headerlink" title="Image.android.js"></a>Image.android.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">react-native/Libraries/Image/Image.android.js</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> Image = (</span><br><span class="line">  props: ImagePropsType,</span><br><span class="line">  forwardedRef: ?React.Ref&lt;<span class="string">'RCTTextInlineImage'</span> | <span class="string">'ImageViewNativeComponent'</span>&gt;,</span><br><span class="line">) =&gt; &#123;</span><br><span class="line">  <span class="comment">//设置source；重点关注，图片路径处理逻辑在里面完成</span></span><br><span class="line">  <span class="keyword">let</span> source = resolveAssetSource(props.source);</span><br><span class="line">  <span class="keyword">const</span> defaultSource = resolveAssetSource(props.defaultSource);</span><br><span class="line">  <span class="keyword">const</span> loadingIndicatorSource = resolveAssetSource(</span><br><span class="line">    props.loadingIndicatorSource,</span><br><span class="line">  );</span><br><span class="line">  ...检查source、props.src属性...</span><br><span class="line">  <span class="keyword">if</span> (source &amp;&amp; !source.uri &amp;&amp; !<span class="built_in">Array</span>.isArray(source)) &#123;</span><br><span class="line">    source = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//根据source.uri 设置sources</span></span><br><span class="line">  <span class="keyword">let</span> style;</span><br><span class="line">  <span class="keyword">let</span> sources;</span><br><span class="line">  <span class="keyword">if</span> (source?.uri != <span class="literal">null</span>) &#123;</span><br><span class="line">    sources = [&#123;<span class="attr">uri</span>: source.uri&#125;];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    style = flattenStyle([styles.base, props.style]);</span><br><span class="line">    sources = source;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//合并属性</span></span><br><span class="line">  <span class="keyword">const</span> &#123;onLoadStart, onLoad, onLoadEnd, onError&#125; = props;</span><br><span class="line">  <span class="keyword">const</span> nativeProps = merge(props, &#123;</span><br><span class="line">    style,</span><br><span class="line">    shouldNotifyLoadEvents: !!(onLoadStart || onLoad || onLoadEnd || onError),</span><br><span class="line">    src: sources,</span><br><span class="line">    headers: source?.headers,</span><br><span class="line">    defaultSrc: defaultSource ? defaultSource.uri : <span class="literal">null</span>,</span><br><span class="line">    loadingIndicatorSrc: loadingIndicatorSource</span><br><span class="line">      ? loadingIndicatorSource.uri</span><br><span class="line">      : <span class="literal">null</span>,</span><br><span class="line">    ref: forwardedRef,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//返回真正的图片实现类</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;TextAncestor.Consumer&gt;</span><br><span class="line">      &#123;hasTextAncestor =&gt;</span><br><span class="line">        hasTextAncestor ? (</span><br><span class="line">          &lt;TextInlineImageNativeComponent &#123;...nativeProps&#125; /&gt;</span><br><span class="line">        ) : (</span><br><span class="line">          &lt;ImageViewNativeComponent &#123;...nativeProps&#125; /&gt;</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;<span class="regexp">/TextAncestor.Consumer&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure>
<h3 id="ImageViewNativeComponent-js"><a href="#ImageViewNativeComponent-js" class="headerlink" title="ImageViewNativeComponent.js"></a>ImageViewNativeComponent.js</h3><p>通过上面的分析可知，如果父路径没有文本，Image真正的图片实现类是 ImageViewNativeComponent </p>
<p>合并属性后生成nativeProps对象，传递给了 ImageViewNativeComponent</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">react-native/Libraries/Image/ImageViewNativeComponent.js</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ImageViewNativeComponent: string = requireNativeComponent(<span class="string">'RCTImageView'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="ReactImageManager-java"><a href="#ReactImageManager-java" class="headerlink" title="ReactImageManager.java"></a>ReactImageManager.java</h3><p>继续跟踪，通过 <code>ReactImageManager.java</code>，可知 <code>RCTImageView</code> 对应的是 <code>ReactImageView</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ReactImageView.java</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ReactImageView <span class="title">createViewInstance</span><span class="params">(ThemedReactContext context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ReactImageView(</span><br><span class="line">        context, getDraweeControllerBuilder(), mGlobalImageLoadListener, getCallerContext());</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// In JS this is Image.props.source</span></span><br><span class="line">  <span class="meta">@ReactProp</span>(name = <span class="string">"src"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSource</span><span class="params">(ReactImageView view, @Nullable ReadableArray sources)</span> </span>&#123;</span><br><span class="line">    view.setSource(sources);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>setSource的文档说明，这里是原封不动的传递了JS中<code>Image.props.source</code> 属性，我们<strong>需要回头到JS代码中去分析图片路径的处理逻辑</strong></p>
<h3 id="resolveAssetSource-js"><a href="#resolveAssetSource-js" class="headerlink" title="resolveAssetSource.js"></a>resolveAssetSource.js</h3><p>现在我们回头分析 resolveAssetSource</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">react-native/Libraries/Image/resolveAssetSource.js</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolveAssetSource</span>(<span class="params">source: any</span>): ?<span class="title">ResolvedAssetSource</span> </span>&#123;</span><br><span class="line">  <span class="comment">//已经处理成对象了，直接返回</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> source === <span class="string">'object'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> source;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//获取图片id，rn会对所有图片编码索引</span></span><br><span class="line">  <span class="keyword">const</span> asset = AssetRegistry.getAssetByID(source);</span><br><span class="line">  <span class="keyword">if</span> (!asset) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//关注核心代码</span></span><br><span class="line">  <span class="keyword">const</span> resolver = <span class="keyword">new</span> AssetSourceResolver(</span><br><span class="line">    getDevServerURL(),</span><br><span class="line">    getScriptURL(),</span><br><span class="line">    asset,</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">if</span> (_customSourceTransformer) &#123;</span><br><span class="line">    <span class="keyword">return</span> _customSourceTransformer(resolver);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> resolver.defaultAsset();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="获取当前js源码路径地址"><a href="#获取当前js源码路径地址" class="headerlink" title="获取当前js源码路径地址"></a>获取当前js源码路径地址</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> _sourceCodeScriptURL: ?string;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSourceCodeScriptURL</span>(<span class="params"></span>): ?<span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (_sourceCodeScriptURL) &#123;</span><br><span class="line">    <span class="keyword">return</span> _sourceCodeScriptURL;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> sourceCode =</span><br><span class="line">    global.nativeExtensions &amp;&amp; global.nativeExtensions.SourceCode;</span><br><span class="line">  <span class="keyword">if</span> (!sourceCode) &#123;</span><br><span class="line">    sourceCode = <span class="built_in">require</span>(<span class="string">'../NativeModules/specs/NativeSourceCode'</span>).default;</span><br><span class="line">  &#125;</span><br><span class="line">  _sourceCodeScriptURL = sourceCode.getConstants().scriptURL;</span><br><span class="line">  <span class="keyword">return</span> _sourceCodeScriptURL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过 <code>NativeSourceCode.js</code> 获取到当前js源码路径地址</p>
<h4 id="服务器地址父路径"><a href="#服务器地址父路径" class="headerlink" title="服务器地址父路径"></a>服务器地址父路径</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDevServerURL</span>(<span class="params"></span>): ?<span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (_serverURL === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sourceCodeScriptURL = getSourceCodeScriptURL();</span><br><span class="line">    <span class="keyword">const</span> match =</span><br><span class="line">      sourceCodeScriptURL &amp;&amp; sourceCodeScriptURL.match(<span class="regexp">/^https?:\/\/.*?\//</span>);</span><br><span class="line">    <span class="keyword">if</span> (match) &#123;</span><br><span class="line">      <span class="comment">// jsBundle was loaded from network</span></span><br><span class="line">      _serverURL = match[<span class="number">0</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// jsBundle was loaded from file</span></span><br><span class="line">      _serverURL = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> _serverURL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过js源码路径地址判断js是来自网络还是本地，网络返回网络地址父路径，本地返回null</p>
<h4 id="js脚本地址父路径"><a href="#js脚本地址父路径" class="headerlink" title="js脚本地址父路径"></a>js脚本地址父路径</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> _coerceLocalScriptURL(<span class="params">scriptURL: ?string</span>): ?<span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (scriptURL) &#123;</span><br><span class="line">    <span class="keyword">if</span> (scriptURL.startsWith(<span class="string">'assets://'</span>)) &#123;</span><br><span class="line">      <span class="comment">// android: running from within assets, no offline path to use</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    scriptURL = scriptURL.substring(<span class="number">0</span>, scriptURL.lastIndexOf(<span class="string">'/'</span>) + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (!scriptURL.includes(<span class="string">'://'</span>)) &#123;</span><br><span class="line">      <span class="comment">// Add file protocol in case we have an absolute file path and not a URL.</span></span><br><span class="line">      <span class="comment">// This shouldn't really be necessary. scriptURL should be a URL.</span></span><br><span class="line">      scriptURL = <span class="string">'file://'</span> + scriptURL;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> scriptURL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getScriptURL</span>(<span class="params"></span>): ?<span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (_scriptURL === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    _scriptURL = _coerceLocalScriptURL(getSourceCodeScriptURL());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> _scriptURL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过js源码路径地址判断js是否来自assets目录，是返回null，否返回js上级目录地址（没有<code>file://</code>前缀，代码会补上）</p>
<h3 id="AssetSourceResolver-js"><a href="#AssetSourceResolver-js" class="headerlink" title="AssetSourceResolver.js"></a>AssetSourceResolver.js</h3><p>真正处理图片地址 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">react-native/Libraries/Image/AssetSourceResolver.js</span><br><span class="line"></span><br><span class="line">  defaultAsset(): ResolvedAssetSource &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.isLoadedFromServer()) &#123;<span class="comment">//服务器地址不为空</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.assetServerURL();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Android，js从assets加载，返回R文件中图片</span></span><br><span class="line">    <span class="comment">//js从本地加载，使用drawableFolderInBundle从bundle目录下获取图片</span></span><br><span class="line">    <span class="keyword">if</span> (Platform.OS === <span class="string">'android'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.isLoadedFromFileSystem()</span><br><span class="line">        ? <span class="keyword">this</span>.drawableFolderInBundle()</span><br><span class="line">        : <span class="keyword">this</span>.resourceIdentifierWithoutScale();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.scaledAssetURLNearBundle();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//从本地bundle目录下获取图片</span></span><br><span class="line">  drawableFolderInBundle(): ResolvedAssetSource &#123;</span><br><span class="line">    <span class="keyword">const</span> path = <span class="keyword">this</span>.jsbundleUrl || <span class="string">'file://'</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.fromSource(path + getAssetPathInDrawableFolder(<span class="keyword">this</span>.asset));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>如果是从本地文件加载的js代码(例如 <code>/sdcard/rn/LiveShoppingMall.js</code>)，那么加载图片的地址就是 <strong>js文件同级目录下</strong> <code>/sdcard/rn/drawable-xhpi/js_assets_common_ic_phone_kefu.png</code></p>
<h2 id="SmartAssets对图片路径的hook"><a href="#SmartAssets对图片路径的hook" class="headerlink" title="SmartAssets对图片路径的hook"></a>SmartAssets对图片路径的hook</h2><p><code>react-native-smartassets</code></p>
<h3 id="缺陷"><a href="#缺陷" class="headerlink" title="缺陷"></a>缺陷</h3><p>上面的图片处理过程有个缺陷（不够<strong>高效和灵活</strong>），就是如果js代码同级目录下找不到目标图片，是展示不出来的。这就意味着，一个页面如果热更，需要把这个页面所有图片都拷贝js文件同级目录下。如果每个业务包都有独立文件夹（方便配置版本控制和安全策略），这个重复拷贝工作量很恐怖的</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>通过hook上面的 <code>AssetSourceResolver.js</code> 获取图片路径的方法，判断js代码父路径下是否存在目标图片，不存在(表示图片不需要更新)则使用R文件中的图片，完美</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">react-native-smartassets/index.js</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> SmartAssets= &#123;</span><br><span class="line">	initSmartAssets()&#123;</span><br><span class="line">		<span class="keyword">var</span> initialize = _.once(<span class="keyword">this</span>.initSmartAssetsInner);</span><br><span class="line">		initialize();</span><br><span class="line">	&#125;,</span><br><span class="line">	initSmartAssetsInner() &#123;</span><br><span class="line">		<span class="keyword">let</span> drawablePathInfos = [];</span><br><span class="line">		<span class="comment">//getSourceCodeScriptURL()获取js文件地址</span></span><br><span class="line">		<span class="comment">//完全复制resolveAssetSource.js. </span></span><br><span class="line">		<span class="comment">//调用Java方法遍历js文件同级的图片文件，存入数组</span></span><br><span class="line">		Smartassets.travelDrawable(getSourceCodeScriptURL(),</span><br><span class="line">			(retArray)=&gt;&#123;</span><br><span class="line">				drawablePathInfos = drawablePathInfos.concat(retArray);</span><br><span class="line">			&#125;);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//核心，hook AssetSourceResolver.defaultAsset方法</span></span><br><span class="line">		AssetSourceResolver.prototype.defaultAsset=_.wrap(AssetSourceResolver.prototype.defaultAsset, <span class="function"><span class="keyword">function</span> (<span class="params">func, ...args</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="keyword">this</span>.isLoadedFromServer()) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">this</span>.assetServerURL();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (Platform.OS === <span class="string">'android'</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span>(<span class="keyword">this</span>.isLoadedFromFileSystem()||bundlePath!=<span class="literal">null</span>)&#123;<span class="comment">//begin assets ios begin drawable android</span></span><br><span class="line">					<span class="keyword">this</span>.jsbundleUrl = bundlePath;</span><br><span class="line">					<span class="keyword">let</span> resolvedAssetSource = <span class="keyword">this</span>.drawableFolderInBundle();</span><br><span class="line">					<span class="keyword">let</span> resPath = resolvedAssetSource.uri;</span><br><span class="line">					<span class="keyword">if</span>(drawablePathInfos.includes(resPath))&#123;<span class="comment">//已经在bundle目录中有</span></span><br><span class="line">						<span class="keyword">return</span> resolvedAssetSource;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">let</span> isFileExist =  Smartassets.isFileExist(resPath);</span><br><span class="line">					<span class="keyword">if</span>(isFileExist===<span class="literal">true</span>)&#123;<span class="comment">//文件存在</span></span><br><span class="line">						<span class="keyword">return</span> resolvedAssetSource;</span><br><span class="line">					&#125;<span class="keyword">else</span> &#123;<span class="comment">//不存在，使用R文件的图片</span></span><br><span class="line">						<span class="keyword">return</span> <span class="keyword">this</span>.resourceIdentifierWithoutScale();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">return</span> <span class="keyword">this</span>.resourceIdentifierWithoutScale();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;<span class="comment">//ios的处理</span></span><br><span class="line">				<span class="keyword">if</span>(bundlePath!=<span class="literal">null</span>)&#123;</span><br><span class="line">					<span class="keyword">this</span>.jsbundleUrl = bundlePath;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">let</span> iOSAsset = <span class="keyword">this</span>.scaledAssetURLNearBundle();</span><br><span class="line">				<span class="keyword">let</span> isFileExist =  Smartassets.isFileExist(iOSAsset.uri);</span><br><span class="line">				<span class="keyword">if</span>(isFileExist) &#123;</span><br><span class="line">					<span class="keyword">return</span> iOSAsset;</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">					<span class="keyword">let</span> oriJsBundleUrl = <span class="string">'file://'</span>+defaultMainBundePath+<span class="string">'/'</span>+iOSRelateMainBundlePath;</span><br><span class="line">					iOSAsset.uri = iOSAsset.uri.replace(<span class="keyword">this</span>.jsbundleUrl, oriJsBundleUrl);</span><br><span class="line">					<span class="keyword">return</span> iOSAsset;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//必须传入js文件的父路径</span></span><br><span class="line">	<span class="comment">//否则会导致一个图片路径bug</span></span><br><span class="line">	setBundlePath(bundlePathNew)&#123;</span><br><span class="line">		bundlePath = bundlePathNew;</span><br><span class="line">	&#125;,</span><br><span class="line">	setiOSRelateMainBundlePath(relatePath)&#123;</span><br><span class="line">		iOSRelateMainBundlePath = relatePath;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="setBundlePath传参"><a href="#setBundlePath传参" class="headerlink" title="setBundlePath传参"></a>setBundlePath传参</h3><p><strong>特别注意</strong> setBundlePath传参形式不当，会导致图片路径bug</p>
<p>js文件地址：<code>/sdcard/rn/LiveShoppingMall.js</code></p>
<p>setBundlePath <strong>唯一标准参数</strong>：<code>file:///sdcard/rn/</code>（js文件父路径，必须file://前缀，以/结尾）</p>
<p>如果setBundlePath传入js文件的路径(而不是期望的js文件父路径，并以/结尾)，那么加载图片的地址就是 <strong>js文件 + 图片地址</strong> <code>/sdcard/rn/LiveShoppingMall.jsdrawable-xhpi/js_assets_common_ic_phone_kefu.png</code></p>
<p>setBundlePath是怎么调用的呢</p>
<p>在框架提供的基础包打包入口文件 <code>platformDep.js</code>中，监听了 <code>sm-bundle-changed</code> 事件来触发调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; SmartAssets &#125; <span class="keyword">from</span> <span class="string">'react-native-smartassets'</span>;</span><br><span class="line">SmartAssets.initSmartAssets();</span><br><span class="line">DeviceEventEmitter.addListener(<span class="string">'sm-bundle-changed'</span>, </span><br><span class="line">    bundlePath =&gt; &#123;</span><br><span class="line">        SmartAssets.setBundlePath(bundlePath);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>所以，我们需要在java代码中发送这个事件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(scriptPath!=<span class="keyword">null</span>)&#123;<span class="comment">//scriptPath是js完整路径</span></span><br><span class="line">    scriptPath = <span class="string">"file://"</span>+scriptPath.substring(<span class="number">0</span>,scriptPath.lastIndexOf(File.separator)+<span class="number">1</span>);</span><br><span class="line">reactContext</span><br><span class="line">        .getJSModule(DeviceEventManagerModule.RCTDeviceEventEmitter.class)</span><br><span class="line">        .emit(<span class="string">"sm-bundle-changed"</span>, bundleAssetPath);    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="参考-amp-扩展"><a href="#参考-amp-扩展" class="headerlink" title="参考&amp;扩展"></a>参考&amp;扩展</h1><ul>
<li><a href="https://github.com/smallnew/react-native-multibundler" target="_blank" rel="noopener">react-native-multibundler</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/06/Android/latex公式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/06/Android/latex公式/" itemprop="url">latex公式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-06T16:12:33+08:00">
                2020-03-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="LaTex"><a href="#LaTex" class="headerlink" title="LaTex"></a>LaTex</h1><h2 id="MathJax"><a href="#MathJax" class="headerlink" title="MathJax"></a>MathJax</h2><p>运行在浏览器中的开源的数学符号渲染引擎</p>
<p>可以解析Latex、MathML和ASCIIMathML的标记语言</p>
<h1 id="MathJax基本语法"><a href="#MathJax基本语法" class="headerlink" title="MathJax基本语法"></a>MathJax基本语法</h1><h2 id="公式标记"><a href="#公式标记" class="headerlink" title="公式标记"></a>公式标记</h2><p>需要用一些适当的标记告诉MathJax某段文本是公式代码</p>
<p>MathJax中的公式排版有两种方式：</p>
<ul>
<li>inline。行内（公式嵌入到文本段中）</li>
<li>displayed。独立（行、块、段落）</li>
</ul>
<p>默认的displayed公式分隔符有 <code>$$...$$</code> 和 <code>\[...\]</code>，默认的inline公式分隔符为 <code>(...)</code> 。</p>
<p>当然可以通过参考文档配置自定义分隔符。下文中，自定义 <code>$...$</code> 作为inline分隔符。</p>
<p>公式：c=(a平方+b平台)开根号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ c = \sqrt&#123;a^&#123;2&#125;+b^&#123;2&#125;&#125; $</span><br><span class="line"></span><br><span class="line">$$ c = \sqrt&#123;a^&#123;2&#125;+b^&#123;2&#125;&#125; $$</span><br></pre></td></tr></table></figure>
<h2 id="上下标"><a href="#上下标" class="headerlink" title="上下标"></a>上下标</h2><ul>
<li><code>^</code> 表示上标, <code>_</code> 表示下标。</li>
<li>如果上下标的内容多于一个字符，要用 <code>{}</code> 把这些内容括起来当成一个整体。</li>
<li>上下标是可以嵌套的，也可以同时使用</li>
</ul>
<h2 id="转义"><a href="#转义" class="headerlink" title="转义"></a>转义</h2><p>以下几个字符: <code># $ % &amp; ~ _ ^ \ { }</code>有特殊意义，需要表示这些字符时，需要转义，即在每个字符前加上 <code>\</code></p>
<h1 id="原生渲染Latex"><a href="#原生渲染Latex" class="headerlink" title="原生渲染Latex"></a>原生渲染Latex</h1><table>
<thead>
<tr>
<th>方案</th>
<th>特性</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>jlatexmath-android</td>
<td>JLaTexMath移植到Android</td>
<td></td>
</tr>
<tr>
<td>JLaTexMath-andriod</td>
<td>基于jlatexmath-android改进；<br> 针对化学、生物类的中文公式做了优化；<br></td>
<td></td>
</tr>
<tr>
<td>FlexibleRichTextView</td>
<td>使用JLaTexMath-andriod渲染；<br></td>
<td>公式弧只支持 ${ab}^{\frown}$ 两个点；<br></td>
</tr>
<tr>
<td>MathView</td>
<td>依赖webview；<br> 支持双渲染引擎MathJax and KaTeX；<br> KaTeX 比 MathJax 快，但 MathJax 支持更多的特性，而且更漂亮</td>
<td>用<code>\(...\)</code>代替<code>$...$</code>表示行内公式；<br> MathJax在Android上的bug导致有些字符是空白的；<br> Java中注意反斜杠、引号等转义字符(<code>\\</code>转义成了<code>\</code>)</td>
</tr>
</tbody>
</table>
<h1 id="参考-amp-扩展"><a href="#参考-amp-扩展" class="headerlink" title="参考&amp;扩展"></a>参考&amp;扩展</h1><ul>
<li><a href="https://www.latex-project.org/" target="_blank" rel="noopener">latex</a></li>
<li><a href="https://www.mathjax.org/" target="_blank" rel="noopener">mathjax</a></li>
<li><a href="https://qianwenma.cn/2018/05/17/mathjax-yu-fa-can-kao/" target="_blank" rel="noopener">MathJax 语法参考</a></li>
<li><a href="https://www.jianshu.com/p/22117d964baf" target="_blank" rel="noopener">LATEX 公式总结</a></li>
<li><a href="https://github.com/opencollab/jlatexmath" target="_blank" rel="noopener">JLaTexMath</a> A Java API to render LaTeX</li>
<li><a href="https://github.com/mksmbrtsh/jlatexmath-android" target="_blank" rel="noopener">jlatexmath-android</a></li>
<li><a href="https://github.com/sixgodIT/JLaTexMath-andriod" target="_blank" rel="noopener">JLaTexMath-andriod</a></li>
<li><a href="https://github.com/daquexian/FlexibleRichTextView" target="_blank" rel="noopener">FlexibleRichTextView</a></li>
<li><a href="https://github.com/jianzhongli/MathView" target="_blank" rel="noopener">MathView</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/14/web/黑马前端39期/01 HTML5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/14/web/黑马前端39期/01 HTML5/" itemprop="url">01 HTML5</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-14T15:28:14+08:00">
                2020-02-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="浏览器内核"><a href="#浏览器内核" class="headerlink" title="浏览器内核"></a>浏览器内核</h1><p>浏览器内核可以分成两部分：</p>
<h2 id="渲染引擎"><a href="#渲染引擎" class="headerlink" title="渲染引擎"></a>渲染引擎</h2><p>Rendering Engine，或者Layout Engineer</p>
<p>解析输出网页内容</p>
<p>不同内核对于网页的语法解释会有不同，所以渲染的效果也不相同。</p>
<h2 id="JS引擎"><a href="#JS引擎" class="headerlink" title="JS引擎"></a>JS引擎</h2><p>解析 Javascript 语言，执行 javascript语言来实现网页的动态效果。</p>
<p>最开始渲染引擎和 JS 引擎并没有区分的很明确，后来 JS 引擎越来越独立，内核就倾向于只指渲染引擎。</p>
<h1 id="Web标准"><a href="#Web标准" class="headerlink" title="Web标准"></a>Web标准</h1><p>不同的浏览器内核，工作原理、解析、显示会有差别，需要一个统一标准</p>
<h2 id="Web-标准构成"><a href="#Web-标准构成" class="headerlink" title="Web 标准构成"></a>Web 标准构成</h2><p> Web标准是由W3C和其他标准化组织制定的一系列标准的集合。</p>
<p> 主要包括结构（Structure）、表现（Presentation）和行为（Behavior）三个方面。</p>
<h3 id="结构标准"><a href="#结构标准" class="headerlink" title="结构标准"></a>结构标准</h3><p>结构用于对网页元素进行整理和分类</p>
<p>主要包括XML和XHTML两个部分。</p>
<h3 id="样式标准"><a href="#样式标准" class="headerlink" title="样式标准"></a>样式标准</h3><p>表现用于设置网页元素的版式、颜色、大小等外观样式</p>
<p>主要指的是CSS。</p>
<h3 id="行为标准"><a href="#行为标准" class="headerlink" title="行为标准"></a>行为标准</h3><p>行为是指网页模型的定义及交互的编写</p>
<p>主要包括DOM和ECMAScript两个部分</p>
<h1 id="HTML-初识"><a href="#HTML-初识" class="headerlink" title="HTML 初识"></a>HTML 初识</h1><p>HTML（Hyper Text Markup Language）中文译为“超文本标签语言”</p>
<p>主要是通过HTML标签对网页中的文本、图片、声音等内容进行描述。</p>
<p>关键词：文本 标签 语言</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">strong</span>&gt;</span> 我是加粗的字体 <span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="HTML骨架格式"><a href="#HTML骨架格式" class="headerlink" title="HTML骨架格式"></a>HTML骨架格式</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">HTML</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span>     </span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">HTML</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>head标签中我们必须要设置的标签是title</p>
<h2 id="HTML标签分类"><a href="#HTML标签分类" class="headerlink" title="HTML标签分类"></a>HTML标签分类</h2><h3 id="双标签"><a href="#双标签" class="headerlink" title="双标签"></a>双标签</h3><p><code>&lt;标签名&gt; 内容 &lt;/标签名&gt;</code></p>
<h3 id="单标签"><a href="#单标签" class="headerlink" title="单标签"></a>单标签</h3><p><code>&lt;标签名 /&gt;</code> 比如 <code>&lt;br /&gt;</code></p>
<h2 id="HTML标签关系"><a href="#HTML标签关系" class="headerlink" title="HTML标签关系"></a>HTML标签关系</h2><h3 id="嵌套关系"><a href="#嵌套关系" class="headerlink" title="嵌套关系"></a>嵌套关系</h3><p><code>&lt;head&gt;  &lt;title&gt; &lt;/title&gt;  &lt;/head&gt;</code></p>
<h3 id="并列关系"><a href="#并列关系" class="headerlink" title="并列关系"></a>并列关系</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="文档类型-lt-DOCTYPE-gt"><a href="#文档类型-lt-DOCTYPE-gt" class="headerlink" title="文档类型&lt;!DOCTYPE&gt;"></a>文档类型&lt;!DOCTYPE&gt;</h1><p>位于文档的最前面</p>
<p>用于向浏览器说明当前文档使用的标准规范，保证浏览器能正确解析。</p>
<p><code>&lt;!DOCTYPE html&gt;</code></p>
<p>HTML5的文档类型兼容很好(向下兼容的原则)，所以使用HTML5的文档类型就好了。</p>
<h1 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h1><p><code>&lt;meta charset=&quot;UTF-8&quot;&gt;</code></p>
<h1 id="HTML标签"><a href="#HTML标签" class="headerlink" title="HTML标签"></a>HTML标签</h1><h2 id="标签属性"><a href="#标签属性" class="headerlink" title="标签属性"></a>标签属性</h2><p><code>&lt;标签名 属性1=&quot;属性值1&quot; 属性2=&quot;属性值2&quot; …&gt; 内容 &lt;/标签名&gt;</code></p>
<ol>
<li><p>标签可以拥有多个属性，必须写在开始标签中，位于标签名后面。</p>
</li>
<li><p>属性之间不分先后顺序</p>
</li>
<li><p>标签名与属性、属性与属性之间均以空格分开</p>
</li>
<li><p>属性采取  键值对 的格式； key=”value”  的格式</p>
</li>
<li><p>属性都有默认值，省略该属性则取默认值</p>
</li>
</ol>
<h2 id="排版标签"><a href="#排版标签" class="headerlink" title="排版标签"></a>排版标签</h2><p>显示网页结构的标签，是网页布局最常用的标签。</p>
<h3 id="标题标签-h1"><a href="#标题标签-h1" class="headerlink" title="标题标签 h1"></a>标题标签 h1</h3><p>单词缩写：  head   头部. 标题 </p>
<p>HTML提供了6个等级的标题，即 <code>&lt;h1&gt;到&lt;h6&gt;</code></p>
<h3 id="段落标签-p"><a href="#段落标签-p" class="headerlink" title="段落标签 p"></a>段落标签 p</h3><p>单词缩写：  paragraph  段落</p>
<h3 id="水平线标签-hr"><a href="#水平线标签-hr" class="headerlink" title="水平线标签 hr"></a>水平线标签 hr</h3><p>单词缩写：  horizontal  横线</p>
<h3 id="换行标签-br"><a href="#换行标签-br" class="headerlink" title="换行标签 br"></a>换行标签 br</h3><p>单词缩写：  break   打断 ,换行</p>
<h3 id="div-span标签"><a href="#div-span标签" class="headerlink" title="div span标签"></a>div span标签</h3><p>单词缩写：  division  分割，分区</p>
<p>span, 跨度，跨距；范围   </p>
<p>网页布局主要的2个盒子</p>
<h2 id="文本格式化标签"><a href="#文本格式化标签" class="headerlink" title="文本格式化标签"></a>文本格式化标签</h2><p>设置文本格式</p>
<table>
<thead>
<tr>
<th>标签</th>
<th>缩写</th>
<th>显示效果</th>
</tr>
</thead>
<tbody>
<tr>
<td>b strong</td>
<td>bold</td>
<td>粗体</td>
</tr>
<tr>
<td>i em</td>
<td>italic 斜体字；emphasize强调</td>
<td>斜体</td>
</tr>
<tr>
<td>s del</td>
<td>strike out 删去；delete</td>
<td>删除线</td>
</tr>
<tr>
<td>u ins</td>
<td>underline；insert插入</td>
<td>下划线，插入线</td>
</tr>
</tbody>
</table>
<p>b i s u 已经不推荐使用</p>
<h2 id="图像标签-img"><a href="#图像标签-img" class="headerlink" title="图像标签 img"></a>图像标签 img</h2><p>单词缩写：   image  图像</p>
<p><code>&lt;img src=&quot;图像URL&quot; /&gt;</code></p>
<p>src属性用于指定图像文件的路径和文件名，是img标签的必需属性。</p>
<h2 id="链接标签-a"><a href="#链接标签-a" class="headerlink" title="链接标签 a"></a>链接标签 a</h2><p>单词缩写：  anchor 锚</p>
<p><code>&lt;a href=&quot;跳转目标&quot; target=&quot;目标窗口的弹出方式&quot;&gt;文本或图像&lt;/a&gt;</code></p>
<p>网页中各种网页元素，如图像、表格、音频、视频等都可以添加超链接。</p>
<h3 id="关键属性"><a href="#关键属性" class="headerlink" title="关键属性"></a>关键属性</h3><h4 id="href"><a href="#href" class="headerlink" title="href"></a>href</h4><p>指定链接目标的url地址</p>
<p>Hypertext Reference, 超文本引用  </p>
<p>取值有：</p>
<ul>
<li>外部链接 <code>&lt; a href=&quot;http:// www.baidu.com&quot;&gt; 百度 &lt;/a &gt;</code></li>
<li>内部链接 <code>&lt; a href=&quot;index.html&quot;&gt; 首页 &lt;/a &gt;</code></li>
<li>空链接 <code>&lt; a href=&quot;#&quot;&gt; 空链接 &lt;/a &gt;</code></li>
</ul>
<h3 id="target"><a href="#target" class="headerlink" title="target"></a>target</h3><p>指定链接页面的打开方式</p>
<p>其取值有：</p>
<ul>
<li><code>_self</code> 默认值</li>
<li><code>_blank</code> 在新窗口中打开方式</li>
</ul>
<h3 id="锚点定位"><a href="#锚点定位" class="headerlink" title="锚点定位"></a>锚点定位</h3><p>通过创建锚点链接，用户能够快速定位到目标内容。</p>
<p>创建锚点链接分为两步：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.使用相应的id名标注跳转目标的位置</span><br><span class="line"></span><br><span class="line">2.使用 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">”#id名</span>"&gt;</span>“链接文本"<span class="tag">&lt;/<span class="name">a</span>&gt;</span> 创建链接文本</span><br></pre></td></tr></table></figure>
<h3 id="全局链接属性设置标签-base"><a href="#全局链接属性设置标签-base" class="headerlink" title="全局链接属性设置标签 base"></a>全局链接属性设置标签 base</h3><p>设置整体链接的属性  </p>
<p>base 写在 head 之间</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">base</span> <span class="attr">target</span>=<span class="string">"_blank"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>设置所有链接都在在新窗口中打开</p>
<h2 id="注释标签"><a href="#注释标签" class="headerlink" title="注释标签"></a>注释标签</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 单行注释语句 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">多行</span></span><br><span class="line"><span class="comment">注释</span></span><br><span class="line"><span class="comment">语句</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="无序列表-ul"><a href="#无序列表-ul" class="headerlink" title="无序列表 ul"></a>无序列表 ul</h2><p>列表项符号默认是点</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>列表项1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>列表项2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>列表项3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  ......</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="有序列表-ol"><a href="#有序列表-ol" class="headerlink" title="有序列表 ol"></a>有序列表 ol</h2><p>列表项符号默认是数字</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>列表项1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>列表项2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>列表项3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  ......</span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="自定义列表-dl"><a href="#自定义列表-dl" class="headerlink" title="自定义列表 dl"></a>自定义列表 dl</h2><p>列表项前没有任何项目符号</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>名词1<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>名词1解释1<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>名词1解释2<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>名词2<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>名词2解释1<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>名词2解释2<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="表格-table"><a href="#表格-table" class="headerlink" title="表格 table"></a>表格 table</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>单元格内的文字<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">table 表格</span><br><span class="line">tr 行；行内只能放单元格</span><br><span class="line">td 单元格；</span><br><span class="line">th 表头单元格（特殊的td）；一般位于表格的第一行或第一列；文本加粗居中</span><br></pre></td></tr></table></figure>
<h3 id="表格属性"><a href="#表格属性" class="headerlink" title="表格属性"></a>表格属性</h3><table>
<thead>
<tr>
<th>属性</th>
<th>含义</th>
<th>属性值</th>
</tr>
</thead>
<tbody>
<tr>
<td>border</td>
<td>单元格边框像素</td>
<td>默认0像素，无边框</td>
</tr>
<tr>
<td>cellspacing</td>
<td>单元格外间距</td>
<td>默认2像素</td>
</tr>
<tr>
<td>cellpadding</td>
<td>单元格内间距（内容与边框间距）</td>
<td>默认1像素</td>
</tr>
</tbody>
</table>
<h2 id="合并单元格"><a href="#合并单元格" class="headerlink" title="合并单元格"></a>合并单元格</h2><p>跨行合并：rowspan    跨列合并：colspan</p>
<p>将多个内容合并的时候，就会有多余的东西，需要把它删除。例如 把 3个 td 合并成一个， 那就多余了2个，需要删除。</p>
<p>删除的个数  =  合并的个数  - 1</p>
<h2 id="表单"><a href="#表单" class="headerlink" title="表单"></a>表单</h2><p>一个完整的表单通常由3个部分构成：</p>
<ul>
<li><strong>表单域</strong>。<strong>容器</strong>：容纳所有的表单控件和提示信息，定义处理表单数据所用程序的url地址，以及数据提交到服务器的方法。</li>
<li><strong>表单控件</strong>（也称为表单元素）。表单功能项，如单行文本输入框、密码输入框、复选框、提交按钮、重置按钮等。</li>
<li><strong>提示信息</strong></li>
</ul>
<h3 id="表单域-form"><a href="#表单域-form" class="headerlink" title="表单域 form"></a>表单域 form</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"url地址"</span> <span class="attr">method</span>=<span class="string">"提交方式"</span> <span class="attr">name</span>=<span class="string">"表单名称"</span>&gt;</span></span><br><span class="line">  各种表单控件</span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>常用属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. Action</span><br><span class="line">   在表单收集到信息后，需要将信息传递给服务器进行处理，action属性用于指定接收并处理表单数据的服务器程序的url地址。</span><br><span class="line">2. method</span><br><span class="line">   用于设置表单数据的提交方式，其取值为get或post。</span><br><span class="line">3. name</span><br><span class="line">   用于指定表单的名称，以区分同一个页面中的多个表单。</span><br></pre></td></tr></table></figure>
<h3 id="输入控件-input"><a href="#输入控件-input" class="headerlink" title="输入控件 input"></a>输入控件 input</h3><p><img src="media/html5/input.png"></p>
<h3 id="多行文本控件-textarea"><a href="#多行文本控件-textarea" class="headerlink" title="多行文本控件 textarea"></a>多行文本控件 textarea</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">cols</span>=<span class="string">"每行中的字符数"</span> <span class="attr">rows</span>=<span class="string">"显示的行数"</span>&gt;</span></span><br><span class="line">  文本内容</span><br><span class="line"><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="下拉菜单-select"><a href="#下拉菜单-select" class="headerlink" title="下拉菜单 select"></a>下拉菜单 select</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span>&gt;</span>选项1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span>&gt;</span>选项2<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span>&gt;</span>选项3<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以使用 <code>selected =&quot;selected&quot;</code>定义默认选中项</p>
<h3 id="文本标签-label"><a href="#文本标签-label" class="headerlink" title="文本标签 label"></a>文本标签 label</h3><p>为 input 定义标注（即绑定input），点击label的时候, 被绑定的表单元素就会获得输入焦点</p>
<p>for属性用来指定要绑定input的id</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"male"</span>&gt;</span>Male<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"sex"</span> <span class="attr">id</span>=<span class="string">"male"</span> <span class="attr">value</span>=<span class="string">"male"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="路径"><a href="#路径" class="headerlink" title="路径"></a>路径</h1><h2 id="相对路径"><a href="#相对路径" class="headerlink" title="相对路径"></a>相对路径</h2><p>相对自身的路径</p>
<p><code>../</code>表示父级文件夹</p>
<h2 id="绝对路径"><a href="#绝对路径" class="headerlink" title="绝对路径"></a>绝对路径</h2><p>完整的路径地址（文件夹或网络地址）</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/04/杂篇/斗地主的技巧/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/04/杂篇/斗地主的技巧/" itemprop="url">斗地主的技巧</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-04T14:49:53+08:00">
                2020-02-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/杂篇/" itemprop="url" rel="index">
                    <span itemprop="name">杂篇</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>扑克游戏指导 斗地主的技巧，孔维民，北京体育大学出版社</p>
<h1 id="游戏规则"><a href="#游戏规则" class="headerlink" title="游戏规则"></a>游戏规则</h1><h2 id="三人斗地主"><a href="#三人斗地主" class="headerlink" title="三人斗地主"></a>三人斗地主</h2><h3 id="牌型"><a href="#牌型" class="headerlink" title="牌型"></a>牌型</h3><p>单牌</p>
<p>对牌</p>
<p>三条（三张一样的）</p>
<p>三带一（一手牌：单或对）</p>
<p>单顺（5连续单牌）</p>
<p>双顺（3连续对牌）</p>
<p>三顺（飞机，2连续三条，可以带同数量的翅膀-单或对）</p>
<p>四带二（4张一样的+两手牌：单或双）</p>
<p>炸弹（4张一样）</p>
<p>火箭（双王）</p>
<h1 id="叫牌"><a href="#叫牌" class="headerlink" title="叫牌"></a>叫牌</h1><h2 id="量化牌力"><a href="#量化牌力" class="headerlink" title="量化牌力"></a>量化牌力</h2><p>3人斗地主为例，牌力量化如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">炸弹 5</span><br><span class="line">大王 3.5</span><br><span class="line">小王 2.5</span><br><span class="line">2 2 是否有王的保护，牌力升降0.5</span><br><span class="line">A 1</span><br><span class="line">K 0.5</span><br></pre></td></tr></table></figure>
<p>不包括炸弹，总牌力是 (2+1+0.5)x4 + 6 = 20</p>
<p>产生炸弹的概率是 1/4 到 1/3，因此牌力在 7 以上，叫牌比较科学</p>
<h2 id="掉张小牌太多，牌力强也不叫"><a href="#掉张小牌太多，牌力强也不叫" class="headerlink" title="掉张小牌太多，牌力强也不叫"></a>掉张小牌太多，牌力强也不叫</h2><p>3人斗地主中，底牌中获取期望单牌的概率：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">手上0张，28.52%</span><br><span class="line">手上1张，22.99%</span><br><span class="line">手上3张，8.11%</span><br></pre></td></tr></table></figure>
<h1 id="必知概率"><a href="#必知概率" class="headerlink" title="必知概率"></a>必知概率</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/03/Android/gradle/gradle使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/03/Android/gradle/gradle使用/" itemprop="url">gradle使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-03T14:13:53+08:00">
                2020-02-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://segmentfault.com/a/1190000004241503#articleHeader7" target="_blank" rel="noopener">Gradle for Android 读书笔记</a></p>
<h1 id="Android-Gradle-plugin-vs-Gradle"><a href="#Android-Gradle-plugin-vs-Gradle" class="headerlink" title="Android Gradle plugin vs Gradle"></a><a href="https://developer.android.google.cn/studio/releases/gradle-plugin#updating-gradle" target="_blank" rel="noopener">Android Gradle plugin vs Gradle</a></h1><p>Android Gradle plugin 增加了一些编译apk的特性，可以独立于Android Studio 升级和使用</p>
<h2 id="Android-Gradle-plugin-和-Gradle-版本兼容"><a href="#Android-Gradle-plugin-和-Gradle-版本兼容" class="headerlink" title="Android Gradle plugin 和 Gradle 版本兼容"></a>Android Gradle plugin 和 Gradle 版本兼容</h2><table>
<thead>
<tr>
<th>Plugin version</th>
<th>Required Gradle version</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.0.0 - 1.1.3</td>
<td>2.2.1 - 2.3</td>
</tr>
<tr>
<td>1.2.0 - 1.3.1</td>
<td>2.2.1 - 2.9</td>
</tr>
<tr>
<td>1.5.0</td>
<td>2.2.1 - 2.13</td>
</tr>
<tr>
<td>2.0.0 - 2.1.2</td>
<td>2.10 - 2.13</td>
</tr>
<tr>
<td>2.1.3 - 2.2.3</td>
<td>2.14.1+</td>
</tr>
<tr>
<td>2.3.0+</td>
<td>3.3+</td>
</tr>
<tr>
<td>3.0.0+</td>
<td>4.1+</td>
</tr>
<tr>
<td>3.1.0+</td>
<td>4.4+</td>
</tr>
</tbody>
</table>
<h2 id="升级-Android-Gradle-plugin"><a href="#升级-Android-Gradle-plugin" class="headerlink" title="升级 Android Gradle plugin"></a>升级 Android Gradle plugin</h2><p>工程根目录 build.gradle</p>
<pre><code>buildscript {
    repositories {
        // Gradle 4.1 and higher include support for Google&apos;s Maven repo using
        // the google() method. And you need to include this repo to download
        // Android Gradle plugin 3.0.0 or higher.
        google()
        ...
    }
    dependencies {
        classpath &apos;com.android.tools.build:gradle:3.2.1&apos;
    }
}
</code></pre><h2 id="升级-Gradle"><a href="#升级-Gradle" class="headerlink" title="升级 Gradle"></a>升级 Gradle</h2><p>工程根目录 gradle/wrapper/gradle-wrapper.properties</p>
<pre><code>distributionUrl = https\://services.gradle.org/distributions/gradle-4.6-all.zip
</code></pre><p><a href="https://services.gradle.org/distributions/" target="_blank" rel="noopener">Gradle版本</a></p>
<h2 id="选择那个Gradle-plugin版本"><a href="#选择那个Gradle-plugin版本" class="headerlink" title="选择那个Gradle plugin版本"></a>选择那个Gradle plugin版本</h2><p>旧版本的话，建议升级到3.0.0</p>
<p>因为有些特性虽然已声明废弃，但还暂时支持</p>
<p>比如 compile，注解</p>
<p>这样可以兼容很多第三方库，节省大量工作</p>
<h2 id="升级到Gradle-plugin-3-0-0遇到的坑"><a href="#升级到Gradle-plugin-3-0-0遇到的坑" class="headerlink" title="升级到Gradle plugin 3.0.0遇到的坑"></a>升级到Gradle plugin 3.0.0遇到的坑</h2><h3 id="坑1"><a href="#坑1" class="headerlink" title="坑1"></a>坑1</h3><pre><code>Error:Cannot set the value of read-only property &apos;outputFile&apos; for ApkVariantOutputImpl_Decorated{apkData=Main{type=MAIN, fullName=debug, filters=[]}} of type com.android.build.gradle.internal.api.ApkVariantOutputImpl.
</code></pre><p>代码如下</p>
<pre><code>// APK 文件名带上版本号
android.applicationVariants.all { variant -&gt;
    variant.outputs.each { output -&gt;
        output.outputFile = new File(
                output.outputFile.parent,
                output.outputFile.name.replace(&quot;.apk&quot;, &quot;-${variant.versionName}.apk&quot;))
    }
}
</code></pre><p>解决方案：</p>
<pre><code>用 all() 代替 each() 
    新模式下，each只能遍历配置时存在的变量；all才能循环执行时生成的变量
用 outputFileName 代替 output.outputFile ，如果只是修改文件名
</code></pre><p>修改后代码</p>
<pre><code>android.applicationVariants.all { variant -&gt;
    variant.outputs.all { output -&gt;
        outputFileName = output.outputFile.name.replace(&quot;.apk&quot;, &quot;-${variant.versionName}.apk&quot;)
    }
}
</code></pre><h3 id="坑2"><a href="#坑2" class="headerlink" title="坑2"></a>坑2</h3><pre><code>Error:Cannot choose between the following configurations of project :XXX:
  - debugApiElements
  - debugRuntimeElements
  - releaseApiElements
  - releaseRuntimeElements
</code></pre><p>解决方案</p>
<pre><code>annotationProcessor 替换 apt
</code></pre><p>详细步骤</p>
<p>1、项目根目录build.gradle文件，删除“apt”配置：</p>
<pre><code>classpath &apos;com.neenbedankt.gradle.plugins:android-apt:1.8&apos; //删除
</code></pre><p>2、module的build.gradle文件，删除“android-apt” plugin引用：</p>
<pre><code>apply plugin: &apos;android-apt&apos;  //删除
</code></pre><p>3、module的build.gradle文件，修改“dependencies”中的“apt”方式 为“annotationProcessor”方式：</p>
<pre><code>apt &quot;引用项&quot;  //老方式，删除
annotationProcessor &quot;引用项&quot; //新方式

比如
apt &apos;com.jakewharton:butterknife-compiler:8.0.1&apos;
annotationProcessor &apos;com.jakewharton:butterknife-compiler:8.0.1&apos;
</code></pre><h3 id="坑3"><a href="#坑3" class="headerlink" title="坑3"></a>坑3</h3><pre><code>Error:All flavors must now belong to a named flavor dimension. Learn more at https://d.android.com/r/tools/flavorDimensions-missing-error-message.html
</code></pre><p>Plugin 3.0.0之后有一种自动匹配消耗库的机制，便于debug variant 自动消耗一个库，然后就是必须要所有的flavor 都属于同一个维度。 </p>
<p>在主 app 的 build.gradle 里面的</p>
<pre><code>defaultConfig {
     targetSdkVersion：***
     minSdkVersion ：***
     versionCode：***
     versionName ：***

    //意思是flavor dimension 它的维度就是该版本号，
    //这样维度就是都是统一的了
     **flavorDimensions &quot;versionCode&quot;**
</code></pre><h3 id="坑4"><a href="#坑4" class="headerlink" title="坑4"></a>坑4</h3><pre><code>Error:Execution failed for task &apos;:youyoubao:javaPreCompileCommonDebug&apos;.
&gt; Annotation processors must be explicitly declared now.  The following dependencies on the compile classpath are found to contain annotation processor.  Please add them to the annotationProcessor configuration.
    - butterknife-compiler-8.6.0.jar (com.jakewharton:butterknife-compiler:8.6.0)
  Alternatively, set android.defaultConfig.javaCompileOptions.annotationProcessorOptions.includeCompileClasspath = true to continue with previous behavior.  Note that this option is deprecated and will be removed in the future.
  See https://developer.android.com/r/tools/annotation-processor-error-message.html for more details.
</code></pre><p>需要在 <code>app下的build.gradle的defaultConfig</code>下 显式声明annotation Processor库。</p>
<p>3.0.0之前的版本中，compile a ，不但会把lib a 放到compile classpath 路径下，还会自动放到processor classpath路径下。这会导致processor classpath路径下有大量不必要的依赖，这会更加编译时间。所以从gradle插件3.0.0以后，如果一个库是annotation processors库（如果库中还有META-INF/services/javax.annotation.processing.Processor，那么就认为这是一个annotation processors库），那么需要自己手动使用<strong>annotationProcessor</strong>关键字添加：</p>
<pre><code>dependencies {
     ...
annotationProcessor &apos;com.google.dagger:dagger-compiler:&lt;version-number&gt;&apos;
}
</code></pre><p>如果annotation processors库也需要放到compile classpath 路径下，需要使用compile/api/implementation再声明依赖一次。</p>
<p>并且，新版本如果发现annotation processors库也存在于compile classpath路径下，就会报错。所以需要在android defaultConfig块中进行声明不进行错误检查。</p>
<pre><code> android {
    ...
   defaultConfig {
   ...
     javaCompileOptions {
        annotationProcessorOptions {
          includeCompileClasspath false
      }
    }
 }
}
</code></pre><p>如果不想那么麻烦，直接使用如下配置也可以，但是这样的配置在之后的gradle插件版本中并不支持，所以不推荐</p>
<pre><code>defaultConfig {
   ...
   javaCompileOptions { annotationProcessorOptions { includeCompileClasspath = true } }
}
</code></pre><h1 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a><a href="http://www.cnblogs.com/xinmengwuheng/p/5797026.html" target="_blank" rel="noopener">基本配置</a></h1><h2 id="gradle-wrapper-properties"><a href="#gradle-wrapper-properties" class="headerlink" title="gradle-wrapper.properties"></a>gradle-wrapper.properties</h2><ul>
<li>声明gradle的目录。 一般不修改</li>
<li><p>声明项目使用的gradle版本及gradle的下载路径</p>
<pre><code>distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists
distributionUrl=https\://services.gradle.org/distributions/gradle-2.14.1-all.zip //gradle 版本
</code></pre></li>
</ul>
<h2 id="setting-gradle"><a href="#setting-gradle" class="headerlink" title="setting.gradle"></a>setting.gradle</h2><p>声明工程包含的模块</p>
<pre><code>include &apos;:app&apos;,&apos;:library&apos;
</code></pre><h2 id="根目录的build-gradle"><a href="#根目录的build-gradle" class="headerlink" title="根目录的build.gradle"></a>根目录的build.gradle</h2><p>声明工程所有模块的公共属性</p>
<pre><code>buildscript {
    repositories {
        jcenter()//使用jcenter库
    }
    dependencies {
        classpath &apos;com.android.tools.build:gradle:1.5.0&apos;// 依赖android提供的1.5.0的gradle build plugin Tools，一般跟AndroidStudio版本号一致

        // NOTE: Do not place your application dependencies here; they belong
        // in the individual module build.gradle files
    }
}
//为所有的工程的repositories配置为jcenters
allprojects {
    repositories {
        jcenter()
    }
}

task clean(type: Delete) {
    delete rootProject.buildDir
}
</code></pre><h3 id="使用技巧"><a href="#使用技巧" class="headerlink" title="使用技巧"></a>使用技巧</h3><p>repositories 指定本地文件夹</p>
<pre><code>allprojects {
        repositories {
            maven { url &quot;https://dl.bintray.com/thelasterstar/maven/&quot; }
            maven {
                // 本地依赖。目录下所有lib都是通过npm安装的。All of React Native (JS, Obj-C sources, Android binaries) is installed from npm
                url &quot;$rootDir/node_modules/react-native/android&quot;
            }
            flatDir {
                dirs &apos;libs&apos;
            }

A problem occurred configuring project &apos;:react-native-svg&apos;.
   &gt; Could not resolve all dependencies for configuration &apos;:react-native-svg:_debugCompile&apos;.
      &gt; Could not find com.facebook.react:react-native:0.48.4.
        Searched in the following locations:
             https://dl.bintray.com/thelasterstar/maven/com/facebook/react/react-native/0.48.4/react-native-0.48.4.pom
            https://dl.bintray.com/thelasterstar/maven/com/facebook/react/react-native/0.48.4/react-native-0.48.4.jar
             file:/D:/AndroidProject/rns/ssz_rn_project/android/node_modules/react-native/android/com/facebook/react/react-native/0.48.4/react-native-0.48.4.pom
            file:/D:/AndroidProject/rns/ssz_rn_project/android/node_modules/react-native/android/com/facebook/react/react-native/0.48.4/react-native-0.48.4.jar
            file:/D:/AndroidProject/rns/ssz_rn_project/android/node_modules/react-native-svg/android/libs/react-native-0.48.4.jar
</code></pre><h2 id="app-build-gradle"><a href="#app-build-gradle" class="headerlink" title="app/build.gradle"></a>app/build.gradle</h2><p>module的gradle配置</p>
<pre><code>#表示该module是一个app module,library module 写com.android.library
apply plugin: &apos;com.android.application&apos;

#android专用配置
android {
    compileSdkVersion 23
    buildToolsVersion &quot;23.0.2&quot; //构建工具的版本号,对应 AndroidSDK 中的 Android SDK Build-tools

    #默认配置，如果没有其他的配置覆盖，就会使用这里的
    defaultConfig {
        applicationId &quot;com.wuxiaolong.gradle4android&quot;
        minSdkVersion 15
        targetSdkVersion 23
        versionCode 1
        versionName &quot;1.0&quot;
    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;
        }
    }
}

#依赖的jar，aar，jcenter库信息
dependencies {
    compile fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])
    testCompile &apos;junit:junit:4.12&apos;
    compile &apos;com.android.support:appcompat-v7:23.2.1&apos;
    compile &apos;com.android.support:design:23.2.1&apos;
}
</code></pre><h2 id="gradle-properties"><a href="#gradle-properties" class="headerlink" title="gradle.properties"></a>gradle.properties</h2><ul>
<li>任何module的 build.gradle 都可以读取 gradle.properties 中的常量</li>
<li>gradle.properties 中的数据类型都是 String 类型<ul>
<li>使用其他数据类型需要自行转换；</li>
</ul>
</li>
</ul>
<p><a href="http://blog.csdn.net/guiying712/article/details/72629948" target="_blank" rel="noopener">利用本地化配置buildToolsVersion和gradleBuildTools</a> </p>
<p>解决方案：</p>
<ul>
<li><p>gradle.properties 从版本控制工具中给忽略掉<br>gradle.properties</p>
</li>
<li><p>配置好的 gradle.properties 给每个开发人员发一份，供本地使用</p>
</li>
</ul>
<p>代码：</p>
<p>gradle.properties 中</p>
<pre><code># 为自动化出包配置(因为每个开发的电脑坏境不一致)
localBuildToolsVersion=25.0.3
# 这个值一般跟你的AndroidStudio版本号一致
localGradlePluginVersion=2.2.3
</code></pre><p>根目录的build.gradle</p>
<pre><code>buildscript {
    dependencies {
        classpath &quot;com.android.tools.build:gradle:$localGradlePluginVersion&quot;
</code></pre><p>module的build.gradle</p>
<pre><code>android {
    buildToolsVersion localBuildToolsVersion
</code></pre><h2 id="repositories节点"><a href="#repositories节点" class="headerlink" title="repositories节点"></a>repositories节点</h2><ul>
<li>buildScript块。根目录下build.gradle<ul>
<li>Gradle脚本自身执行依赖插件 </li>
</ul>
</li>
<li>allprojects块。根目录下build.gradle<ul>
<li>所有项目共同所需依赖包</li>
</ul>
</li>
<li>根级别。module目录下build.gradle<ul>
<li>当前项目所需依赖包</li>
</ul>
</li>
</ul>
<h1 id="全局设置"><a href="#全局设置" class="headerlink" title="全局设置"></a><a href="http://www.cnblogs.com/xinmengwuheng/p/5797048.html" target="_blank" rel="noopener">全局设置</a></h1><h2 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h2><p>根目录下build.gradle 定义全局设置</p>
<pre><code>ext {
    compileSdkVersion = 23
    buildToolsVersion = &quot;23.0.2&quot;
    minSdkVersion = 14
    targetSdkVersion = 23
}
</code></pre><p>module下build.gradle 引用全局设置</p>
<pre><code>android {
    compileSdkVersion rootProject.ext.compileSdkVersion
    buildToolsVersion rootProject.ext.buildToolsVersion

    defaultConfig {
        applicationId &quot;com.example.android&quot;
        minSdkVersion rootProject.ext.minSdkVersion
        targetSdkVersion rootProject.ext.targetSdkVersion
        versionCode 1
        versionName &quot;1.0&quot;
    }
</code></pre><h2 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h2><p>根目录下建config.gradle 定义全局变量设置</p>
<pre><code>ext {

    android = [
            compileSdkVersion: 23,
            buildToolsVersion: &quot;23.0.2&quot;,
            minSdkVersion    : 14,
            targetSdkVersion : 22,

    ]

    dependencies = [
            appcompatV7&apos;: &apos;com.android.support:appcompat-v7:23.2.1&apos;,
            design      : &apos;com.android.support:design:23.2.1&apos;

    ]
}
</code></pre><p>根目录下build.gradle 最顶部</p>
<pre><code>apply from: &quot;config.gradle&quot;
</code></pre><p>module下build.gradle 引用全局设置</p>
<pre><code>android {
    compileSdkVersion rootProject.ext.android.compileSdkVersion
    buildToolsVersion rootProject.ext.buildToolsVersion

    defaultConfig {
        applicationId &quot;com.example.android&quot;
        minSdkVersion rootProject.ext.android.minSdkVersion
        targetSdkVersion rootProject.ext.android.targetSdkVersion
        versionCode 1
        versionName &quot;1.0&quot;
    }

...

dependencies {
    compile fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])
    testCompile &apos;junit:junit:4.12&apos;
    compile rootProject.ext.dependencies.appcompatV7
    compile rootProject.ext.dependencies.design
}
</code></pre><h1 id="buildConfigField"><a href="#buildConfigField" class="headerlink" title="buildConfigField"></a>buildConfigField</h1><p>自动生成 BuildConfig 类。 每个字段都是 public static final，直接由BuildConfig类点出key名来取值</p>
<p>示例：服务器可能有正式环境和测试环境</p>
<pre><code>defaultConfig {
    buildConfigField &apos;String&apos;,&apos;API_SERVER_URL&apos;,&apos;&quot;http://url/&quot;&apos; //定义了String类型，名为API_SERVER_URL，值为http://url/
}

Log.d(&quot;wxl&quot;, &quot;API_SERVER_URL=&quot; + BuildConfig.API_SERVER_URL);
</code></pre><p>注意，字符串类型的值一定要用双引号包裹起来，否则生成的BuildConfig类中会值类型错误</p>
<pre><code>buildConfigField(&quot;String&quot;, &quot;APP_URL&quot;, &quot;https://test-app.xuehu365.com/&quot;)
public static final String APP_URL = https://test-app.xuehu365.com/; //错误值类型，没有双引号

buildConfigField(&quot;String&quot;, &quot;APP_URL&quot;, &apos;&quot;https://test-app.xuehu365.com/&quot;&apos;)
public static final String APP_URL = &quot;https://test-app.xuehu365.com/&quot;;
</code></pre><p>生成的完整的BuildConfig类</p>
<pre><code>public static final boolean DEBUG = Boolean.parseBoolean(&quot;true&quot;);
public static final String APPLICATION_ID = &quot;com.xuehu365.xuehu&quot;;
public static final String BUILD_TYPE = &quot;debug&quot;;
public static final String FLAVOR = &quot;xuehuDetect&quot;;
public static final int VERSION_CODE = 280;
public static final String VERSION_NAME = &quot;2.8.0&quot;;
public static final String FLAVOR_channel = &quot;xuehu&quot;;
public static final String FLAVOR_server = &quot;detect&quot;;
// Fields from build type: debug
public static final boolean isDebug = true;
// Fields from product flavor: detect 正式开始自定义的值。上面都是预定义的
public static final String APP_URL = https://test-app.xuehu365.com/;
</code></pre><h1 id="flavorDimensions-一套代码打包多个应用"><a href="#flavorDimensions-一套代码打包多个应用" class="headerlink" title="flavorDimensions 一套代码打包多个应用"></a><a href="https://juejin.im/post/59648441f265da6c415f3078" target="_blank" rel="noopener">flavorDimensions 一套代码打包多个应用</a></h1><p>将某个应用更换 UI、文案或者某些界面布局和逻辑代码,换一套皮肤、第三方账号、后台服务器，改个名字上线，并且以后的新功能同步进行更新</p>
<p>总结一下技术点：</p>
<pre><code>manifestPlaceholders -&gt; AndroidManifest.xml 占位符
buildConfigField -&gt; BuildConfig 动态配置常量值
resValue -&gt; String.xml 动态配置字符串
signingConfigs -&gt; 配置签名文件
productFlavors -&gt; 产品定制多版本
flavorDimensions -&gt; 为产品定制设置多个维度
android.applicationVariants -&gt; 操作 task
</code></pre><p>示例： 区分渠道(官方，应用宝)和服务器版本（开发，测试，生产），</p>
<p>根据 Product Flavors 的两个维度和 Build Type [debug, release]，最后会生成 <code>2渠道x3服务器版本x2打包类型=12</code> 12个 Build Variant</p>
<pre><code>android {

    //创建两个维度的 flavor
    flavorDimensions &quot;server&quot;, &quot;channel&quot;//定义顺序很重要。决定BuildVariant和productFlavors.all批量遍历的name值(最后一维的flavor为name值)

    productFlavors {
        xuehu { dimension &quot;channel&quot; }
        yybao { dimension &quot;channel&quot; }

        dev {
            dimension &quot;server&quot;
            buildConfigField(&quot;String&quot;, &quot;APP_URL&quot;, &quot;https://dev.app.xuehu365.com/&quot;)
        }
        detect {
            dimension &quot;server&quot;
            buildConfigField(&quot;String&quot;, &quot;APP_URL&quot;, &quot;https://test-app.xuehu365.com/&quot;)
        }
        prod {
            dimension &quot;server&quot;
            buildConfigField(&quot;String&quot;, &quot;APP_URL&quot;, &quot;https://app.xuehu365.com/&quot;)
        }

        productFlavors.all {
            flavor -&gt; flavor.manifestPlaceholders = [UMENG_CHANNEL_VALUE: name]//取值为最后一维的值(xuehu,yybao等)
        }
    }
</code></pre><h1 id="android-applicationVariants"><a href="#android-applicationVariants" class="headerlink" title="android.applicationVariants"></a><a href="http://www.jianshu.com/p/25b385afd8b7" target="_blank" rel="noopener">android.applicationVariants</a></h1><p>Android工程相对Java工程来说，要复杂的多，因为通过Build Types和Product Flavors动态的创建很多任务。</p>
<ul>
<li>applicationVariants (仅仅适用于Android应用Gradle插件)</li>
<li>libraryVariants (仅仅适用于Android库Gradle插件)</li>
<li>testVariants (以上两种Gradle插件都使用)</li>
</ul>
<p>以上三个属性返回的都是<strong>DomainObjectSet对象集合</strong>，里面元素分别是ApplicationVariant、LibraryVariant和TestVariant</p>
<p>applicationVariants是Android动态构建的产物，可以代表google渠道正式服务器的release包，也可以代表baidu渠道dev开发服务器的debug包</p>
<p><strong>特别注意</strong>，访问以上这三种集合都会触发动态创建所有的任务。也就是说假如我们通过访问这些集合，修改生成Apk的输出文件名，那么就会自动的触发创建所有任务，此时我们修改后的新的Apk文件名就会在所有任务中起作用（如果我们在多个product flavor中都访问这些集合，就以最后一次访问结果为最终结果，而不是每个flavor有不同结果）。</p>
<p>applicationVariants是一个DomainObjectCollection集合，可以通过all方法进行遍历，遍历的每一个variant都是一个ApplicationVariant</p>
<p>ApplicationVariant，通过查看源代码看到它有一个outputs List集合 作为它的输出，我们再遍历它，如果它的名字是以.apk结尾的话那么就是我们要修改的apk名字了</p>
<pre><code>android.applicationVariants.all { variant -&gt;
    variant.outputs.each { output -&gt;
        if (output.outputFile != null &amp;&amp; output.outputFile.name.endsWith(&apos;.apk&apos;)) {
            def file = output.outputFile
            output.outputFile = new File(file.parent, file.name.replace(file.name,
                    variant.productFlavors[0].name + &quot;_&quot; +
                            variant.versionName
                            + &quot;_${variant.productFlavors[1].name}.apk&quot;))
        }
    }
}
</code></pre><h1 id="library-构建"><a href="#library-构建" class="headerlink" title="library 构建"></a>library 构建</h1><p><strong>library module 默认是输出 release 包的</strong>。所以默认情况下载library module 设置debug字段(如高德debug key)是浪费表情</p>
<h2 id="library-支持-debug-设置"><a href="#library-支持-debug-设置" class="headerlink" title="library 支持 debug 设置"></a>library 支持 debug 设置</h2><ul>
<li>library的gradle中加入以下配置 <code>publishNonDefault true</code> 意思是 library在打包的时候不只是打release包</li>
<li><p>主module的gradle中添加如下配置</p>
<pre><code>debugCompile project(path: &apos;:library&apos;, configuration: &apos;debug&apos;)
releaseCompile project(path: &apos;:library&apos;, configuration: &apos;release&apos;)
</code></pre><p>  这样项目就会根据不同的编译环境依赖对应的包。</p>
</li>
</ul>
<h1 id="compileSdkVersion与buildToolsVersion引起的问题"><a href="#compileSdkVersion与buildToolsVersion引起的问题" class="headerlink" title="compileSdkVersion与buildToolsVersion引起的问题"></a>compileSdkVersion与buildToolsVersion引起的问题</h1><pre><code>No resource found that matches the given name: attr &apos;android:keyboardNavigationCluster&apos;.
</code></pre><p>一般都是compileSdkVersion低于依赖的sdk版本，升级版本即可</p>
<pre><code>例如compileSdkVersion是25，依赖了v7:27。就会报错
</code></pre><h1 id="删除重复文件"><a href="#删除重复文件" class="headerlink" title="删除重复文件"></a>删除重复文件</h1><p>有时候依赖三方库会造成文件重复。比如腾讯im包含部分bugly的文件</p>
<pre><code>// 解决IM SDK与RN依赖和bugly冲突【libgnustl_shared.so】
import com.android.build.gradle.internal.pipeline.TransformTask

def deleteDuplicateJniFiles() {
    def files = fileTree(&quot;${buildDir}/intermediates/exploded-aar/shensz_android/imsdk/unspecified/jni/&quot;) {
        include &quot;**/libgnustl_shared.so&quot;
    }
    files.each { it.delete() }
    def buglyFiles = fileTree(&quot;${buildDir}/intermediates/exploded-aar/com.tencent.bugly/nativecrashreport/3.0/jni/&quot;) {
        include &quot;**/libBugly.so&quot;
    }
    buglyFiles.each { it.delete() }

    def sharedFiles = fileTree(&quot;${buildDir}/intermediates/exploded-aar/com.tencent.ilivesdk/ilivesdk/1.7.0/jni/&quot;) {
        include &quot;**/libstlport_shared.so&quot;
    }
    sharedFiles.each { it.delete() }
}

tasks.withType(TransformTask) { pkgTask -&gt;
    pkgTask.doFirst { deleteDuplicateJniFiles() }
}
</code></pre><h1 id="ResolutionStrategy"><a href="#ResolutionStrategy" class="headerlink" title="ResolutionStrategy"></a>ResolutionStrategy</h1><p>support包冲突,无法编译</p>
<p>最深的坑是：force强制使用某个版本，编译通过。然后在某些系统，ClassNotFoundException</p>
<pre><code>java.lang.ClassNotFoundException:Didn&apos;t find class &quot;android.support.v4.animation.AnimatorCompatHelper&quot; on path: DexPathList[[zip file &quot;/data/app/com.zy.course-1/base.apk&quot;],nativeLibraryDirectories=[/data/app/com.zy.course-1/lib/arm, /data/app/com.zy.course-1/base.apk!/lib/armeabi-v7a, /vendor/lib, /system/lib]]
    dalvik.system.BaseDexClassLoader.findClass(BaseDexClassLoader.java:56)
    java.lang.ClassLoader.loadClass(ClassLoader.java:511)
    java.lang.ClassLoader.loadClass(ClassLoader.java:469)
    android.support.v7.widget.DefaultItemAnimator.resetAnimation(ProGuard:515)
    android.support.v7.widget.DefaultItemAnimator.animateChange(ProGuard:322)
    android.support.v7.widget.SimpleItemAnimator.animateChange(ProGuard:149)
    android.support.v7.widget.RecyclerView.animateChange(ProGuard:3624)
</code></pre><p>原来方案：</p>
<pre><code>configurations.all {
    resolutionStrategy {
        force &apos;com.android.support:support-v4:27.0.1&apos;
        force &apos;com.android.support:design:27.0.1&apos;
        force &apos;com.android.support:appcompat-v7:27.0.1&apos;
    }
}
</code></pre><p>解决方案</p>
<pre><code>android {
    configurations.all {
            resolutionStrategy.eachDependency { DependencyResolveDetails details -&gt;
                def requested = details.requested
                if (requested.group == &apos;com.android.support&apos;) {
                    if (!requested.name.startsWith(&quot;multidex&quot;)) {
                        details.useVersion &apos;24.1.0&apos;
                    }
                }
            }
        }
}
</code></pre><h1 id="Walle-渠道包打包神器"><a href="#Walle-渠道包打包神器" class="headerlink" title="Walle 渠道包打包神器"></a>Walle 渠道包打包神器</h1><p>Android Signature V2 Scheme签名下的新一代渠道包打包神器</p>
<p><a href="https://github.com/Meituan-Dianping/walle" target="_blank" rel="noopener">github</a></p>
<h2 id="未开启V2签名错误"><a href="#未开启V2签名错误" class="headerlink" title="未开启V2签名错误"></a>未开启V2签名错误</h2><p><code>Plugin requires &#39;APK Signature Scheme v2 Enabled&#39; for Release.</code></p>
<p>官方教程要求 在 app 的 <code>build.gradle</code> 配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">  signingConfigs &#123;</span><br><span class="line">      sign &#123;</span><br><span class="line">          storeFile file(&quot;../sjd.jks&quot;)</span><br><span class="line">          storePassword &quot;sjd123&quot;</span><br><span class="line">          keyAlias &quot;sjd&quot;</span><br><span class="line">          keyPassword &quot;sjd123&quot;</span><br><span class="line">          v2SigningEnabled true//v2签名</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">   buildTypes &#123;</span><br><span class="line">      release &#123;</span><br><span class="line">          minifyEnabled false</span><br><span class="line">          proguardFiles getDefaultProguardFile(&apos;proguard-android-optimize.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class="line">          signingConfig signingConfigs.sign</span><br><span class="line">      &#125;</span><br><span class="line">      debug &#123;</span><br><span class="line">          minifyEnabled false</span><br><span class="line">          proguardFiles getDefaultProguardFile(&apos;proguard-android-optimize.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class="line">          signingConfig signingConfigs.sign</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置上还是提示未开启V2签名；排查gradle脚本好久，才发现项目未把 keystore文件和sign.properties文件加入git管理，然后ci工作空间这个两个文件被清理掉了。加入这个两个文件，打包成功。</p>
<p>所以，缺少签名配置也会报 未开启V2签名 这个错误</p>
<h1 id="设置代理"><a href="#设置代理" class="headerlink" title="设置代理"></a>设置代理</h1><p>配置文件 <code>gradle.properties</code></p>
<p>作用域：</p>
<ul>
<li>全局。配置文件在当前项目根目录下</li>
<li>当前项目。配置文件在 ~/.gradle目录下</li>
</ul>
<p>配置内容(Host和Port是必须)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemProp.http.proxyHost=xx.xx.xx.xx</span><br><span class="line">systemProp.http.proxyPort=xxxx</span><br><span class="line"># systemProp.http.proxyUser=userid</span><br><span class="line"># systemProp.http.proxyPassword=password</span><br><span class="line"># systemProp.http.nonProxyHosts=*.nonproxydomains.com|localhost</span><br><span class="line"></span><br><span class="line">systemProp.https.proxyHost=xx.xx.xx.xx</span><br><span class="line">systemProp.https.proxyPort=xxxx</span><br></pre></td></tr></table></figure>
<h1 id="替换仓库地址"><a href="#替换仓库地址" class="headerlink" title="替换仓库地址"></a>替换仓库地址</h1><h2 id="阿里云"><a href="#阿里云" class="headerlink" title="阿里云"></a>阿里云</h2><p>打开 <a href="https://maven.aliyun.com" target="_blank" rel="noopener">阿里云源</a><br>，会转到<a href="https://maven.aliyun.com/mvn/view。跟Android相关的有以下四个" target="_blank" rel="noopener">https://maven.aliyun.com/mvn/view。跟Android相关的有以下四个</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">maven &#123; url &apos;https://maven.aliyun.com/repository/jcenter&apos; &#125;</span><br><span class="line">maven &#123; url &apos;https://maven.aliyun.com/repository/google&apos; &#125;</span><br><span class="line">maven &#123; url &apos;https://maven.aliyun.com/repository/central&apos; &#125;</span><br><span class="line">maven &#123; url &apos;https://maven.aliyun.com/repository/gradle-plugin&apos; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>gradle 生命周期中有一个初始化(Initialization)的过程，初始化之后才会运行 build script。我们可以在初始化中定制一些全局设置，比如配置仓库地址。</p>
<p>可以使用初始化脚本的位置：</p>
<ul>
<li>命令行</li>
<li>放一个<code>init.gradle</code> 文件到<code>USER_HOME/.gradle/</code>目录下</li>
<li>放一个<code>xx.gradle</code>的文件到 <code>USER_HOME/.gradle/init.d/</code> 目录下.</li>
<li>放一个<code>xx.gradle</code>的文件到 <code>GRADLE_HOME/init.d/</code> 目录下.</li>
</ul>
<h2 id="文件内容"><a href="#文件内容" class="headerlink" title="文件内容"></a>文件内容</h2><h3 id="在最前面插入仓库"><a href="#在最前面插入仓库" class="headerlink" title="在最前面插入仓库"></a>在最前面插入仓库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenLocal()</span><br><span class="line">        maven &#123; url &apos;http://maven.aliyun.com/nexus/content/repositories/central/&apos; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样就会优先搜索本地和阿里云，找不到才会使用项目配置的仓库</p>
<h3 id="移除国外仓库"><a href="#移除国外仓库" class="headerlink" title="移除国外仓库"></a>移除国外仓库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven &#123; url &apos;https://maven.aliyun.com/repository/public/&apos; &#125;</span><br><span class="line">        maven &#123; url &apos;https://maven.aliyun.com/nexus/content/repositories/google&apos; &#125;</span><br><span class="line">        maven &#123; url &apos;https://maven.aliyun.com/nexus/content/groups/public/&apos; &#125;</span><br><span class="line">        maven &#123; url &apos;https://maven.aliyun.com/nexus/content/repositories/jcenter&apos;&#125;</span><br><span class="line"></span><br><span class="line">        all &#123; ArtifactRepository repo -&gt;</span><br><span class="line">            if (repo instanceof MavenArtifactRepository) &#123;</span><br><span class="line">                def url = repo.url.toString()</span><br><span class="line"></span><br><span class="line">                if (url.startsWith(&apos;https://repo.maven.apache.org/maven2/&apos;) || url.startsWith(&apos;https://repo.maven.org/maven2&apos;) || url.startsWith(&apos;https://repo1.maven.org/maven2&apos;) || url.startsWith(&apos;https://jcenter.bintray.com/&apos;)) &#123;</span><br><span class="line">                    //project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $REPOSITORY_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    buildscript &#123;</span><br><span class="line"></span><br><span class="line">        repositories &#123;</span><br><span class="line"></span><br><span class="line">            maven &#123; url &apos;https://maven.aliyun.com/repository/public/&apos;&#125;</span><br><span class="line">            maven &#123; url &apos;https://maven.aliyun.com/nexus/content/repositories/google&apos; &#125;</span><br><span class="line">            maven &#123; url &apos;https://maven.aliyun.com/nexus/content/groups/public/&apos; &#125;</span><br><span class="line">            maven &#123; url &apos;https://maven.aliyun.com/nexus/content/repositories/jcenter&apos;&#125;</span><br><span class="line">            all &#123; ArtifactRepository repo -&gt;</span><br><span class="line">                if (repo instanceof MavenArtifactRepository) &#123;</span><br><span class="line">                    def url = repo.url.toString()</span><br><span class="line">                    if (url.startsWith(&apos;https://repo1.maven.org/maven2&apos;) || url.startsWith(&apos;https://jcenter.bintray.com/&apos;)) &#123;</span><br><span class="line">                        //project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $REPOSITORY_URL.&quot;</span><br><span class="line">                        remove repo</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="风" />
            
              <p class="site-author-name" itemprop="name">风</p>
              <p class="site-description motion-element" itemprop="description">随心而动，随刃而行</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">318</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">73</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">风</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
