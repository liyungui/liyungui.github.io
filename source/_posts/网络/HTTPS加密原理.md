---
title: HTTPS加密原理
date: 2019-01-14 10:06:53
categories:
  - 网络
tags:
  - 网络
---

# HTTPS概念

HTTPS 的全称是 `Hypertext Transfer Protocol Secure`

## 设计目的

**网络通信安全**

## SSL/TLS

HTTP + SSL(TLS) = HTTPS。

HTTPS 是 HTTP 协议的一种扩展，使用 SSL(TLS)**加密通信协议进行**。

安全套接字层(SSL，Secure Socket Layer)

传输层安全性(TLS，Transport Layer Security)

TLS是SSL的后续版本

SSL 是一个独立的协议，不只有 HTTP 可以使用，其他应用层协议也可以使用，比如 SMTP(电子邮件协议)、Telnet(远程登录协议) 等都可以使用。

{% asset_img SSL.png %}

# 安全通信三要素

- **数据保密**：加密
- **数据一致性**（传输过程中不被篡改）：内容完整性校验
- **身份认证**（身份冒用，中间人攻击）：数字签名

# 数据保密：加密

按加密密钥和解密密钥是否相同，分为

- 对称密钥加密
- 非对称密钥加密

## 对称加密与非对称加密

|特 性| 对称加密| 非对称加密|
|:---|:---|:---|
|密钥形式|加解密共用同一密钥|密钥(公钥私钥)配对使用，只有配对的密钥能解密|
|密钥是否公开|保密|公开公钥，私钥保密|
|密钥管理|存在传输安全问题|需要数字证书及可靠第三者|
|内容安全|不安全|安全，公钥被拦截也无法解密内容|
|身份安全|无法验证身份|能验证解密者身份|
|运算速度|非常快|慢|
|用途|大文件|小文件|
|常用算法|DES、AES|RSA|

### 密钥的管理

#### 1. 密钥时效和次数

一般强调仅将一个对话密钥用于一条信息中或一次对话中，或者建立一种按时更换密钥的机制以减小密钥暴露的可能性。

#### 2 .多密钥的管理

Kerberos提供了一种解决这个较好方案，它是由MIT发明的，使保密密钥的管理和分发变得十分容易，但这种方法本身还存在一定的缺点。

Kerberos建立了一个安全的、可信任的密钥分发中心（Key Distribution Center，KDC），每个用户只要知道一个和KDC进行会话的密钥就可以了，而不需要知道成百上千个不同的密钥。

假设用户甲想要和用户乙进行秘密通信

	1.用户甲先和KDC通信告诉KDC他想和用户乙进行通信(用密钥(只有用户甲和KDC知道的)进行加密) 
	2.KDC会为用户甲和用户乙之间的会话随机选择一个会话密钥，并生成一个标签(这个标签由KDC和用户乙之间的密钥进行加密)返回给用户甲
	用户甲启动和用户乙对话时把这个标签交给用户乙（这个标签的作用是让用户甲确信和他交谈的是用户乙，而不是冒充者。因为这个标签是由只有用户乙和KDC知道的密钥进行加密的，所以即使冒充者得到用户甲发出的标签也不可能进行解密，只有用户乙收到后才能够进行解密，从而确定了与用户甲对话的人就是用户乙。）
	3.当KDC生成标签和随机会话密钥，就会把它们用只有用户甲和KDC知道的密钥进行加密，然后把标签和会话钥传给用户甲，加密的结果可以确保只有用户甲能得到这个信息，只有用户甲能利用这个会话密钥和用户乙进行通话。同理，KDC会把会话密码用只有KDC和用户乙知道的密钥加密，并把会话密钥给用户乙。
	4.用户甲会启动一个和用户乙的会话，并用得到的会话密钥加密自己和用户乙的会话，还要把KDC传给它的标签传给用户乙以确定用户乙的身份，然后用户甲和用户乙之间就可以用会话密钥进行安全的会话了，而且为了保证安全，这个会话密钥是一次性的，这样黑客就更难进行破解了。同时由于密钥是一次性由系统自动产生的，则用户不必记那么多密钥了，方便了人们的通信。

### 数据加密的标准

#### 对称密钥加密算法DES(Data Encryption Standard)

最早、最著名的保密密钥或对称密钥加密算法DES(Data Encryption Standard)是由IBM公司在70年代发展起来的，并经政府的加密标准筛选后，于1976年11月被美国政府采用，DES随后被美国国家标准局和美国国家标准协会（American National Standard Institute，ANSI）承认。

DES使用56位密钥对64位的数据块进行加密，并对64位的数据块进行16轮编码。与每轮编码时，一个48位的"每轮"密钥值由56位的完整密钥得出来。DES用软件进行解码需用很长时间，而用硬件解码速度非常快。幸运的是，当时大多数黑客并没有足够的设备制造出这种硬件设备。在1977年，人们估计要耗资两千万美元才能建成一个专门计算机用于DES的解密，而且需要12个小时的破解才能得到结果。当时DES被认为是一种十分强大的加密方法。
随着计算机硬件的速度越来越快，制造一台这样特殊的机器的花费已经降到了十万美元左右，而用它来保护十亿美元的银行，那显然是不够保险了。另一方面，如果只用它来保护一台普通服务器，那么DES确实是一种好的办法，因为黑客绝不会仅仅为入侵一个服务器而花那么多的钱破解DES密文。

#### 非对称密钥加密算法RSA(Rivest-Shamir-Adleman) -- 身份鉴别 + 内容保密

另一种非常著名的加密算法就是RSA了，RSA(Rivest-Shamir-Adleman)算法是基于大数不可能被质因数分解假设的公钥体系。简单地说就是找两个很大的质数。一个对外公开的为"公钥"（Public key） ，另一个不告诉任何人，称为"私钥"（Private key）。这两个密钥是互补的，也就是说用公钥加密的密文可以用私钥解密，反过来也一样。

假设用户甲要寄信给用户乙，他们互相知道对方的公钥。

	1.内容保密问题--接收方公钥加密
	甲就用乙的公钥加密邮件寄出，
	乙收到后就可以用自己的私钥解密出甲的原文。
		由于别人不知道乙的私钥，
		所以即使是甲本人也无法解密那封信，
		这就解决了信件保密的问题。
	2.来源身份鉴别问题（假冒身份）--发送方私钥签名
		由于每个人都知道乙的公钥，他们都可以给乙发信，
		那么乙怎么确信是不是甲的来信呢？
		那就要用到基于加密技术的数字签名了。
	甲用自己的私钥将 签名内容 加密，附加在邮件后，
	再用乙的公钥将整个邮件加密
		注意这里的次序，先签名，再加密
		如果先加密再签名的话，
		别人可以将签名去掉后签上自己的签名，
		从而篡改了签名）。
	乙收到后用自己的私钥将邮件解密，
	得到甲的原文和数字签名，
	然后用甲的公钥解密签名，
		这样就可以确保两方面的安全了。

## 混合加密

混合加密是对称加密和非对称加密的结合

特性：

- 安全地传输对称密钥：使用非对称解密算法
- 克服非对称加密算法效率低的缺陷：使用获得的对称密钥加密内容

# 数据一致性：信息摘要算法

混合加密系统可以解决通信三要素中的数据保密，数据一致性问题则需要靠摘要算法

哈希算法（hash algorithm），也叫信息摘要算法（message-digest algorithm），可以提供数据完整性方面的判断依据

常用的有：

- **MD5**：Message Digest Algorithm 5
- **SHA-2**：Secure Hash Algorithm 2

# 身份认证：数字签名

数字签名（digital signature）技术通过某种加密算法，在一条地址消息的尾部添加一个字符串，

而收信人可以根据这个字符串验明发信人的身份，并可进行数据完整性检查。

	1、发方对信息生成信息摘要。 
	2、发方用自己的私钥签名摘要。 
	3、发方把信息本身和已签名的信息摘要一起发送出去。
	4、收方对解密后的信息生成新摘要，
	再用发方的公钥对数字签名解密得到发方的摘要，
	比较摘要，以确认发方的身份和信息是否被修改过。
		这里测量的是身份认证
		所以发送过程并没有对内容加密
		然后对信息摘要并签名比较巧妙，
			因为签名一个专门的身份字符串，会增加报文长度
			而对信息摘要签名，节省长度的同时还校验了内容一致性
			
到这里，安全通信三要素已经完全解决，那么是不是真的安全了呢

不是的，还存在一个数字签名的认证问题。

因为公钥谁都可以发布，所以必须解决公钥信任问题

所以引入了 CA，CA 的全称是 Certificate Authority，证书认证机构，你必须让 CA 颁布具有认证过的公钥，才能解决公钥的信任问题。

# HTTPS建立连接

{% asset_img HTTPS建立连接.png %}

# HTTPS中间人攻击	

{% asset_img HTTPS中间人攻击.png %}			
			