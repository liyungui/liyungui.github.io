---
title: 播放器技术三-音画同步
date: 2019-09-19 16:12:14
categories:
  - 直播
tags:
  - 直播
---

# 音画同步的概念

音画同步是指播放器正在渲染的每一帧画面和正在播放的每一段声音都是严格对应起来的，不存在**人耳和肉眼可以分辨的偏差**。

# 音画同步的标准

## 时间戳

机器如何去感知视频文件中的某一帧视频数据跟某一帧音频数据是属于 同一时间 的呢 ？

现实生活中，判断两件事情是否同一时刻发生的方法就是记录并且比较事件发生的日期时间，同样，音视频在采集（生产）的时候，就给每一帧都打上 “时间戳”（注意，音视频的时间戳需要使用一个共同的时间戳基准），代表着它的出生时间。由此，播放器就可以通过附加在音频和视频帧上的时间戳信息，感知到音频帧和视频帧的 “相对关系”，实现音画同步就轻而易举了

{% asset_img 音画同步-时间戳.png %}

视频帧和音频帧的时间戳大致的递增规律为：

```
视频帧：10，43，76，109，142，……
音频帧：0，20，40，60，80，120，……
```

音视频是分开采集的，所以它们的时间戳不可能完全对应得上，因此，只要在一个合理的 “阈值” 范围内即可认为是同步的。

**音画同步的方法**：判断视频与音频帧的**时间戳差值**，是不是在一定的 “阈值” 范围内，如果是，则可以渲染/播放，否则就 “等” 到合适的时间。

## 时间戳偏移的 “阈值”

音频和视频的时间戳差值 “阈值”，国际标准 “RFC-1359” 定义了：

1. **无法察觉**：(-100ms ~ +25ms)。 
2. **可以接受**：(-185ms ~ +90ms)。

负数表示音频滞后；正数表示音频超前。（**人类对音频滞后有更高的兼容性**）

{% asset_img 音画同步-时间戳差值阈值.png %}

# 音画同步的实现

音画同步的**实现策略**一般有 3 种：

1. 视频同步到音频。**最常用**

2. 音频同步到视频

3. 音视频同步到外部时钟

## 视频同步到音频

最常用。

因为

- 人对声音敏感度高于图像
- 视频播放速率更好控制。

	**音频是流式**的，按照规律**匀速播放**，才能显得更加 “平滑”，而视频的播放其实是一张一张图片进行刷新显示，它的刷新时间的调整相对而言更容易一些，用户肉眼的敏感度也更弱一些。

# 参考&扩展

- [播放器技术分享（3）：音画同步](https://blog.51cto.com/ticktick/2328003) 七牛-卢俊
