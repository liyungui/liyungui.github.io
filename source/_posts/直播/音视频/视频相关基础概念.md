---
title: 视频相关基础概念
date: 2019-07-31 14:52:14
categories:
  - 视频
tags:
  - 视频
---

# 分辨率

分辨率是以横向和纵向的像素数量来衡量的，表示平面图像的精细程度。

视频精细程度并不只取决于视频分辨率，还取决于屏幕分辨率。

1080P 的 **P** 指 **Progressive scan**（逐行扫描），即垂直方向像素点，也就是 "高"，所以 1920X1080 叫 1080P， 不叫 1920P。

当 720P 的视频在 1080P 屏幕上播放时，需要将图像放大，**放大操作也叫上采样**。

上采样几乎都是采用内插值方法，即在原有图像的像素点之间采用合适的插值算法插入新的元素，所以图像放大也称为图像插值。

当 1080P 的视频在 720P 屏幕上播放时，需要将图像缩小，**缩小操作也叫下采样**。

下采样的定义为：对于一个样值序列，间隔几个样值取样一次，得到新序列。

# GOP

Group of Pictures

图像组或画面组，一个GOP就是一组连续的画面

GOP策略影响**编码质量**

**GOP 越长，理论上画面越高清**。但是生成 HLS 直播时，最小切割粒度也是一个 GOP，所以针对交互直播，通常不建议 GOP 设置太长。直播一般 2 个关键帧间隔即可（也就是 2s）。

在H264中图像以GOP图像组为单位进行组织，一个GOP图像组是一段图像编码后的数据流，以I帧开始

## I、P、B 帧

MPEG编码将画面（即帧）分为I、P、B三种。

帧内压缩生成I帧，帧间压缩生成B帧和P帧

- **I** **关键帧** 是内部编码帧。压缩率是7（跟JPG差不多）
- **P**  **参考帧** 是前向预测帧。压缩率是20
	- 参考之前的I帧编码的，只包含差异部分编码（体积很小）
	- P 帧没有完整画面数据，只有与前一帧的画面差别的数据
	- 解码时需要用之前缓存的画面叠加上本帧定义的差别，生成最终画面。
	- P 帧是参考帧(后面P帧/前后的B帧的参考帧),它可能造成解码错误的扩散;
- **B** 是双向预测内插帧。压缩率是50（比较耗CPU）
	- 参考前后的帧编码的，只包含差异部分编码（体积很小）
	- B 帧记录的是本帧与前后帧的差别
	- 解码时需要用前后画面叠加本帧定义的差别，生成最终的画面。
	- B 帧不是参考帧,不会造成解码错误的扩散。

简单地讲，I帧是一个完整的画面，而P帧和B帧记录的是相对于I帧的变化。

没有I帧，P帧和B帧就无法解码，这就是MPEG格式难以精确剪辑的原因，也是我们之所以要微调头和尾的原因。

### 花屏和跳跃

丢失掉了“关键帧”，随后的几帧图像无法正常地解码，因此产生“花屏”现象。

从技术的角度，怎么解决“花屏”现象呢？

当我们在视频传输过程中，通过帧序号发现丢帧后，可以跳过随后的非“关键帧”，直到遇到下一个关键帧再送入解码。这样的确可以解决“花屏”现象，但是由于跳跃了很多帧，因此会出现视频图像的不连续情况（即“跳跃”现象）。

## IDR

IDR（Instantaneous Decoding Refresh）--即时解码刷新。

一个序列的第一个图像叫做 IDR 图像（立即刷新图像），IDR 图像都是 I 帧图像。H.264 引入 IDR 图像是为了**解码的重同步**，当解码器解码到 IDR 图像时，立即将参考帧队列清空，将已解码的数据全部输出或抛弃，重新查找参数集，开始一个新的序列。这样，如果前一个序列出现重大错误，在这里可以获得重新同步的机会。IDR图像之后的图像永远不会使用IDR之前的图像的数据来解码。

## MPEG-2 帧结构

MPEG-2压缩的帧结构有两个参数，

- GOP
	- 一般可按编码方式从1－15；
	- 两个I帧之间的间隔
- I帧和P帧之间B帧的数量
	- 一般是1－2个。
	- 多少帧里出现一次P帧

# 比特率

比特率即码率，在多媒体领域，指单位时间播放音频或视频的比特数，可以理解成吞吐量或带宽。

单位为 bps , 即 bits per second，每秒传输的数据量

在一个视频中，不同时段画面的复杂程度是不同的，比如高速变化的场景和几乎静止的场景，所需的数据量也是不同的，若都使用同一种比特率是不太合理的，所以引入了动态比特率。

## 动态比特率

简称为 **VBR**，即 Variable Bit Rate，比特率可以随着图像复杂程度的不同而随之变化。

图像内容简单的片段采用较小的码率，图像内容复杂的片段采用较大的码率，这样既保证了播放质量，又兼顾了数据量的限制。

比如 RMVB 视频文件，其中的 VB 就是指 VBR，表示采用动态比特率编码方式，达到播放质量与体积兼得的效果。

## 静态比特率

简称为 **CBR**，即 Constant Bit Rate，比特率恒定。

图像内容复杂的片段质量不稳定，图像内容简单的片段质量较好。

除 VBR 和 CBR 外，还有 **CVBR**（Constrained VariableBit Rate） 、**ABR** (Average Bit Rate) 等等。

# 采样率

定义：每秒从连续信号中提取并组成离散信号的采样个数，单位为赫兹（Hz）。

## 音频中的采样率

指把音频信号数字化后 1 个通道 1 秒钟采取多少个样本，如 44.1kHz 的采样率，就是指 1 个通道 1 秒钟有 44.1k 个数据。

## 视频中的采样率

视频一般**不标识**采样率属性

采样率本身就是一个可泛化的概念，对于视频来说，若非要用采样率来描述的话，那就要分为两个层面：**帧频和场频**。

从帧频层面来说，采样率就是指**帧率**，指 1 秒钟显示多少帧图像。

从场频层面来说，采样率就是指**像素频率**，指 1 秒钟显示多少个像素。

像素频率是显示器的一个指标，可以理解成显示器的最大带宽，可以起到限制**分辨率和刷新率(每秒刷新的次数，Hz)**的作用

根据含义可得出一个公式：

`像素频率 = 刷新率 X 帧像素数量`

`像素频率 = 60Hz*1920*1080/1024/1024 = 118.65 MHz`

# 帧率

定义：用于测量显示帧数的量度。单位为 FPS（Frames per Second，每秒显示帧数）或赫兹（Hz）。

帧率越高，画面越流畅、逼真，对显卡的处理能力要求越高，数据量越大。

根据人眼视觉暂留原理，每秒超过 **24** 帧的图像变化看上去是平滑连续的，这样的连续画面叫视频。

## 帧率主观感受

{% asset_img 帧率主观感受.jpeg %}

视频长度是8秒。分辨率是QCIF (176 x 144) 。原始帧率是25 fps。

实验过程中，帧率变换为以下几种：25， 12.5， 8.33， 6.25， 5 以及 2.5 fps。

主观感受（MOS）取的是各个测试序列的平均值，包含了95%的置信区间。

可见帧率超过15帧以后，人眼就会获得很好的感受。而如果低于12.5帧的话，人眼的主观感受会随着帧率的下降而迅速下降。

## 24 帧

对电影等视频而言，24 帧 是流畅的；对游戏来说 是不流畅的

### 两者图像生成原理不同

电影的每一帧都包含一段时间的信息，会有动态模糊；而游戏的画面则是由显卡计算生成的，一帧只包含那一瞬间的信息

### 电影的FPS是稳定的，而游戏则是不稳定的

电影若为 24fps，那就表示每隔 1/24 秒刷新一次画面，帧间隔是固定的。

游戏若为 60fps，表示大约每隔 1/60 秒刷新一次画面，帧间隔是不稳定的，即使 1 秒能显示 60 帧，那也可能是前半秒显示了 59 帧，后半秒显示了 1 帧。

所以游戏卡顿有两个解决方案：提高帧率，或增加动态模糊效果(游戏设置都有)。

# 参考&扩展

- [视频相关的理论知识与基础概念](https://www.jianshu.com/p/1379ed99783e)
- [h264 Gop组 I 、P、B 帧](https://blog.csdn.net/lcalqf/article/details/53048347)
- [图像和流媒体 -- I 帧,B帧,P帧,IDR帧的区别](https://blog.csdn.net/qq_29350001/article/details/73770702)
- [视频帧率对人眼主观感受的影响 2](https://blog.csdn.net/leixiaohua1020/article/details/84490329) 雷霄骅