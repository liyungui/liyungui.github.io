<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Android," />










<meta name="description" content="Gradle for Android-第三篇、依赖管理 Android Studio 打包及引用 aar  依赖配置APIcompile – api/implementation(Gradle plugin 3.0.0) 依赖参与编译并且打包到最终的apk文件中。     api         外部依赖，等同于compile     implementation         内部依赖：编译期">
<meta name="keywords" content="Android">
<meta property="og:type" content="article">
<meta property="og:title" content="gradle导入依赖">
<meta property="og:url" content="http://yoursite.com/2020/02/03/Android/gradle/gradle导入依赖/index.html">
<meta property="og:site_name" content="风">
<meta property="og:description" content="Gradle for Android-第三篇、依赖管理 Android Studio 打包及引用 aar  依赖配置APIcompile – api/implementation(Gradle plugin 3.0.0) 依赖参与编译并且打包到最终的apk文件中。     api         外部依赖，等同于compile     implementation         内部依赖：编译期">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2226246-efd370c8c43bd35f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2020-03-12T04:25:00.175Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="gradle导入依赖">
<meta name="twitter:description" content="Gradle for Android-第三篇、依赖管理 Android Studio 打包及引用 aar  依赖配置APIcompile – api/implementation(Gradle plugin 3.0.0) 依赖参与编译并且打包到最终的apk文件中。     api         外部依赖，等同于compile     implementation         内部依赖：编译期">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/2226246-efd370c8c43bd35f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/02/03/Android/gradle/gradle导入依赖/"/>





  <title>gradle导入依赖 | 风</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">风</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">技术博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/03/Android/gradle/gradle导入依赖/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">gradle导入依赖</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-03T14:13:53+08:00">
                2020-02-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><a href="https://segmentfault.com/a/1190000004237922" target="_blank" rel="noopener">Gradle for Android-第三篇、依赖管理</a></p>
<p><a href="http://www.androidchina.net/2467.html" target="_blank" rel="noopener">Android Studio 打包及引用 aar</a> </p>
<h1 id="依赖配置API"><a href="#依赖配置API" class="headerlink" title="依赖配置API"></a>依赖配置API</h1><h2 id="compile-–-api-implementation"><a href="#compile-–-api-implementation" class="headerlink" title="compile – api/implementation"></a>compile – api/implementation</h2><p>(Gradle plugin 3.0.0)</p>
<pre><code>依赖参与编译并且打包到最终的apk文件中。
    api
        外部依赖，等同于compile
    implementation
        内部依赖：编译期依赖隔离。将该依赖隐藏在内部，而不对外部公开(外部无法访问)
        提高编译速度：不会编译内部依赖
</code></pre><p>实例：A依赖B，B依赖C</p>
<p>依赖路径：</p>
<ul>
<li>compile/api：无法直观知道A所有的依赖，也无法直观知道传递依赖的具体版本</li>
<li>implementation：规范直观。虽然需要多写依赖</li>
</ul>
<p>编译期：C修改重新编译</p>
<ul>
<li>compile/api：AB都需要重新编译(即使A没有用到C的接口)</li>
<li>implementation：编译期隔离，只重新编译B</li>
</ul>
<p>打包运行：</p>
<ul>
<li>都会打包进apk。如果某依赖有多个版本，打包最高版本</li>
</ul>
<h3 id="编译期和运行期版本冲突"><a href="#编译期和运行期版本冲突" class="headerlink" title="编译期和运行期版本冲突"></a>编译期和运行期版本冲突</h3><pre><code>&apos;com.facebook.fresco:fresco&apos; has different version for the compile (1.3.0) and runtime (1.11.0) classpath. You should manually set the same version via DependencyResolution
</code></pre><p>统一版本即可</p>
<pre><code>configurations.all {
    resolutionStrategy.eachDependency { DependencyResolveDetails details -&gt;
        def requested = details.requested
        if (requested.group == &apos;com.facebook.fresco&apos;){
            details.useVersion &apos;1.3.0&apos;
        }
    }
}
</code></pre><h2 id="Provided-–-compileOnly"><a href="#Provided-–-compileOnly" class="headerlink" title="Provided – compileOnly"></a>Provided – compileOnly</h2><pre><code>依赖只在编译时使用，只参与编译，不打包到最终apk。类似eclipse中的external-libs,

注：使用Provided必须删除compile fileTree(include: [&apos;*.jar&apos;], dir: &apos;libs&apos;) 
不然lib下的jar均按照compile方式引入到Module
</code></pre><h2 id="apk-–-runtimeOnly"><a href="#apk-–-runtimeOnly" class="headerlink" title="apk – runtimeOnly"></a>apk – runtimeOnly</h2><pre><code>依赖只会打包到apk文件中，而不参与编译，所以不能在代码中直接调用jar中的类或方法，否则在编译时会报错
</code></pre><p>以上三个 对所有的build type以及favlors 有效</p>
<h2 id="testCompile"><a href="#testCompile" class="headerlink" title="testCompile"></a>testCompile</h2><pre><code>仅单元测试apk时有效，而对正常的debug或者release apk包不起作用。
</code></pre><h2 id="debug-compile"><a href="#debug-compile" class="headerlink" title="debug compile"></a>debug compile</h2><pre><code>仅debug模式的编译和最终的debug apk打包
</code></pre><h2 id="release-compile"><a href="#release-compile" class="headerlink" title="release compile"></a>release compile</h2><pre><code>仅Release 模式的编译和最终的Release apk打包。
</code></pre><h2 id="Gradle-plugin-3-0-0依赖使用api和implementation，废弃compile"><a href="#Gradle-plugin-3-0-0依赖使用api和implementation，废弃compile" class="headerlink" title="Gradle plugin 3.0.0依赖使用api和implementation，废弃compile"></a>Gradle plugin 3.0.0依赖使用api和implementation，废弃compile</h2><p>compile 兼容支持一段时间。即已废弃，还会保留一段时间，直到下个比较大的gradle tools版本发布</p>
<pre><code>compile fileTree(dir: &apos;xxx&apos;, include: [&apos;*.jar&apos;, &quot;*.xxx&quot;])：将某个目录下所有符合扩展名的文件作为依赖；
compile &apos;com.xx.xx:ProjectName:Version&apos;：配置Maven 库作为依赖；在 Maven 库中心 可以搜索自己想用的库进行依赖；
compile project(&apos;:AnotherModule&apos;)：配置另一个 Module 作为本 Module 的依赖，被依赖的 Module 必须被导入到当前工程中；
compile files(&apos;xxx.jar&apos;)：配置某个 jar 包作为依赖。
compile(name: &apos;xxx&apos;, ext: &apos;aar&apos;) //配置某个 aar 包作为依赖。xxx.aar是文件名

compile fileTree(include: [&apos;*.jar&apos;], dir: &apos;libs&apos;)
testCompile &apos;junit:junit:4.12&apos;
apt &apos;com.jakewharton:butterknife-compiler:8.0.1&apos;
compile &apos;com.android.support:appcompat-v7:23.3.0&apos;
compile &apos;com.squareup.retrofit2:retrofit:2.0.2&apos;
compile(name: &apos;Yrecycleview&apos;, ext: &apos;aar&apos;)
compile project(path: &apos;:easeui&apos;)
compile files(&apos;libs/hyphenatechat_3.1.3.jar&apos;)
</code></pre><h1 id="library-module"><a href="#library-module" class="headerlink" title="library module"></a>library module</h1><p>直接引入lib工程</p>
<pre><code>dependencies {
    compile project(&apos;:library名字&apos;)
    compile project(&apos;:libraries:library名字&apos;)//多个library，libraries是文件夹名字
}
</code></pre><h1 id="jar包依赖"><a href="#jar包依赖" class="headerlink" title="jar包依赖"></a>jar包依赖</h1><p>module目录下新建libs文件夹，放置jar</p>
<p>右键 Add As Library，选择相应module即可。</p>
<p>上面第二部的操作其实是配置了相应module的 <code>build.gradle</code></p>
<pre><code>dependencies {
       compile fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])//即添加所有在libs文件夹中的jar
       compile fileTree(&apos;libs/WuXiaolong.jar&apos;)
}
</code></pre><h2 id="添加jar包-Choose-the-appropriate-categories-from-the-list-错误"><a href="#添加jar包-Choose-the-appropriate-categories-from-the-list-错误" class="headerlink" title="添加jar包 Choose the appropriate categories from the list.错误"></a>添加jar包 Choose the appropriate categories from the list.错误</h2><pre><code>Android Studio cannot determine what kind of files the chosen items contain.
Choose the appropriate categories from the list.
- classes
- external annotations
- jar directory
- JavaDocs
- source archive directory
- sources
</code></pre><p>不用考虑，jar出错了！！！</p>
<pre><code>http://ask.android-studio.org/?/question/188
</code></pre><h1 id="so库依赖"><a href="#so库依赖" class="headerlink" title="so库依赖"></a>so库依赖</h1><p>app/src/main/目录下新建jniLibs目录，so库需要放入对应的cpu下（如armeabi）</p>
<pre><code>sourceSets{
    main.jniLibs.srcDir &apos;src/main/libs&apos; //默认so库目录
}
</code></pre><p>.so文件放在对应的文件夹中</p>
<pre><code>app
   ├── AndroidManifest.xml
   └── jniLibs
       ├── armeabi
       │   └── libiconv.so
       ├── armeabi-v7a
       │   └── libiconv.so
       ├── mips
       │   └── libiconv.so
       └── x86
           └── libiconv.so    
</code></pre><h2 id="暂时不提供64位的so文件"><a href="#暂时不提供64位的so文件" class="headerlink" title="暂时不提供64位的so文件"></a>暂时不提供64位的so文件</h2><p>解决方案：强制APP使用32位so</p>
<ul>
<li><p>指定只保留32位so库</p>
<pre><code>android{
    defaultConfig{
        ndk{abiFilters &quot;armeabi&quot;}
    }
}

如果配置后编译报错，在gradle.properties文件中加上 Android.useDeprecatedNdk=true； 
</code></pre></li>
<li><p>指定目录下必须有so文件(否则打包无该目录)</p>
<pre><code>build.gradle中配置的so加载目录:jniLibs.srcDir:customerDir

如果没有该项配置则so加载目录默认为：src/main/jniLibs

将.so文件放置该目录的armeabi文件夹下
    没有该目录则新建一个
    APP中没有使用到.so文件则需要拷贝任意一个32位的so文件到该目录下
        如果没有合适的so可以到官网http://x5.tencent.com/tbs/sdk.html下载官网“SDK接入示例“,拷贝对应目录下的liblbs.so文件
</code></pre></li>
</ul>
<p><a href="https://zhuanlan.zhihu.com/p/21359984" target="_blank" rel="noopener">与 so 有关的一个长年大坑</a><br><a href="https://developer.android.com/ndk/guides/abis.html?hl=is#sa" target="_blank" rel="noopener">ABI 管理</a> </p>
<h3 id="ABI"><a href="#ABI" class="headerlink" title="ABI"></a>ABI</h3><pre><code>mips / mips64: 极少用于手机可以忽略
x86 / x86_64: x86 架构的手机都会包含由 Intel 提供的称为 Houdini 的指令集动态转码工具，实现 对 arm .so 的兼容，再考虑 x86 1% 以下的市场占有率，x86 相关的两个 .so 也是可以忽略的
armeabi: 支持ARMV5TE和更高版本 相当老旧的版本 无硬浮点，在需要大量计算时有性能瓶颈
armeabi-v7a: 支持armeabi等 目前主流版本（与 ARMv5、v6 设备不兼容）
arm64-v8a: 支持AArch-64 64位支持
</code></pre><p>现在armeabi v5基本都淘汰了，<strong>建议保留armeabi-v7a就可以兼容到市面上的绝大多数手机</strong></p>
<p>选择保留armeabi(微信保留了) ，并保证armeabi 和 armeabi-v7a这两个文件夹中 so 数量一致</p>
<p><strong>对只提供 armeabi 版本的第三方 so，原样复制一份到 armeabi-v7a 文件夹（armeabi-v7a: 支持armeabi）。</strong></p>
<p><a href="http://www.jianshu.com/p/a8433f053248" target="_blank" rel="noopener">Android ABI想到的</a></p>
<h3 id="ABI-1"><a href="#ABI-1" class="headerlink" title="ABI"></a>ABI</h3><p>应用程序二进制接口ABI（Application Binary Interface）</p>
<h3 id="so文件"><a href="#so文件" class="headerlink" title=".so文件"></a>.so文件</h3><p>Native Libs Monitor 这个app可以帮助我们理解手机上安装的APK用到了哪些.so文件，以及.so文件来源于哪些函数库或者框架</p>
<h3 id="ABI和CPU的关系"><a href="#ABI和CPU的关系" class="headerlink" title="ABI和CPU的关系"></a>ABI和CPU的关系</h3><p>很多设备都支持多于一种的ABI</p>
<p>但最好是针对特 定平台提供相应平台的二进制包，这种情况下运行时就少了一个模拟层（例如x86设备上模拟arm的虚拟层），从而得到更好的性能</p>
<p>可以通过 <code>Build.SUPPORTED_ABIS</code> 得到根据偏好排序的设备支持的ABI列表。但你不应该从你的应用程序中读取它，因为 Android包管理器安装APK时，会自动选择APK包中为对应系统ABI预编译好的.so文件，如果在对应的lib／ABI目录中存在.so文件的话。</p>
<p>对应关系如下图：<br><img src="http://upload-images.jianshu.io/upload_images/2226246-efd370c8c43bd35f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><strong>不同CPU架构的Android手机加载时会在libs下找自己对应的目录，从对应的目录下寻找需要的.so文件；如果没有对应的目录，就会去armeabi下去寻找，如果已经有对应的目录，但是没有找到对应的.so文件，也不会去armeabi下去寻找了。</strong></p>
<p><strong>微信就是只有armeabi一个目录</strong></p>
<p>当引入一个新的预编译.so文件，而且项目中还存在其他的.so文件时，需要首先确认新引入的.so文件使用的C++运行时是否和已经存在的.so文件一致。</p>
<h3 id="xx-so-is-32-bit-instead-of-64-bit"><a href="#xx-so-is-32-bit-instead-of-64-bit" class="headerlink" title="xx.so is 32-bit instead of 64-bit"></a>xx.so is 32-bit instead of 64-bit</h3><p>这是因为module下有64位的so库目录，而某个so库却没有提供64位的</p>
<p><strong>解决方案：</strong></p>
<ul>
<li>只保留armeabi，删除其他以”armeabi“开头的文件夹</li>
<li><p>module的build.gradle</p>
<pre><code>android {
    defaultConfig {
        ndk {
            abiFilters &quot;armeabi&quot;
        }
    }
}
</code></pre></li>
<li><p>gradle.properties</p>
<pre><code>Android.useDeprecatedNdk=true
</code></pre></li>
</ul>
<h3 id="Android-6-0-so-动态库的适配"><a href="#Android-6-0-so-动态库的适配" class="headerlink" title="Android 6.0 + .so 动态库的适配"></a><a href="http://www.cnblogs.com/linguanh/p/6137641.html" target="_blank" rel="noopener">Android 6.0 + .so 动态库的适配</a></h3><h4 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h4><p>同一个 APP 在 api &lt;=22 的 sdk 情况下编译，可以运行正常，不存在闪退或者 .so 库加载失败的情况</p>
<p>当你采用 api &gt;=23 的sdk 编译的时候，安装到 Android 6.0 及其以上的手机的时候，大范围出现崩溃 或者 .so 库加载失败，而在 6.0 以下的手机却正常；</p>
<p>Catch的信息：<code>dlopen failed: cannot locate symbol &quot;XXXX&quot; xxxx.so</code></p>
<h4 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h4><p>不同链接方式，决定dlopen是否会打开指定的系统中(手机中)提供的动态库，并使用 dlsym 获取符号地址</p>
<p>在此时的手机中如果找不到，那么就会出问题，一般和 API 有关系。</p>
<p><code>Application.mk</code>，里面有一行 <code>APP_STL := XXX</code> 指明<code>库的链接方式</code></p>
<p><strong>STL的取值：</strong></p>
<pre><code>1）system，默认的值，最危险方式，直接和手机系统版本挂钩，采用手机最小版本的.so库链接

2）gabi++_static

3）gabi++_shared

4）stlport_static

5）stlport_shared

6）gnustl_static

7）gnustl_shared

主要是两种，静态链接，动态链接：

动态链接，是指在生成可执行文件时不将所有程序用到的函数链接到一个文件，因为有许多函数在操作系统带的dll文件中，当程序运行时直接从操作系统中找。

静态链接，是把所有用到的函数全部链接到 .so 文件中；
</code></pre><h4 id="目前存在该问题的知名SDK"><a href="#目前存在该问题的知名SDK" class="headerlink" title="目前存在该问题的知名SDK"></a>目前存在该问题的知名SDK</h4><p>百度地图、环信、高德地图、语音库 speex</p>
<p>不知道修复没有</p>
<p>这些 SDK 一但在你的 APK 编译版中中设置 API &gt;=23 就会出现各种问题，闪退或者抛出异常。</p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p>主要有两种：</p>
<ol>
<li><p>委曲求全，指标不治本，把你的 APK 编译时 API 降低到 23 以下，还出问题就继续降低</p>
<p> 这意味着，你很多 Android Sdk 的新控件用不了；</p>
</li>
<li><p>在 Application.mk 中修改 APP_STL，重新编译 .so 。</p>
</li>
</ol>
<p>如果没有源码，要么等他们解决，要么采用第一种，建议尝试 APP_STL := gnustl_shared 这种方式，对于所需要的外部动态链接函数、符号，在 NDK 13b 中都会独立生成一份，全部引用就解决此类问题，例如</p>
<pre><code>private void load() {
      try {
          System.loadLibrary(&quot;gnustl_shared&quot;);
          System.loadLibrary(&quot;speex&quot;);
      } catch (Throwable e) {
          Log.d(&quot;zzzzz&quot;,&quot;加载语音库异常 ：&quot;+e.toString());
      }
}
</code></pre><h1 id="aar文件"><a href="#aar文件" class="headerlink" title="aar文件"></a>aar文件</h1><ul>
<li>Android Library项目导出的<strong>jar文件不能包含资源文件</strong>，<ul>
<li>比如一些drawable文件、xml资源文件之类的，</li>
<li>在gradle之前我们要引用带资源文件的Android Library必须要把整个library导入进来进行引用</li>
</ul>
</li>
<li>Android Library项目导出的<strong>aar（包含资源文件、第三方库文件、so、manifest ）</strong><ul>
<li>gradle最普遍的方法是把aar上传到mavenCentral或者jcenter</li>
</ul>
</li>
</ul>
<h2 id="导出aar"><a href="#导出aar" class="headerlink" title="导出aar"></a>导出aar</h2><pre><code>apply plugin: &apos;com.android.library&apos; //输出 aar。 
apply plugin: &apos;com.android.application&apos; //输出 apk

gradle aR 生成 aar
</code></pre><p>library库输出的.aar文件，目录为 [ModuleName]/build/outputs/aar</p>
<h2 id="依赖aar-两种方式"><a href="#依赖aar-两种方式" class="headerlink" title="依赖aar 两种方式"></a>依赖aar 两种方式</h2><ol>
<li><p>直接导入。不推荐</p>
<pre><code>File -- Project Structure，添加一个新 Module，选择 Import *.JAR or *.AAR Package
导入后，在你的工程下面，会生成一个文件夹，里面是 aar 文件以及 Android Studio 的配置文件。
接着在 gradle 中配置依赖，依赖方式使用 compile project 的方式
</code></pre><p> <code>缺点</code>：被依赖的 aar 无法 F3 跟进去，无法看到资源文件内容以及目录层级等</p>
</li>
<li><p>依赖配置。<strong>推荐使用</strong></p>
<ul>
<li><p>module目录下新建aars文件夹，放置aar</p>
<pre><code>repositories {
    flatDir {
        dirs &apos;aars&apos; //添加该文件夹作为依赖库
    }
}

dependencies {
    compile(name:&apos;libraryname&apos;, ext:&apos;aar&apos;)
}
</code></pre></li>
</ul>
</li>
</ol>
<p>lib module 依赖了aar库，failed to resolve aar</p>
<p>在app module 的build.gradle中加入下面代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;  </span><br><span class="line">    flatDir &#123;  </span><br><span class="line">        dirs project(&apos;:taesdk&apos;).file(&apos;libs&apos;)  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="手动下载远程aar"><a href="#手动下载远程aar" class="headerlink" title="手动下载远程aar"></a>手动下载远程aar</h1><p>有时gradle构建下载依赖包出现错误(timeout)，可以手动去仓库下载，放到gradle的cache目录(<code>~/.gradle/caches/modules-2/files-2.1</code>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; Could not download codeview-android.aar (com.github.softwee:codeview-android:1.2.0)</span><br><span class="line">  &gt; Could not get resource &apos;https://jitpack.io/com/github/softwee/codeview-android/1.2.0/codeview-android-1.2.0.aar&apos;.</span><br><span class="line">     &gt; Read timed out</span><br></pre></td></tr></table></figure>
<p>最终目录 <code>/Users/liyungui/.gradle/caches/modules-2/files-2.1/com.github.softwee/codeview-android/1.2.0/83787aabb0260a92ae7c9632e56995a38395560d/codeview-android-1.2.0.aar</code></p>
<p>关于文件父目录，网上资料很少，其实是文件SHA1码</p>
<p>mac的话可以用 <code>shasum</code> 命令查看，win的话是 <code>certutil -hashfile</code></p>
<p>一般情况，jar、aar、pom、source、doc等文件，都是一个SHA1目录对应一个文件。</p>
<p>有时jar和pom会下载到同一个目录下面，这其实还是用的是jar的SHA1</p>
<h1 id="依赖module和主module-资源id-冲突"><a href="#依赖module和主module-资源id-冲突" class="headerlink" title="依赖module和主module 资源id 冲突"></a>依赖module和主module 资源id 冲突</h1><p>android studio 并不会对依赖module和主module 资源id 在编译时时报错（eclipse会）</p>
<p>如 依赖和主module 都有 activity_main.xml 布局文件，在运行时，依赖module 中activity_main中的id就会找不到，因为首先是在主module中的activity_main文件中查找，就会报错 <code>ava.lang.NoSuchFieldError: No static field rl_dd of type I in class Lcom/xuehu365/videoviewmediacontroller/R$id;</code></p>
<p>确保依赖工程和主module 资源文件名 不重复即可。</p>
<p><strong>每个资源文件名中的控件id可以重复，不影响查找（只要控件id不在同一个资源文件中）</strong></p>
<h1 id="远程依赖包重复问题"><a href="#远程依赖包重复问题" class="headerlink" title="远程依赖包重复问题"></a><a href="https://juejin.im/post/591a5084128fe1005cda382d" target="_blank" rel="noopener">远程依赖包重复问题</a></h1><p>错误 <code>com.android.dex.DexException: Multiple dex files define XXXX</code></p>
<p>或 <code>java.util.zip.ZipException: duplicate entry: uk/co/senab/photoview/BuildConfig.class</code></p>
<p>引用了重复的库或者jar包引起的</p>
<p>两个库同时引用了同一个第三方库，最坑人的是都是直接引用，而不是使用 Provided 的方式</p>
<p><strong>解决思路</strong>：找到重复删掉一个</p>
<pre><code>gradlew -q app:dependencies 命令，输出树状依赖

星号后缀标记 (*)，意思是忽略该依赖(不下载)
</code></pre><ul>
<li><p>删掉远程依赖库的依赖</p>
<pre><code>compile(&apos;com.loonggg.saoyisao.lib:1.1.0&apos;)
compile(&apos;com.timmy.qrcode.lib:1.4.1&apos;) {
        exclude group: &apos;com.google.zxing&apos;
}
编译时将group为com.google.zxing的所有library都去除在外，com.timmy.qrcode.lib:1.4.1就会自动去引用com.loonggg.saoyisao.lib:1.1.0项目里的zxing依赖
</code></pre></li>
<li><p>删掉本地依赖库的依赖</p>
<pre><code>下载修改后重修打jar包，蛋疼
</code></pre></li>
</ul>
<p><code>java.util.zip.ZipException: duplicate entry: tv/danmaku/ijk/media/player/AbstractMediaPlayer.class</code></p>
<p><strong>完美解决方式</strong> <code>resolutionStrategy.force</code></p>
<pre><code>configurations.all {
    resolutionStrategy {
        force &apos;com.android.support:support-v4:27.0.1&apos;
        force &apos;com.android.support:design:27.0.1&apos;
        force &apos;com.android.support:appcompat-v7:27.0.1&apos;
    }
}
</code></pre><h1 id="v4包重复"><a href="#v4包重复" class="headerlink" title="v4包重复"></a>v4包重复</h1><p>v7包已经包含了v4包。</p>
<p>所以如果主module已有v7包依赖，lib module有v4包依赖，就会v4包重复。这时需要把v7包中的v4 exclude</p>
<pre><code>compile(&apos;com.airbnb.android:lottie:2.5.4&apos;) { exclude group: &apos;com.android.support.v4&apos; }
    lottie依赖v7包
</code></pre><h1 id="v4-v7包在线依赖失败"><a href="#v4-v7包在线依赖失败" class="headerlink" title="v4 v7包在线依赖失败"></a>v4 v7包在线依赖失败</h1><pre><code>//将maven.googlecom
//maven { url &apos;https://maven.google.com/&apos; }
//替换为
maven { url &apos;https://dl.google.com/dl/android/maven2/&apos; }
</code></pre>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag"><i class="fa fa-tag"></i> Android</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/02/03/Android/gradle/gradle构建最佳实践/" rel="next" title="gradle构建最佳实践">
                <i class="fa fa-chevron-left"></i> gradle构建最佳实践
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/02/03/Android/gradle/gradle使用/" rel="prev" title="gradle使用">
                gradle使用 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="风" />
            
              <p class="site-author-name" itemprop="name">风</p>
              <p class="site-description motion-element" itemprop="description">随心而动，随刃而行</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">308</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">71</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#依赖配置API"><span class="nav-number">1.</span> <span class="nav-text">依赖配置API</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#compile-–-api-implementation"><span class="nav-number">1.1.</span> <span class="nav-text">compile – api/implementation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#编译期和运行期版本冲突"><span class="nav-number">1.1.1.</span> <span class="nav-text">编译期和运行期版本冲突</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Provided-–-compileOnly"><span class="nav-number">1.2.</span> <span class="nav-text">Provided – compileOnly</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#apk-–-runtimeOnly"><span class="nav-number">1.3.</span> <span class="nav-text">apk – runtimeOnly</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#testCompile"><span class="nav-number">1.4.</span> <span class="nav-text">testCompile</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#debug-compile"><span class="nav-number">1.5.</span> <span class="nav-text">debug compile</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#release-compile"><span class="nav-number">1.6.</span> <span class="nav-text">release compile</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gradle-plugin-3-0-0依赖使用api和implementation，废弃compile"><span class="nav-number">1.7.</span> <span class="nav-text">Gradle plugin 3.0.0依赖使用api和implementation，废弃compile</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#library-module"><span class="nav-number">2.</span> <span class="nav-text">library module</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#jar包依赖"><span class="nav-number">3.</span> <span class="nav-text">jar包依赖</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#添加jar包-Choose-the-appropriate-categories-from-the-list-错误"><span class="nav-number">3.1.</span> <span class="nav-text">添加jar包 Choose the appropriate categories from the list.错误</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#so库依赖"><span class="nav-number">4.</span> <span class="nav-text">so库依赖</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#暂时不提供64位的so文件"><span class="nav-number">4.1.</span> <span class="nav-text">暂时不提供64位的so文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ABI"><span class="nav-number">4.1.1.</span> <span class="nav-text">ABI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ABI-1"><span class="nav-number">4.1.2.</span> <span class="nav-text">ABI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#so文件"><span class="nav-number">4.1.3.</span> <span class="nav-text">.so文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ABI和CPU的关系"><span class="nav-number">4.1.4.</span> <span class="nav-text">ABI和CPU的关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#xx-so-is-32-bit-instead-of-64-bit"><span class="nav-number">4.1.5.</span> <span class="nav-text">xx.so is 32-bit instead of 64-bit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Android-6-0-so-动态库的适配"><span class="nav-number">4.1.6.</span> <span class="nav-text">Android 6.0 + .so 动态库的适配</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#问题描述"><span class="nav-number">4.1.6.1.</span> <span class="nav-text">问题描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#问题原因"><span class="nav-number">4.1.6.2.</span> <span class="nav-text">问题原因</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#目前存在该问题的知名SDK"><span class="nav-number">4.1.6.3.</span> <span class="nav-text">目前存在该问题的知名SDK</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#解决方案"><span class="nav-number">4.1.6.4.</span> <span class="nav-text">解决方案</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#aar文件"><span class="nav-number">5.</span> <span class="nav-text">aar文件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#导出aar"><span class="nav-number">5.1.</span> <span class="nav-text">导出aar</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#依赖aar-两种方式"><span class="nav-number">5.2.</span> <span class="nav-text">依赖aar 两种方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#手动下载远程aar"><span class="nav-number">6.</span> <span class="nav-text">手动下载远程aar</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#依赖module和主module-资源id-冲突"><span class="nav-number">7.</span> <span class="nav-text">依赖module和主module 资源id 冲突</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#远程依赖包重复问题"><span class="nav-number">8.</span> <span class="nav-text">远程依赖包重复问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#v4包重复"><span class="nav-number">9.</span> <span class="nav-text">v4包重复</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#v4-v7包在线依赖失败"><span class="nav-number">10.</span> <span class="nav-text">v4 v7包在线依赖失败</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">风</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  







  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
