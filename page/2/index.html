<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="随心而动，随刃而行">
<meta property="og:type" content="website">
<meta property="og:title" content="风">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="风">
<meta property="og:description" content="随心而动，随刃而行">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="风">
<meta name="twitter:description" content="随心而动，随刃而行">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>风</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">风</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">技术博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/03/Android/gradle/gradle导入依赖/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/03/Android/gradle/gradle导入依赖/" itemprop="url">gradle导入依赖</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-03T14:13:53+08:00">
                2020-02-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://segmentfault.com/a/1190000004237922" target="_blank" rel="noopener">Gradle for Android-第三篇、依赖管理</a></p>
<p><a href="http://www.androidchina.net/2467.html" target="_blank" rel="noopener">Android Studio 打包及引用 aar</a> </p>
<h1 id="依赖配置API"><a href="#依赖配置API" class="headerlink" title="依赖配置API"></a>依赖配置API</h1><h2 id="compile-–-api-implementation"><a href="#compile-–-api-implementation" class="headerlink" title="compile – api/implementation"></a>compile – api/implementation</h2><p>(Gradle plugin 3.0.0)</p>
<pre><code>依赖参与编译并且打包到最终的apk文件中。
    api
        外部依赖，等同于compile
    implementation
        内部依赖：编译期依赖隔离。将该依赖隐藏在内部，而不对外部公开(外部无法访问)
        提高编译速度：不会编译内部依赖
</code></pre><p>实例：A依赖B，B依赖C</p>
<p>依赖路径：</p>
<ul>
<li>compile/api：无法直观知道A所有的依赖，也无法直观知道传递依赖的具体版本</li>
<li>implementation：规范直观。虽然需要多写依赖</li>
</ul>
<p>编译期：C修改重新编译</p>
<ul>
<li>compile/api：AB都需要重新编译(即使A没有用到C的接口)</li>
<li>implementation：编译期隔离，只重新编译B</li>
</ul>
<p>打包运行：</p>
<ul>
<li>都会打包进apk。如果某依赖有多个版本，打包最高版本</li>
</ul>
<h3 id="编译期和运行期版本冲突"><a href="#编译期和运行期版本冲突" class="headerlink" title="编译期和运行期版本冲突"></a>编译期和运行期版本冲突</h3><pre><code>&apos;com.facebook.fresco:fresco&apos; has different version for the compile (1.3.0) and runtime (1.11.0) classpath. You should manually set the same version via DependencyResolution
</code></pre><p>统一版本即可</p>
<pre><code>configurations.all {
    resolutionStrategy.eachDependency { DependencyResolveDetails details -&gt;
        def requested = details.requested
        if (requested.group == &apos;com.facebook.fresco&apos;){
            details.useVersion &apos;1.3.0&apos;
        }
    }
}
</code></pre><h2 id="Provided-–-compileOnly"><a href="#Provided-–-compileOnly" class="headerlink" title="Provided – compileOnly"></a>Provided – compileOnly</h2><pre><code>依赖只在编译时使用，只参与编译，不打包到最终apk。类似eclipse中的external-libs,

注：使用Provided必须删除compile fileTree(include: [&apos;*.jar&apos;], dir: &apos;libs&apos;) 
不然lib下的jar均按照compile方式引入到Module
</code></pre><h2 id="apk-–-runtimeOnly"><a href="#apk-–-runtimeOnly" class="headerlink" title="apk – runtimeOnly"></a>apk – runtimeOnly</h2><pre><code>依赖只会打包到apk文件中，而不参与编译，所以不能在代码中直接调用jar中的类或方法，否则在编译时会报错
</code></pre><p>以上三个 对所有的build type以及favlors 有效</p>
<h2 id="testCompile"><a href="#testCompile" class="headerlink" title="testCompile"></a>testCompile</h2><pre><code>仅单元测试apk时有效，而对正常的debug或者release apk包不起作用。
</code></pre><h2 id="debug-compile"><a href="#debug-compile" class="headerlink" title="debug compile"></a>debug compile</h2><pre><code>仅debug模式的编译和最终的debug apk打包
</code></pre><h2 id="release-compile"><a href="#release-compile" class="headerlink" title="release compile"></a>release compile</h2><pre><code>仅Release 模式的编译和最终的Release apk打包。
</code></pre><h2 id="Gradle-plugin-3-0-0依赖使用api和implementation，废弃compile"><a href="#Gradle-plugin-3-0-0依赖使用api和implementation，废弃compile" class="headerlink" title="Gradle plugin 3.0.0依赖使用api和implementation，废弃compile"></a>Gradle plugin 3.0.0依赖使用api和implementation，废弃compile</h2><p>compile 兼容支持一段时间。即已废弃，还会保留一段时间，直到下个比较大的gradle tools版本发布</p>
<pre><code>compile fileTree(dir: &apos;xxx&apos;, include: [&apos;*.jar&apos;, &quot;*.xxx&quot;])：将某个目录下所有符合扩展名的文件作为依赖；
compile &apos;com.xx.xx:ProjectName:Version&apos;：配置Maven 库作为依赖；在 Maven 库中心 可以搜索自己想用的库进行依赖；
compile project(&apos;:AnotherModule&apos;)：配置另一个 Module 作为本 Module 的依赖，被依赖的 Module 必须被导入到当前工程中；
compile files(&apos;xxx.jar&apos;)：配置某个 jar 包作为依赖。
compile(name: &apos;xxx&apos;, ext: &apos;aar&apos;) //配置某个 aar 包作为依赖。xxx.aar是文件名

compile fileTree(include: [&apos;*.jar&apos;], dir: &apos;libs&apos;)
testCompile &apos;junit:junit:4.12&apos;
apt &apos;com.jakewharton:butterknife-compiler:8.0.1&apos;
compile &apos;com.android.support:appcompat-v7:23.3.0&apos;
compile &apos;com.squareup.retrofit2:retrofit:2.0.2&apos;
compile(name: &apos;Yrecycleview&apos;, ext: &apos;aar&apos;)
compile project(path: &apos;:easeui&apos;)
compile files(&apos;libs/hyphenatechat_3.1.3.jar&apos;)
</code></pre><h1 id="library-module"><a href="#library-module" class="headerlink" title="library module"></a>library module</h1><p>直接引入lib工程</p>
<pre><code>dependencies {
    compile project(&apos;:library名字&apos;)
    compile project(&apos;:libraries:library名字&apos;)//多个library，libraries是文件夹名字
}
</code></pre><h1 id="jar包依赖"><a href="#jar包依赖" class="headerlink" title="jar包依赖"></a>jar包依赖</h1><p>module目录下新建libs文件夹，放置jar</p>
<p>右键 Add As Library，选择相应module即可。</p>
<p>上面第二部的操作其实是配置了相应module的 <code>build.gradle</code></p>
<pre><code>dependencies {
       compile fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])//即添加所有在libs文件夹中的jar
       compile fileTree(&apos;libs/WuXiaolong.jar&apos;)
}
</code></pre><h2 id="添加jar包-Choose-the-appropriate-categories-from-the-list-错误"><a href="#添加jar包-Choose-the-appropriate-categories-from-the-list-错误" class="headerlink" title="添加jar包 Choose the appropriate categories from the list.错误"></a>添加jar包 Choose the appropriate categories from the list.错误</h2><pre><code>Android Studio cannot determine what kind of files the chosen items contain.
Choose the appropriate categories from the list.
- classes
- external annotations
- jar directory
- JavaDocs
- source archive directory
- sources
</code></pre><p>不用考虑，jar出错了！！！</p>
<pre><code>http://ask.android-studio.org/?/question/188
</code></pre><h1 id="so库依赖"><a href="#so库依赖" class="headerlink" title="so库依赖"></a>so库依赖</h1><p>app/src/main/目录下新建jniLibs目录，so库需要放入对应的cpu下（如armeabi）</p>
<pre><code>sourceSets{
    main.jniLibs.srcDir &apos;src/main/libs&apos; //默认so库目录
}
</code></pre><p>.so文件放在对应的文件夹中</p>
<pre><code>app
   ├── AndroidManifest.xml
   └── jniLibs
       ├── armeabi
       │   └── libiconv.so
       ├── armeabi-v7a
       │   └── libiconv.so
       ├── mips
       │   └── libiconv.so
       └── x86
           └── libiconv.so    
</code></pre><h2 id="暂时不提供64位的so文件"><a href="#暂时不提供64位的so文件" class="headerlink" title="暂时不提供64位的so文件"></a>暂时不提供64位的so文件</h2><p>解决方案：强制APP使用32位so</p>
<ul>
<li><p>指定只保留32位so库</p>
<pre><code>android{
    defaultConfig{
        ndk{abiFilters &quot;armeabi&quot;}
    }
}

如果配置后编译报错，在gradle.properties文件中加上 Android.useDeprecatedNdk=true； 
</code></pre></li>
<li><p>指定目录下必须有so文件(否则打包无该目录)</p>
<pre><code>build.gradle中配置的so加载目录:jniLibs.srcDir:customerDir

如果没有该项配置则so加载目录默认为：src/main/jniLibs

将.so文件放置该目录的armeabi文件夹下
    没有该目录则新建一个
    APP中没有使用到.so文件则需要拷贝任意一个32位的so文件到该目录下
        如果没有合适的so可以到官网http://x5.tencent.com/tbs/sdk.html下载官网“SDK接入示例“,拷贝对应目录下的liblbs.so文件
</code></pre></li>
</ul>
<p><a href="https://zhuanlan.zhihu.com/p/21359984" target="_blank" rel="noopener">与 so 有关的一个长年大坑</a><br><a href="https://developer.android.com/ndk/guides/abis.html?hl=is#sa" target="_blank" rel="noopener">ABI 管理</a> </p>
<h3 id="ABI"><a href="#ABI" class="headerlink" title="ABI"></a>ABI</h3><pre><code>mips / mips64: 极少用于手机可以忽略
x86 / x86_64: x86 架构的手机都会包含由 Intel 提供的称为 Houdini 的指令集动态转码工具，实现 对 arm .so 的兼容，再考虑 x86 1% 以下的市场占有率，x86 相关的两个 .so 也是可以忽略的
armeabi: 支持ARMV5TE和更高版本 相当老旧的版本 无硬浮点，在需要大量计算时有性能瓶颈
armeabi-v7a: 支持armeabi等 目前主流版本（与 ARMv5、v6 设备不兼容）
arm64-v8a: 支持AArch-64 64位支持
</code></pre><p>现在armeabi v5基本都淘汰了，<strong>建议保留armeabi-v7a就可以兼容到市面上的绝大多数手机</strong></p>
<p>选择保留armeabi(微信保留了) ，并保证armeabi 和 armeabi-v7a这两个文件夹中 so 数量一致</p>
<p><strong>对只提供 armeabi 版本的第三方 so，原样复制一份到 armeabi-v7a 文件夹（armeabi-v7a: 支持armeabi）。</strong></p>
<p><a href="http://www.jianshu.com/p/a8433f053248" target="_blank" rel="noopener">Android ABI想到的</a></p>
<h3 id="ABI-1"><a href="#ABI-1" class="headerlink" title="ABI"></a>ABI</h3><p>应用程序二进制接口ABI（Application Binary Interface）</p>
<h3 id="so文件"><a href="#so文件" class="headerlink" title=".so文件"></a>.so文件</h3><p>Native Libs Monitor 这个app可以帮助我们理解手机上安装的APK用到了哪些.so文件，以及.so文件来源于哪些函数库或者框架</p>
<h3 id="ABI和CPU的关系"><a href="#ABI和CPU的关系" class="headerlink" title="ABI和CPU的关系"></a>ABI和CPU的关系</h3><p>很多设备都支持多于一种的ABI</p>
<p>但最好是针对特 定平台提供相应平台的二进制包，这种情况下运行时就少了一个模拟层（例如x86设备上模拟arm的虚拟层），从而得到更好的性能</p>
<p>可以通过 <code>Build.SUPPORTED_ABIS</code> 得到根据偏好排序的设备支持的ABI列表。但你不应该从你的应用程序中读取它，因为 Android包管理器安装APK时，会自动选择APK包中为对应系统ABI预编译好的.so文件，如果在对应的lib／ABI目录中存在.so文件的话。</p>
<p>对应关系如下图：<br><img src="http://upload-images.jianshu.io/upload_images/2226246-efd370c8c43bd35f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><strong>不同CPU架构的Android手机加载时会在libs下找自己对应的目录，从对应的目录下寻找需要的.so文件；如果没有对应的目录，就会去armeabi下去寻找，如果已经有对应的目录，但是没有找到对应的.so文件，也不会去armeabi下去寻找了。</strong></p>
<p><strong>微信就是只有armeabi一个目录</strong></p>
<p>当引入一个新的预编译.so文件，而且项目中还存在其他的.so文件时，需要首先确认新引入的.so文件使用的C++运行时是否和已经存在的.so文件一致。</p>
<h3 id="xx-so-is-32-bit-instead-of-64-bit"><a href="#xx-so-is-32-bit-instead-of-64-bit" class="headerlink" title="xx.so is 32-bit instead of 64-bit"></a>xx.so is 32-bit instead of 64-bit</h3><p>这是因为module下有64位的so库目录，而某个so库却没有提供64位的</p>
<p><strong>解决方案：</strong></p>
<ul>
<li>只保留armeabi，删除其他以”armeabi“开头的文件夹</li>
<li><p>module的build.gradle</p>
<pre><code>android {
    defaultConfig {
        ndk {
            abiFilters &quot;armeabi&quot;
        }
    }
}
</code></pre></li>
<li><p>gradle.properties</p>
<pre><code>Android.useDeprecatedNdk=true
</code></pre></li>
</ul>
<h3 id="Android-6-0-so-动态库的适配"><a href="#Android-6-0-so-动态库的适配" class="headerlink" title="Android 6.0 + .so 动态库的适配"></a><a href="http://www.cnblogs.com/linguanh/p/6137641.html" target="_blank" rel="noopener">Android 6.0 + .so 动态库的适配</a></h3><h4 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h4><p>同一个 APP 在 api &lt;=22 的 sdk 情况下编译，可以运行正常，不存在闪退或者 .so 库加载失败的情况</p>
<p>当你采用 api &gt;=23 的sdk 编译的时候，安装到 Android 6.0 及其以上的手机的时候，大范围出现崩溃 或者 .so 库加载失败，而在 6.0 以下的手机却正常；</p>
<p>Catch的信息：<code>dlopen failed: cannot locate symbol &quot;XXXX&quot; xxxx.so</code></p>
<h4 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h4><p>不同链接方式，决定dlopen是否会打开指定的系统中(手机中)提供的动态库，并使用 dlsym 获取符号地址</p>
<p>在此时的手机中如果找不到，那么就会出问题，一般和 API 有关系。</p>
<p><code>Application.mk</code>，里面有一行 <code>APP_STL := XXX</code> 指明<code>库的链接方式</code></p>
<p><strong>STL的取值：</strong></p>
<pre><code>1）system，默认的值，最危险方式，直接和手机系统版本挂钩，采用手机最小版本的.so库链接

2）gabi++_static

3）gabi++_shared

4）stlport_static

5）stlport_shared

6）gnustl_static

7）gnustl_shared

主要是两种，静态链接，动态链接：

动态链接，是指在生成可执行文件时不将所有程序用到的函数链接到一个文件，因为有许多函数在操作系统带的dll文件中，当程序运行时直接从操作系统中找。

静态链接，是把所有用到的函数全部链接到 .so 文件中；
</code></pre><h4 id="目前存在该问题的知名SDK"><a href="#目前存在该问题的知名SDK" class="headerlink" title="目前存在该问题的知名SDK"></a>目前存在该问题的知名SDK</h4><p>百度地图、环信、高德地图、语音库 speex</p>
<p>不知道修复没有</p>
<p>这些 SDK 一但在你的 APK 编译版中中设置 API &gt;=23 就会出现各种问题，闪退或者抛出异常。</p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p>主要有两种：</p>
<ol>
<li><p>委曲求全，指标不治本，把你的 APK 编译时 API 降低到 23 以下，还出问题就继续降低</p>
<p> 这意味着，你很多 Android Sdk 的新控件用不了；</p>
</li>
<li><p>在 Application.mk 中修改 APP_STL，重新编译 .so 。</p>
</li>
</ol>
<p>如果没有源码，要么等他们解决，要么采用第一种，建议尝试 APP_STL := gnustl_shared 这种方式，对于所需要的外部动态链接函数、符号，在 NDK 13b 中都会独立生成一份，全部引用就解决此类问题，例如</p>
<pre><code>private void load() {
      try {
          System.loadLibrary(&quot;gnustl_shared&quot;);
          System.loadLibrary(&quot;speex&quot;);
      } catch (Throwable e) {
          Log.d(&quot;zzzzz&quot;,&quot;加载语音库异常 ：&quot;+e.toString());
      }
}
</code></pre><h1 id="aar文件"><a href="#aar文件" class="headerlink" title="aar文件"></a>aar文件</h1><ul>
<li>Android Library项目导出的<strong>jar文件不能包含资源文件</strong>，<ul>
<li>比如一些drawable文件、xml资源文件之类的，</li>
<li>在gradle之前我们要引用带资源文件的Android Library必须要把整个library导入进来进行引用</li>
</ul>
</li>
<li>Android Library项目导出的<strong>aar（包含资源文件、第三方库文件、so、manifest ）</strong><ul>
<li>gradle最普遍的方法是把aar上传到mavenCentral或者jcenter</li>
</ul>
</li>
</ul>
<h2 id="导出aar"><a href="#导出aar" class="headerlink" title="导出aar"></a>导出aar</h2><pre><code>apply plugin: &apos;com.android.library&apos; //输出 aar。 
apply plugin: &apos;com.android.application&apos; //输出 apk

gradle aR 生成 aar
</code></pre><p>library库输出的.aar文件，目录为 [ModuleName]/build/outputs/aar</p>
<h2 id="依赖aar-两种方式"><a href="#依赖aar-两种方式" class="headerlink" title="依赖aar 两种方式"></a>依赖aar 两种方式</h2><ol>
<li><p>直接导入。不推荐</p>
<pre><code>File -- Project Structure，添加一个新 Module，选择 Import *.JAR or *.AAR Package
导入后，在你的工程下面，会生成一个文件夹，里面是 aar 文件以及 Android Studio 的配置文件。
接着在 gradle 中配置依赖，依赖方式使用 compile project 的方式
</code></pre><p> <code>缺点</code>：被依赖的 aar 无法 F3 跟进去，无法看到资源文件内容以及目录层级等</p>
</li>
<li><p>依赖配置。<strong>推荐使用</strong></p>
<ul>
<li><p>module目录下新建aars文件夹，放置aar</p>
<pre><code>repositories {
    flatDir {
        dirs &apos;aars&apos; //添加该文件夹作为依赖库
    }
}

dependencies {
    compile(name:&apos;libraryname&apos;, ext:&apos;aar&apos;)
}
</code></pre></li>
</ul>
</li>
</ol>
<p>lib module 依赖了aar库，failed to resolve aar</p>
<p>在app module 的build.gradle中加入下面代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;  </span><br><span class="line">    flatDir &#123;  </span><br><span class="line">        dirs project(&apos;:taesdk&apos;).file(&apos;libs&apos;)  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="手动下载远程aar"><a href="#手动下载远程aar" class="headerlink" title="手动下载远程aar"></a>手动下载远程aar</h1><p>有时gradle构建下载依赖包出现错误(timeout)，可以手动去仓库下载，放到gradle的cache目录(<code>~/.gradle/caches/modules-2/files-2.1</code>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; Could not download codeview-android.aar (com.github.softwee:codeview-android:1.2.0)</span><br><span class="line">  &gt; Could not get resource &apos;https://jitpack.io/com/github/softwee/codeview-android/1.2.0/codeview-android-1.2.0.aar&apos;.</span><br><span class="line">     &gt; Read timed out</span><br></pre></td></tr></table></figure>
<p>最终目录 <code>/Users/liyungui/.gradle/caches/modules-2/files-2.1/com.github.softwee/codeview-android/1.2.0/83787aabb0260a92ae7c9632e56995a38395560d/codeview-android-1.2.0.aar</code></p>
<p>关于文件父目录，网上资料很少，其实是文件SHA1码</p>
<p>mac的话可以用 <code>shasum</code> 命令查看，win的话是 <code>certutil -hashfile</code></p>
<p>一般情况，jar、aar、pom、source、doc等文件，都是一个SHA1目录对应一个文件。</p>
<p>有时jar和pom会下载到同一个目录下面，这其实还是用的是jar的SHA1</p>
<h1 id="依赖module和主module-资源id-冲突"><a href="#依赖module和主module-资源id-冲突" class="headerlink" title="依赖module和主module 资源id 冲突"></a>依赖module和主module 资源id 冲突</h1><p>android studio 并不会对依赖module和主module 资源id 在编译时时报错（eclipse会）</p>
<p>如 依赖和主module 都有 activity_main.xml 布局文件，在运行时，依赖module 中activity_main中的id就会找不到，因为首先是在主module中的activity_main文件中查找，就会报错 <code>ava.lang.NoSuchFieldError: No static field rl_dd of type I in class Lcom/xuehu365/videoviewmediacontroller/R$id;</code></p>
<p>确保依赖工程和主module 资源文件名 不重复即可。</p>
<p><strong>每个资源文件名中的控件id可以重复，不影响查找（只要控件id不在同一个资源文件中）</strong></p>
<h1 id="远程依赖包重复问题"><a href="#远程依赖包重复问题" class="headerlink" title="远程依赖包重复问题"></a><a href="https://juejin.im/post/591a5084128fe1005cda382d" target="_blank" rel="noopener">远程依赖包重复问题</a></h1><p>错误 <code>com.android.dex.DexException: Multiple dex files define XXXX</code></p>
<p>或 <code>java.util.zip.ZipException: duplicate entry: uk/co/senab/photoview/BuildConfig.class</code></p>
<p>引用了重复的库或者jar包引起的</p>
<p>两个库同时引用了同一个第三方库，最坑人的是都是直接引用，而不是使用 Provided 的方式</p>
<p><strong>解决思路</strong>：找到重复删掉一个</p>
<pre><code>gradlew -q app:dependencies 命令，输出树状依赖

星号后缀标记 (*)，意思是忽略该依赖(不下载)
</code></pre><ul>
<li><p>删掉远程依赖库的依赖</p>
<pre><code>compile(&apos;com.loonggg.saoyisao.lib:1.1.0&apos;)
compile(&apos;com.timmy.qrcode.lib:1.4.1&apos;) {
        exclude group: &apos;com.google.zxing&apos;
}
编译时将group为com.google.zxing的所有library都去除在外，com.timmy.qrcode.lib:1.4.1就会自动去引用com.loonggg.saoyisao.lib:1.1.0项目里的zxing依赖
</code></pre></li>
<li><p>删掉本地依赖库的依赖</p>
<pre><code>下载修改后重修打jar包，蛋疼
</code></pre></li>
</ul>
<p><code>java.util.zip.ZipException: duplicate entry: tv/danmaku/ijk/media/player/AbstractMediaPlayer.class</code></p>
<p><strong>完美解决方式</strong> <code>resolutionStrategy.force</code></p>
<pre><code>configurations.all {
    resolutionStrategy {
        force &apos;com.android.support:support-v4:27.0.1&apos;
        force &apos;com.android.support:design:27.0.1&apos;
        force &apos;com.android.support:appcompat-v7:27.0.1&apos;
    }
}
</code></pre><h1 id="v4包重复"><a href="#v4包重复" class="headerlink" title="v4包重复"></a>v4包重复</h1><p>v7包已经包含了v4包。</p>
<p>所以如果主module已有v7包依赖，lib module有v4包依赖，就会v4包重复。这时需要把v7包中的v4 exclude</p>
<pre><code>compile(&apos;com.airbnb.android:lottie:2.5.4&apos;) { exclude group: &apos;com.android.support.v4&apos; }
    lottie依赖v7包
</code></pre><h1 id="v4-v7包在线依赖失败"><a href="#v4-v7包在线依赖失败" class="headerlink" title="v4 v7包在线依赖失败"></a>v4 v7包在线依赖失败</h1><pre><code>//将maven.googlecom
//maven { url &apos;https://maven.google.com/&apos; }
//替换为
maven { url &apos;https://dl.google.com/dl/android/maven2/&apos; }
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/03/Android/gradle/gradle构建最佳实践/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/03/Android/gradle/gradle构建最佳实践/" itemprop="url">gradle构建最佳实践</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-03T14:13:53+08:00">
                2020-02-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>gradle构建最佳实践 https://www.figotan.org/2016/04/01/gradle-on-android-best-practise/
Gradle构建编译速度太慢的解决方法 http://www.52codes.net/article/658.html
加速Android Studio/Gradle构建 http://blog.isming.me/2015/03/18/android-build-speed-up/
</code></pre><h1 id="加速篇"><a href="#加速篇" class="headerlink" title="加速篇"></a>加速篇</h1><p>GRADLE的构建过程通常会比较漫长，一个中等项目，10M左右大小的app，一次完整构建大概在5分钟左右。</p>
<p>调试阶段，采用Android Studuo 2.0，默认提供的Instant Run方式，每次修改都不会重新构建项目，从而加快了构建过程。</p>
<p>GRADLE一次完整的构建过程通常分成三个部分，初始化，配置和执行任务，那么我们可以考虑从这三个部分分别尝试优化。</p>
<h3 id="1-开启daemon"><a href="#1-开启daemon" class="headerlink" title="1. 开启daemon"></a>1. 开启daemon</h3><p>构建初始化的很多工作是关于java虚拟机的启动，加载虚拟机环境，加载class文件等，这些动作交给一个单独的后台进程去做</p>
<pre><code>gradle.properties（全局起效是~/.gradle/gradle.properties，从工程目录拷贝过来）

org.gradle.daemon=true
</code></pre><h3 id="2-并行构建模块化项目"><a href="#2-并行构建模块化项目" class="headerlink" title="2. 并行构建模块化项目"></a>2. 并行构建模块化项目</h3><p>库工程(Library projects)，主工程(Application project)并行构建</p>
<pre><code>org.gradle.parallel=true
</code></pre><h3 id="3-按需配置"><a href="#3-按需配置" class="headerlink" title="3. 按需配置"></a>3. 按需配置</h3><pre><code>org.gradle.configureondemand=true
</code></pre><h3 id="4-增大gradle运行的java虚拟机的大小"><a href="#4-增大gradle运行的java虚拟机的大小" class="headerlink" title="4. 增大gradle运行的java虚拟机的大小"></a>4. 增大gradle运行的java虚拟机的大小</h3><p>org.gradle.jvmargs=-Xmx2048m -XX:MaxPermSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8</p>
<h3 id="5-依赖库使用固定版本"><a href="#5-依赖库使用固定版本" class="headerlink" title="5. 依赖库使用固定版本"></a>5. 依赖库使用固定版本</h3><pre><code>compile &apos;com.google.code.gson:gson:2.2.1&apos;

compile &apos;com.google.code.gson:gson:2.+&apos;这种避免使用，每次都去repo拉取最新版本
</code></pre><h3 id="6-升级到最新的GRADLE、和android-gradle-plugin-和-JDK"><a href="#6-升级到最新的GRADLE、和android-gradle-plugin-和-JDK" class="headerlink" title="6. 升级到最新的GRADLE、和android gradle plugin 和 JDK"></a>6. 升级到最新的GRADLE、和android gradle plugin 和 JDK</h3><p>最新版的GRADLE和JDK往往是性能最好</p>
<p>GRALDE采用了一种叫做wrapper的方式，可以做到每个项目独立使用其自己的GRADLE版本，这样做的好处是每个项目的构建环境独立，互不影响。GRADLE发展太快，新旧版本之间很难兼容。假设都用同一个全局的GRADLE，那么当这个GRADLE升级后，所有的项目可能都会编译失败，你得一个一个改配置</p>
<h3 id="7-命令行构建"><a href="#7-命令行构建" class="headerlink" title="7. 命令行构建"></a>7. 命令行构建</h3><p>Android Studio中，点击运行是将当前的构建任务加入到队列中。如果你改过build.gradle的文件导致它在同步脚本时，就必须等到这个任务完成之后才会执行你刚才的构建任务</p>
<h3 id="8-屏蔽不必要的productFlavor"><a href="#8-屏蔽不必要的productFlavor" class="headerlink" title="8. 屏蔽不必要的productFlavor"></a>8. 屏蔽不必要的productFlavor</h3><p>尽管只是要构建Develop版本，但还是会去解析每一个productFlavor的依赖，并且在依赖上卡很久。所以在构建时先注释掉其他pruductFlavor</p>
<h3 id="9-使用离线模式"><a href="#9-使用离线模式" class="headerlink" title="9. 使用离线模式"></a>9. 使用离线模式</h3><p>编译过一次，依赖应该都在本地中有缓存了。这时命令行构建可以使用–offline参数</p>
<h3 id="10-没必要-不要在构建时进行clean"><a href="#10-没必要-不要在构建时进行clean" class="headerlink" title="10. 没必要 不要在构建时进行clean"></a>10. 没必要 不要在构建时进行clean</h3><h3 id="11-引入依赖库尽量使用aar"><a href="#11-引入依赖库尽量使用aar" class="headerlink" title="11. 引入依赖库尽量使用aar"></a>11. 引入依赖库尽量使用aar</h3><pre><code>maven http://gradleplease.appspot.com/
githu https://github.com/Goddchen/mvn-repo。
</code></pre><p>自己的库模块也可以打包成aar</p>
<p><strong>以上功能其实可以通过修改android studio配置实现，区别是配置只会在ide构建的时候生效，命令行构建不会生效</strong></p>
<p>Gradle 和 Compiler 两个选项卡中配置</p>
<h1 id="gradle-把依赖缓存在哪"><a href="#gradle-把依赖缓存在哪" class="headerlink" title="gradle 把依赖缓存在哪"></a>gradle 把依赖缓存在哪</h1><p>用户目录\ .gradle\caches\modules-2\files-2.1</p>
<h1 id="使用Gradle-Wrapper必要性"><a href="#使用Gradle-Wrapper必要性" class="headerlink" title="使用Gradle Wrapper必要性"></a>使用Gradle Wrapper必要性</h1><p>便于统一项目所使用的gradle版本。</p>
<p>GRALDE采用了一种叫做wrapper的方式，可以做到每个项目独立使用其自己的GRADLE版本，这样做的好处是每个项目的构建环境独立，互不影响。GRADLE发展太快，新旧版本之间很难兼容。假设都用同一个全局的GRADLE，那么当这个GRADLE升级后，所有的项目可能都会编译失败，你得一个一个改配置</p>
<p>使用Gradle Wrapper，自动下载二进制包的时间需要以分钟计算（毕竟服务器在国外），不过还好，这个过程只会出现一次</p>
<h1 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h1><h2 id="Error-Configuration-with-name-‘default’-not-found"><a href="#Error-Configuration-with-name-‘default’-not-found" class="headerlink" title="Error:Configuration with name ‘default’ not found."></a><a href="http://blog.csdn.net/luo451591667/article/details/50667549" target="_blank" rel="noopener">Error:Configuration with name ‘default’ not found.</a></h2><p>同事添加了某个module,自己同步代码后会出现Error:Configuration with name ‘default’ not found.的错误,</p>
<p>这是因为同步时不会自动把<code>远程仓库</code>下载下来，需要你自己初始化下载,这时只要执行:</p>
<pre><code>git submodule update --init --recursive 
</code></pre><p><strong>实例</strong> </p>
<p><a href="https://github.com/eolwral/OSMonitor/" target="_blank" rel="noopener">https://github.com/eolwral/OSMonitor/</a></p>
<p>包含远程仓库</p>
<pre><code>colorpicker @ ec1d13e
volley @ d20f9d3
</code></pre><p>下载回来发现 colorpicker 和volley文件夹为空</p>
<pre><code>$ git submodule update --init --recursive
Submodule &apos;colorpicker&apos; (https://github.com/eolwral/android-ColorPickerPreference.git) registered for path &apos;colorpicker&apos;
Submodule &apos;volley&apos; (https://android.googlesource.com/platform/frameworks/volley/) registered for path &apos;volley&apos;
Cloning into &apos;colorpicker&apos;...
remote: Counting objects: 394, done.
Receivin94 g objects:  77% (3(0d4/39e4lta 0), reused 0) ,(del 2ta 0), pa4ck4.00  394
Receiving objects: 100% (394/394), 252.30 KiB | 83.00 KiB/s, done.
Resolving deltas: 100% (164/164), done.
Checking connectivity... done.
Submodule path &apos;colorpicker&apos;: checked out &apos;ec1d13e450e65bbd086bd6094c5cd36a4da737fa&apos;
Cloning into &apos;volley&apos;...
fatal: unable to access &apos;https://android.googlesource.com/platform/frameworks/volley/&apos;: Failed to connect to android.googlesource.com port 443: Timed out
fatal: clone of &apos;https://android.googlesource.com/platform/frameworks/volley/&apos; into submodule path &apos;volley&apos; failed
</code></pre><p>volley下载失败，点击发现volley远程仓库地址失效（无法跳转），手动搜索下载volley</p>
<h2 id="transformClassesWithDexForXuehuDebug-UnsupportedOperationException"><a href="#transformClassesWithDexForXuehuDebug-UnsupportedOperationException" class="headerlink" title="transformClassesWithDexForXuehuDebug UnsupportedOperationException"></a>transformClassesWithDexForXuehuDebug UnsupportedOperationException</h2><p>可能两种原因：</p>
<ol>
<li>JDK1.8与gradle不兼容</li>
<li><p>内存不足</p>
<p> 主module build.gradle</p>
<pre><code>dexOptions {
    javaMaxHeapSize &quot;4g&quot;
    preDexLibraries = false
}

defaultConfig {
    multiDexEnabledtrue
}

dependencies {
    compile &apos;com.android.support:multidex:1.0.1&apos;
}
</code></pre></li>
</ol>
<h2 id="Unsupported-major-minor-version-52-0"><a href="#Unsupported-major-minor-version-52-0" class="headerlink" title="Unsupported major.minor version 52.0"></a>Unsupported major.minor version 52.0</h2><pre><code>java.lang.UnsupportedClassVersionError: com/android/build/gradle/LibraryPlugin : Unsupported major.minor version 52.0
</code></pre><p>可能两种原因：</p>
<ol>
<li>JDK1.8与gradle不兼容</li>
<li><p>compileSdkVersion 和 buildToolsVersion 版本不一致。一个23，一个24</p>
<pre><code>android {
    compileSdkVersion 23
    buildToolsVersion &quot;24.0.3&quot;
</code></pre></li>
</ol>
<h1 id="指定cpu类型，减少apk体积"><a href="#指定cpu类型，减少apk体积" class="headerlink" title="指定cpu类型，减少apk体积"></a>指定cpu类型，减少apk体积</h1><p>gradle.properties</p>
<pre><code>android.useDeprecatedNdk=true
</code></pre><p>主module 的 build.gradle</p>
<pre><code>android {
    defaultConfig {
        ndk {
            abiFilters &quot;armeabi&quot;, &quot;armeabi-v7a&quot;, &quot;armeabi-v8a&quot;, &quot;x86&quot;
        }
    }
}
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/03/Android/gradle/gradle自动签名构建/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/03/Android/gradle/gradle自动签名构建/" itemprop="url">gradle自动签名构建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-03T14:13:53+08:00">
                2020-02-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>gradle自动签名构建 http://www.tuicool.com/articles/MjqYbiu
Android Studio用release模式进行调试  http://www.cnblogs.com/tianzhijiexian/p/4442804.html
</code></pre><p>module的buil.gradle android标签下</p>
<pre><code>signingConfigs {
    myConfig {
        storeFile file(&quot;xuehu.jks&quot;) // 放在module根目录（和buil.gradle同级），所以直接写了相对路径
        storePassword &quot;xuehu2016&quot;
        keyAlias &quot;xuehu&quot;
        keyPassword &quot;xuehu2016&quot;
    }
}
buildTypes {
    release {
        signingConfig signingConfigs.myConfig//不要忘了要在release的时候加入我么的签名配置信息
        minifyEnabled false
        proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;
    }
}
</code></pre><p>如果调试时也希望使用签名</p>
<pre><code>buildTypes {
    debug {
        signingConfig signingConfigs.myConfig
    }
    release {
        signingConfig signingConfigs.myConfig//不要忘了要在release的时候加入我么的签名配置信息
        minifyEnabled false
        proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;
    }
}
</code></pre><p><a href="http://blog.chinaunix.net/uid-20771867-id-5106723.html" target="_blank" rel="noopener">Android studio的gradle配置 </a></p>
<ol>
<li>自动按照版本号和版本名称及日期重命名apk。</li>
<li>自动按照日期升级versionCode。</li>
<li>自动将apk文件复制出来。</li>
</ol>
<h1 id="将apk名-替换为-xuehu-渠道名-v版本名-apk。"><a href="#将apk名-替换为-xuehu-渠道名-v版本名-apk。" class="headerlink" title="将apk名 替换为 xuehu-渠道名_v版本名.apk。"></a>将apk名 替换为 xuehu-渠道名_v版本名.apk。</h1><ul>
<li>android标签下</li>
<li>甚至可以在buildTypes –&gt; release { 标签下，仅release时才重命名apk</li>
</ul>
<p>代码如下</p>
<pre><code>android.applicationVariants.all { variant -&gt;
    variant.outputs.each { output -&gt;
        def file = output.outputFile
        output.outputFile = new File(file.parent, file.name.replace(file.name, &quot;xuehu-&quot;+variant.productFlavors[0].name+&quot;_v${variant.versionName}.apk&quot;))
    }
}
</code></pre><h1 id="将打包后的文件复制到build目录下"><a href="#将打包后的文件复制到build目录下" class="headerlink" title="将打包后的文件复制到build目录下"></a>将打包后的文件复制到build目录下</h1><ul>
<li>不用深入到apk目录</li>
<li>同时还看不到unaligned的apk了</li>
<li>android标签下</li>
<li><p>代码如下</p>
<p>  task copyTask(type: Copy) {</p>
<pre><code>from &apos;build/outputs/apk/&apos;
into &apos;build/&apos;
exclude &apos;*-unaligned.apk&apos;
</code></pre><p>  }</p>
<p>  task bd(dependsOn: [‘assembleDebug’, ‘assembleRelease’, ‘copyTask’]){</p>
<pre><code>copyTask.mustRunAfter assembleRelease
</code></pre><p>  }</p>
</li>
</ul>
<p><code>gradle bd</code> 即可编译并复制到build目录下</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/17/阿里云日志分析服务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/17/阿里云日志分析服务/" itemprop="url">阿里云日志分析服务</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-17T16:49:53+08:00">
                2020-01-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <img src="/2020/01/17/阿里云日志分析服务/版本卡顿看板.png">
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">body.pl:2 and body.p:zywx_app and body.e_n:player_event_sum</span><br><span class="line">|select <span class="string">"版本"</span>,<span class="string">"卡顿用户量"</span>,<span class="string">"卡顿用户占比%"</span> </span><br><span class="line">from (</span><br><span class="line">select <span class="string">"body.v"</span> as <span class="string">"版本"</span>,</span><br><span class="line">(<span class="keyword">case</span> when num &gt;= 5 <span class="keyword">then</span> <span class="string">'卡顿'</span> <span class="keyword">else</span> <span class="string">'正常'</span> end) as <span class="string">"播放状态"</span>,</span><br><span class="line">count(distinct uid) as <span class="string">"卡顿用户量"</span>,round(count(distinct uid) * 100.00 / sum(count(distinct uid)) over(PARTITION BY <span class="string">"body.v"</span>),2) as <span class="string">"卡顿用户占比%"</span></span><br><span class="line">from <span class="built_in">log</span> group by <span class="string">"body.v"</span>,<span class="string">"播放状态"</span> order by <span class="string">"body.v"</span></span><br><span class="line">)<span class="built_in">where</span> <span class="string">"播放状态"</span> = <span class="string">'卡顿'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>里层select，真正的逻辑<ul>
<li>定义播放卡顿</li>
<li>计算卡顿用户量</li>
<li>计算卡顿用户占比</li>
<li>以播放状态分组，区分卡顿和正常    </li>
</ul>
</li>
<li>外层select<ul>
<li>字段别名，提高可读性</li>
<li>过滤出播放卡顿的行</li>
</ul>
</li>
</ul>
<h1 id="窗口函数-over"><a href="#窗口函数-over" class="headerlink" title="窗口函数 over"></a>窗口函数 over</h1><p>窗口函数用来跨行计算。普通的SQL聚合函数只能用来计算一行内的结果，或者把所有行聚合成一行结果。窗口函数，可以跨行计算，并且把结果填到到每一行中。</p>
<p>窗口函数语法：</p>
<p><code>rank() OVER (PARTITION BY  KEY1 ORDER BY KEY2 DESC)</code></p>
<p>其中rank()是一个聚合函数，可以使用分析语法中的任何函数</p>
<p>实例：<code>sum(count(distinct uid)) over(PARTITION BY &quot;body.pl&quot;,&quot;body.v&quot;)</code></p>
<h1 id="参考-amp-扩展"><a href="#参考-amp-扩展" class="headerlink" title="参考&amp;扩展"></a>参考&amp;扩展</h1><ul>
<li><a href="https://help.aliyun.com/document_detail/63972.html?spm=5176.11065259.1996646101.searchclickresult.5fba6238KEPvzj" target="_blank" rel="noopener">窗口函数</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/16/Android/FileProvider/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/16/Android/FileProvider/" itemprop="url">FileProvider</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-16T16:49:53+08:00">
                2020-01-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>为了提高 <strong>私有目录</strong> 的安全性，防止应用信息的泄漏，从 Android 7.0 开始，应用私有目录的访问权限被做限制。</p>
<p>具体表现为，开发人员不能够再简单地通过 <code>file://</code> URI 访问其他应用的私有目录文件或者让其他应用访问自己的私有目录文件。否者会抛出 <code>FileUriExposedException</code> 引发 Crash。</p>
<p><code>android.os.FileUriExposedException: file:///storage/emulated/0/xxx exposed beyond app through Intent.getData()</code></p>
<p>所有包含 <code>file://</code> 的URI 的 Intent 离开你的 App ，都受此限制</p>
<p>安卓提供的解决方案是 FileProvider，通过 <code>comtent://</code> 的模式替换掉 <code>file://</code> </p>
<p>FileProvider 本质上就是一个 ContentProvider。ContentProvider 其实就是在可控的范围内，向外部其他的 App 分享数据。</p>
<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><ul>
<li>调用相机拍照。</li>
<li>剪裁图片。</li>
<li>调用系统安装器去安装 Apk。</li>
</ul>
<img src="/2020/01/16/Android/FileProvider/映射.png">
<h1 id="参考-amp-扩展"><a href="#参考-amp-扩展" class="headerlink" title="参考&amp;扩展"></a>参考&amp;扩展</h1><ul>
<li><a href="https://juejin.im/post/5974ca356fb9a06bba4746bc" target="_blank" rel="noopener">我想把 FileProvider 聊的更透彻一些</a></li>
<li><a href="https://juejin.im/post/590bbf33ac502e006cdb341a" target="_blank" rel="noopener">关于 Android 7.0 适配中 FileProvider 部分的总结</a></li>
<li><a href="https://www.jianshu.com/p/c58d17073e65" target="_blank" rel="noopener">Android 7.0 DownloadManager与FileProvider的坑</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/15/NDK/try-catch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/15/NDK/try-catch/" itemprop="url">try-catch</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-15T11:39:14+08:00">
                2020-01-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="捕获所有异常"><a href="#捕获所有异常" class="headerlink" title="捕获所有异常"></a>捕获所有异常</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    g_app-&gt;start();</span><br><span class="line">    g_isStarted = <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (...) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="NDK开启try-catch支持"><a href="#NDK开启try-catch支持" class="headerlink" title="NDK开启try-catch支持"></a>NDK开启<code>try-catch</code>支持</h1><p><code>cannot use &#39;try&#39; with exceptions disabled</code></p>
<p>这是由于 DragonBonesCPP 库使用了 C++ 标准异常，而Android NDK r5 版本开始支持 C++ 异常控制，但是编译器的 C++ 异常控制特性支持默认是关闭的。</p>
<p>要打开它，可以这样做：</p>
<p>编辑 Android.mk 文件，使当前module支持：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_CPP_FEATURES += exceptions</span><br><span class="line">或者：</span><br><span class="line"></span><br><span class="line">LOCAL_CPPFLAGS += -fexceptions</span><br></pre></td></tr></table></figure>
<p>如果想偷懒，也可以编辑 Application.mk 文件，使所有module支持：</p>
<p><code>APP_CPPFLAGS += -fexceptions</code></p>
<h1 id="参考-amp-扩展"><a href="#参考-amp-扩展" class="headerlink" title="参考&amp;扩展"></a>参考&amp;扩展</h1><ul>
<li><a href="https://www.cnblogs.com/zl1991/p/6604889.html" target="_blank" rel="noopener">cannot use ‘try’ with exceptions disabled</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/10/Android/DownloadManager使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/10/Android/DownloadManager使用/" itemprop="url">DownloadManager使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-10T14:49:53+08:00">
                2020-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="基本API"><a href="#基本API" class="headerlink" title="基本API"></a>基本API</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">enqueue(Request request) 开始任务</span><br><span class="line">remove(<span class="keyword">long</span>... ids) 移除任务；如果任务下载中，取消然后移除</span><br><span class="line">query(Query query) 查询已开始的任务</span><br><span class="line"></span><br><span class="line">Request设置文件存储路径：只支持外部存储</span><br><span class="line">setDestinationUri(Uri uri)</span><br><span class="line">setDestinationInExternalFilesDir</span><br><span class="line">setDestinationInExternalPublicDir</span><br></pre></td></tr></table></figure>
<h1 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h1><ul>
<li>开始下载</li>
<li>注册广播接收器，接受下载完成广播事件</li>
<li>注销广播接收器</li>
</ul>
<h2 id="下载新版本的-apk"><a href="#下载新版本的-apk" class="headerlink" title="下载新版本的 apk"></a>下载新版本的 apk</h2><pre><code>public void downloadNewVersion() {
    mDownloadManager = (DownloadManager) getSystemService(DOWNLOAD_SERVICE);
    // apkDownloadUrl 是 apk 的下载地址
    DownloadManager.Request request = new DownloadManager.Request(Uri.parse(apkDownloadUrl));
    // 获取下载队列 id
    enqueueId = mDownloadManager.enqueue(request);
}
</code></pre><h2 id="注册接收下载完成的广播"><a href="#注册接收下载完成的广播" class="headerlink" title="注册接收下载完成的广播"></a>注册接收下载完成的广播</h2><pre><code>BroadcastReceiver receiver = new BroadcastReceiver() {
    @Override
    public void onReceive(Context context, Intent intent) {
        long downloadCompletedId = intent.getLongExtra(
                DownloadManager.EXTRA_DOWNLOAD_ID, 0);
        // 检查是否是自己的下载队列 id, 有可能是其他应用的
        if (enqueueId != downloadCompletedId) {
            return;
        }
        DownloadManager.Query query = new DownloadManager.Query();
        query.setFilterById(enqueueId);
        Cursor c = mDownloadManager.query(query);
        if (c.moveToFirst()) {
            int columnIndex = c.getColumnIndex(DownloadManager.COLUMN_STATUS);
            // 下载失败也会返回这个广播，所以要判断下是否真的下载成功
            if (DownloadManager.STATUS_SUCCESSFUL == c.getInt(columnIndex)) {
                // 获取下载好的 apk 路径
                String uriString = c.getString(c.getColumnIndex(DownloadManager.COLUMN_LOCAL_FILENAME));
                // 提示用户安装
                promptInstall(Uri.parse(&quot;file://&quot; + uriString));
            }
        }
    }
};

// 注册广播, 设置只接受下载完成的广播
registerReceiver(receiver, new IntentFilter(
        DownloadManager.ACTION_DOWNLOAD_COMPLETE));
</code></pre><h2 id="注销广播"><a href="#注销广播" class="headerlink" title="注销广播"></a>注销广播</h2><pre><code>@Override
protected void onDestroy() {
    super.onDestroy();

    unregisterReceiver(mBroadcastReceiver);
}
</code></pre><h2 id="提示用户安装"><a href="#提示用户安装" class="headerlink" title="提示用户安装"></a>提示用户安装</h2><pre><code>private void promptInstall(Uri data) {
    Intent promptInstall = new Intent(Intent.ACTION_VIEW)
            .setDataAndType(data, &quot;application/vnd.android.package-archive&quot;);
    // FLAG_ACTIVITY_NEW_TASK 可以保证安装成功时可以正常打开 app
    promptInstall.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
    startActivity(promptInstall);
}
</code></pre><h1 id="最佳实践建议"><a href="#最佳实践建议" class="headerlink" title="最佳实践建议"></a>最佳实践建议</h1><h2 id="服务化"><a href="#服务化" class="headerlink" title="服务化"></a>服务化</h2><p>最好在服务中进行下载，而且不要绑定Activity生命周期，保证下载完成</p>
<p>下载完成要及时的注销广播，停止服务</p>
<h1 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h1><h2 id="DownloadManager-某些型号手机被禁掉"><a href="#DownloadManager-某些型号手机被禁掉" class="headerlink" title="DownloadManager 某些型号手机被禁掉"></a>DownloadManager 某些型号手机被禁掉</h2><p>用其他网络下载框架</p>
<h2 id="解析apk包错误"><a href="#解析apk包错误" class="headerlink" title="解析apk包错误"></a>解析apk包错误</h2><p>mDownloadManager.getUriForDownloadedFile(enqueueId)返回的Uri是这种格式的 <code>content://downloads/my_downloads/83</code>, 这种格式的Uri启动intent会报解析程序包时出现问题。所以需要解析或直接指定绝对下载路径</p>
<h2 id="ERROR-UNKNOWN"><a href="#ERROR-UNKNOWN" class="headerlink" title="ERROR_UNKNOWN"></a>ERROR_UNKNOWN</h2><p>Android 18之前，下载链接含有 [] 会导致这个问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(Build.VERSION.SDK_INT&lt;=Build.VERSION_CODES.JELLY_BEAN_MR2)&#123;</span><br><span class="line">    uri = uri.replace(&quot;[&quot;,&quot;%5B&quot;).replace(&quot;]&quot;,&quot;%5D&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方案来自 <a href="http://stackoverflow.com/questions/37976748/downloadmanager-fails-with-error-unknown-on-api-17" target="_blank" rel="noopener">stackoverflow</a></p>
<h2 id="IllegalArgumentException"><a href="#IllegalArgumentException" class="headerlink" title="IllegalArgumentException"></a>IllegalArgumentException</h2><p><code>崩溃在了mDownloadManager.enqueue(request)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">enqueue</span><span class="params">(Request request)</span> </span>&#123;</span><br><span class="line">    ContentValues values = request.toContentValues(mPackageName);</span><br><span class="line">    Uri downloadUri = mResolver.insert(Downloads.Impl.CONTENT_URI, values);</span><br><span class="line">    <span class="keyword">long</span> id = Long.parseLong(downloadUri.getLastPathSegment());</span><br><span class="line">    <span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="meta">@Nullable</span> <span class="function">Uri <span class="title">insert</span><span class="params">(@NonNull Uri url, @Nullable ContentValues values)</span> </span>&#123;</span><br><span class="line">    Preconditions.checkNotNull(url, <span class="string">"url"</span>);</span><br><span class="line">    IContentProvider provider = acquireProvider(url);</span><br><span class="line">    <span class="keyword">if</span> (provider == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 看这里 嘿嘿嘿</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unknown URL "</span> + url);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">long</span> startTime = SystemClock.uptimeMillis();</span><br><span class="line">        Uri createdRow = provider.insert(mPackageName, url, values);</span><br><span class="line">        <span class="keyword">long</span> durationMillis = SystemClock.uptimeMillis() - startTime;</span><br><span class="line">        maybeLogUpdateToEventLog(durationMillis, url, <span class="string">"insert"</span>, <span class="keyword">null</span> <span class="comment">/* where */</span>);</span><br><span class="line">        <span class="keyword">return</span> createdRow;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">        <span class="comment">// Arbitrary and not worth documenting, as Activity</span></span><br><span class="line">        <span class="comment">// Manager will kill this process shortly anyway.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        releaseProvider(provider);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>原因是系统的DownloadManager Service被关闭了, 可以有两种解决方法</p>
<ol>
<li>告知用户去系统里找到相应的开关 打开下载服务</li>
<li>catch 住自己去手写下载</li>
</ol>
<h2 id="SecurityException"><a href="#SecurityException" class="headerlink" title="SecurityException"></a>SecurityException</h2><p>原因是Context.getExternalFilesDir得到的地址 和Environment.getExternalStorageDirectory() 不一致</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkFileUriDestination</span><span class="params">(ContentValues values)</span> </span>&#123;</span><br><span class="line">    String fileUri = values.getAsString(Downloads.Impl.COLUMN_FILE_NAME_HINT);</span><br><span class="line">    <span class="keyword">if</span> (fileUri == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">                <span class="string">"DESTINATION_FILE_URI must include a file URI under COLUMN_FILE_NAME_HINT"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    Uri uri = Uri.parse(fileUri);</span><br><span class="line">    String scheme = uri.getScheme();</span><br><span class="line">    <span class="keyword">if</span> (scheme == <span class="keyword">null</span> || !scheme.equals(<span class="string">"file"</span>)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Not a file URI: "</span> + uri);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> String path = uri.getPath();</span><br><span class="line">    <span class="keyword">if</span> (path == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Invalid file URI: "</span> + uri);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> String canonicalPath = <span class="keyword">new</span> File(path).getCanonicalPath();</span><br><span class="line">        <span class="keyword">final</span> String externalPath = Environment.getExternalStorageDirectory().getAbsolutePath();</span><br><span class="line">        <span class="keyword">if</span> (!canonicalPath.startsWith(externalPath)) &#123;</span><br><span class="line">            <span class="comment">// 看这里,嘿嘿嘿</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SecurityException(<span class="string">"Destination must be on external storage: "</span> + uri);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> SecurityException(<span class="string">"Problem resolving path: "</span> + uri);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解决方案：手动拼1个存储地址</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">DownloadManager.Request request = <span class="keyword">new</span> DownloadManager.Request(Uri.parse(你的APK下载地址));</span><br><span class="line">request.setDestinationUri(你的app 本地存储URI));</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">long</span> mDownloadId = instance.mSystemDownloadManager.enqueue(request);</span><br><span class="line">&#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">    File f = Environment.getExternalStorageDirectory();</span><br><span class="line">    f = <span class="keyword">new</span> File(f, <span class="string">"Android"</span>);</span><br><span class="line">    f = <span class="keyword">new</span> File(f, <span class="string">"data"</span>);</span><br><span class="line">    f = <span class="keyword">new</span> File(f, mContext.getPackageName());</span><br><span class="line">    f = <span class="keyword">new</span> File(f, <span class="string">"files"</span>);</span><br><span class="line">    f = <span class="keyword">new</span> File(f, Environment.DIRECTORY_DOWNLOADS);</span><br><span class="line">    <span class="keyword">if</span> (!f.exists()) &#123;</span><br><span class="line">        f.mkdirs();</span><br><span class="line">    &#125;</span><br><span class="line">    request.setDestinationUri(f));</span><br><span class="line">    instance.mDownloadId = instance.mSystemDownloadManager.enqueue(request);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line"> <span class="comment">// 让用户打开下载服务；或者手动写下载</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="参考-amp-扩展"><a href="#参考-amp-扩展" class="headerlink" title="参考&amp;扩展"></a>参考&amp;扩展</h1><ul>
<li><a href="https://juejin.im/entry/57715565d342d30057dcea62" target="_blank" rel="noopener">Android 快速实现文件下载</a></li>
<li><a href="https://www.jianshu.com/p/c58d17073e65" target="_blank" rel="noopener">Android 7.0 DownloadManager与FileProvider的坑</a></li>
<li><a href="http://quanke.name/posts/42104/" target="_blank" rel="noopener">Android DownloadManager ERROR_UNKNOWN 在API 17 巨坑完美解决</a></li>
<li><a href="https://corydon.cc/2017/03/17/downloadbug/" target="_blank" rel="noopener">android 源生DownloadManager 的两个Crash 坑</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/07/web/egg.js/快速入门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/07/web/egg.js/快速入门/" itemprop="url">快速入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-07T17:28:14+08:00">
                2020-01-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/egg-js/" itemprop="url" rel="index">
                    <span itemprop="name">egg.js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="egg-js"><a href="#egg-js" class="headerlink" title="egg.js"></a>egg.js</h1><p>为企业级框架和应用而生</p>
<h2 id="设计原则"><a href="#设计原则" class="headerlink" title="设计原则"></a>设计原则</h2><p>没有选择社区常见框架的大集市模式（集成如数据库、模板引擎、前端框架等功能），而是专注于提供 Web 开发的核心功能和一套灵活可扩展的插件机制（一个插件只做一件事）</p>
<p>奉行『约定优于配置』</p>
<h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul>
<li>提供基于 Egg 定制上层框架的能力</li>
<li>高度可扩展的插件机制</li>
<li>内置多进程管理</li>
<li>基于 Koa 开发，性能优异。Koa基于Express</li>
<li>框架稳定，测试覆盖率高</li>
<li>渐进式开发</li>
</ul>
<p>Express是 Node.js 社区广泛使用的框架，简单且扩展性强，非常适合做个人项目。但框架本身缺少约定，不利于团队协作</p>
<h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><p>建议选择 <a href="http://nodejs.org/" target="_blank" rel="noopener">LTS 版本</a>，最低要求 8.x。</p>
<p>下载安装</p>
<p>安装完成，输入 ，<code>node -v</code>，能看到node版本，即表示安装成功</p>
<h1 id="快速初始化"><a href="#快速初始化" class="headerlink" title="快速初始化"></a>快速初始化</h1><h2 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir egg-example &amp;&amp; cd egg-example</span><br><span class="line">npm init egg --type=simple</span><br></pre></td></tr></table></figure>
<p>输入 工程名字等配置信息，即生成了一个示例项目。输出如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[egg-init] usage:</span><br><span class="line">      - cd /Users/liyungui/egg-example</span><br><span class="line">      - npm install</span><br><span class="line">      - npm start / npm run dev / npm test</span><br></pre></td></tr></table></figure>
<h2 id="启动项目"><a href="#启动项目" class="headerlink" title="启动项目"></a>启动项目</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>
<p>启动成功，输出如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">egg started on http://127.0.0.1:7001</span><br></pre></td></tr></table></figure>
<p>浏览器打开 <code>http://127.0.0.1:7001</code>，页面显示 <code>hi, egg</code></p>
<p>技术周会纪要：</p>
<p>一、分享</p>
<p>1.Native崩溃精确定位 @云贵</p>
<p>内容：精确定位c/c++代码崩溃行数。addr2line工具。bugly制作与上传so符号表</p>
<p>结论：有源码的c/c++崩溃都可以解决；三方so库没有源码，拦截信号量并不能避免崩溃</p>
<p>2.Android Jetpack介绍 @凌云</p>
<p>内容：目标是帮助开发者快速构建出稳定、高性能应用。功能介绍，Data Binding，Activity和Fragment的生命周期，LiveData，Fragment导航的管理，帮助开发者快速构建出稳定、高性能、测试友好同时向后兼容的应用</p>
<p>结论：逐步引进，下阶段的下载框架可以用DownloadManager，Fragment使用Navigation</p>
<p>二、讨论</p>
<p>APP内大量加载高清大图的内存管理<br>场景：20道多题测加载图片<br>方案：压缩，裁剪，分区域加载，LRU缓存，渲染模式（ARBG等），避免超大图</p>
<p>三、技术规划</p>
<p>技术：单元测试、自动化测试、JS SDK、Android页面改造、微信工具问题、RN升级；<br>技术储备：竞品分析逆向、实时白板、PPT头像分流、多路推流、美颜、视频连麦</p>
<p>讨论：<br>1.单元测试、自动化测试、集体测的目标侧重点，推进实施节奏<br>2.JS SDK 做前期资料整理和设计文档<br>3.Android页面改造先做工作量统计<br>4.RN升级在四月前上线，寒假班不上<br>5.竞品分析逆向由研发主导，可以先做起来<br>6.腾讯云互动视频直播带白板和视频互动，不选择的原因是不能obs推流</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/07/Android/性能优化/ANR定位分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/07/Android/性能优化/ANR定位分析/" itemprop="url">ANR定位分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-07T15:08:53+08:00">
                2020-01-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ANR问题很难定位</p>
<p>ANR是耗时操作造成</p>
<h1 id="ANR类型"><a href="#ANR类型" class="headerlink" title="ANR类型"></a>ANR类型</h1><h2 id="KeyDispatchTimeout"><a href="#KeyDispatchTimeout" class="headerlink" title="KeyDispatchTimeout"></a>KeyDispatchTimeout</h2><p>主要类型</p>
<p>按键或触摸事件在特定时间(5s)内无响应</p>
<h2 id="BroadcastTimeout"><a href="#BroadcastTimeout" class="headerlink" title="BroadcastTimeout"></a>BroadcastTimeout</h2><p>BroadcastReceiver在特定时间((10s)内无法处理完成</p>
<h2 id="ServiceTimeout"><a href="#ServiceTimeout" class="headerlink" title="ServiceTimeout"></a>ServiceTimeout</h2><p>小概率类型</p>
<p>Service在特定时间((20s)内无法处理完成</p>
<h1 id="ANR基本定位–trace文件，定位不准"><a href="#ANR基本定位–trace文件，定位不准" class="headerlink" title="ANR基本定位–trace文件，定位不准"></a>ANR基本定位–trace文件，定位不准</h1><p>根据trace文件定位ANR未必能准确，trace只能够确定发生ANR的位置，但只是压死骆驼的最后一根稻草。</p>
<p>若有A/B/C事件串行执行于UI线程，当C事件发生ANR时，说明A-&gt;B-&gt;C太耗时了，并不能确定耗时操作在哪个具体事件上。</p>
<p>trace文件路径：data\anr\traces_packageName.txt</p>
<p>下面的”main”指的是主线程，我们分析”main”所在的片段即可定位ANR。</p>
<pre><code>&quot;main&quot; prio=5 tid=1 SUSPENDED
  | group=&quot;main&quot; sCount=2 dsCount=1 obj=0x94c48bd8 self=0xb79a2500
  | sysTid=3319 nice=0 sched=0/0 cgrp=[fopen-error:2] handle=-1217108224
  | state=S schedstat=( 0 0 0 ) utm=238 stm=2439 core=1
  at com.xuehu365.xuehu.utils.XueHuVideoView.setVideoPlayRecord(XueHuVideoView.java:~244)
  at com.xuehu365.xuehu.utils.XueHuVideoView.videoStart(XueHuVideoView.java:184)
  at com.xuehu365.xuehu.utils.XueHuVideoView.onClick(XueHuVideoView.java:264)
  at com.xuehu365.xuehu.utils.XueHuVideoView$$ViewBinder$1.doClick(XueHuVideoView$$ViewBinder.java:26)
  at butterknife.internal.DebouncingOnClickListener.onClick(DebouncingOnClickListener.java:22)
</code></pre><h1 id="ANR辅助定位——BlockCanary"><a href="#ANR辅助定位——BlockCanary" class="headerlink" title="ANR辅助定位——BlockCanary"></a>ANR辅助定位——BlockCanary</h1><p>BlockCanary工具却能<strong>统计过程中所有耗时操作</strong>(耗时阈值由自己设置)。</p>
<p><strong>原理</strong>比较简单，通过<strong>替换Looper的Printer达到计算msg处理的耗时</strong>。</p>
<p>同时也提供了一些很有帮助的参数，譬如总耗时与线程耗时，可用内存等。</p>
<h1 id="ANR辅助定位——埋点"><a href="#ANR辅助定位——埋点" class="headerlink" title="ANR辅助定位——埋点"></a>ANR辅助定位——埋点</h1><p>方法内多次调用同一耗时操作，那么就果断埋点吧！确定是哪次操作真正耗时</p>
<p>通过埋点统计操作用时，即可更准确定位耗时操作。</p>
<h1 id="多次采样确定ANR耗时操作"><a href="#多次采样确定ANR耗时操作" class="headerlink" title="多次采样确定ANR耗时操作"></a>多次采样确定ANR耗时操作</h1><p>ANR不好复现，耗时操作的耗时也不稳定，通过多次采样来确定耗时操作已经是通用方案了。</p>
<p>若是层级较深或复杂操作才能触发耗时操作的，推荐使用iTestin工具进行自动化测试。</p>
<h1 id="参考-amp-扩展"><a href="#参考-amp-扩展" class="headerlink" title="参考&amp;扩展"></a>参考&amp;扩展</h1><ul>
<li><a href="https://www.cnblogs.com/purediy/p/3225060.html" target="_blank" rel="noopener">Android ANR 分析解决方法</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/04/资产/美国银行卡/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/04/资产/美国银行卡/" itemprop="url">美国银行卡</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-04T14:18:53+08:00">
                2020-01-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/资产/" itemprop="url" rel="index">
                    <span itemprop="name">资产</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="美国银行"><a href="#美国银行" class="headerlink" title="美国银行"></a>美国银行</h1><p>美国银行，Bank Of America，简称BOA</p>
<p>美国第二大商业银行，仅次于摩根大通</p>
<h1 id="账户类型"><a href="#账户类型" class="headerlink" title="账户类型"></a>账户类型</h1><p>美国的银行把国内的储蓄卡功能一分为三</p>
<ul>
<li>支票账户 checking account。日常消费：ATM、网上支付、转账<ul>
<li>core checking 个人支票账户，美国居民必备。<ul>
<li>开户最低存款25美金</li>
<li>月费12美金。<ul>
<li>满足任一条件，可免除<ul>
<li>一次性存入250美金</li>
<li>保持1500美金额度</li>
<li>24岁以下的学生</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>interest checking 利息支票账户，可消费有利息</li>
<li>student banking 学生账户，免月管理费</li>
<li>business checking 对公账户</li>
</ul>
</li>
<li>储蓄账户 savings account。活期存款。有利息；不能消费，更加安全<ul>
<li>开户最低存款100美金</li>
<li>月费8美金。<ul>
<li>满足任一条件，可免除<ul>
<li>保持500美金额度</li>
<li>已绑定 interest checking</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>定期储蓄账户，Certificate of Deposit 缩写为CDs</li>
<li>个人退休账户，缩写为 IRAs</li>
</ul>
<p>注意：BOA首选客户，可免4个支票账户和储蓄账户月费</p>
<h2 id="账户与卡的关系"><a href="#账户与卡的关系" class="headerlink" title="账户与卡的关系"></a>账户与卡的关系</h2><p>开户成功就会有一个账户号码</p>
<p>支票账户和储蓄账户是唯一的不可更改的</p>
<p>支票账户对应的借记卡(debit card)是可以随时更换的。美国的借记卡都有visa通道，即某种情况下可以直接当做信用卡使用。而且美国的借记卡还有有效期，美国的银行卡会随时在有效期到期前把新卡寄到客户家里，或者银行的风险预警系统判断客户的银行卡处于风险中，例如有不明商户扣钱或者被国际信用卡机构盗号，银行则会主动寄新卡给客人。借记卡被捡到会被盗刷掉支票账户里的钱(储蓄账户里的钱是无法消费的)</p>
<h1 id="国际人士开户流程"><a href="#国际人士开户流程" class="headerlink" title="国际人士开户流程"></a>国际人士开户流程</h1><h2 id="需要资料"><a href="#需要资料" class="headerlink" title="需要资料"></a>需要资料</h2><ul>
<li>护照</li>
<li>原国籍证明：身份证、信用卡</li>
<li>美国住址：邮寄银行卡</li>
<li>美国手机号：可以APP修改，支持TextNow和Google Voice</li>
</ul>
<h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><ul>
<li>中文经理</li>
<li>介绍Checking Account 和 Saving Accont 的区别和套餐费用；一般开这两个账户就够了</li>
<li>登记资料，APP操作</li>
<li>给临时卡，30天有效期</li>
<li>资料袋，里面有账户信息</li>
<li>存25美金激活账户</li>
<li>30 天内，分别 Checking Account 存进去 1500 美刀，Saving Account 存进去 500 美刀，能够免除月费</li>
</ul>
<h1 id="参考-amp-扩展"><a href="#参考-amp-扩展" class="headerlink" title="参考&amp;扩展"></a>参考&amp;扩展</h1><ul>
<li><a href="https://www.zhihu.com/question/51678829" target="_blank" rel="noopener">在美国的银行开户时的Checking account 和 Saving account有什么区别？</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="风" />
            
              <p class="site-author-name" itemprop="name">风</p>
              <p class="site-description motion-element" itemprop="description">随心而动，随刃而行</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">318</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">73</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">风</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
