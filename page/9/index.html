<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="随心而动，随刃而行">
<meta property="og:type" content="website">
<meta property="og:title" content="风">
<meta property="og:url" content="http://yoursite.com/page/9/index.html">
<meta property="og:site_name" content="风">
<meta property="og:description" content="随心而动，随刃而行">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="风">
<meta name="twitter:description" content="随心而动，随刃而行">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/9/"/>





  <title>风</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">风</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">技术博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/03/直播/音频/学乎录音实现方式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/03/直播/音频/学乎录音实现方式/" itemprop="url">学乎录音实现方式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-03T14:52:14+08:00">
                2019-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/直播/" itemprop="url" rel="index">
                    <span itemprop="name">直播</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>学乎录音实现</p>
<h1 id="学乎录音实现方式探索历程"><a href="#学乎录音实现方式探索历程" class="headerlink" title="学乎录音实现方式探索历程"></a>学乎录音实现方式探索历程</h1><p>尝试过 MedicaRecord,AudioRecord录音，lame库编码为MP3(<a href="https://github.com/liyungui/MP3LameRecord" target="_blank" rel="noopener">MP3LameRecord</a>)，webrtc降噪(<a href="https://github.com/liyungui/PCMNoiseSupression" target="_blank" rel="noopener">PCMNoiseSupression</a>)</p>
<p>经过实践测试，发现音效最好(音量大，噪音小)的实现方式是：AudioRecord录制，使用Android系统自带的pcm转arm</p>
<h2 id="关键细节"><a href="#关键细节" class="headerlink" title="关键细节"></a>关键细节</h2><pre><code>AudioManager audioManager = (AudioManager) App.getApplication().getSystemService(Context.AUDIO_SERVICE);
audioManager.setMode(AudioManager.MODE_IN_COMMUNICATION);
audioManager.setSpeakerphoneOn(true);

// 获得缓冲区字节大小
bufferSizeInBytes = AudioRecord.getMinBufferSize(AUDIO_SAMPLE_RATE,
        AudioFormat.CHANNEL_IN_MONO, AudioFormat.ENCODING_PCM_16BIT);

// 创建AudioRecord对象
recorder = new AudioRecord(AUDIO_INPUT, AUDIO_SAMPLE_RATE,
        AudioFormat.CHANNEL_IN_MONO, AudioFormat.ENCODING_PCM_16BIT, bufferSizeInBytes);
voiceFilePath = PathUtil.getInstance().getVoicePath() + File.separator + getPCMFileName(&quot;&quot;);
file = new File(voiceFilePath);
recorder.startRecording();
isRecording = true;// 让录制状态为true
// 开启音频文件写入线程
new Thread(new AudioRecordThread()).start();

private void writeDateTOFile(String AudioName) {
    // new一个byte数组用来存一些字节数据，大小为缓冲区大小
    byte[] audiodata = new byte[bufferSizeInBytes];
    FileOutputStream fos = null;
    int readsize = 0;
    try {
        File file = new File(AudioName);
        if (file.exists()) {
            file.delete();
        }
        fos = new FileOutputStream(file);// 建立一个可存取字节的文件

        while (isRecording) {
            readsize = recorder.read(audiodata, 0, bufferSizeInBytes);
            if (AudioRecord.ERROR_INVALID_OPERATION != readsize &amp;&amp; fos != null) {
                try {
                    fos.write(audiodata);

                    getVolumeDB(readsize, audiodata);
                } catch (Exception e) {
                    if (e != null) {
                        e.printStackTrace();
                    }
                }
            }
        }

        if (fos != null)
            fos.close();// 关闭写入流
    } catch (Exception e) {
        e.printStackTrace();
    }
}
</code></pre><p>pcm 转 amr实现细节参考另一篇笔记。反射调用在华为机型上容易ANR，要把系统类文件复制到工程中使用，性能好</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/03/直播/音频/微信语音编码-silk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/03/直播/音频/微信语音编码-silk/" itemprop="url">微信语音编码-silk</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-03T14:52:14+08:00">
                2019-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/直播/" itemprop="url" rel="index">
                    <span itemprop="name">直播</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Android微信语音聊天记录及文本聊天记录-数据库破解-silk-整理"><a href="#Android微信语音聊天记录及文本聊天记录-数据库破解-silk-整理" class="headerlink" title="Android微信语音聊天记录及文本聊天记录 数据库破解 silk 整理"></a><a href="http://blog.csdn.net/voler_HJL/article/details/53788126" target="_blank" rel="noopener">Android微信语音聊天记录及文本聊天记录 数据库破解 silk 整理</a></h1><p><strong>微信语音文件存储位置</strong></p>
<pre><code>根目录 -》tencent -》MicroMsg -》名字很长又很乱的那个文件夹 -》voice2 
</code></pre><p><strong>播放</strong></p>
<p>.amr后缀，但它并不是真正的.amr文件，amr播放器是播放不了的 </p>
<p>其实是silk v3格式，QQ的语音文件也是这种格式 </p>
<h1 id="微信语音文件的格式转换"><a href="#微信语音文件的格式转换" class="headerlink" title="微信语音文件的格式转换"></a><a href="http://www.jianshu.com/p/71137d5acf78" target="_blank" rel="noopener">微信语音文件的格式转换</a></h1><p>起初，iOS 只是去掉了文件头的 amr，添上就能还原为 amr 了；Android 则是原生的 amr。</p>
<p>微信6.0 之后开始采用 silk 编码来传输语音，必须用 slik v3 解码器</p>
<p>这方面许多人做过工作，罗列一下：</p>
<h2 id="个人"><a href="#个人" class="headerlink" title="个人"></a>个人</h2><p><strong>kn007</strong>: </p>
<p><a href="https://kn007.net/topics/decoding-qq-wechat-silk-v3-encoded-audio-to-mp3-or-other-formats/" target="_blank" rel="noopener">解码转换QQ微信的SILK v3编码音频为MP3或其他格式</a></p>
<p><a href="https://kn007.net/topics/batch-convert-silk-v3-audio-files-to-mp3-in-windows/" target="_blank" rel="noopener">Windows下批量转换Silk v3音频文件为MP3格式</a></p>
<p><a href="https://kn007.net/topics/update-silk2mp3-to-official-version/" target="_blank" rel="noopener">更新了Silk2MP3</a></p>
<p><strong>snakeninny</strong>：</p>
<p><a href="http://bbs.iosre.com/t/topic/3199" target="_blank" rel="noopener">从微信中提取语音文件，并转换成文字的全自动化解决方案</a></p>
<p><strong>hangcom</strong>：《iOS应用逆向工程》的作者，之前还开发了朋友圈导出。</p>
<p><a href="https://zhuanlan.zhihu.com/p/21783890" target="_blank" rel="noopener">微信语音文件的解析</a></p>
<p><strong>杨树下的狐狸</strong>：Android 方案</p>
<p><a href="https://www.zhihu.com/question/19909162/answer/80640430" target="_blank" rel="noopener">微信的语音聊天记录可以从手机提取出来保存到PC上么？ - 知乎</a></p>
<p><strong>cxun</strong>：整体解决方案</p>
<p>（暂时失效）<a href="http://www.cnblogs.com/cxun/p/4338643.html" target="_blank" rel="noopener">微信聊天记录查看器（程序+源码）</a></p>
<h2 id="商用"><a href="#商用" class="headerlink" title="商用"></a>商用</h2><p>iTools：可以转换 aud 到 wav</p>
<p>楼月微信聊天记录导出恢复助手：同上</p>
<p>其他还有：Silk 手机音频播放器、Silk 转换工具、WeBack 等等。</p>
<h1 id="Skype-Silk-与Opus的关系"><a href="#Skype-Silk-与Opus的关系" class="headerlink" title="Skype Silk 与Opus的关系"></a><a href="http://tiger-beach.blogspot.com/2014/04/skype-silk-opus.html" target="_blank" rel="noopener">Skype Silk 与Opus的关系</a></h1><p>Skype自2009年1月以来一直采用自己的SILK音频编码解码器，但是从2012年起过渡到新的Opus标准。</p>
<p>Opus标准已经获互联网工程任务组（IETF）批准，标准格式为RFC 6716。</p>
<p>Opus支持6kbps到510kbps的可变比特率。</p>
<p>它是一个有损声音编码的格式，适用于网络上的实时声音传输。</p>
<p>由于是一个开放格式，Opus在使用上没有任何专利限制。</p>
<p>Opus合并了Xiph.org的CELT低延时音频编解码器和Skype的SILK语音编解码器，专为互联网音频设计，可用于替代现有的私有音频编解码器</p>
<p>由 Xiph.Org、Mozilla、微软、Broadcom、Octasic和Google联合开发。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/03/直播/音频/音频基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/03/直播/音频/音频基础/" itemprop="url">音频基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-03T14:52:14+08:00">
                2019-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/直播/" itemprop="url" rel="index">
                    <span itemprop="name">直播</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="PCM"><a href="#PCM" class="headerlink" title="PCM"></a>PCM</h1><p>Pulse Code Modulation 脉冲编码调制</p>
<p>PCM是把声音从模拟信号(人耳听到的)转化为数字信号的技术。原理是用一个固定的频率对模拟信号进行采样，采样后的信号在波形上看就像一串连续的幅值不一的脉冲</p>
<p>把这些脉冲的幅值按一定精度进行量化和编码，这就组成了数字音频的产生三个过程：<strong>采样、量化、编码</strong></p>
<p>采样就是在时间轴上对信号进行数字化</p>
<p>量化是指在幅度轴上对信号进行数字化</p>
<p>编码就是按照一定的格式记录采样和量化后的数字数据，比如顺序存储或压缩存储</p>
<p>采样频率：每秒采集数据的次数</p>
<p>采样精度：每次采集数据的位数</p>
<p>声道数：存在几路音频</p>
<p>比特率：针对编码格式，表示压缩编码后每秒的音频数据量大小</p>
<h1 id="编码方式"><a href="#编码方式" class="headerlink" title="编码方式"></a>编码方式</h1><h2 id="WAV"><a href="#WAV" class="headerlink" title="WAV"></a>WAV</h2><p>Windows Media Audio</p>
<p>微软公司开发的Windows平台数字音频编码</p>
<p>录音质量高，但是压缩率小，文件大。每秒170k左右</p>
<h2 id="AMR"><a href="#AMR" class="headerlink" title="AMR"></a>AMR</h2><p>Adaptive Multi-Rate 自适应多速率</p>
<p>使用1-8个不同的位速编码，使语音编码最优化</p>
<p>高压缩率，质量比较差，多用于人声，由欧洲通信标准化委员会提出，是在移动通信系统中使用最广泛的语音标准。每秒1K左右</p>
<p>分为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.AMR-NB</span><br><span class="line">2.AMR-WB, Adaptive Multi-Rate - Wideband Speech Codec</span><br><span class="line">3.AMR-WB+, Extended Adaptive Multi-Rate - Wideband Speech Codec</span><br></pre></td></tr></table></figure>
<h2 id="MP3"><a href="#MP3" class="headerlink" title="MP3"></a>MP3</h2><p>MPEG-1 or MPEG-2 Audio Layer III</p>
<p>有损压缩，大幅度地降低音频数据量(压缩率 10-12)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">就bit rates来说MP3可以分为2种：</span><br><span class="line">MP3-CBR：Constant Bit Rate 固定比特率</span><br><span class="line">MP3_VBR： Variable Bit Rate 可变比特率</span><br></pre></td></tr></table></figure>
<h2 id="AAC"><a href="#AAC" class="headerlink" title="AAC"></a>AAC</h2><p>Advanced Audio Coding 高级音频编码</p>
<p>高压缩比(18)</p>
<p>音质方面，采用多声道，在同规格下比其他编码更胜一筹</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/03/直播/音频/音频增益/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/03/直播/音频/音频增益/" itemprop="url">音频增益</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-03T14:52:14+08:00">
                2019-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/直播/" itemprop="url" rel="index">
                    <span itemprop="name">直播</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://www.cnblogs.com/mod109/p/5767867.html" target="_blank" rel="noopener">音频增益</a> c++</p>
<p><a href="https://my.oschina.net/jinzei/blog/1305843" target="_blank" rel="noopener">PortAudio+webrtc+lame实现采集降噪增益mp3</a> c++</p>
<pre><code>不同采样率的兼容计算和细节讲的比较详细

先降噪后增益,噪音降低后增益把原声和降低的噪音又都放大了,效果是降噪不太明显,主声增大比较显著. 

可以尝试 降噪–增益–再降噪
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/03/直播/音频/音频播放中切换听筒和扬声器模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/03/直播/音频/音频播放中切换听筒和扬声器模式/" itemprop="url">音频播放中切换听筒和扬声器模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-03T14:52:14+08:00">
                2019-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/直播/" itemprop="url" rel="index">
                    <span itemprop="name">直播</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://blog.csdn.net/wl332197858/article/details/51298868" target="_blank" rel="noopener">音频播放中切换听筒和扬声器模式</a></p>
<h1 id="切换听筒和扬声器模式"><a href="#切换听筒和扬声器模式" class="headerlink" title="切换听筒和扬声器模式"></a>切换听筒和扬声器模式</h1><p>网上的版本都是对于5.0以下可以使用的，实测5.0及以上不能使用，系统没有提供权限给我们修改</p>
<pre><code>audioManager.setSpeakerphoneOn(false);//关闭扬声器  
audioManager.setRouting(AudioManager.MODE_NORMAL, AudioManager.ROUTE_EARPIECE, AudioManager.ROUTE_ALL);  
mediaPlayer.setAudioStreamType(AudioManager.STREAM_VOICE_CALL); 
audioManager.setMode(AudioManager.MODE_IN_CALL);  //把声音设定成Earpiece（听筒）出来，设定为正在通话中  

需要权限： android.permission.MODIFY_AUDIO_SETTINGS
</code></pre><p>兼容5.0及以上的版本分三个步骤</p>
<pre><code>1.播放音频流类型要设置为AudioManager.STREAM_VOICE_CALL
2.在播放前调用AudioSystem.setForceUse(AudioSystem.FOR_COMMUNICATION,AudioSystem.FORCE_NONE);
3.配置权限： android.permission.MODIFY_AUDIO_SETTINGS
</code></pre><p>代码如下：</p>
<pre><code>private void setSpeakerphoneOn(boolean on) {
    try {

        mediaPlayer.setAudioStreamType(AudioManager.STREAM_VOICE_CALL);

        Class audioSystemClass = Class.forName(&quot;android.media.AudioSystem&quot;);
        Method setForceUse = audioSystemClass.getMethod(&quot;setForceUse&quot;, int.class, int.class);

        if (on) {
            audioManager.setMicrophoneMute(false);
            audioManager.setSpeakerphoneOn(true);
            audioManager.setMode(AudioManager.MODE_NORMAL);
        } else {
            audioManager.setSpeakerphoneOn(false);
            audioManager.setMode(AudioManager.MODE_NORMAL);
            setForceUse.invoke(null, 0, 0);
            audioManager.setMode(AudioManager.MODE_IN_COMMUNICATION);
        }
    } catch (Exception e) {
        e.printStackTrace();
    }
}
</code></pre><h1 id="播放中切换"><a href="#播放中切换" class="headerlink" title="播放中切换"></a>播放中切换</h1><p>在播放声音过程中切换，是无法立即生效的，只有当调用 <code>mediaPlayer.prepare()</code> 后才起效</p>
<p>解决方案： 每次切换模式后，强制重新开始播放（微信就是从头开始播放）</p>
<pre><code>mediaPlayer.reset();
mediaPlayer.setDataSource(filePath);
mediaPlayer.prepare();
mediaPlayer.start();
</code></pre><h1 id="自动切换"><a href="#自动切换" class="headerlink" title="自动切换"></a><a href="http://blog.csdn.net/jjmm2009/article/details/37930449" target="_blank" rel="noopener">自动切换</a></h1><p>耳朵靠近时听筒播放，离开后扬声器播放</p>
<p>插入耳机耳机播放，拔出耳机扬声器播放</p>
<p>解决方案： </p>
<ol>
<li><p>利用<strong>距离感应器</strong>感应距离，当距离超过感应器最大距离（说明没有阻挡），就是扬声器播放</p>
<pre><code>SensorManager sensorManager = (SensorManager) context.getSystemService(Context.SENSOR_SERVICE);
final Sensor sensor = sensorManager.getDefaultSensor(Sensor.TYPE_PROXIMITY);
sensorManager.registerListener(new SensorEventListener() {
    @Override
    public void onSensorChanged(SensorEvent event) {
        if (isPlaying) {
            float range = event.values[0];
            if (range == sensor.getMaximumRange()) {
                Toast.makeText(context, &quot;正常模式&quot;, Toast.LENGTH_LONG).show();
                setSpeakerphoneOn(true);
            } else {
                Toast.makeText(context, &quot;听筒模式&quot;, Toast.LENGTH_LONG).show();
                setSpeakerphoneOn(false);
            }
            startPlayVoice(message.getLocalurl());
        }
    }

    @Override
    public void onAccuracyChanged(Sensor sensor, int accuracy) {

    }
}, sensor, SensorManager.SENSOR_DELAY_NORMAL);    
</code></pre></li>
<li><p><strong>耳机插拔广播接受者</strong></p>
<p> 监听广播 AudioManager.ACTION_AUDIO_BECOMING_NOISY和 android.intent.action.HEADSET_PLUG</p>
<pre><code>public class HeadsetPlugReceiver extends BroadcastReceiver {   
    @Override   
    public void onReceive(Context context, Intent intent) {   
        Log.i(&quot;NoisyAudioStreamReceiver=====================&gt;&quot;, &quot;change mode&quot;);  
        if (intent.hasExtra(&quot;state&quot;)){   
            if (intent.getIntExtra(&quot;state&quot;, 0) == 0){   
                Log.i(&quot;NoisyAudioStreamReceiver=====================&gt;headset not connected&quot;, &quot;change mode1&quot;);  
                audioManager.setMode(AudioManager.MODE_NORMAL);  
            }   
            else if (intent.getIntExtra(&quot;state&quot;, 0) == 1){   
                Log.i(&quot;NoisyAudioStreamReceiver=====================&gt;headset connected&quot;, &quot;change mode3&quot;);  
                audioManager.setMode(AudioManager.MODE_IN_CALL);  
            }   
        }   
    }   
} 

广播注册：
    myNoisyAudioStreamReceiver = new HeadsetPlugReceiver();  
    IntentFilter intentFilter = new IntentFilter(AudioManager.ACTION_AUDIO_BECOMING_NOISY);  
    intentFilter.addAction(&quot;android.intent.action.HEADSET_PLUG&quot;);  
    registerReceiver(myNoisyAudioStreamReceiver, intentFilter);    
</code></pre></li>
<li><p><strong>总结</strong></p>
<ul>
<li>耳机插拔可以不用监听，因为系统会自动处理（插入耳机用耳机，拔出耳机用扬声器）</li>
<li>添加了距离感应器切换扬声器和听筒后，系统自带的耳机插拔处理会失效<ul>
<li>原因：因为 距离感应器切换扬声器和听筒只有扬声器和听筒两种状态</li>
<li>解决：距离感应器增加判断，当有耳机插入时，什么也不做 <code>audioManager.isWiredHeadsetOn()</code></li>
</ul>
</li>
</ul>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/02/Android/TransactionTooLargeException错误/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/02/Android/TransactionTooLargeException错误/" itemprop="url">TransactionTooLargeException错误</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-02T17:54:53+08:00">
                2019-09-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="表现"><a href="#表现" class="headerlink" title="表现"></a>表现</h1><pre><code>TransactionTooLargeException: data parcel size 587588  bytes
</code></pre><h1 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h1><p><strong>Binder传递数据量过大</strong>    </p>
<p>进程内Binder缓冲区最大上限1M（进程内所有线程共享这块空间，实际上操作的线程内，数据超过200K都可能挂掉）</p>
<p>在6.0的源码 <code>/frameworks/base/core/jni/android_util_Binder.cpp</code>v中的 <code>signalExceptionForError</code> 函数里，对于 <code>FAILED_TRANSACTION</code> 这种错误的分支里，丢出了异常，不过还是有让人困惑的地方：传递的数据超过200K就要报错</p>
<h2 id="Activity状态Bundle"><a href="#Activity状态Bundle" class="headerlink" title="Activity状态Bundle"></a>Activity状态Bundle</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onSaveInstanceState</span><span class="params">(Bundle outState)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Activity跳转Intent"><a href="#Activity跳转Intent" class="headerlink" title="Activity跳转Intent"></a>Activity跳转Intent</h2><p>通过Intent传递数据，具体的大小限制不同版本的系统不同，比较普遍的一个看法是不能超过1MB，因为官方文档里有这样的说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">The Binder transaction failed because it was too large.</span><br><span class="line"></span><br><span class="line">During a remote procedure call, the arguments and the return value of the call are transferred as Parcel objects stored in the Binder transaction buffer. If the arguments or the return value are too large to fit in the transaction buffer, then the call will fail and TransactionTooLargeException will be thrown.</span><br><span class="line"></span><br><span class="line">The Binder transaction buffer has a limited fixed size, currently 1Mb, which is shared by all transactions in progress for the process. Consequently this exception can be thrown when there are many transactions in progress even when most of the individual transactions are of moderate size.</span><br></pre></td></tr></table></figure>
<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><h2 id="压缩数据量"><a href="#压缩数据量" class="headerlink" title="压缩数据量"></a>压缩数据量</h2><h2 id="使用其他方式传递数据"><a href="#使用其他方式传递数据" class="headerlink" title="使用其他方式传递数据"></a>使用其他方式传递数据</h2><ul>
<li>文件</li>
<li>EventBus</li>
</ul>
<h1 id="参考-amp-扩展"><a href="#参考-amp-扩展" class="headerlink" title="参考&amp;扩展"></a>参考&amp;扩展</h1><ul>
<li><a href="https://www.jianshu.com/p/044e2c318306" target="_blank" rel="noopener">Android TransactionTooLargeException 解析，思考与监控方案</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/31/web/wordpress/主题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/31/web/wordpress/主题/" itemprop="url">主题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-31T17:35:14+08:00">
                2019-08-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Flatsome"><a href="#Flatsome" class="headerlink" title="Flatsome"></a>Flatsome</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">requests数量：过多 90+</span><br><span class="line"></span><br><span class="line">电商主题</span><br></pre></td></tr></table></figure>
<h1 id="Avada"><a href="#Avada" class="headerlink" title="Avada"></a>Avada</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">功能：全面而强大</span><br><span class="line">编辑器：体验很好</span><br><span class="line">个性化设置：丰富</span><br><span class="line">requests数量：过多 120+</span><br><span class="line">服务器资源要求：高</span><br><span class="line"></span><br><span class="line">ThemeForest市场上最畅销的主题，但它并不是WordPress最畅销的主题。</span><br><span class="line">将Avada用于电子商务网站是在寻找麻烦。电子商务网站拥有更多的资源需求，需要精简高效且编码良好的主题。</span><br><span class="line">使用后端页面构建器，浪费很多时间在前端和后端切换验证每一个小变化；</span><br></pre></td></tr></table></figure>
<p><a href="http://libs.websoft9.com/apps/wordpress/wordpress5.0.2-avada5.7.2-en.tar.gz" target="_blank" rel="noopener">Websoft9 Avada5.7.2 官方原版下载</a></p>
<h1 id="Enfold"><a href="#Enfold" class="headerlink" title="Enfold"></a>Enfold</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">编辑器：体验很好;优于avada</span><br><span class="line">requests数量：50+</span><br><span class="line">个性化设置：略欠缺，需要custom css</span><br></pre></td></tr></table></figure>
<h1 id="Betheme"><a href="#Betheme" class="headerlink" title="Betheme"></a>Betheme</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">requests数量：40+</span><br><span class="line"></span><br><span class="line">WP主题 TOP5</span><br></pre></td></tr></table></figure>
<h1 id="Impreza"><a href="#Impreza" class="headerlink" title="Impreza"></a>Impreza</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">requests数量：30+</span><br><span class="line"></span><br><span class="line">最大的主题库themeforest 中的wordpress好评排名第一。</span><br><span class="line">推荐外贸建站的WordPress用户使用Impreza</span><br></pre></td></tr></table></figure>
<h1 id="GeneratePress"><a href="#GeneratePress" class="headerlink" title="GeneratePress"></a>GeneratePress</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">requests数量：40+；速度最快，谷歌速度分数：A（95％）</span><br><span class="line"></span><br><span class="line">轻量级主题</span><br></pre></td></tr></table></figure>
<h1 id="参考-amp-扩展"><a href="#参考-amp-扩展" class="headerlink" title="参考&amp;扩展"></a>参考&amp;扩展</h1><ul>
<li><a href="https://www.liaosam.com/wordpress-theme-avada-enfold-betheme.html/comment-page-1" target="_blank" rel="noopener">Avada &amp; Enfold &amp; Betheme：最棒的三个外贸建站英文主题</a></li>
<li><a href="https://www.imaiko.com/why-i-not-choose-avada.html" target="_blank" rel="noopener">为什么我不推荐Avada</a></li>
<li><a href="https://www.imaiko.com/avada-divi-impreza.html" target="_blank" rel="noopener">三个主题比较，Avada，Divi和Impreza</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/29/Android/APP弱网络测试工具/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/29/Android/APP弱网络测试工具/" itemprop="url">APP弱网络测试工具</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-29T15:40:53+08:00">
                2019-08-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>弱网络专项测试的方案主要有</p>
<h1 id="PC上使用抓包工具设置延时模拟弱网"><a href="#PC上使用抓包工具设置延时模拟弱网" class="headerlink" title="PC上使用抓包工具设置延时模拟弱网"></a>PC上使用抓包工具设置延时模拟弱网</h1><ul>
<li>在PC上的Fiddler在设置延时</li>
<li>将Android设备的网络代理到PC上</li>
</ul>
<h1 id="专有服务器上构建弱网络Wi-Fi"><a href="#专有服务器上构建弱网络Wi-Fi" class="headerlink" title="专有服务器上构建弱网络Wi-Fi"></a>专有服务器上构建弱网络Wi-Fi</h1><ul>
<li>在专有服务器上构建弱网络Wi-Fi</li>
<li>移动设备连接该Wi-Fi进行弱网络测试</li>
</ul>
<p>相关的技术方案有Facebook的ATC和腾讯的Wetest-WiFi;</p>
<h1 id="缺陷"><a href="#缺陷" class="headerlink" title="缺陷"></a>缺陷</h1><ul>
<li>需要额外的PC或者服务器，弱网环境构建成本高；</li>
<li>需要安装、部署额外的工具，并且弱网络环境需要在PC上或者Web上进行配置，使用成本高；</li>
<li>弱网络环境功能并不完善，比如Fiddler不支持丢包、抖动等弱网环境；</li>
</ul>
<h1 id="QNET"><a href="#QNET" class="headerlink" title="QNET"></a>QNET</h1><ul>
<li>无需ROOT手机，只需安装一个独立app</li>
<li>弱网模拟功能强大。2G，3G，4G，丢包，抖动</li>
<li>支持 TCP/UDP网络协议抓包，导出为Pcap文件</li>
</ul>
<h2 id="已知问题"><a href="#已知问题" class="headerlink" title="已知问题"></a>已知问题</h2><p>引起APP频繁刷新，某些生命周期相关的方法会频繁回调，可能引起ANR</p>
<h1 id="参考-amp-扩展"><a href="#参考-amp-扩展" class="headerlink" title="参考&amp;扩展"></a>参考&amp;扩展</h1><ul>
<li><a href="https://www.520mwx.com/view/53152" target="_blank" rel="noopener">QNET，一款给力的APP弱网络测试工具</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/20/web/Chrome诊断网页打开慢的原因/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/20/web/Chrome诊断网页打开慢的原因/" itemprop="url">Chrome诊断网页打开慢的原因</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-20T09:05:14+08:00">
                2019-08-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h1><ul>
<li>打开目标网页</li>
<li>打开开发者模式</li>
<li>右键浏览器的刷新按钮，选择 <code>清空缓存并硬性重新加载</code><ul>
<li>正常重新加载 Ctrl+R：正常重新加载。 </li>
<li>硬性重新加载：Ctrl+Shift+R:浅层次的清除历史记录，但不一定缓存完全清除。(Ctrl+F5)同理。 </li>
<li>清空缓存并硬性重新加载：可以深层次的清除所有的缓存。(建议用这个) </li>
</ul>
</li>
</ul>
<h1 id="诊断"><a href="#诊断" class="headerlink" title="诊断"></a>诊断</h1><p>上面流程加载完成后，开发者工具 <code>network</code> 标签如下</p>
<img src="/2019/08/20/web/Chrome诊断网页打开慢的原因/chrome-network.png"> 
<h2 id="重要指标"><a href="#重要指标" class="headerlink" title="重要指标"></a>重要指标</h2><p>底部展示了几个重要的指标</p>
<ul>
<li>请求成功数量/请求总数量</li>
<li>网页加载成功体积/网页总体积</li>
<li>资源加载成功体积/资源总体积</li>
<li>耗时</li>
</ul>
<h2 id="时间线-详细耗时信息"><a href="#时间线-详细耗时信息" class="headerlink" title="时间线-详细耗时信息"></a>时间线-详细耗时信息</h2><p>网记请求列表，默认是按时间顺序排序(waterfall瀑布)</p>
<p>找到耗时最长的几个请求</p>
<p>鼠标悬停某个请求的waterfall会弹窗展示耗时的详细信息，如下</p>
<img src="/2019/08/20/web/Chrome诊断网页打开慢的原因/time-detail.png"> 
<img src="/2019/08/20/web/Chrome诊断网页打开慢的原因/time-detail-2.png"> 
<h2 id="时间线各阶段指标"><a href="#时间线各阶段指标" class="headerlink" title="时间线各阶段指标"></a>时间线各阶段指标</h2><h3 id="Queueing-排队时间"><a href="#Queueing-排队时间" class="headerlink" title="Queueing(排队时间)"></a>Queueing(排队时间)</h3><p>如果某个请求正在排队，则指示：</p>
<ul>
<li>请求已被渲染引擎推迟<ul>
<li>因为该请求的优先级被视为低于关键资源（例如脚本/样式）的优先级。 </li>
<li>图像经常发生这种情况。</li>
</ul>
</li>
<li>请求已被暂停，以等待可复用的TCP连接。<ul>
<li>因为在 HTTP 1 上，浏览器仅允许每个源拥有六个 TCP 连接。</li>
</ul>
</li>
<li>生成磁盘缓存条目所用的时间（通常非常迅速）</li>
</ul>
<h3 id="Stalled-Blocking"><a href="#Stalled-Blocking" class="headerlink" title="Stalled/Blocking"></a>Stalled/Blocking</h3><p>浏览器得到要发出这个请求的指令，到请求可以发出的<strong>等待时间</strong></p>
<p>可以是等待 Queueing 中介绍的任何一个原因。 </p>
<p>此外，此时间包含代理协商所用的时间。</p>
<p>不包括DNS查询、建立TCP连接等时间。</p>
<h3 id="Proxy-Negotiation"><a href="#Proxy-Negotiation" class="headerlink" title="Proxy Negotiation"></a>Proxy Negotiation</h3><p>与代理服务器连接协商所用的时间。</p>
<h3 id="DNS-lookup"><a href="#DNS-lookup" class="headerlink" title="DNS lookup"></a>DNS lookup</h3><p>DNS解析所耗费的时间。</p>
<h3 id="Initial-connection"><a href="#Initial-connection" class="headerlink" title="Initial connection"></a>Initial connection</h3><p>用户建立连接的时间，包括TCP握手以及多次尝试握手，以及处理SSL的时间。</p>
<h3 id="SSL"><a href="#SSL" class="headerlink" title="SSL"></a>SSL</h3><p>完成SSL握手的时间。</p>
<h3 id="Request-sent"><a href="#Request-sent" class="headerlink" title="Request_sent"></a>Request_sent</h3><p>请求第一个字节发出到最后一个字节发出的时间，请求发出时间(一般可以忽略，否则即为浏览器本身或者本地网络问题)。</p>
<p>Waitting(TTFB)：请求发出后，到收到响应的第一个字节所花费的时间(Time To First Byte)，即请求从客户端发送给服务端时间+服务器处理请求的时间。</p>
<h3 id="Content-Download"><a href="#Content-Download" class="headerlink" title="Content Download"></a>Content Download</h3><p>接收到响应的第一个字节，到接收完最后一个字节的时间，就是下载响应所耗费的时间。</p>
<h2 id="诊断问题"><a href="#诊断问题" class="headerlink" title="诊断问题"></a>诊断问题</h2><h3 id="队列时间过长"><a href="#队列时间过长" class="headerlink" title="队列时间过长"></a>队列时间过长</h3><h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4><p>从单个网域检索太多的资源，即<strong>单个网域的请求数量过多</strong></p>
<p>在 HTTP 1.0/1.1 连接上，Chrome 会将每个主机强制设置为最多六个 TCP 连接。如果您一次请求十二个条目，前六个将开始，而后六个将被加入队列。</p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><h5 id="HTTP-1"><a href="#HTTP-1" class="headerlink" title="HTTP 1"></a>HTTP 1</h5><ul>
<li>合并 图片、css、js等一些可以合并的文件，来减少http的请求数</li>
<li>设置 <code>keep-alive</code> 可以在一定的时间内保证连接的可复用性，减少连接时间</li>
<li>实现域分片。也就是在您的应用上设置多个子域，以便提供资源。然后，在子域之间平均分配正在提供的资源。<ul>
<li>在浏览器最大并行下载数跟dns查找(也有耗时)之间做权衡。根据雅虎的研究，最好将主机名控制在2-4个内</li>
</ul>
</li>
</ul>
<h5 id="HTTP-2"><a href="#HTTP-2" class="headerlink" title="HTTP 2"></a>HTTP 2</h5><p>请不要对您的资源进行域分片</p>
<p>在 HTTP 2 中，到服务器的单个 TCP 连接作为多路复用连接。这消除了 HTTP 1 中的六个连接限制，并且可以通过单个连接同时传输多个资源。</p>
<h3 id="第一字节等待时间过长"><a href="#第一字节等待时间过长" class="headerlink" title="第一字节等待时间过长"></a>第一字节等待时间过长</h3><p>又称：大片绿色</p>
<p>将此值控制在 200 毫秒以下</p>
<h4 id="原因-1"><a href="#原因-1" class="headerlink" title="原因"></a>原因</h4><ol>
<li>客户端与服务器之间的网络条件较差</li>
<li><strong>服务器应用的响应慢</strong></li>
</ol>
<h4 id="解决方案-1"><a href="#解决方案-1" class="headerlink" title="解决方案"></a>解决方案</h4><p>将应用托管在本地，然后查看 TTFB 真实的响应速度。如果仍然很长，则需要优化应用的响应速度。可以是优化数据库查询、为特定部分的内容实现缓存，或者修改您的网络服务器配置。</p>
<h3 id="内容下载时间过长"><a href="#内容下载时间过长" class="headerlink" title="内容下载时间过长"></a>内容下载时间过长</h3><p>又称：大片蓝色。决定服务器吞吐能力</p>
<h4 id="原因-2"><a href="#原因-2" class="headerlink" title="原因"></a>原因</h4><p><strong>内容体积过大</strong></p>
<h4 id="解决方案-2"><a href="#解决方案-2" class="headerlink" title="解决方案"></a>解决方案</h4><ul>
<li>减少发送的字节数</li>
<li>压缩文件</li>
<li>启用本地缓存。把网站里面更新频率比较低的静态资源缓存在浏览器中</li>
<li>启用CDN加速。本质也是缓存，把内容缓存在离用户近的主机</li>
</ul>
<h1 id="参考-amp-扩展"><a href="#参考-amp-扩展" class="headerlink" title="参考&amp;扩展"></a>参考&amp;扩展</h1><ul>
<li><a href="https://help.aliyun.com/knowledge_detail/36453.html" target="_blank" rel="noopener">使用chrome浏览器排查网页打开慢的方法</a></li>
<li><a href="https://blog.csdn.net/shan1991fei/article/details/80690220" target="_blank" rel="noopener">Chrome Dev Tool 中时间线各阶段代表的意义</a></li>
<li><a href="https://www.liulanqi.com/239.html" target="_blank" rel="noopener">了解资源耗时 | Chrome F12 network</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/16/编程思想/Android端架构_MVP-Clean架构/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/16/编程思想/Android端架构_MVP-Clean架构/" itemprop="url">Android端架构_MVP-Clean架构</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-16T11:46:01+08:00">
                2019-08-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程思想/" itemprop="url" rel="index">
                    <span itemprop="name">编程思想</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Activity跳转"><a href="#Activity跳转" class="headerlink" title="Activity跳转"></a>Activity跳转</h1><p>Activity跳转是如何实现的</p>
<p><code>BaseActivity</code> 持有 <code>Navigator</code>，Activity A 调用 Navigator 相应的跳转方法。</p>
<p>每个Activity 都需要提供启动自己的Intent，而不是由Navigator构造</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Navigator</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">navigateToUserList</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (context != <span class="keyword">null</span>) &#123;</span><br><span class="line">      Intent intentToLaunch = UserListActivity.getCallingIntent(context);</span><br><span class="line">      context.startActivity(intentToLaunch);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserListActivity</span> <span class="keyword">extends</span> <span class="title">BaseActivity</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Intent <span class="title">getCallingIntent</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Intent(context, UserListActivity.class);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">navigator.navigateToUserList(<span class="keyword">this</span>);<span class="comment">//跳转到UserListActivity</span></span><br></pre></td></tr></table></figure>
<h1 id="完整的渲染数据过程"><a href="#完整的渲染数据过程" class="headerlink" title="完整的渲染数据过程"></a>完整的渲染数据过程</h1><p>以用户列表页为例</p>
<h2 id="presentation-表现层"><a href="#presentation-表现层" class="headerlink" title="presentation 表现层"></a>presentation 表现层</h2><h3 id="model"><a href="#model" class="headerlink" title="model"></a>model</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserModel</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="view"><a href="#view" class="headerlink" title="view"></a>view</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LoadDataView</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">showLoading</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">hideLoading</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">showRetry</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">hideRetry</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">showError</span><span class="params">(String message)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">Context <span class="title">context</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserListView</span> <span class="keyword">extends</span> <span class="title">LoadDataView</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Render a user list in the UI.</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">renderUserList</span><span class="params">(Collection&lt;UserModel&gt; userModelCollection)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//View a UserModel profile/details.</span></span><br><span class="line">  <span class="comment">//Presenter call this when click a UserModel</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">viewUser</span><span class="params">(UserModel userModel)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserListFragment</span> <span class="keyword">extends</span> <span class="title">BaseFragment</span> <span class="keyword">implements</span> <span class="title">UserListView</span> </span>&#123;</span><br><span class="line">  UserListPresenter userListPresenter;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onViewCreated</span><span class="params">(View view, Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onViewCreated(view, savedInstanceState);</span><br><span class="line">    <span class="keyword">this</span>.userListPresenter.setView(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">if</span> (savedInstanceState == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.loadUserList();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">renderUserList</span><span class="params">(Collection&lt;UserModel&gt; userModelCollection)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (userModelCollection != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.usersAdapter.setUsersCollection(userModelCollection);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">viewUser</span><span class="params">(UserModel userModel)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mActivity != <span class="keyword">null</span>) &#123;</span><br><span class="line">      mActivity.navigator.navigateToUserDetails(mActivity, userModel.getUserId());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">//Loads all users.</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loadUserList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.userListPresenter.loadUserList();</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="presenter"><a href="#presenter" class="headerlink" title="presenter"></a>presenter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserListPresenter</span> <span class="keyword">implements</span> <span class="title">Presenter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> UserListView viewListView;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> GetUserList getUserListUseCase;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> UserModelDataMapper userModelDataMapper;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">UserListPresenter</span><span class="params">(GetUserList getUserListUserCase,</span></span></span><br><span class="line"><span class="function"><span class="params">      UserModelDataMapper userModelDataMapper)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.getUserListUseCase = getUserListUserCase;</span><br><span class="line">    <span class="keyword">this</span>.userModelDataMapper = userModelDataMapper;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setView</span><span class="params">(@NonNull UserListView view)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.viewListView = view;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showUsersCollectionInView</span><span class="params">(Collection&lt;User&gt; usersCollection)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Collection&lt;UserModel&gt; userModelsCollection =</span><br><span class="line">        <span class="keyword">this</span>.userModelDataMapper.transform(usersCollection);</span><br><span class="line">    <span class="keyword">this</span>.viewListView.renderUserList(userModelsCollection);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getUserList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.getUserListUseCase.execute(<span class="keyword">new</span> UserListObserver(), <span class="keyword">null</span>);</span><br><span class="line">  &#125; </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">UserListObserver</span> <span class="keyword">extends</span> <span class="title">DefaultObserver</span>&lt;<span class="title">List</span>&lt;<span class="title">User</span>&gt;&gt; </span>&#123;<span class="comment">//DisposableObserver继承rxjava2的DisposableObserver</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      UserListPresenter.<span class="keyword">this</span>.hideViewLoading();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">      UserListPresenter.<span class="keyword">this</span>.hideViewLoading();</span><br><span class="line">      UserListPresenter.<span class="keyword">this</span>.showErrorMessage(<span class="keyword">new</span> DefaultErrorBundle((Exception) e));</span><br><span class="line">      UserListPresenter.<span class="keyword">this</span>.showViewRetry();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(List&lt;User&gt; users)</span> </span>&#123;</span><br><span class="line">      UserListPresenter.<span class="keyword">this</span>.showUsersCollectionInView(users);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="domain-领域层"><a href="#domain-领域层" class="headerlink" title="domain 领域层"></a>domain 领域层</h2><h3 id="entity"><a href="#entity" class="headerlink" title="entity"></a>entity</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Class that represents a User in the domain layer.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="interactor-use-case"><a href="#interactor-use-case" class="headerlink" title="interactor(use case)"></a>interactor(use case)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GetUserListUseCase</span> <span class="keyword">extends</span> <span class="title">UseCase</span>&lt;<span class="title">List</span>&lt;<span class="title">User</span>&gt;, <span class="title">Void</span>&gt; </span>&#123;</span><br><span class="line">	<span class="comment">//调用 data层的UserRepository</span></span><br><span class="line">	<span class="comment">//将可观察的用户列表，发射到上面presenter指定的观察者</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="data-数据层"><a href="#data-数据层" class="headerlink" title="data 数据层"></a>data 数据层</h2><h3 id="entity-1"><a href="#entity-1" class="headerlink" title="entity"></a>entity</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * User Entity used in the data layer.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserEntity</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="repository"><a href="#repository" class="headerlink" title="repository"></a>repository</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Interface that represents a Repository for getting &#123;<span class="doctag">@link</span> User&#125; related data.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserRepository</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="datasource"><a href="#datasource" class="headerlink" title="datasource"></a>datasource</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Interface that represents a data store from where data is retrieved.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDataStore</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CloudUserDataStore</span> <span class="keyword">implements</span> <span class="title">UserDataStore</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DiskUserDataStore</span> <span class="keyword">implements</span> <span class="title">UserDataStore</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Factory that creates different implementations of &#123;<span class="doctag">@link</span> UserDataStore&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDataStoreFactory</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="cache"><a href="#cache" class="headerlink" title="cache"></a>cache</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * An interface representing a user Cache.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserCache</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="net"><a href="#net" class="headerlink" title="net"></a>net</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RestApi for retrieving data from the network.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RestApi</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Dagger2"><a href="#Dagger2" class="headerlink" title="Dagger2"></a>Dagger2</h1><p>是否使用，这个具体问题具体分析。更多内容参考 Dagger2 文档</p>
<h1 id="参考-amp-扩展"><a href="#参考-amp-扩展" class="headerlink" title="参考&amp;扩展"></a>参考&amp;扩展</h1><ul>
<li><a href="https://github.com/android10/Android-CleanArchitecture" target="_blank" rel="noopener">实例源码</a>by Fernando Cejas (Fernando 大神)</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="风" />
            
              <p class="site-author-name" itemprop="name">风</p>
              <p class="site-description motion-element" itemprop="description">随心而动，随刃而行</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">315</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">72</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">风</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  







  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
